<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Ð Ñ‹Ð±Ð°Ð»ÐºÐ° ÐžÐ½Ð»Ð°Ð¹Ð½: Ð ÐµÐ±Ð¾Ñ€Ð½</title>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Neucha&display=swap" rel="stylesheet">
<style>
/* ============================================================
   ROOT VARIABLES
   ============================================================ */
:root {
  --wood-dark:   #2a1605;
  --wood-mid:    #4a2808;
  --wood-light:  #7a4e20;
  --plank:       #8a5520;
  --accent-gold: #d4a030;
  --coin:        #e8b830;
  --rope:        #7a6030;

  /* Sky / weather colors - animated by JS */
  --sky-top:    #020609;
  --sky-bot:    #081812;
  --water-top:  #0c3820;
  --water-bot:  #030e08;
  --amb-light:  rgba(0,0,0,0);

  /* Transition for weather */
  --wtrans: 4s;
}

/* ============================================================
   RESET & BASE
   ============================================================ */
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html {
  width:100%; height:100%;
  /* fill safe area on phones */
  background:#0d0905;
}
body {
  width:100%; height:100%;
  display:flex; justify-content:center; align-items:center;
  overflow:hidden; background:#0d0905;
  /* avoid iOS bounce */
  position:fixed; top:0; left:0;
}

/* ============================================================
   GAME WRAPPER â€” always 360Ã—700, scaled to fit screen
   ============================================================ */
#game-scale-wrapper {
  transform-origin: center center;
  /* JS sets transform: scale() */
}

#game {
  width:360px; height:700px;
  position:relative; overflow:hidden;
  border-radius:12px;
  border:5px solid var(--wood-dark);
  box-shadow:0 0 0 2px var(--wood-mid), 0 0 80px rgba(0,0,0,.95);
  background:#000;
}

/* ============================================================
   SCREEN SYSTEM
   ============================================================ */
.screen {
  position:absolute; inset:0;
  display:none; z-index:5;
  padding-bottom:60px; /* space for navtabs */
}
.screen.active { display:block; }

/* ============================================================
   STATUSBAR
   ============================================================ */
#statusbar {
  position:absolute; top:0; left:0; right:0; height:46px; z-index:200;
}
#statusbar-bg {
  position:absolute; inset:0;
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 20px,rgba(0,0,0,.07) 20px,rgba(0,0,0,.07) 22px),
    linear-gradient(to bottom,#a06030,#5a2e08);
  border-bottom:3px solid var(--wood-dark);
}
#statusbar-bg::after {
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(173deg,transparent 0,transparent 8px,rgba(0,0,0,.03) 8px,rgba(0,0,0,.03) 9px);
}
.s-nail {
  position:absolute; width:10px; height:10px;
  background:radial-gradient(circle at 35% 35%,#bbb,#444);
  border-radius:50%; border:1px solid #222;
  box-shadow:1px 1px 2px rgba(0,0,0,.6); z-index:5;
}
.s-nail.tl{top:8px;left:8px;} .s-nail.tr{top:8px;right:8px;}

#time-box {
  position:absolute; left:26px; top:9px;
  background:rgba(0,0,0,.5); border:1px solid var(--wood-dark); border-radius:4px;
  padding:4px 10px; font-family:'Neucha',cursive; font-size:14px; color:#e8c880;
  letter-spacing:1px; text-shadow:0 1px 3px rgba(0,0,0,.8); z-index:5;
  display:flex; align-items:center; gap:5px;
}
#weather-icon { font-size:16px; animation:weatherBob 2s ease-in-out infinite alternate; display:inline-block; }
@keyframes weatherBob { 0%{transform:translateY(0)} 100%{transform:translateY(-2px)} }

#coins-box {
  position:absolute; right:26px; top:9px;
  background:rgba(0,0,0,.5); border:1px solid #a07020; border-radius:4px;
  padding:4px 10px; font-family:'Neucha',cursive; font-size:14px; color:var(--coin);
  display:flex; align-items:center; gap:5px; text-shadow:0 1px 3px rgba(0,0,0,.8); z-index:5;
}
.coin-spin {
  font-size:16px; animation:coinSpin 4s ease-in-out infinite;
  display:inline-block; transform-style:preserve-3d;
}
@keyframes coinSpin {
  0%,40%{transform:rotateY(0)}
  50%{transform:rotateY(180deg)}
  60%,100%{transform:rotateY(360deg)}
}

/* ENERGY */
#energybar {
  position:absolute; top:46px; left:0; right:0; height:8px;
  background:rgba(0,0,0,.6); z-index:200; border-bottom:1px solid var(--wood-dark);
}
#energyfill {
  height:100%; width:65%;
  background:linear-gradient(to right,#1e5010,#4aaa20,#90e840);
  transition:width .5s; box-shadow:0 0 7px rgba(80,200,40,.5);
}

/* ============================================================
   FISHING SCENE â€” full screen from 54px to navtabs (640px)
   ============================================================ */
#fishing-screen {
  top:0; bottom:0; left:0; right:0;
  display:none; padding-bottom:0; /* custom layout */
}
#fishing-screen.active { display:block; }

/* SKY */
#sky {
  position:absolute;
  top:54px; left:0; right:0; bottom:42%;
  background:linear-gradient(to bottom, var(--sky-top) 0%, var(--sky-bot) 100%);
  transition:background var(--wtrans);
}
#sky-overlay {
  position:absolute; inset:0;
  background:var(--amb-light);
  transition:background var(--wtrans);
  pointer-events:none;
}

/* Stars container */
#stars { position:absolute; inset:0; pointer-events:none; }
.star {
  position:absolute; background:#fff; border-radius:50%;
  animation:twinkle var(--d,3s) ease-in-out infinite alternate;
  animation-delay:var(--delay,0s);
  transition:opacity 3s;
}
@keyframes twinkle { 0%{opacity:.15;transform:scale(.8)} 100%{opacity:1;transform:scale(1.3)} }

/* Moon */
#moon {
  position:absolute; top:20px; right:60px;
  transition:opacity 3s, top 4s;
}
#moon-circle {
  width:36px; height:36px;
  background:radial-gradient(circle at 40% 35%,#fffae0,#e8cc70,#b89030);
  border-radius:50%;
  box-shadow:0 0 25px rgba(220,180,60,.6),0 0 50px rgba(220,180,60,.2);
  animation:moonGlow 4s ease-in-out infinite alternate;
}
#moon-shadow { position:absolute; top:3px; left:11px; width:28px; height:28px; background:rgba(6,14,10,.6); border-radius:50%; }
@keyframes moonGlow {
  0%{box-shadow:0 0 18px rgba(220,180,60,.4),0 0 35px rgba(220,180,60,.15)}
  100%{box-shadow:0 0 30px rgba(220,180,60,.8),0 0 60px rgba(220,180,60,.35)}
}

/* Sun */
#sun {
  position:absolute; top:30px; left:60px;
  width:40px; height:40px;
  opacity:0; transition:opacity 3s, top 4s, left 4s;
}
#sun-circle {
  width:40px; height:40px;
  background:radial-gradient(circle at 40% 35%,#fff5a0,#ffd040,#ff8820);
  border-radius:50%;
  box-shadow:0 0 30px rgba(255,200,50,.8),0 0 70px rgba(255,160,30,.4);
  animation:sunPulse 5s ease-in-out infinite alternate;
}
#sun-rays {
  position:absolute; inset:-14px;
  animation:sunRotate 20s linear infinite;
}
#sun-rays::before, #sun-rays::after {
  content:''; position:absolute; left:50%; top:0;
  width:3px; height:14px; margin-left:-1.5px;
  background:rgba(255,200,50,.5); border-radius:2px;
  transform-origin:1.5px 34px;
}
#sun-rays::after { transform:rotate(45deg); }
@keyframes sunPulse {
  0%{box-shadow:0 0 25px rgba(255,200,50,.7),0 0 60px rgba(255,160,30,.3)}
  100%{box-shadow:0 0 40px rgba(255,220,60,.9),0 0 90px rgba(255,180,40,.5)}
}
@keyframes sunRotate { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

/* Extra sun rays via canvas-less approach */
.sun-ray {
  position:absolute; left:50%; top:50%;
  width:3px; height:18px;
  background:rgba(255,210,50,.4); border-radius:2px;
  transform-origin:1.5px -20px;
}

/* Clouds */
#clouds { position:absolute; inset:0; pointer-events:none; overflow:hidden; }
.cloud {
  position:absolute;
  background:rgba(200,220,240,.12);
  border-radius:50%;
  filter:blur(6px);
  animation:cloudDrift var(--cd,30s) linear infinite;
  animation-delay:var(--cdelay,0s);
  transition:opacity 3s;
}
@keyframes cloudDrift {
  0%{transform:translateX(-120px)}
  100%{transform:translateX(460px)}
}

/* Rain */
#rain-canvas {
  position:absolute; inset:0; pointer-events:none;
  opacity:0; transition:opacity 2s; z-index:8;
}

/* Mountains */
#mountains {
  position:absolute;
  bottom:0; left:0; right:0; height:200px;
  pointer-events:none;
}

/* Forest */
#forest {
  position:absolute;
  bottom:0; left:0; right:0; height:95px;
  overflow:hidden; pointer-events:none;
}
#forest svg { position:absolute; bottom:0; width:100%; height:95px; }

/* WATER */
#water {
  position:absolute;
  top:auto; bottom:60px; left:0; right:0;
  height:58%; /* water zone */
  overflow:hidden;
}
#water-bg {
  position:absolute; inset:0;
  background:linear-gradient(to bottom, var(--water-top) 0%, var(--water-bot) 100%);
  transition:background var(--wtrans);
}
#water-lines {
  position:absolute; inset:0;
  background:repeating-linear-gradient(to bottom,transparent 0,transparent 5px,rgba(25,90,50,.08) 5px,rgba(25,90,50,.08) 6px);
  animation:waterFlow 7s linear infinite;
}
@keyframes waterFlow { 0%{transform:translateY(0)} 100%{transform:translateY(6px)} }
#moon-reflection {
  position:absolute; top:4%; left:50%; transform:translateX(-28%);
  width:65px; height:130px;
  background:linear-gradient(to bottom,rgba(200,160,40,.4) 0%,rgba(200,160,40,.08) 60%,transparent 100%);
  border-radius:50%; filter:blur(5px);
  animation:reflWaver 3s ease-in-out infinite alternate;
  transition:opacity 3s;
}
#sun-reflection {
  position:absolute; top:3%; left:30%; transform:translateX(-20%);
  width:80px; height:150px;
  background:linear-gradient(to bottom,rgba(255,200,50,.35) 0%,rgba(255,180,30,.08) 60%,transparent 100%);
  border-radius:50%; filter:blur(6px);
  animation:reflWaver 4s ease-in-out infinite alternate;
  opacity:0; transition:opacity 3s;
}
@keyframes reflWaver {
  0%{transform:translateX(-20%) scaleX(1);opacity:.7}
  100%{transform:translateX(-20%) scaleX(1.4);opacity:1}
}
#water-shimmer {
  position:absolute; top:0; left:0; right:0; height:5px;
  background:linear-gradient(to right,transparent 0%,rgba(50,160,90,.35) 30%,rgba(110,210,140,.55) 50%,rgba(50,160,90,.35) 70%,transparent 100%);
  animation:shimmerMove 4s ease-in-out infinite alternate;
}
@keyframes shimmerMove { 0%{opacity:.4;transform:scaleX(.9)} 100%{opacity:1;transform:scaleX(1.05)} }

/* Fog */
#fog {
  position:absolute; bottom:60px; left:0; right:0; height:40%;
  background:linear-gradient(to top,rgba(150,180,160,.15) 0%,transparent 100%);
  pointer-events:none; opacity:0; transition:opacity 3s; z-index:9;
}

/* Swimming fish shadows */
.swimming-fish {
  position:absolute; pointer-events:none;
  animation:swimAcross var(--sd,12s) linear infinite;
  animation-delay:var(--sdelay,0s);
  opacity:.3;
}
@keyframes swimAcross {
  0%{transform:translateX(-60px) scaleX(1)}
  49%{transform:translateX(430px) scaleX(1)}
  50%{transform:translateX(430px) scaleX(-1)}
  100%{transform:translateX(-60px) scaleX(-1)}
}

/* Lily pads */
.lily { position:absolute; animation:lilyWobble 4s ease-in-out infinite alternate; pointer-events:none; }
@keyframes lilyWobble { 0%{transform:rotate(-3deg)} 100%{transform:rotate(3deg)} }

/* Fireflies */
.firefly {
  position:absolute; width:3px; height:3px; border-radius:50%;
  background:rgba(160,255,80,.9); box-shadow:0 0 6px rgba(160,255,80,.8);
  animation:fireflyFloat var(--fd,5s) ease-in-out infinite;
  animation-delay:var(--fdelay,0s);
  transition:opacity 3s;
}
@keyframes fireflyFloat {
  0%{transform:translate(0,0);opacity:.1}
  25%{transform:translate(var(--fx,10px),var(--fy,-8px));opacity:1}
  50%{transform:translate(var(--fx2,-5px),var(--fy2,-15px));opacity:.2}
  75%{transform:translate(var(--fx3,8px),var(--fy3,-5px));opacity:.9}
  100%{transform:translate(0,0);opacity:.1}
}

/* Birds */
.bird {
  position:absolute; font-size:14px; opacity:.5;
  animation:birdFly var(--bd,22s) linear infinite;
  animation-delay:var(--bdelay,0s);
  transition:opacity 3s;
}
@keyframes birdFly { 0%{transform:translateX(-40px)} 100%{transform:translateX(420px)} }

/* ============================================================
   DOCK
   ============================================================ */
#dock { position:absolute; bottom:60px; right:0; width:90px; height:75%; z-index:10; pointer-events:none; }
#dock svg { width:90px; height:100%; }

/* ============================================================
   FISHING ROD
   ============================================================ */
#rod-wrapper {
  position:absolute; bottom:60px; right:18px;
  width:35px; height:85%; z-index:15; pointer-events:none;
  transform-origin:bottom center;
  overflow:visible;
}
#rod-body {
  position:absolute; bottom:0; right:6px; width:7px; height:93%;
  background:linear-gradient(to right,#2e1804,#7a4e20,#4e2e10,#2e1804);
  border-radius:3px 2px 0 0; transform-origin:bottom center;
  box-shadow:2px 0 4px rgba(0,0,0,.5);
  transition:transform .3s ease-out, background .3s, box-shadow .3s;
  overflow:visible;
}
#rod-body.casting { animation:rodCast .55s ease-out forwards; }
@keyframes rodCast {
  0%{transform:rotate(0deg)}
  25%{transform:rotate(50deg)}
  60%{transform:rotate(-18deg)}
  100%{transform:rotate(-8deg)}
}
.rod-ring { position:absolute; right:-3px; width:13px; height:3px; background:linear-gradient(to right,#888,#ccc,#888); border-radius:2px; }
#rod-reel { position:absolute; bottom:22%; right:-2px; width:30px; height:22px; }
#rod-reel svg { transition:transform .1s; }
#rod-reel svg.spinning { animation:reelSpin .25s linear infinite; }
@keyframes reelSpin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

/* ROD 2 */
#rod-wrapper2 {
  position:absolute; bottom:60px; left:18px;
  width:35px; height:85%; z-index:15; pointer-events:none;
  transform-origin:bottom center; transform:scaleX(-1);
}
#rod-body2 {
  position:absolute; bottom:0; left:6px; width:7px; height:93%;
  background:linear-gradient(to right,#2e1804,#60a040,#3e2810,#2e1804);
  border-radius:3px 2px 0 0; transform-origin:bottom center;
  box-shadow:2px 0 4px rgba(0,0,0,.5);
}


#linecanvas { position:absolute; top:54px; left:0; width:100%; bottom:60px; pointer-events:none; z-index:16; }

/* ============================================================
   BOBBER
   ============================================================ */
#bobber-wrap {
  position:absolute; width:20px; height:48px;
  display:none; z-index:20;
  transform:translate(-50%,-50%); pointer-events:none;
}
#bobber-top {
  width:10px; height:28px; margin:0 auto;
  background:linear-gradient(to right,#aa1010,#ee2222,#aa1010);
  border-radius:5px 5px 2px 2px;
  box-shadow:0 0 6px rgba(200,20,20,.5); position:relative;
}
#bobber-antenna {
  position:absolute; top:-13px; left:50%; transform:translateX(-50%);
  width:2px; height:14px; background:linear-gradient(to bottom,#888,#555); border-radius:1px;
}
#bobber-antenna::after {
  content:''; position:absolute; top:-3px; left:-2px; width:6px; height:6px;
  background:radial-gradient(circle at 40% 35%,#ff6666,#cc0000);
  border-radius:50%; box-shadow:0 0 5px rgba(255,50,50,.9);
}
#bobber-bottom {
  width:10px; height:20px; margin:0 auto;
  background:linear-gradient(to right,#aa8800,#ffdd00,#aa8800);
  border-radius:2px 2px 5px 5px; box-shadow:0 0 4px rgba(200,160,0,.4);
}
#bobber-ring {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  width:28px; height:8px; border-radius:50%; border:1px solid rgba(80,200,120,.4);
}
@keyframes floatBob {
  0%{transform:translate(-50%,-50%) translateY(0)}
  50%{transform:translate(-50%,-50%) translateY(-5px)}
  100%{transform:translate(-50%,-50%) translateY(0)}
}
@keyframes floatBite {
  0%{transform:translate(-50%,-50%) translateY(0)}
  15%{transform:translate(-50%,-50%) translateY(22px)}
  30%{transform:translate(-50%,-50%) translateY(-5px)}
  50%{transform:translate(-50%,-50%) translateY(18px)}
  65%{transform:translate(-50%,-50%) translateY(-4px)}
  100%{transform:translate(-50%,-50%) translateY(16px)}
}

/* Ripples */
.ripple {
  position:absolute; border-radius:50%; pointer-events:none;
  border:1px solid rgba(60,180,100,.5);
  animation:rippleOut 1.8s ease-out forwards;
  transform:translate(-50%,-60%) scale(0);
}
@keyframes rippleOut {
  0%{transform:translate(-50%,-60%) scale(0);opacity:.8}
  100%{transform:translate(-50%,-60%) scale(1);opacity:0}
}

/* ============================================================
   STATS OVERLAY (fishing screen)
   ============================================================ */
#stats {
  position:absolute; top:60px; left:8px; z-index:80; pointer-events:none;
}
.stat-plank {
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 14px,rgba(0,0,0,.06) 14px,rgba(0,0,0,.06) 15px),
    linear-gradient(to bottom,var(--plank),var(--wood-mid));
  border:2px solid var(--wood-dark); border-radius:4px;
  padding:4px 10px; margin-bottom:5px;
  font-family:'Neucha',cursive; font-size:13px; color:#f0d898;
  text-shadow:0 1px 2px rgba(0,0,0,.7); box-shadow:1px 2px 4px rgba(0,0,0,.5);
  position:relative;
}
.stat-plank::before,.stat-plank::after {
  content:''; position:absolute; top:50%; transform:translateY(-50%);
  width:5px; height:5px; background:radial-gradient(circle at 35% 35%,#bbb,#555); border-radius:50%;
}
.stat-plank::before{left:3px;} .stat-plank::after{right:3px;}

/* WEATHER BADGE */
#weather-badge {
  position:absolute; top:60px; right:8px; z-index:80;
  background:rgba(0,0,0,.45); border:1px solid var(--wood-mid);
  border-radius:8px; padding:4px 8px;
  font-family:'Neucha',cursive; font-size:11px; color:#c8d0b0;
  text-align:center; pointer-events:none;
  animation:badgePop .4s ease-out;
}
@keyframes badgePop { 0%{transform:scale(0)} 60%{transform:scale(1.1)} 100%{transform:scale(1)} }

/* ROD NAME */
#current-rod-name {
  position:absolute; bottom:155px; left:50%; transform:translateX(-50%);
  font-family:'Neucha',cursive; font-size:11px; color:#c8a060;
  text-shadow:0 1px 2px rgba(0,0,0,.8); white-space:nowrap; z-index:201; pointer-events:none;
}
#current-rod-stats {
  position:absolute; bottom:142px; left:50%; transform:translateX(-50%);
  font-family:'Neucha',cursive; font-size:9px; color:#a0c8e0;
  text-shadow:0 1px 2px rgba(0,0,0,.9); white-space:nowrap; z-index:201; pointer-events:none;
  opacity:0.85;
}

/* CAST HINT */
#cast-hint {
  position:absolute; bottom:148px; left:50%; transform:translateX(-50%);
  font-family:'Neucha',cursive; font-size:14px; color:rgba(200,180,120,.85);
  text-shadow:0 1px 3px rgba(0,0,0,.9); white-space:nowrap;
  pointer-events:none; z-index:50;
  animation:hintPulse 2s ease-in-out infinite alternate;
}
@keyframes hintPulse { 0%{opacity:.35} 100%{opacity:1} }

/* BITE INDICATOR */
#bite-indicator {
  position:absolute; top:66px; left:50%;
  transform:translateX(-50%) scale(0); z-index:150; cursor:pointer;
  transition:transform .25s cubic-bezier(0.34,1.56,0.64,1);
}
#bite-indicator.visible { transform:translateX(-50%) scale(1); }
#bite-plank {
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 12px,rgba(0,0,0,.06) 12px,rgba(0,0,0,.06) 13px),
    linear-gradient(to bottom,#c04010,#902808);
  border:2px solid #601a04; border-radius:6px;
  padding:8px 20px; font-family:'Neucha',cursive; font-size:17px; color:#ffe0a0;
  text-shadow:0 1px 3px rgba(0,0,0,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.6),0 0 20px rgba(200,50,10,.4);
  animation:biteShake .4s ease-in-out infinite alternate; letter-spacing:1px;
}
@keyframes biteShake {
  0%{transform:rotate(-1.5deg);box-shadow:0 4px 12px rgba(0,0,0,.6),0 0 20px rgba(200,50,10,.4)}
  100%{transform:rotate(1.5deg);box-shadow:0 4px 12px rgba(0,0,0,.6),0 0 38px rgba(200,80,10,.9)}
}

/* Score pop */
.score-pop {
  position:absolute; font-family:'Neucha',cursive; font-size:18px;
  color:var(--accent-gold); text-shadow:0 2px 4px rgba(0,0,0,.8);
  pointer-events:none; z-index:100; animation:scoreFly 1.8s ease-out forwards;
}
@keyframes scoreFly {
  0%{opacity:1;transform:translateY(0) scale(1)}
  100%{opacity:0;transform:translateY(-70px) scale(1.5)}
}

/* ============================================================
   TOOLBAR (fishing screen)
   ============================================================ */
#toolbar {
  position:absolute; bottom:60px; left:0; right:0; height:80px;
  z-index:200; overflow:hidden; display:flex; align-items:center; justify-content:center; gap:16px;
}
#toolbar-bg {
  position:absolute; inset:0;
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 22px,rgba(0,0,0,.07) 22px,rgba(0,0,0,.07) 24px),
    linear-gradient(to bottom,var(--plank),var(--wood-mid));
  border-top:3px solid var(--wood-dark); border-bottom:2px solid var(--wood-dark);
}
#toolbar-bg::after {
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(178deg,transparent 0,transparent 8px,rgba(0,0,0,.03) 8px,rgba(0,0,0,.03) 9px);
}
.tnail { position:absolute; width:10px; height:10px; background:radial-gradient(circle at 35% 35%,#bbb,#444); border-radius:50%; border:1px solid #222; top:10px; z-index:5; }

.tool-btn { width:58px; height:58px; border-radius:50%; position:relative; cursor:pointer; transition:transform .15s; z-index:2; flex-shrink:0; }
.tool-btn:active{transform:scale(.9);}
.tool-btn svg{width:58px;height:58px;}
.tool-btn-ring { position:absolute; inset:-4px; border-radius:50%; border:3px solid var(--wood-dark); pointer-events:none; transition:border-color .2s,box-shadow .2s; }
.tool-btn.active .tool-btn-ring { border-color:#80cc30; box-shadow:0 0 14px rgba(100,220,40,.7); }

/* Animated tool icons */
@keyframes toolWiggle { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-8deg)} 75%{transform:rotate(8deg)} }
@keyframes toolBounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-4px)} }
@keyframes toolSpin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
@keyframes toolPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.12)} }
@keyframes toolShine { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.4)} }

.tool-icon-rod { animation:toolWiggle 3s ease-in-out infinite; transform-origin:bottom center; }
.tool-icon-bait { animation:toolBounce 1.8s ease-in-out infinite; }
.tool-icon-lure { animation:toolSpin 5s linear infinite; }

/* ============================================================
   CATCH POPUP
   ============================================================ */
#catch-popup {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%) scale(0) rotate(-5deg);
  z-index:300; transition:transform .4s cubic-bezier(0.34,1.56,0.64,1); width:250px;
}
#catch-popup.show { transform:translate(-50%,-50%) scale(1) rotate(0deg); }
#catch-board {
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 20px,rgba(0,0,0,.05) 20px,rgba(0,0,0,.05) 22px),
    linear-gradient(to bottom,var(--plank),var(--wood-mid),var(--plank));
  border:4px solid var(--wood-dark); border-radius:8px;
  padding:20px 24px 16px; box-shadow:0 8px 30px rgba(0,0,0,.9),inset 0 1px 0 rgba(255,255,255,.08);
  position:relative;
}
#catch-board::before {
  content:''; position:absolute; top:-24px; left:50%; transform:translateX(-50%);
  width:3px; height:24px; background:linear-gradient(to bottom,var(--rope),var(--wood-dark)); border-radius:2px;
}
.board-nail { position:absolute; width:9px; height:9px; background:radial-gradient(circle at 35% 35%,#bbb,#444); border-radius:50%; border:1px solid #222; }
.board-nail.tl{top:6px;left:8px;} .board-nail.tr{top:6px;right:8px;} .board-nail.bl{bottom:6px;left:8px;} .board-nail.br{bottom:6px;right:8px;}
#catch-header { font-family:'UnifrakturMaguntia',cursive; font-size:20px; color:var(--accent-gold); text-align:center; text-shadow:0 2px 4px rgba(0,0,0,.7); margin-bottom:12px; border-bottom:2px solid var(--wood-dark); padding-bottom:8px; }
#catch-fish-svg { display:block; margin:10px auto; animation:fishWigglePop .6s ease-in-out infinite alternate; }
@keyframes fishWigglePop { 0%{transform:rotate(-8deg) scaleX(1)} 100%{transform:rotate(8deg) scaleX(1.05)} }
@keyframes fishBlink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes finWave{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(15deg)}}
@keyframes fishWiggle{0%,100%{transform:rotate(-3deg) scaleX(1)}25%{transform:rotate(3deg) scaleX(1.05)}50%{transform:rotate(-2deg) scaleX(.98)}75%{transform:rotate(4deg) scaleX(1.03)}}
@keyframes marbleSplashAnim{0%{transform:scale(1) translateY(0);opacity:1}100%{transform:scale(0.2) translateY(-40px);opacity:0}}
@keyframes marbleRodGlow{0%{opacity:.9}100%{opacity:1;filter:drop-shadow(0 0 6px rgba(200,180,255,.7))}}
#catch-name-txt { font-family:'Neucha',cursive; font-size:20px; color:#f5e0a0; text-align:center; text-shadow:0 1px 3px rgba(0,0,0,.7); margin-top:6px; }
#catch-weight-txt { font-family:'Neucha',cursive; font-size:13px; color:#c8b070; text-align:center; margin-top:4px; }
#catch-rarity { font-family:'Neucha',cursive; font-size:12px; text-align:center; margin-top:3px; padding:2px 8px; border-radius:8px; display:inline-block; width:100%; }
.rarity-common{color:#a8b8a0;} .rarity-rare{color:#60a8ff;} .rarity-epic{color:#d060ff;} .rarity-legend{color:#ff9030;text-shadow:0 0 10px rgba(255,140,30,.8);animation:legendGlow 1s ease-in-out infinite alternate;}
@keyframes legendGlow{0%{text-shadow:0 0 8px rgba(255,140,30,.6)}100%{text-shadow:0 0 20px rgba(255,180,50,1)}}
.catch-btns { display:flex; gap:8px; margin-top:14px; }
.catch-btn { flex:1; border:2px solid; border-radius:18px; padding:7px 10px; font-family:'Neucha',cursive; font-size:14px; cursor:pointer; text-shadow:0 1px 2px rgba(0,0,0,.6); box-shadow:0 3px 8px rgba(0,0,0,.5); transition:transform .1s; text-align:center; animation:btnPop .3s ease-out; }
@keyframes btnPop { 0%{transform:scale(0)} 60%{transform:scale(1.08)} 100%{transform:scale(1)} }
.catch-btn:active{transform:scale(.95);}
.btn-keep { background:linear-gradient(to bottom,#4a7a28,#2a5010); border-color:#1a3808; color:#d4f090; }
.btn-sell-pop { background:linear-gradient(to bottom,#7a5a18,#4a3008); border-color:#2a1808; color:#f0d060; }

/* ============================================================
   NAV TABS
   ============================================================ */
#navtabs {
  position:absolute; bottom:0; left:0; right:0; height:60px; z-index:300;
  display:flex;
}
.navtab {
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
  font-family:'Neucha',cursive; font-size:11px; color:#c8a050; cursor:pointer; gap:3px;
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 18px,rgba(0,0,0,.06) 18px,rgba(0,0,0,.06) 19px),
    linear-gradient(to bottom,#7a4818,#4a2808);
  border-top:3px solid var(--wood-dark); border-right:1px solid var(--wood-dark);
  transition:all .15s; position:relative; text-shadow:0 1px 2px rgba(0,0,0,.8);
}
.navtab:last-child{border-right:none;}
.navtab.active { background:repeating-linear-gradient(90deg,transparent 0,transparent 18px,rgba(0,0,0,.06) 18px,rgba(0,0,0,.06) 19px),linear-gradient(to bottom,#a06828,#6a3810); color:#f0d878; box-shadow:0 -3px 0 #d4a030 inset; }
.navtab svg { width:22px; height:22px; transition:transform .2s; }
.navtab:hover svg { transform:scale(1.15); }
.navtab.active svg { animation:navIconBounce .4s ease-out; }
@keyframes navIconBounce { 0%{transform:scale(.8)} 60%{transform:scale(1.2)} 100%{transform:scale(1)} }

/* ============================================================
   SHOP SCREEN
   ============================================================ */
#shop-screen {
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 22px,rgba(0,0,0,.04) 22px,rgba(0,0,0,.04) 24px),
    linear-gradient(to bottom,#3a1e08 0%,#1e0e04 100%);
  display:none; flex-direction:column; overflow:hidden;
  top:0; padding-bottom:0;
}
#shop-screen.active { display:flex; }
.shop-header {
  height:66px; flex-shrink:0; position:relative;
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 20px,rgba(0,0,0,.07) 20px,rgba(0,0,0,.07) 22px),
    linear-gradient(to bottom,#8a5522,#4a2808);
  border-bottom:4px solid var(--wood-dark);
  display:flex; align-items:center; justify-content:center;
}
.shop-header::before,.shop-header::after { content:''; position:absolute; bottom:-4px; width:40%; height:3px; background:linear-gradient(to right,transparent,var(--accent-gold),transparent); }
.shop-header::before{left:0;} .shop-header::after{right:0;}
.shop-title { font-family:'UnifrakturMaguntia',cursive; font-size:26px; color:var(--accent-gold); text-shadow:0 2px 6px rgba(0,0,0,.8),0 0 20px rgba(200,150,30,.4); letter-spacing:2px; animation:shopTitleGlow 3s ease-in-out infinite alternate; }
@keyframes shopTitleGlow { 0%{text-shadow:0 2px 6px rgba(0,0,0,.8),0 0 10px rgba(200,150,30,.3)} 100%{text-shadow:0 2px 6px rgba(0,0,0,.8),0 0 30px rgba(200,150,30,.7)} }

.shop-banner { flex-shrink:0; padding:8px 10px 0; display:flex; gap:6px; overflow-x:auto; scrollbar-width:none; }
.shop-banner::-webkit-scrollbar{display:none;}
.shop-tab { font-family:'Neucha',cursive; font-size:12px; padding:5px 12px; border-radius:14px; cursor:pointer; border:2px solid var(--wood-mid); color:#c8a060; white-space:nowrap; transition:all .2s; background:rgba(0,0,0,.35); flex-shrink:0; }
.shop-tab.active { background:linear-gradient(to bottom,#7a4818,#4a2808); border-color:var(--accent-gold); color:#f0d878; box-shadow:0 0 8px rgba(200,160,30,.4); }
.shop-tab:active{transform:scale(.95);}

.shop-body { flex:1; overflow-y:auto; padding:8px 10px 70px; scrollbar-width:thin; scrollbar-color:var(--wood-mid) transparent; }
.shop-body::-webkit-scrollbar{width:5px;} .shop-body::-webkit-scrollbar-thumb{background:var(--wood-mid);border-radius:3px;}

.shop-item {
  display:flex; align-items:center; gap:10px;
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 18px,rgba(0,0,0,.04) 18px,rgba(0,0,0,.04) 19px),
    linear-gradient(to bottom,rgba(90,50,15,.85),rgba(50,25,6,.95));
  border:2px solid var(--wood-dark); border-radius:8px;
  padding:9px 10px; margin-bottom:9px; position:relative; overflow:visible;
  box-shadow:0 2px 8px rgba(0,0,0,.5);
  animation:itemSlideIn .3s ease-out;
  flex-wrap:nowrap;
}
@keyframes itemSlideIn { 0%{opacity:0;transform:translateX(-10px)} 100%{opacity:1;transform:translateX(0)} }
.shop-item::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(to right,transparent,rgba(200,160,60,.3),transparent); }
.shop-item.owned { border-color:#4a7a18; }
.shop-item.equipped { border-color:#80cc30; box-shadow:0 2px 8px rgba(0,0,0,.5),0 0 14px rgba(100,220,40,.35); }
.shop-item-icon { width:52px; height:52px; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
.shop-item-icon svg { animation:iconFloat 2.5s ease-in-out infinite alternate; }
@keyframes iconFloat { 0%{transform:translateY(0)} 100%{transform:translateY(-4px)} }
.shop-item-icon .icon-jar svg { animation:iconSpin 6s linear infinite; }
@keyframes iconSpin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
.shop-item-info { flex:1; min-width:0; }
.shop-item-name { font-family:'Neucha',cursive; font-size:14px; color:#f0d090; text-shadow:0 1px 2px rgba(0,0,0,.7); }
.shop-item-desc { font-family:'Neucha',cursive; font-size:10px; color:#a09060; margin-top:1px; }
.shop-item-stats { font-family:'Neucha',cursive; font-size:11px; color:#80b050; margin-top:2px; }
.shop-item-price { display:flex; align-items:center; gap:4px; font-family:'Neucha',cursive; font-size:12px; color:var(--coin); margin-top:3px; }
.shop-item-btn { font-family:'Neucha',cursive; font-size:12px; padding:5px 10px; border-radius:10px; cursor:pointer; border:2px solid; flex-shrink:0; transition:transform .12s,filter .12s; text-shadow:0 1px 2px rgba(0,0,0,.6); box-shadow:0 2px 5px rgba(0,0,0,.4); white-space:nowrap; }
.shop-item-btn:active{transform:scale(.93);}
.shop-item-btn:hover{filter:brightness(1.15);}
.btn-buy-shop { background:linear-gradient(to bottom,#6a8a30,#3a5010); border-color:#2a3808; color:#d0f060; }
.btn-equip-shop { background:linear-gradient(to bottom,#3a6a20,#1a4008); border-color:#0a2804; color:#a0e060; }
.btn-owned-shop { background:rgba(0,0,0,.3); border-color:#3a3828; color:#706858; cursor:default; }
.btn-equipped-shop { background:linear-gradient(to bottom,#204a10,#103008); border-color:#80cc30; color:#80cc30; cursor:default; }

/* ============================================================
   INVENTORY SCREEN
   ============================================================ */
#inventory-screen {
  background:
    repeating-linear-gradient(90deg,transparent 0,transparent 22px,rgba(0,0,0,.04) 22px,rgba(0,0,0,.04) 24px),
    linear-gradient(to bottom,#3a1e08 0%,#1e0e04 100%);
  display:none; flex-direction:column; overflow:hidden;
  top:0; padding-bottom:0;
}
#inventory-screen.active { display:flex; }
.inv-header { height:66px; flex-shrink:0; background:repeating-linear-gradient(90deg,transparent 0,transparent 20px,rgba(0,0,0,.07) 20px,rgba(0,0,0,.07) 22px),linear-gradient(to bottom,#8a5522,#4a2808); border-bottom:4px solid var(--wood-dark); display:flex; align-items:center; justify-content:center; gap:12px; }
.inv-title { font-family:'UnifrakturMaguntia',cursive; font-size:26px; color:var(--accent-gold); text-shadow:0 2px 6px rgba(0,0,0,.8); letter-spacing:2px; }
.inv-total-badge { background:rgba(0,0,0,.45); border:1px solid var(--accent-gold); border-radius:8px; padding:3px 10px; font-family:'Neucha',cursive; font-size:12px; color:var(--coin); }
.inv-body { flex:1; overflow-y:auto; padding:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:8px; align-content:start; scrollbar-width:thin; scrollbar-color:var(--wood-mid) transparent; }
.inv-body::-webkit-scrollbar{width:5px;} .inv-body::-webkit-scrollbar-thumb{background:var(--wood-mid);border-radius:3px;}
.inv-slot { background:repeating-linear-gradient(45deg,transparent 0,transparent 6px,rgba(0,0,0,.03) 6px,rgba(0,0,0,.03) 7px),rgba(30,14,4,.85); border:2px solid var(--wood-mid); border-radius:8px; padding:7px; display:flex; flex-direction:column; align-items:center; gap:3px; min-height:88px; position:relative; cursor:pointer; transition:border-color .2s,transform .1s; }
.inv-slot:active{transform:scale(.95);}
.inv-slot:hover:not(.empty){ border-color:#d4a030; }
.inv-slot.empty { opacity:.4; cursor:default; }
.inv-fish-name { font-family:'Neucha',cursive; font-size:11px; color:#d4b060; text-align:center; text-shadow:0 1px 2px rgba(0,0,0,.7); line-height:1.2; }
.inv-fish-weight { font-family:'Neucha',cursive; font-size:10px; color:#908060; text-align:center; }
.inv-coins-small { font-family:'Neucha',cursive; font-size:10px; color:var(--coin); text-align:center; }
.inv-fish-svg { animation:fishSlot 2s ease-in-out infinite alternate; display:block; }
@keyframes fishSlot { 0%{transform:rotate(-5deg)} 100%{transform:rotate(5deg)} }
.sell-all-btn { margin:10px; background:linear-gradient(to bottom,#8a5a18,#5a3008); border:2px solid #3a1808; border-radius:18px; padding:10px; font-family:'Neucha',cursive; font-size:15px; color:#f0d060; text-align:center; cursor:pointer; text-shadow:0 1px 3px rgba(0,0,0,.7); box-shadow:0 3px 10px rgba(0,0,0,.5); transition:transform .1s,filter .1s; flex-shrink:0; animation:sellBtnGlow 2s ease-in-out infinite alternate; }
.sell-all-btn:active{transform:scale(.95);}
@keyframes sellBtnGlow { 0%{box-shadow:0 3px 10px rgba(0,0,0,.5)} 100%{box-shadow:0 3px 14px rgba(200,150,30,.5)} }

/* ============================================================
   MULTIPLAYER / ONLINE SCREEN
   ============================================================ */
#multi-screen {
  background:linear-gradient(to bottom,#080c20 0%,#040810 100%);
  display:none; flex-direction:column; align-items:flex-start;
  overflow:hidden; overflow-y:auto; top:0; padding-bottom:60px; padding-top:54px;
}
#multi-screen.active { display:flex; }
.multi-header { width:100%; padding:12px 16px 6px; font-family:'UnifrakturMaguntia',cursive; font-size:22px; color:#8090ff; text-shadow:0 0 16px rgba(100,120,255,.7); }
.multi-section { width:100%; padding:8px 16px; }
.multi-section-title { font-family:'Neucha',cursive; font-size:13px; color:#5060a0; margin-bottom:6px; text-transform:uppercase; letter-spacing:1px; }
.multi-toggle-row { display:flex; align-items:center; justify-content:space-between; background:rgba(80,100,255,.1); border:1.5px solid rgba(100,120,255,.2); border-radius:12px; padding:12px 14px; margin-bottom:8px; }
.multi-toggle-label { font-family:'Neucha',cursive; font-size:14px; color:#9090d0; }
.multi-toggle-desc { font-family:'Neucha',cursive; font-size:11px; color:#4050a0; margin-top:2px; }
.toggle-switch { position:relative; width:44px; height:24px; flex-shrink:0; }
.toggle-switch input { opacity:0; width:0; height:0; }
.toggle-slider { position:absolute; cursor:pointer; inset:0; background:#1a1a3a; border-radius:24px; border:1.5px solid #3040a0; transition:.3s; }
.toggle-slider:before { content:''; position:absolute; height:18px; width:18px; left:2px; bottom:2px; background:#4050a0; border-radius:50%; transition:.3s; }
.toggle-switch input:checked + .toggle-slider { background:rgba(80,140,255,.3); border-color:#6080ff; }
.toggle-switch input:checked + .toggle-slider:before { transform:translateX(20px); background:#6080ff; box-shadow:0 0 8px rgba(100,150,255,.8); }
.multi-player-card { display:flex; align-items:center; gap:10px; background:rgba(50,70,180,.12); border:1.5px solid rgba(80,110,255,.2); border-radius:12px; padding:10px 14px; margin-bottom:8px; }
.player-avatar { width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#4060c0,#8090ff); display:flex; align-items:center; justify-content:center; font-size:18px; border:2px solid rgba(100,140,255,.4); }
.player-info { flex:1; }
.player-name { font-family:'Neucha',cursive; font-size:14px; color:#b0b8f0; }
.player-status { font-family:'Neucha',cursive; font-size:11px; color:#5060a0; margin-top:1px; }
.player-location-badge { font-family:'Neucha',cursive; font-size:10px; color:#7080d0; background:rgba(80,100,255,.15); border-radius:8px; padding:2px 8px; display:flex; align-items:center; gap:4px; }
.multi-fish-parade { position:absolute; bottom:70px; left:0; right:0; height:55px; overflow:hidden; }
.multi-shared-stats { display:grid; grid-template-columns:1fr 1fr 1fr; gap:6px; margin-bottom:8px; }
.shared-stat { background:rgba(80,100,200,.12); border:1.5px solid rgba(100,120,255,.15); border-radius:10px; padding:8px; text-align:center; }
.shared-stat-val { font-family:'UnifrakturMaguntia',cursive; font-size:18px; color:#8090e0; }
.shared-stat-lbl { font-family:'Neucha',cursive; font-size:10px; color:#4050a0; }
.multi-room-input { display:flex; gap:8px; margin-bottom:8px; }
.multi-room-input input { flex:1; background:rgba(30,40,100,.5); border:1.5px solid #3040a0; border-radius:10px; padding:8px 12px; font-family:'Neucha',cursive; font-size:13px; color:#9090d0; outline:none; }
.multi-room-input input::placeholder { color:#303870; }
.multi-btn { background:linear-gradient(135deg,rgba(80,100,255,.3),rgba(50,70,200,.4)); border:1.5px solid #5060d0; border-radius:10px; padding:8px 16px; font-family:'Neucha',cursive; font-size:13px; color:#9090e0; cursor:pointer; transition:.2s; }
.multi-btn:active { background:rgba(80,100,255,.5); }
.multi-session-id { font-family:'Neucha',cursive; font-size:11px; color:#3040a0; text-align:center; margin-top:4px; }

/* ============================================================
   GARDEN SCREEN
   ============================================================ */
#garden-screen {
  top:0; bottom:0; left:0; right:0;
  display:none; padding-bottom:0;
  background:#000;
}
#garden-screen.active { display:block; }

/* Scene layers */
.garden-scene { position:absolute; inset:0; transition:opacity .7s; }

/* Garden main view */
#gscene-garden {
  background:linear-gradient(to bottom, #1a3a0a 0%, #0a2005 100%);
  overflow:hidden;
}
.gdn-sky {
  position:absolute; top:0; left:0; right:0; height:200px;
  background:linear-gradient(to bottom,#1a3a70 0%,#2a6040 100%);
}
.gdn-ground {
  position:absolute; bottom:60px; left:0; right:0; height:320px;
  background:linear-gradient(to bottom,#2a5015 0%,#1a3a0a 100%);
}
.gdn-path {
  position:absolute; bottom:60px; left:50%; transform:translateX(-50%);
  width:70px; height:340px;
  background:repeating-linear-gradient(to bottom, #8a6030 0, #6a4818 12px, #7a5520 12px, #8a6030 24px);
  border-left:3px solid #5a3808; border-right:3px solid #5a3808;
  cursor:pointer; z-index:5;
}
.gdn-path:active { filter:brightness(1.2); }
.gdn-path-label { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-family:'Neucha',cursive; font-size:11px; color:rgba(255,220,150,.7); text-align:center; pointer-events:none; white-space:nowrap; }
.gdn-tree { position:absolute; bottom:60px; pointer-events:none; }
.gdn-tree-trunk { width:14px; height:50px; background:linear-gradient(to right,#3a1e08,#7a4a18,#3a1e08); border-radius:4px 4px 2px 2px; margin:0 auto; }
.gdn-tree-top { width:60px; height:70px; background:radial-gradient(circle at 50% 60%,#2a6a10,#0e3808); border-radius:50% 50% 40% 40%; margin:0 auto; transform:translateY(8px); }
.gdn-flower-bed { position:absolute; bottom:60px; display:flex; flex-wrap:wrap; gap:4px; padding:6px; z-index:3; }
.gdn-plot { width:55px; height:55px; border:2px solid #3a2008; border-radius:8px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:.15s; position:relative; }
.gdn-plot.empty { background:rgba(40,20,5,.6); }
.gdn-plot.seeded { background:rgba(30,60,10,.6); }
.gdn-plot.growing { background:rgba(20,60,15,.7); }
.gdn-plot.ready { background:rgba(20,80,20,.8); box-shadow:0 0 8px rgba(80,200,60,.4); }
.gdn-plot:active { filter:brightness(1.3); }
.gdn-plot-icon { font-size:26px; }
.gdn-plot-label { font-family:'Neucha',cursive; font-size:9px; color:rgba(200,255,150,.7); }
.gdn-progress { position:absolute; bottom:2px; left:3px; right:3px; height:3px; background:rgba(0,0,0,.4); border-radius:2px; overflow:hidden; }
.gdn-progress-fill { height:100%; background:linear-gradient(to right,#40a020,#80e040); border-radius:2px; transition:width .5s; }

/* Road scene (walking animation) */
/* SHOP BUILDING â€” fixed layout */
.shop-building {
  position:absolute; top:54px; left:50%; transform:translateX(-50%);
  width:160px; text-align:center; z-index:5;
}
.shop-roof-wrap {
  width:180px; margin:0 auto;
}
.shop-chimney {
  width:18px; height:24px;
  background:linear-gradient(to right,#6a3010,#9a5020,#6a3010);
  border:2px solid #4a2008; border-radius:3px 3px 0 0;
  margin:0 0 -3px 110px; position:relative; z-index:2;
}
.shop-chimney::after {
  content:'ðŸ’¨'; position:absolute; top:-18px; left:50%; transform:translateX(-50%);
  font-size:12px; opacity:0.7; animation:chimneySmoke 3s ease-in-out infinite;
}
@keyframes chimneySmoke { 0%,100%{opacity:.3;transform:translateX(-50%) translateY(0)} 50%{opacity:.8;transform:translateX(-50%) translateY(-6px)} }
.shop-roof-svg { width:180px; height:60px; display:block; filter:drop-shadow(0 4px 6px rgba(0,0,0,.5)); }
.shop-walls {
  background:linear-gradient(160deg, #e8c880 0%, #c8a050 40%, #a07838 100%);
  width:160px; height:100px; border-radius:4px 4px 0 0;
  margin:0 auto; position:relative;
  border:3px solid #6a4010; border-bottom:none;
  box-shadow:inset -8px 0 16px rgba(0,0,0,.2), inset 0 -8px 16px rgba(0,0,0,.1);
}
/* Wood plank texture on walls */
.shop-walls::before {
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(to bottom, transparent 0, transparent 14px, rgba(0,0,0,.06) 14px, rgba(0,0,0,.06) 15px);
  border-radius:2px 2px 0 0;
}
.shop-walls-base {
  width:168px; height:12px; margin:0 auto;
  background:linear-gradient(to bottom,#6a4010,#4a2808);
  border:2px solid #3a1806; border-top:none;
}
.shop-door {
  position:absolute; bottom:0; left:50%; transform:translateX(-50%);
  width:36px; height:52px;
  background:linear-gradient(160deg,#7a4020,#4a2008);
  border-radius:6px 6px 0 0; cursor:pointer; transition:.3s;
  border:2px solid #3a1806; border-bottom:none;
  box-shadow:inset -3px 0 6px rgba(0,0,0,.3);
}
.shop-door::after {
  content:''; position:absolute; right:5px; top:50%; transform:translateY(-50%);
  width:5px; height:5px; border-radius:50%; background:#c8a040;
  box-shadow:0 0 4px rgba(200,160,40,.6);
}
.shop-door.open { transform:translateX(-50%) perspective(200px) rotateY(-75deg); transform-origin:left center; }
.shop-window {
  position:absolute; top:16px; width:30px; height:28px;
  background:linear-gradient(135deg,rgba(180,220,255,.7),rgba(140,180,220,.4));
  border:2px solid #7a5020; border-radius:4px;
  box-shadow:inset 0 0 8px rgba(150,200,255,.3);
}
.shop-window::after {
  content:''; position:absolute; inset:2px;
  background:linear-gradient(135deg,rgba(255,255,255,.3) 0%,transparent 60%);
}
.shop-window.cross::before {
  content:''; position:absolute; inset:0;
  background:linear-gradient(to right,transparent 45%,#7a5020 45%,#7a5020 55%,transparent 55%),
             linear-gradient(to bottom,transparent 45%,#7a5020 45%,#7a5020 55%,transparent 55%);
}
.shop-window.left { left:16px; }
.shop-window.right { right:16px; }
.shop-sign {
  font-family:'Neucha',cursive; font-size:13px; color:#f0d880;
  text-shadow:1px 1px 2px rgba(0,0,0,.8);
  margin:0 auto 6px; background:rgba(60,30,5,.9);
  padding:4px 12px; border-radius:6px;
  border:1.5px solid #8a6020; display:inline-block;
  box-shadow:0 2px 6px rgba(0,0,0,.5);
}
/* Ground / grass under building */
.shop-ground {
  position:absolute; bottom:60px; left:0; right:0; height:80px;
  background:linear-gradient(to bottom,#2a5015,#1a3a0a);
  z-index:1;
}
.shop-ground::before {
  content:''; position:absolute; top:0; left:0; right:0; height:8px;
  background:linear-gradient(to bottom,#3a7020,#2a5015);
  border-radius:4px 4px 0 0;
}
/* Road perspective effect */
.road-path-visual {
  position:absolute; bottom:60px; left:50%; transform:translateX(-50%);
  width:80px; height:580px;
  background:repeating-linear-gradient(to bottom, #8a6030 0, #6a4818 16px, #7a5520 16px, #8a6030 32px);
  border-left:3px solid #5a3808; border-right:3px solid #5a3808;
  box-shadow:inset 2px 0 8px rgba(0,0,0,.3), inset -2px 0 8px rgba(0,0,0,.3);
  z-index:2;
}
/* Side grass strips */
.road-grass-left, .road-grass-right {
  position:absolute; top:0; bottom:60px; width:calc(50% - 43px);
  background:linear-gradient(to bottom,#1a4010,#0e2808);
}
.road-grass-left { left:0; }
.road-grass-right { right:0; }
/* Small flowers on the side */
.road-flower {
  position:absolute; font-size:14px; pointer-events:none;
  animation:roadFlowerSway 3s ease-in-out infinite alternate;
}
@keyframes roadFlowerSway { 0%{transform:rotate(-5deg)} 100%{transform:rotate(5deg)} }


/* Road scene container */
#gscene-road {
  background:linear-gradient(to bottom, #0a1a30 0%, #1a4020 50%, #0e2810 100%);
  display:none; position:absolute; inset:0;
}
#gscene-road.active-scene { display:block; }
.walker {
  position:absolute; font-size:32px; left:50%; transform:translateX(-50%);
  animation:walkBob 0.5s steps(2) infinite;
  z-index:10;
}
.walker.to-shop { animation:walkToShop 2.8s linear forwards, walkBob 0.5s steps(2) infinite; }
.walker.from-shop { animation:walkFromShop 2.2s linear forwards, walkBob 0.5s steps(2) infinite; }
@keyframes walkBob { 0%{transform:translateX(-50%) translateY(0) scaleX(1)} 50%{transform:translateX(-50%) translateY(-4px) scaleX(1)} }
@keyframes walkToShop { 0%{bottom:160px;} 100%{bottom:520px;} }
@keyframes walkFromShop { 0%{bottom:520px;} 100%{bottom:160px;} }

/* Seed shop scene */
#gscene-seedshop {
  background:linear-gradient(to bottom,#2a1a08 0%,#1a0e04 100%);
  display:flex; flex-direction:column; align-items:center; overflow-y:auto; padding-bottom:70px; padding-top:54px;
}
.seedshop-counter { background:linear-gradient(to bottom,#6a4018,#3a2008); border-radius:8px; border:3px solid #2a1004; padding:8px 12px; width:94%; margin-bottom:10px; display:flex; align-items:center; gap:8px; }
.seedshop-counter-img { font-size:32px; }
.seedshop-title { font-family:'UnifrakturMaguntia',cursive; font-size:18px; color:#f0c860; text-shadow:0 2px 6px rgba(0,0,0,.8); }
.seedshop-sub { font-family:'Neucha',cursive; font-size:11px; color:#a07040; margin-top:2px; }
.seed-pack { width:94%; background:rgba(40,25,8,.8); border:2px solid #5a3510; border-radius:12px; padding:12px; margin-bottom:10px; display:flex; gap:10px; cursor:pointer; transition:.15s; }
.seed-pack:active { background:rgba(60,40,15,.9); }
.seed-pack-left { flex-shrink:0; }
.seed-pack-bag { width:64px; height:64px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:38px; border:2px solid rgba(200,150,60,.3); }
.seed-pack-info { flex:1; }
.seed-pack-name { font-family:'Neucha',cursive; font-size:15px; color:#e0b060; margin-bottom:2px; }
.seed-pack-desc { font-family:'Neucha',cursive; font-size:11px; color:#806040; margin-bottom:4px; }
.seed-pack-flower { display:flex; align-items:center; gap:6px; margin-bottom:4px; }
.seed-pack-flower-icon { font-size:20px; }
.seed-pack-flower-desc { font-family:'Neucha',cursive; font-size:10px; color:#908060; }
.seed-pack-price { font-family:'Neucha',cursive; font-size:13px; color:#f0c040; display:flex; align-items:center; gap:4px; }
.seed-buy-btn { background:linear-gradient(to bottom,#6a8a20,#3a5010); border:2px solid #2a3808; border-radius:8px; padding:5px 12px; font-family:'Neucha',cursive; font-size:12px; color:#c0e040; cursor:pointer; margin-top:4px; display:inline-block; }
.seed-buy-btn:active { filter:brightness(1.3); }
.seed-pack-detail { display:none; }
.seed-pack.expanded .seed-pack-detail { display:block; margin-top:8px; padding-top:8px; border-top:1px solid rgba(150,100,30,.3); }

/* Scene transition overlay */
#scene-fade {
  position:absolute; inset:0; background:#000; opacity:0; pointer-events:none; z-index:100; transition:opacity .6s;
}
#scene-fade.fading { opacity:1; pointer-events:all; }

/* Garden nav indicator for multiplayer */
.nav-player-dot { position:absolute; top:2px; right:2px; width:8px; height:8px; border-radius:50%; background:#6080ff; box-shadow:0 0 4px #6080ff; display:none; }
.navtab { position:relative; }

/* ============================================================
   TOAST NOTIFICATION
   ============================================================ */
#toast {
  position:absolute; bottom:68px; left:50%;
  transform:translateX(-50%) translateY(80px);
  background:rgba(20,50,15,.95); border:2px solid #4a7a18; border-radius:20px;
  padding:8px 20px; font-family:'Neucha',cursive; font-size:13px; color:#a0f060;
  white-space:nowrap; z-index:500;
  transition:transform .4s cubic-bezier(0.34,1.56,0.64,1),opacity .4s; opacity:0;
  text-shadow:0 1px 2px rgba(0,0,0,.8);
  pointer-events:none;
}
#toast.show { transform:translateX(-50%) translateY(0); opacity:1; }

/* ============================================================
   WEATHER TIME LABEL
   ============================================================ */
#time-period-label {
  position:absolute; top:60px; left:50%; transform:translateX(-50%);
  font-family:'Neucha',cursive; font-size:12px; color:rgba(220,200,140,.7);
  pointer-events:none; z-index:50; transition:opacity 1s;
  white-space:nowrap;
}

/* ============================================================
   MISC ANIMATIONS
   ============================================================ */
@keyframes coinBurst {
  0%{transform:translate(0,0) scale(1);opacity:1}
  100%{transform:translate(var(--cx,0),var(--cy,-40px)) scale(0);opacity:0}
}
.coin-burst {
  position:absolute; font-size:16px; pointer-events:none; z-index:400;
  animation:coinBurst 1s ease-out forwards;
}

/* ============================================================
   FORTUNE WHEEL OVERLAY
   ============================================================ */
#fortune-overlay {
  position:absolute; inset:0; background:rgba(0,0,0,.85); z-index:600;
  display:none; align-items:center; justify-content:center; flex-direction:column;
}
#fortune-overlay.show { display:flex; }
#fortune-wheel-wrap { position:relative; width:260px; height:260px; }
#fortune-wheel-canvas { border-radius:50%; }
#fortune-wheel-pointer {
  position:absolute; top:-18px; left:50%; transform:translateX(-50%);
  width:0; height:0;
  border-left:14px solid transparent; border-right:14px solid transparent;
  border-top:30px solid #f0d040;
  filter:drop-shadow(0 2px 6px rgba(0,0,0,.8));
}
#fortune-spin-btn {
  margin-top:16px; padding:10px 32px;
  background:linear-gradient(135deg,#c04010,#801010);
  border:2px solid #f0d040; border-radius:20px;
  font-family:'Neucha',cursive; font-size:16px; color:#f0d040;
  cursor:pointer; text-shadow:0 1px 3px rgba(0,0,0,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.6);
}
#fortune-spin-btn:active { transform:scale(.95); }
#fortune-close-btn {
  margin-top:10px; padding:6px 20px;
  background:rgba(0,0,0,.4); border:1px solid #555; border-radius:12px;
  font-family:'Neucha',cursive; font-size:13px; color:#aaa; cursor:pointer;
}
#fortune-title {
  font-family:'UnifrakturMaguntia',cursive; font-size:24px; color:#f0d040;
  text-shadow:0 0 20px rgba(240,200,50,.6); margin-bottom:12px;
}
#fortune-cost { font-family:'Neucha',cursive; font-size:12px; color:#a08040; margin-top:4px; }
#fortune-result {
  font-family:'Neucha',cursive; font-size:16px; color:#a0f060;
  margin-top:10px; min-height:24px; text-align:center;
}

/* Fortune wheel button on fishing screen */
#fortune-btn {
  position:absolute; bottom:255px; left:10px;
  background:linear-gradient(135deg,#8a3010,#501808);
  border:2px solid #f0d040; border-radius:50%; width:44px; height:44px;
  display:flex; align-items:center; justify-content:center; font-size:22px;
  cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,.6);
  animation:wheelPulse 2s ease-in-out infinite alternate;
  z-index:30;
}
@keyframes wheelPulse {
  0%{box-shadow:0 2px 8px rgba(0,0,0,.6)}
  100%{box-shadow:0 2px 16px rgba(240,200,50,.5)}
}

/* ============================================================
   POKEMON MAP OVERLAY / STYLE
   ============================================================ */
/* Pokemon mode â€” overlay on water */
#poke-overlay {
  position:absolute; inset:0; pointer-events:none; z-index:6;
  transition:opacity .8s;
}
#poke-mode-badge {
  position:absolute; top:56px; left:50%; transform:translateX(-50%);
  background:linear-gradient(135deg,#3050e0,#8040c0);
  border:2px solid #f0f040; border-radius:12px; padding:3px 12px;
  font-family:'Neucha',cursive; font-size:11px; color:#f0f040;
  text-shadow:0 1px 2px rgba(0,0,0,.8); z-index:50; display:none;
  animation:pokeBadgeGlow 1.5s ease-in-out infinite alternate;
}
@keyframes pokeBadgeGlow {
  0%{box-shadow:0 0 6px rgba(100,100,255,.4)} 100%{box-shadow:0 0 18px rgba(255,100,255,.7)}
}

/* Pikachu coins display */
#pika-coins-box {
  position:absolute; right:26px; top:26px;
  background:rgba(0,0,0,.5); border:1px solid #f0d040; border-radius:4px;
  padding:3px 8px; font-family:'Neucha',cursive; font-size:12px; color:#f0e040;
  display:none; align-items:center; gap:4px; text-shadow:0 1px 3px rgba(0,0,0,.8); z-index:5;
}

/* PikaBuffs shop section */
.pikabufs-section {
  background:linear-gradient(135deg,rgba(50,50,200,.15),rgba(150,50,200,.15));
  border:2px solid rgba(150,100,255,.3); border-radius:12px;
  padding:10px; margin-bottom:10px;
}
.pikabufs-title {
  font-family:'UnifrakturMaguntia',cursive; font-size:16px; color:#c0a0ff;
  text-align:center; margin-bottom:8px; text-shadow:0 0 10px rgba(150,100,255,.5);
}

/* ============================================================
   MAP SELECTOR (Normal / Pokemon)
   ============================================================ */
#map-selector {
  position:absolute; bottom:145px; left:10px;
  background:rgba(0,0,0,.75); border:1px solid var(--wood-mid); border-radius:10px;
  padding:5px 7px; z-index:30; display:flex; flex-direction:column; gap:5px;
}
.map-btn {
  font-family:'Neucha',cursive; font-size:12px; padding:6px 10px;
  border-radius:8px; cursor:pointer; border:2px solid;
  transition:.2s; text-align:center; white-space:nowrap; min-width:80px;
}
.map-btn.active { background:rgba(200,160,30,.35); border-color:#d4a030; color:#f0d060; }
.map-btn:not(.active) { background:rgba(0,0,0,.4); border-color:#555; color:#999; }
.map-btn:active { transform:scale(.93); }

/* ============================================================
   LEADERBOARD SCREEN
   ============================================================ */
#leaderboard-screen {
  background:linear-gradient(to bottom,#08081a 0%,#04040e 100%);
  display:none; flex-direction:column; align-items:flex-start;
  overflow:hidden; overflow-y:auto; top:0; padding-bottom:60px; padding-top:54px;
}
#leaderboard-screen.active { display:flex; }
.lb-header {
  width:100%; padding:12px 16px 6px;
  font-family:'UnifrakturMaguntia',cursive; font-size:22px;
  color:#f0d040; text-shadow:0 0 16px rgba(240,200,50,.7);
}
.lb-tabs {
  display:flex; gap:8px; padding:0 16px 8px; width:100%;
}
.lb-tab {
  flex:1; text-align:center; padding:6px 8px;
  font-family:'Neucha',cursive; font-size:12px;
  border-radius:10px; cursor:pointer; border:1.5px solid;
  transition:.2s;
}
.lb-tab.active { background:rgba(240,200,50,.2); border-color:#f0d040; color:#f0d040; }
.lb-tab:not(.active) { background:rgba(0,0,0,.3); border-color:#444; color:#888; }
.lb-row {
  width:90%; margin:4px auto; display:flex; align-items:center; gap:10px;
  background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
  border-radius:10px; padding:8px 14px;
}
.lb-rank { font-family:'Neucha',cursive; font-size:16px; color:#f0d040; width:28px; flex-shrink:0; }
.lb-name { font-family:'Neucha',cursive; font-size:13px; color:#c0c0e0; flex:1; }
.lb-val { font-family:'Neucha',cursive; font-size:14px; color:#80e080; }
.lb-me { border-color:rgba(240,200,50,.4); background:rgba(240,200,50,.06); }

/* ============================================================
   ROAD CHOICE (Shop or Kiosk)
   ============================================================ */
#road-choice {
  position:absolute; bottom:100px; left:50%; transform:translateX(-50%);
  display:none; flex-direction:column; align-items:center; gap:10px; z-index:20;
}
.road-choice-btn {
  padding:10px 24px; font-family:'Neucha',cursive; font-size:14px;
  border-radius:14px; cursor:pointer; border:2px solid; text-align:center;
  min-width:150px; box-shadow:0 3px 10px rgba(0,0,0,.5); transition:.15s;
}
.road-choice-btn:active { transform:scale(.95); }
.road-choice-plant {
  background:linear-gradient(135deg,#2a6010,#1a3808);
  border-color:#4a8a18; color:#a0e040;
}
.road-choice-kiosk {
  background:linear-gradient(135deg,#604010,#3a2008);
  border-color:#c08020; color:#f0c040;
}

/* ============================================================
   KIOSK SCREEN
   ============================================================ */
#gscene-kiosk {
  background:linear-gradient(to bottom,#1a0a04 0%,#0e0604 100%);
  display:none; flex-direction:column; align-items:center; overflow-y:auto; padding-bottom:70px; padding-top:54px;
}
#gscene-kiosk.active-scene { display:flex; }
.kiosk-header {
  width:94%; background:linear-gradient(to bottom,#7a4010,#3a1a04);
  border-radius:8px; border:3px solid #2a0e04; padding:8px 12px;
  margin-bottom:10px; display:flex; align-items:center; gap:8px;
}
.kiosk-title { font-family:'UnifrakturMaguntia',cursive; font-size:18px; color:#f0c840; }
.kiosk-subtitle { font-family:'Neucha',cursive; font-size:11px; color:#a07040; margin-top:2px; }
.kiosk-section-title {
  font-family:'Neucha',cursive; font-size:12px; color:#a08040;
  text-transform:uppercase; letter-spacing:1px; margin:8px 0 4px; width:94%;
}
.kiosk-my-listing {
  width:94%; background:rgba(60,40,10,.6); border:2px solid #7a5010;
  border-radius:10px; padding:10px; margin-bottom:8px; display:flex; align-items:center; gap:8px;
}
.kiosk-listing-icon { font-size:28px; }
.kiosk-listing-info { flex:1; }
.kiosk-listing-name { font-family:'Neucha',cursive; font-size:13px; color:#e0b060; }
.kiosk-listing-price { font-family:'Neucha',cursive; font-size:12px; color:#f0c040; }
.kiosk-listing-btn {
  padding:6px 12px; font-family:'Neucha',cursive; font-size:11px;
  border-radius:8px; cursor:pointer; border:1.5px solid; transition:.15s;
}
.kiosk-listing-btn:active { transform:scale(.93); }
.btn-list { background:linear-gradient(135deg,#406010,#203008); border-color:#608020; color:#a0d040; }
.btn-buy-listing { background:linear-gradient(135deg,#604010,#3a2008); border-color:#a06020; color:#e0a040; }
.btn-cancel-listing { background:rgba(60,10,10,.6); border-color:#803030; color:#e06060; }
.kiosk-price-input {
  width:80px; background:rgba(30,20,5,.8); border:1.5px solid #7a5010;
  border-radius:8px; padding:5px 8px; font-family:'Neucha',cursive; font-size:13px;
  color:#e0b060; outline:none; text-align:center;
}

/* ============================================================
   ROD VISUAL UPGRADE (color on fishing screen)
   ============================================================ */
#rod-body {
  transition: filter .5s;
}

/* ============================================================
   MULTIPLAYER ROD 2 IMPROVEMENTS
   ============================================================ */
#rod-wrapper2 {
  transition:opacity .4s;
}
#rod-body2-inner {
  width:100%; height:100%; position:relative;
}

/* ============================================================
   SCORE POP & OTHER
   ============================================================ */
.score-pop {
  position:absolute; pointer-events:none; z-index:300;
  font-family:'Neucha',cursive; font-size:14px; color:#f0d040;
  text-shadow:0 1px 3px rgba(0,0,0,.8);
  animation:scorePop 1.8s ease-out forwards;
}
@keyframes scorePop {
  0%{opacity:1;transform:translateY(0) scale(1)}
  100%{opacity:0;transform:translateY(-50px) scale(1.3)}
}


/* â”€â”€ Ð“Ð•Ð™ÐœÐŸÐ›Ð•Ð™ ÐžÐ‘ÐÐžÐ’Ð â”€â”€ */
@keyframes levelUpPop {
  0%{opacity:0;transform:translateX(-50%) scale(.5) translateY(0)}
  20%{opacity:1;transform:translateX(-50%) scale(1.3) translateY(-10px)}
  80%{opacity:1;transform:translateX(-50%) scale(1) translateY(-20px)}
  100%{opacity:0;transform:translateX(-50%) scale(.8) translateY(-40px)}
}
@keyframes achieveIn {
  from{transform:translateX(-50%) translateY(-30px) scale(.8);opacity:0}
  to{transform:translateX(-50%) translateY(0) scale(1);opacity:1}
}
@keyframes streakGlow {
  0%,100%{text-shadow:0 0 6px #ff6020}
  50%{text-shadow:0 0 18px #ff9040}
}
/* Streak indicator */
#streak-display {
  position:absolute;top:56px;right:8px;
  font-family:'Neucha',cursive;font-size:11px;
  background:rgba(0,0,0,.5);border-radius:8px;padding:2px 7px;
  display:none;
}
#streak-display.active {display:block;animation:streakGlow 1s ease-in-out infinite;color:#ff8040;}
/* Xp pop */
.xp-pop {
  position:absolute;font-family:'Neucha',cursive;font-size:13px;
  color:#80ff80;pointer-events:none;z-index:300;
  animation:scorePop 1.5s ease forwards;font-weight:bold;
  text-shadow:0 1px 4px rgba(0,100,0,.8);
}

/* â”€â”€ Ð“Ð›ÐžÐ‘ÐÐ›Ð¬ÐÐ«Ð™ Ð§ÐÐ¢ â”€â”€ */
#global-chat {
  position:absolute; bottom:135px; right:10px; z-index:80;
}
#chat-toggle {
  background:linear-gradient(135deg,#1a3060,#0a1830);
  border:2px solid #4090f0; border-radius:50%; width:42px; height:42px;
  display:flex;align-items:center;justify-content:center;font-size:20px;
  cursor:pointer; box-shadow:0 2px 10px rgba(40,100,255,.5);
  animation:chatPulse 2.5s ease-in-out infinite alternate;
}
@keyframes chatPulse {
  0%{box-shadow:0 2px 10px rgba(40,100,255,.3)}
  100%{box-shadow:0 2px 20px rgba(80,150,255,.8)}
}
#chat-unread {
  position:absolute;top:-4px;right:-4px;background:#f04040;border-radius:50%;
  font-size:10px;color:#fff;width:16px;height:16px;display:none;
  align-items:center;justify-content:center;font-family:'Neucha',cursive;
}
#chat-box {
  position:absolute; bottom:50px; right:0;
  width:230px; background:rgba(5,10,30,.92);
  border:1.5px solid #3060a0; border-radius:12px; overflow:hidden;
  box-shadow:0 4px 20px rgba(0,0,80,.7);
}
#chat-messages {
  height:160px; overflow-y:auto; padding:8px;
  font-family:'Neucha',cursive; font-size:11px; color:#c0d8f0;
  display:flex; flex-direction:column; gap:3px;
}
#chat-messages::-webkit-scrollbar{width:4px}
#chat-messages::-webkit-scrollbar-thumb{background:#3060a0;border-radius:2px}
.chat-msg { line-height:1.3; word-break:break-word; }
.chat-msg .chat-name { color:#60b0ff; font-weight:bold; }
.chat-msg .chat-time { color:#405070; font-size:10px; }
#chat-input-row {
  display:flex; border-top:1px solid #2040608;
  background:rgba(0,10,30,.8);
}
#chat-input {
  flex:1; background:transparent; border:none; outline:none;
  font-family:'Neucha',cursive; font-size:12px; color:#c0d8f0;
  padding:6px 8px;
}
#chat-input::placeholder { color:#304060; }
#chat-send {
  background:#1a3880; border:none; color:#60b0ff; padding:6px 10px;
  font-size:16px; cursor:pointer; transition:.15s;
}
#chat-send:active { background:#2050c0; }

/* â”€â”€ ÐŸÐžÐ‘Ð•Ð Ð•Ð–Ð¬Ð• Ð‘Ð•Ð™Ð”Ð– â”€â”€ */
#coast-mode-badge {
  position:absolute; top:56px; left:50%; transform:translateX(-50%);
  background:linear-gradient(135deg,#003060,#001840);
  border:2px solid #4090f0; border-radius:12px; padding:3px 12px;
  font-family:'Neucha',cursive; font-size:11px; color:#60c0ff;
  text-shadow:0 1px 2px rgba(0,0,0,.8); z-index:50; display:none;
  animation:coastGlow 1.8s ease-in-out infinite alternate;
}
@keyframes coastGlow {
  0%{box-shadow:0 0 8px rgba(0,80,200,.4)} 100%{box-shadow:0 0 22px rgba(60,150,255,.8)}
}

/* â”€â”€ Ð¡Ð¢ÐÐ Ð¢ÐžÐ’Ð«Ð™ ÐŸÐžÐ”ÐÐ ÐžÐš â”€â”€ */
#gift-overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.88); z-index:9999;
  display:flex; align-items:center; justify-content:center;
}
#gift-box {
  background:linear-gradient(160deg,#1a0a30,#0a0518);
  border:3px solid #d4a030; border-radius:20px;
  padding:24px 20px; width:310px; text-align:center;
  box-shadow:0 0 60px rgba(200,150,30,.4);
  animation:giftAppear .5s cubic-bezier(.34,1.56,.64,1) forwards;
}
@keyframes giftAppear {
  from{transform:scale(.5) rotate(-10deg);opacity:0}
  to{transform:scale(1) rotate(0deg);opacity:1}
}
#gift-title {
  font-family:'UnifrakturMaguntia',cursive; font-size:22px; color:#f0d060;
  text-shadow:0 0 15px rgba(255,200,50,.6); margin-bottom:8px;
}
#gift-subtitle {
  font-family:'Neucha',cursive; font-size:13px; color:#c0a060;
  margin-bottom:16px; line-height:1.4;
}
#gift-items { list-style:none; margin:0 0 18px 0; padding:0; }
.gift-item {
  font-family:'Neucha',cursive; font-size:13px; color:#e0c880;
  background:rgba(200,150,30,.1); border:1px solid rgba(200,150,30,.3);
  border-radius:8px; padding:6px 10px; margin-bottom:6px;
  display:flex; align-items:center; gap:8px; text-align:left;
  animation:giftItemIn .4s ease backwards;
}
@keyframes giftItemIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:none}}
#gift-claim-btn {
  background:linear-gradient(135deg,#c08010,#806000);
  border:2px solid #f0c040; border-radius:12px; padding:10px 32px;
  font-family:'Neucha',cursive; font-size:16px; color:#ffe060;
  cursor:pointer; box-shadow:0 3px 15px rgba(200,150,0,.4);
  transition:.2s; width:100%;
}
#gift-claim-btn:active{transform:scale(.97);}

/* â”€â”€ ÐÐžÐ’Ð«Ð• ROD ÐÐÐ˜ÐœÐÐ¦Ð˜Ð˜ â”€â”€ */
@keyframes duckWobble {
  0%,100%{transform:rotate(-3deg)} 50%{transform:rotate(3deg)}
}
@keyframes crystalShimmer {
  0%{filter:brightness(1) drop-shadow(0 0 4px #a0e8ff)}
  50%{filter:brightness(1.4) drop-shadow(0 0 12px #a0e8ff)}
  100%{filter:brightness(1) drop-shadow(0 0 4px #a0e8ff)}
}
@keyframes thunderZap {
  0%,90%,100%{filter:brightness(1)}
  92%{filter:brightness(2.5) drop-shadow(0 0 16px #ffff50)}
}
@keyframes voidPulse {
  0%{filter:drop-shadow(0 0 6px #3010a0)}
  50%{filter:drop-shadow(0 0 18px #6020e0)}
  100%{filter:drop-shadow(0 0 6px #3010a0)}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OG RARITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rarity-og {
  background:linear-gradient(135deg,#ff40ff,#40c8ff,#ffd040,#ff40ff);
  background-size:300% 300%;
  animation:ogRainbow 2s linear infinite;
  color:#fff; font-weight:bold; text-shadow:0 0 8px #fff;
  padding:2px 10px; border-radius:8px; font-size:12px;
  box-shadow:0 0 14px rgba(255,100,255,.7);
}
@keyframes ogRainbow{0%{background-position:0%}100%{background-position:300%}}

/* â•â•â• Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐ«Ð• Ð Ð«Ð‘Ð« â•â•â• */
.rarity-flower {
  background: linear-gradient(135deg, #ff80c0, #c060ff, #ff80c0, #ffd060, #ff80c0);
  background-size: 400% 400%;
  animation: flowerRainbow 1.5s linear infinite;
  color: #fff; font-weight: bold; text-shadow: 0 0 10px #ff80ff, 0 0 20px #fff;
  padding: 2px 10px; border-radius: 8px; font-size: 12px;
  box-shadow: 0 0 20px rgba(255,100,200,.9), 0 0 40px rgba(200,80,255,.5);
}
@keyframes flowerRainbow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ Ñ€Ñ‹Ð±Ð° â€” Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ Ð² Ð¿Ð¾Ð¿Ð°Ð¿Ðµ */
@keyframes petalFloat    {0%{transform:translateY(0) rotate(-5deg) scale(1)}50%{transform:translateY(-8px) rotate(5deg) scale(1.08)}100%{transform:translateY(0) rotate(-5deg) scale(1)}}
@keyframes lilyPulse     {0%{transform:scale(1);filter:drop-shadow(0 0 6px #c060ff)}50%{transform:scale(1.12);filter:drop-shadow(0 0 20px #e080ff)}100%{transform:scale(1);filter:drop-shadow(0 0 6px #c060ff)}}
@keyframes daisySpin     {0%{transform:rotate(0deg) scale(1)}50%{transform:rotate(10deg) scale(1.1)}100%{transform:rotate(0deg) scale(1)}}
@keyframes rainbowShimmer{0%{filter:hue-rotate(0deg) drop-shadow(0 0 10px #ff4080)}100%{filter:hue-rotate(360deg) drop-shadow(0 0 20px #ff8000)}}
@keyframes orchidGlow    {0%{filter:drop-shadow(0 0 8px #e040ff) brightness(1)}50%{filter:drop-shadow(0 0 30px #ff80ff) brightness(1.4)}100%{filter:drop-shadow(0 0 8px #e040ff) brightness(1)}}
@keyframes sunflowerBlaze{0%{transform:scale(1) rotate(-3deg);filter:drop-shadow(0 0 12px #ffd700)}33%{transform:scale(1.15) rotate(3deg);filter:drop-shadow(0 0 30px #ff8800) brightness(1.5)}66%{transform:scale(1.05) rotate(-1deg);filter:drop-shadow(0 0 20px #ffd700)}100%{transform:scale(1) rotate(-3deg);filter:drop-shadow(0 0 12px #ffd700)}}

/* Ð›ÐµÐ¿ÐµÑÑ‚ÐºÐ¸ Ð»ÐµÑ‚ÑÑ‚ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¸Ð¼ÐºÐµ Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹ */
@keyframes petalFly {
  0%   {transform:translate(0,0) rotate(0deg) scale(1);   opacity:1;}
  100% {transform:translate(var(--px),var(--py)) rotate(var(--pr)) scale(0.3); opacity:0;}
}
.flower-petal {
  position:absolute; font-size:14px; pointer-events:none; z-index:10000;
  animation: petalFly 1.2s ease-out forwards;
}
/* Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° SVG Ð² Ð¼Ð°Ð³Ð°Ð·Ðµ */
.rod-tier-flower {
  background: linear-gradient(135deg,#ff60a0,#c040ff,#ff60a0);
  background-size:200% 200%;
  animation: flowerRainbow 1.5s linear infinite;
  color:#fff; border:1px solid #ff80c0;
  box-shadow: 0 0 8px rgba(255,100,200,.6);
}
/* â”€â”€ EASTER â”€â”€ */
@keyframes easterGlow {
  0%,100%{box-shadow:0 0 8px #ff80c0,0 0 20px #ffb3de;}
  50%{box-shadow:0 0 18px #ff80c0,0 0 40px #ffe0f0,0 0 60px #ff80c055;}
}
@keyframes easterRodGlow {
  0%,100%{filter:drop-shadow(0 0 6px #ff80c0);}
  50%{filter:drop-shadow(0 0 18px #ff80c0) drop-shadow(0 0 30px #ffe0f0);}
}
.rod-tier-easter {
  background:linear-gradient(90deg,#ff80c0,#ffb3de,#ff80c0);
  background-size:200% 100%;
  animation:flowerRainbow 1.5s linear infinite;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  font-weight:900;font-size:10px;margin-left:4px;
}
.craft-easter-btn {
  background:linear-gradient(90deg,#ff80c0,#c060ff,#ff80c0);
  background-size:200% 100%;
  animation:flowerRainbow 2s linear infinite;
  border:none;border-radius:10px;
  color:#fff;font-family:'Neucha',cursive;font-size:13px;
  padding:8px 16px;cursor:pointer;font-weight:700;
  text-shadow:0 1px 3px rgba(0,0,0,.5);
}
.craft-easter-btn:active{transform:scale(.94);}
.craft-easter-btn:disabled{opacity:.4;cursor:default;animation:none;background:#442233;}
.easter-rabbit-bonus {
  position:absolute;top:4px;right:4px;
  background:rgba(255,128,192,.9);border-radius:8px;
  padding:2px 6px;font-size:11px;font-weight:700;
  color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.5);
  border:1px solid #ff60b0;
  animation:easterGlow .8s ease-in-out infinite;
  pointer-events:none;z-index:10;
}
#easter-mode-badge {
  display:none;position:absolute;top:50px;left:50%;transform:translateX(-50%);
  background:rgba(255,128,192,.9);border-radius:12px;padding:3px 10px;
  font-family:'Neucha',cursive;font-size:12px;color:#fff;font-weight:700;
  z-index:30;animation:easterGlow 1.5s ease-in-out infinite;
  border:1px solid #ff60b0;pointer-events:none;
}
.easter-screen {
  overflow-y:auto;padding:10px;
  background:linear-gradient(135deg,rgba(60,0,40,.97),rgba(30,0,25,.95));
}
.easter-progress-bar-outer {
  background:rgba(0,0,0,.4);border-radius:10px;height:14px;margin:8px 0;
  border:1px solid #ff60b0;overflow:hidden;
}
.easter-progress-bar-inner {
  height:100%;border-radius:10px;transition:width .5s ease;
  background:linear-gradient(90deg,#ff80c0,#c060ff,#ff80c0);
  background-size:200% 100%;animation:flowerRainbow 2s linear infinite;
}
.easter-rabbit-card {
  display:flex;align-items:center;gap:8px;
  background:rgba(255,128,192,.08);border:1px solid rgba(255,128,192,.25);
  border-radius:10px;padding:8px;margin:5px 0;
}
.easter-map-btn {
  display:block;width:100%;margin-top:12px;padding:10px;
  background:linear-gradient(90deg,#ff80c0,#c060ff);
  border:none;border-radius:12px;color:#fff;
  font-family:'Neucha',cursive;font-size:15px;font-weight:700;
  cursor:pointer;text-shadow:0 1px 2px rgba(0,0,0,.5);
}
.easter-map-btn:active{transform:scale(.96);}

@keyframes flowerRodGlow {
  0%  {filter:drop-shadow(0 0 8px #ff80c0);}
  50% {filter:drop-shadow(0 0 24px #ff40ff) brightness(1.3);}
  100%{filter:drop-shadow(0 0 8px #ff80c0);}
}
/* Craft ÐºÐ½Ð¾Ð¿ÐºÐ° Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ */
.craft-flower-btn {
  font-family:'UnifrakturMaguntia',cursive; font-size:13px;
  background: linear-gradient(135deg,#cc2080,#8020c0,#cc2080);
  background-size:200% 200%;
  animation: flowerRainbow 2s linear infinite;
  border: 2px solid #ff80c0; border-radius:12px;
  padding: 6px 12px; color:#fff; cursor:pointer;
  box-shadow: 0 0 12px rgba(255,80,200,.6);
  text-shadow: 0 1px 4px rgba(0,0,0,.8);
}
.craft-flower-btn:active{transform:scale(.94);}
.craft-flower-btn:disabled{opacity:.4;cursor:default;animation:none;background:#442233;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOSS FIGHT OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#boss-overlay {
  display:none;
  position:absolute; inset:0; z-index:9999;
  background:#000;
  flex-direction:column; align-items:center; justify-content:center;
  overflow:hidden;
}
#boss-overlay.active { display:flex; }

/* Cutscene layer */
#boss-cutscene {
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:2;
}
.boss-cs-text {
  font-family:'UnifrakturMaguntia',cursive;
  font-size:22px; color:#40e8ff;
  text-shadow:0 0 20px #40e8ff, 0 0 40px rgba(0,200,255,.5);
  text-align:center; padding:0 20px; opacity:0;
  animation:csTextIn 0.8s ease forwards;
}
@keyframes csTextIn{0%{opacity:0;transform:scale(.7)}100%{opacity:1;transform:scale(1)}}

.boss-cs-sub {
  font-family:'Neucha',cursive; font-size:14px; color:#a0e8ff;
  text-align:center; padding:8px 20px; opacity:0;
  animation:csTextIn 0.8s 0.4s ease forwards;
  max-width:320px; line-height:1.5;
}

/* Ocean BG animation */
#boss-ocean {
  position:absolute; inset:0;
  background:linear-gradient(to bottom,#000510 0%,#001428 40%,#002850 100%);
  overflow:hidden;
}
.boss-wave {
  position:absolute; left:-50%; width:200%; height:60px;
  background:linear-gradient(to bottom,transparent,rgba(0,80,160,.3),transparent);
  border-radius:50%;
  animation:bossWave var(--bwt,6s) ease-in-out infinite alternate;
}
@keyframes bossWave{0%{transform:translateX(0) translateY(0)}100%{transform:translateX(5%) translateY(-10px)}}

/* Shark silhouette */
#boss-shark-wrap {
  position:relative; z-index:3;
  animation:sharkEmerge 2s ease forwards;
}
@keyframes sharkEmerge{
  0%{transform:translateY(120px) scale(0.6);opacity:0}
  60%{opacity:1}
  100%{transform:translateY(0) scale(1);opacity:1}
}
#boss-shark-svg {
  filter:drop-shadow(0 0 30px rgba(0,200,255,.8)) drop-shadow(0 0 60px rgba(0,100,200,.4));
  animation:sharkFloat 2s ease-in-out infinite alternate;
}
@keyframes sharkFloat{0%{transform:translateY(0) rotate(-2deg)}100%{transform:translateY(-12px) rotate(2deg)}}

/* HP bar */
#boss-hp-wrap {
  position:absolute; top:70px; left:20px; right:20px; z-index:10;
}
#boss-hp-label {
  font-family:'UnifrakturMaguntia',cursive; font-size:18px; color:#ff4040;
  text-shadow:0 0 12px #ff0000; text-align:center; margin-bottom:4px;
  animation:bossHpGlow 1s ease-in-out infinite alternate;
}
@keyframes bossHpGlow{0%{text-shadow:0 0 8px #ff0000}100%{text-shadow:0 0 24px #ff8000}}
#boss-hp-bar-bg {
  height:18px; background:rgba(0,0,0,.6); border:2px solid #ff4040;
  border-radius:9px; overflow:hidden;
  box-shadow:0 0 10px rgba(255,0,0,.4);
}
#boss-hp-fill {
  height:100%; width:100%;
  background:linear-gradient(to right,#ff0000,#ff6000,#ffcc00);
  transition:width 0.5s;
  animation:hpShimmer 1s linear infinite;
}
@keyframes hpShimmer{
  0%{filter:brightness(1)}50%{filter:brightness(1.3)}100%{filter:brightness(1)}
}

/* Attack area */
#boss-attack-zone {
  position:absolute; bottom:120px; left:20px; right:20px; z-index:10;
  text-align:center;
}
.boss-attack-btn {
  font-family:'UnifrakturMaguntia',cursive; font-size:18px;
  background:linear-gradient(to bottom,#ff4040,#a00000);
  border:3px solid #ff8040; border-radius:16px;
  padding:12px 30px; color:#fff; cursor:pointer;
  text-shadow:0 0 8px rgba(255,100,0,.8);
  box-shadow:0 0 20px rgba(255,50,0,.6);
  transition:transform .1s, filter .1s;
  animation:attackBtnPulse 1s ease-in-out infinite alternate;
}
@keyframes attackBtnPulse{0%{box-shadow:0 0 15px rgba(255,50,0,.5)}100%{box-shadow:0 0 30px rgba(255,100,0,.9)}}
.boss-attack-btn:active{transform:scale(.92); filter:brightness(1.4);}

#boss-attack-hint {
  font-family:'Neucha',cursive; font-size:13px; color:#80c8ff;
  margin-bottom:10px; animation:csTextIn 1s ease forwards;
}

/* Boss phase messages */
#boss-phase-msg {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  font-family:'UnifrakturMaguntia',cursive; font-size:26px;
  color:#ff8040; text-shadow:0 0 30px #ff4000;
  z-index:20; pointer-events:none; display:none;
  text-align:center; width:320px;
}

/* Mini shark particles */
.mini-shark {
  position:absolute; font-size:20px; pointer-events:none; z-index:15;
  animation:miniSharkSwim 1.5s ease-in-out forwards;
}
@keyframes miniSharkSwim{
  0%{transform:translate(0,0) scale(0.5);opacity:0}
  30%{opacity:1}
  70%{transform:translate(var(--msx,30px),var(--msy,-50px)) scale(1.2);opacity:1}
  100%{transform:translate(var(--msx2,60px),var(--msy2,-100px)) scale(0.3);opacity:0}
}

/* Victory screen */
#boss-victory {
  position:absolute; inset:0; z-index:30; display:none;
  background:radial-gradient(ellipse at center,rgba(0,200,255,.2),rgba(0,0,0,.95));
  flex-direction:column; align-items:center; justify-content:center;
}
#boss-victory.show { display:flex; }
.boss-victory-title {
  font-family:'UnifrakturMaguntia',cursive; font-size:32px;
  color:#40ffff; text-shadow:0 0 40px #00ffff, 0 0 80px rgba(0,200,255,.5);
  animation:victoryPop 0.6s ease forwards; text-align:center;
}
@keyframes victoryPop{0%{transform:scale(0) rotate(-10deg)}100%{transform:scale(1) rotate(0)}}
.boss-reward-item {
  font-family:'Neucha',cursive; font-size:15px; color:#f0f090;
  margin:6px 0; text-align:center;
  animation:csTextIn 0.5s ease forwards;
}
.boss-close-btn {
  font-family:'UnifrakturMaguntia',cursive; font-size:16px;
  background:linear-gradient(to bottom,#006090,#003060);
  border:2px solid #0090d0; border-radius:12px;
  padding:10px 28px; color:#80e8ff; cursor:pointer; margin-top:16px;
  box-shadow:0 0 16px rgba(0,150,200,.5);
}

/* Craft rod btn */
.craft-rod-btn {
  font-family:'UnifrakturMaguntia',cursive; font-size:15px;
  background:linear-gradient(135deg,#004060,#00a0c0);
  border:2px solid #40c8ff; border-radius:12px;
  padding:8px 20px; color:#c0f8ff; cursor:pointer;
  box-shadow:0 0 14px rgba(0,180,220,.5);
  transition:.15s; display:block; margin:6px auto;
}
.craft-rod-btn:active{transform:scale(.94);}
.craft-rod-btn:disabled{opacity:.5;cursor:default;}
/* â•â•â• Piranha â•â•â• */

/* â•â•â• Pokeball â•â•â• */
@keyframes pokeballSpin{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.2)}100%{transform:rotate(360deg) scale(1)}}
@keyframes pokeballFloat{0%{transform:translateY(0) scale(1)}100%{transform:translateY(-10px) scale(1.05)}}

/* â•â•â• Hardcore map badge â•â•â• */
#hardcore-mode-badge {
  display:none; position:absolute; top:56px; left:50%; transform:translateX(-50%);
  background:linear-gradient(135deg,rgba(120,0,0,.9),rgba(40,0,0,.95));
  border:2px solid #ff2020; border-radius:20px; padding:4px 14px;
  font-family:'Neucha',cursive; font-size:12px; color:#ff6060;
  text-shadow:0 0 10px #ff0000; z-index:50; white-space:nowrap;
  animation:hardcoreGlow 1s ease-in-out infinite alternate;
  box-shadow:0 0 14px rgba(255,0,0,.4);
}
@keyframes hardcoreGlow{0%{box-shadow:0 0 8px rgba(255,0,0,.3)}100%{box-shadow:0 0 22px rgba(255,0,0,.8)}}

/* â•â•â• Bum map badge â•â•â• */
#bum-mode-badge {
  display:none; position:absolute; top:56px; left:50%; transform:translateX(-50%);
  background:rgba(20,12,4,.95); border:2px solid #604010; border-radius:20px; padding:4px 14px;
  font-family:'Neucha',cursive; font-size:12px; color:#a07040; z-index:50; white-space:nowrap;
}

/* â•â•â• Pokeball inventory item â•â•â• */
.pokeball-inv-slot {
  position:relative;
  animation:pokeballFloat 2s ease-in-out infinite alternate;
}
.pokeball-inv-slot::after {
  content:'âš¡'; position:absolute; top:-4px; right:-4px;
  font-size:10px; filter:drop-shadow(0 0 4px #ffd040);
}

/* â•â•â• Hardcore boss HP bar (in-game, not overlay) â•â•â• */
#hc-boss-bar {
  display:none; position:absolute; top:56px; left:10px; right:10px; z-index:60;
  background:rgba(0,0,0,.7); border:2px solid #ff2020; border-radius:8px; padding:4px 8px;
}
#hc-boss-name { font-family:'Neucha',cursive; font-size:11px; color:#ff6060; margin-bottom:2px; }
#hc-boss-hp-bg { height:10px; background:rgba(0,0,0,.5); border-radius:5px; overflow:hidden; }
#hc-boss-hp-fill { height:100%; background:linear-gradient(to right,#ff0000,#ff8000); transition:.5s; }

/* New detailed rod badge */
.rod-detail-badge {
  display:inline-block; font-size:9px; padding:1px 5px; border-radius:4px;
  background:linear-gradient(135deg,#c0a020,#806010); color:#fff8d0;
  vertical-align:middle; margin-left:4px; border:1px solid #ffd060;
}
@keyframes meteorPulse{0%{filter:drop-shadow(0 0 8px #ff6020)}100%{filter:drop-shadow(0 0 24px #ffaa00) brightness(1.2)}}
/* â•â•â• ÐÐžÐ’Ð«Ð• Ð£Ð”ÐžÐ§ÐšÐ˜ â•â•â• */
@keyframes pharaohGlow{
  0%  {filter:drop-shadow(0 0 12px #e8c020) brightness(1);}
  50% {filter:drop-shadow(0 0 40px #ffe060) brightness(1.5) saturate(1.3);}
  100%{filter:drop-shadow(0 0 12px #e8c020) brightness(1);}
}
@keyframes pharaohCurse{
  0%,100%{filter:drop-shadow(0 0 10px #e8c020);}
  45%    {filter:drop-shadow(0 0 30px #e8c020) brightness(1.3);}
  50%    {filter:drop-shadow(0 0 6px #8800ff) hue-rotate(120deg) brightness(.8);}
  55%    {filter:drop-shadow(0 0 30px #e8c020) brightness(1.3);}
}
@keyframes neonScan{
  0%  {filter:drop-shadow(0 0 10px #00ffcc) brightness(1);}
  25% {filter:drop-shadow(0 0 30px #00ffff) brightness(1.4) hue-rotate(20deg);}
  50% {filter:drop-shadow(0 0 50px #00ffcc) brightness(1.8);}
  75% {filter:drop-shadow(0 0 30px #00ffcc) brightness(1.4) hue-rotate(-20deg);}
  100%{filter:drop-shadow(0 0 10px #00ffcc) brightness(1);}
}
@keyframes krakenTentacle{
  0%  {filter:drop-shadow(0 0 15px #6020c0);}
  33% {filter:drop-shadow(0 0 40px #9030e0) brightness(1.3);}
  66% {filter:drop-shadow(0 0 25px #4010a0) brightness(.9);}
  100%{filter:drop-shadow(0 0 15px #6020c0);}
}
@keyframes timeFreeze{
  0%   {filter:drop-shadow(0 0 20px #c0e0ff) brightness(1);}
  20%  {filter:drop-shadow(0 0 60px #ffffff) brightness(2.5) saturate(.2);}
  25%  {filter:drop-shadow(0 0 20px #c0e0ff) brightness(1);}
  100% {filter:drop-shadow(0 0 20px #c0e0ff) brightness(1);}
}
@keyframes timeClockSpin {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@keyframes neonDataScroll {
  0%   { transform: translateY(0); }
  100% { transform: translateY(-20px); }
}
@keyframes krakenWiggle {
  0%,100% { transform: rotate(-3deg); }
  50%     { transform: rotate(3deg); }
}
@keyframes pharaohScarabSpin {
  0%   { transform: rotate(0deg) scale(1); }
  50%  { transform: rotate(180deg) scale(1.2); }
  100% { transform: rotate(360deg) scale(1); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ðŸŽ£ FISHER SCREEN â€” Ð­ÐºÑ€Ð°Ð½ Ñ€Ñ‹Ð±Ð°ÐºÐ° Ñ ÑÐºÐ¸Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#fisher-screen {
  background: linear-gradient(160deg, #0a1a0e 0%, #050e08 60%, #030a06 100%);
  overflow-y: auto;
  overflow-x: hidden;
  padding-bottom: 70px;
}

/* ÐÐ½Ð¸Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ„Ð¾Ð½ */
#fisher-bg-anim {
  position: absolute; inset: 0; pointer-events: none; overflow: hidden; z-index: 0;
}
.fisher-bg-particle {
  position: absolute; border-radius: 50%; pointer-events: none;
  animation: fisherBgFloat var(--fd, 8s) ease-in-out infinite alternate;
  animation-delay: var(--fdelay, 0s);
}
@keyframes fisherBgFloat {
  0%   { transform: translate(0,0) scale(1);   opacity: .08; }
  50%  { transform: translate(var(--tx,10px), var(--ty,-15px)) scale(1.3); opacity: .18; }
  100% { transform: translate(var(--tx2,-8px), var(--ty2,10px)) scale(.8); opacity: .06; }
}

/* Ð¨Ð°Ð¿ÐºÐ° ÑÐºÑ€Ð°Ð½Ð° */
#fisher-header {
  position: relative; z-index: 5;
  display: flex; flex-direction: column; align-items: center;
  padding: 16px 0 10px;
}
#fisher-title {
  font-family: 'UnifrakturMaguntia', cursive;
  font-size: 24px; color: #c8e870;
  text-shadow: 0 0 18px rgba(100,200,50,.7), 0 2px 4px rgba(0,0,0,.8);
  letter-spacing: 2px;
}
#fisher-subtitle {
  font-family: 'Neucha', cursive; font-size: 12px; color: rgba(180,220,130,.6);
  margin-top: 2px; letter-spacing: 1px;
}

/* â”€â”€ Ð“Ð›ÐÐ’ÐÐ«Ð™ Ð‘Ð›ÐžÐš: Ð¤Ð˜Ð“Ð£Ð Ð Ð Ð«Ð‘ÐÐšÐ â”€â”€ */
#fisher-character-zone {
  position: relative; z-index: 5;
  width: 100%; height: 280px;
  display: flex; align-items: flex-end; justify-content: center;
  margin-bottom: 8px;
}

/* Ð¤Ð¾Ð½-ÑÑ†ÐµÐ½Ð° Ð·Ð° Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¼ */
#fisher-scene-bg {
  position: absolute; inset: 0;
  background: radial-gradient(ellipse 80% 60% at 50% 90%, rgba(10,60,20,.5), transparent);
}
.fisher-scene-glow {
  position: absolute; border-radius: 50%; filter: blur(20px); pointer-events: none;
}

/* ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð° (Ð·ÐµÐ¼Ð»Ñ) */
#fisher-platform {
  position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
  width: 200px; height: 28px;
  background: linear-gradient(to bottom, #2a4a18 0%, #1a2e0e 100%);
  border-radius: 50% 50% 0 0;
  border-top: 2px solid rgba(80,160,40,.4);
  box-shadow: 0 0 30px rgba(40,120,20,.3), inset 0 4px 8px rgba(0,0,0,.4);
}
#fisher-platform::before {
  content: '';
  position: absolute; top: -2px; left: 10%; right: 10%; height: 2px;
  background: linear-gradient(to right, transparent, rgba(120,255,80,.3), transparent);
  border-radius: 50%;
}

/* â”€â”€ ÐŸÐ•Ð Ð¡ÐžÐÐÐ– SVG â”€â”€ */
#fisher-char-wrap {
  position: relative; z-index: 10;
  display: flex; align-items: flex-end;
  gap: 0;
}

#fisher-char-svg {
  width: 120px; height: 220px;
  filter: drop-shadow(0 10px 20px rgba(0,0,0,.7));
  animation: fisherIdle 3s ease-in-out infinite alternate;
}
@keyframes fisherIdle {
  0%   { transform: translateY(0px) rotate(0deg); }
  100% { transform: translateY(-4px) rotate(.5deg); }
}

/* Ð£Ð´Ð¾Ñ‡ÐºÐ° Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¼ */
#fisher-rod-display {
  position: absolute; right: -30px; bottom: 20px;
  width: 24px; height: 200px;
  transform-origin: bottom center;
  animation: fisherRodSway 4s ease-in-out infinite alternate;
  filter: var(--rod-glow, none);
}
@keyframes fisherRodSway {
  0%   { transform: rotate(-5deg); }
  100% { transform: rotate(2deg); }
}

/* Ð Ñ‹Ð±Ð°Ð»ÐºÐ° Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð»ÐµÑÐºÐ¸ */
#fisher-line-svg {
  position: absolute; right: -30px; top: 0;
  pointer-events: none; z-index: 20;
  overflow: visible;
}

/* â”€â”€ ÐŸÐÐÐ•Ð›Ð¬ Ð­ÐšÐ˜ÐŸÐ˜Ð ÐžÐ’ÐšÐ˜ â”€â”€ */
#fisher-equip-panel {
  position: relative; z-index: 5;
  padding: 0 10px;
  display: flex; flex-direction: column; gap: 8px;
}

.fisher-equip-section {
  background: rgba(5,20,10,.85);
  border: 1px solid rgba(60,120,30,.4);
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 2px 12px rgba(0,0,0,.5), inset 0 1px 0 rgba(80,160,40,.1);
}
.fisher-equip-section-title {
  font-family: 'UnifrakturMaguntia', cursive;
  font-size: 13px; color: rgba(160,220,100,.8);
  padding: 8px 14px 4px;
  border-bottom: 1px solid rgba(60,120,30,.2);
  display: flex; align-items: center; gap: 6px;
  letter-spacing: 1px;
}
.fisher-equip-section-title::before {
  content: ''; display: inline-block; width: 3px; height: 14px;
  background: linear-gradient(to bottom, #80e040, #30a010);
  border-radius: 2px;
}

/* Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ */
#fisher-rod-card {
  padding: 12px 14px;
  display: flex; align-items: center; gap: 12px;
  background: linear-gradient(135deg, rgba(0,0,0,0), rgba(20,40,10,.3));
}
#fisher-rod-icon-big {
  width: 64px; height: 64px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  background: radial-gradient(circle, rgba(20,40,10,.8), rgba(5,15,5,.95));
  border: 2px solid rgba(80,160,40,.5);
  border-radius: 12px;
  box-shadow: 0 0 20px var(--rod-aura, rgba(80,160,40,.2));
  position: relative; overflow: visible;
}
#fisher-rod-icon-big::after {
  content: ''; position: absolute; inset: -4px;
  border-radius: 14px;
  background: conic-gradient(from 0deg, transparent 60%, var(--rod-aura-color, rgba(80,160,40,.3)) 80%, transparent 100%);
  animation: fisherRodAura 3s linear infinite;
  opacity: .6;
}
@keyframes fisherRodAura {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#fisher-rod-info { flex: 1; min-width: 0; }
#fisher-rod-name-big {
  font-family: 'UnifrakturMaguntia', cursive;
  font-size: 17px; color: var(--rod-color, #80d040);
  text-shadow: 0 0 10px var(--rod-color, #80d040);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
#fisher-rod-stats-big {
  font-family: 'Neucha', cursive; font-size: 11px;
  color: rgba(160,200,130,.7); margin-top: 3px; line-height: 1.5;
}
#fisher-rod-rarity-badge {
  font-family: 'Neucha', cursive; font-size: 9px;
  padding: 2px 8px; border-radius: 6px; margin-top: 4px;
  display: inline-block; letter-spacing: .5px;
}

/* ÐÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ð½Ð°Ð¶Ð¸Ð²ÐºÐ° Ð¸ Ð¿Ñ€Ð¸Ð¼Ð°Ð½ÐºÐ° */
#fisher-bait-lure-row {
  display: flex; gap: 8px; padding: 10px 14px;
}
.fisher-item-slot {
  flex: 1; display: flex; align-items: center; gap: 8px;
  background: rgba(0,0,0,.3); border: 1px solid rgba(60,120,30,.25);
  border-radius: 10px; padding: 8px 10px;
  transition: all .2s;
}
.fisher-item-slot:hover { border-color: rgba(80,160,40,.5); }
.fisher-item-slot-icon { font-size: 26px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.5)); }
.fisher-item-slot-info { min-width: 0; }
.fisher-item-slot-name { font-family: 'Neucha', cursive; font-size: 11px; color: #c8e090; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fisher-item-slot-qty  { font-family: 'Neucha', cursive; font-size: 10px; color: rgba(150,200,100,.6); margin-top: 1px; }

/* Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ */
#fisher-upgrades-grid {
  display: flex; flex-wrap: wrap; gap: 6px;
  padding: 10px 14px;
}
.fisher-upgrade-chip {
  display: flex; align-items: center; gap: 5px;
  background: rgba(10,30,15,.8);
  border: 1px solid rgba(60,140,30,.4);
  border-radius: 20px; padding: 4px 10px;
  font-family: 'Neucha', cursive; font-size: 10px; color: #a0d060;
  transition: all .3s;
  animation: chipGlow 2s ease-in-out infinite alternate;
  animation-delay: var(--chip-delay, 0s);
}
@keyframes chipGlow {
  0%  { box-shadow: 0 0 4px rgba(60,160,30,.2); }
  100%{ box-shadow: 0 0 10px rgba(80,200,40,.4), inset 0 0 6px rgba(40,100,20,.2); }
}
.fisher-upgrade-chip.inactive {
  border-color: rgba(60,60,60,.4); color: rgba(100,100,100,.6);
  animation: none; background: rgba(10,10,10,.6);
}
.fisher-upgrade-chip-icon { font-size: 14px; }

/* â”€â”€ Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ Ð Ð«Ð‘ÐÐšÐ â”€â”€ */
#fisher-stats-panel {
  position: relative; z-index: 5;
  padding: 0 10px; margin-top: 4px;
}
.fisher-stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 6px; padding: 10px 14px;
}
.fisher-stat-card {
  background: linear-gradient(135deg, rgba(5,20,10,.9), rgba(0,10,5,.8));
  border: 1px solid rgba(60,120,30,.3);
  border-radius: 10px; padding: 8px 10px;
  display: flex; align-items: center; gap: 8px;
  animation: statCardPulse 3s ease-in-out infinite alternate;
  animation-delay: var(--sc-delay, 0s);
}
@keyframes statCardPulse {
  0%  { border-color: rgba(60,120,30,.3); }
  100%{ border-color: rgba(80,180,40,.5); box-shadow: 0 0 8px rgba(40,140,20,.2); }
}
.fisher-stat-icon { font-size: 20px; width: 28px; text-align: center; flex-shrink: 0; filter: drop-shadow(0 2px 6px rgba(0,0,0,.4)); }
.fisher-stat-val { font-family: 'UnifrakturMaguntia', cursive; font-size: 18px; color: #c0e870; line-height: 1; }
.fisher-stat-lbl { font-family: 'Neucha', cursive; font-size: 10px; color: rgba(160,200,100,.6); margin-top: 1px; }

/* â”€â”€ Ð£Ð ÐžÐ’Ð•ÐÐ¬ Ð˜ XP â”€â”€ */
#fisher-level-bar-wrap {
  padding: 4px 14px 10px;
}
#fisher-level-row {
  display: flex; align-items: center; justify-content: space-between;
  font-family: 'Neucha', cursive; margin-bottom: 4px;
}
#fisher-level-label { font-size: 13px; color: #a0d060; }
#fisher-xp-label { font-size: 11px; color: rgba(140,180,90,.7); }
#fisher-xp-bar-bg {
  height: 10px; background: rgba(0,0,0,.5); border-radius: 5px; overflow: hidden;
  border: 1px solid rgba(60,120,30,.4);
  box-shadow: inset 0 2px 4px rgba(0,0,0,.4);
}
#fisher-xp-fill {
  height: 100%; border-radius: 5px; transition: width .8s ease-out;
  background: linear-gradient(to right, #2a8010, #70d030, #c0ff60);
  box-shadow: 0 0 8px rgba(80,200,30,.5);
  position: relative; overflow: hidden;
}
#fisher-xp-fill::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.3) 50%, transparent 100%);
  animation: xpShine 2s linear infinite;
}
@keyframes xpShine {
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* â”€â”€ Ð‘ÐžÐ•Ð’Ð«Ð• ÐŸÐÐ¡Ð¡Ð˜Ð’ÐšÐ˜ â”€â”€ */
#fisher-passives-list {
  padding: 8px 14px;
  display: flex; flex-direction: column; gap: 5px;
}
.fisher-passive-row {
  display: flex; align-items: center; gap: 8px;
  font-family: 'Neucha', cursive; font-size: 11px;
  padding: 5px 8px; border-radius: 8px;
  background: rgba(0,0,0,.3);
  border-left: 3px solid var(--passive-color, #60a030);
  color: rgba(200,230,160,.8);
}
.fisher-passive-icon { font-size: 14px; width: 20px; text-align: center; }
.fisher-passive-val { color: var(--passive-color, #80d040); font-weight: bold; margin-left: auto; }

/* â”€â”€ ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ ÑÐ¼ÐµÐ½Ñ‹ ÑÐºÑ€Ð°Ð½Ð° â”€â”€ */
#fisher-screen.active {
  animation: fisherScreenIn .35s ease-out;
}
@keyframes fisherScreenIn {
  from { opacity: 0; transform: translateY(15px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ÐŸÐ¾Ð»Ð¾ÑÐ°-Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð¾Ð¼ */
.fisher-divider {
  height: 1px; margin: 4px 14px;
  background: linear-gradient(to right, transparent, rgba(80,160,40,.3), transparent);
}

/* ÐŸÐ»Ð°Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð¸ÐºÐ¾Ð½ÐºÐ¸ Ñ€Ñ‹Ð±Ð¾Ðº Ð½Ð°Ð´ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¼ */
.fisher-float-fish {
  position: absolute;
  font-size: 14px;
  pointer-events: none;
  animation: floatFishAnim var(--ff-dur, 4s) ease-in-out infinite;
  animation-delay: var(--ff-delay, 0s);
  opacity: 0;
  z-index: 15;
}
@keyframes floatFishAnim {
  0%   { transform: translate(0, 0)    rotate(-10deg) scale(.8); opacity: 0; }
  20%  { opacity: .7; }
  80%  { opacity: .5; }
  100% { transform: translate(var(--ff-tx, 30px), -60px) rotate(10deg) scale(1.1); opacity: 0; }
}

/* Ð—Ð²Ñ‘Ð·Ð´Ð¾Ñ‡ÐºÐ¸ ÑƒÑ€Ð¾Ð²Ð½Ñ */
.fisher-lvl-star {
  display: inline-block;
  animation: starTwinkle 1.5s ease-in-out infinite alternate;
  animation-delay: var(--star-delay, 0s);
}
@keyframes starTwinkle {
  0%   { opacity: .4; transform: scale(.8); }
  100% { opacity: 1;  transform: scale(1.2); }
}
@keyframes dragonBreathe{0%{filter:drop-shadow(0 0 10px #cc2200)}50%{filter:drop-shadow(0 0 30px #ff4000) brightness(1.3)}100%{filter:drop-shadow(0 0 10px #cc2200)}}
@keyframes poseidonWave{0%{filter:drop-shadow(0 0 12px #0060ff)}100%{filter:drop-shadow(0 0 32px #40a0ff) brightness(1.2)}}
@keyframes quantumFlicker{0%{filter:drop-shadow(0 0 10px #ff00ff) hue-rotate(0deg)}50%{filter:drop-shadow(0 0 20px #00ffff) hue-rotate(180deg)}100%{filter:drop-shadow(0 0 10px #ff00ff) hue-rotate(360deg)}}
@keyframes celestialGlow{0%{filter:drop-shadow(0 0 15px #ffffff) brightness(1.2)}100%{filter:drop-shadow(0 0 40px #ffffc0) brightness(1.6)}}
@keyframes apocalypseShake{0%{transform:translate(0,0) rotate(-2deg) scale(1)}33%{transform:translate(-2px,2px) rotate(2deg) scale(1.02)}66%{transform:translate(2px,-1px) rotate(-1deg) scale(0.99)}100%{transform:translate(0,0) rotate(0deg) scale(1)}}
@keyframes mechPulse{0%{filter:drop-shadow(0 0 6px #40c0e0)}50%{filter:drop-shadow(0 0 20px #00f8ff) brightness(1.3)}100%{filter:drop-shadow(0 0 6px #40c0e0)}}
@keyframes cosmicSpin{0%{filter:drop-shadow(0 0 10px #c060ff) hue-rotate(0deg)}100%{filter:drop-shadow(0 0 30px #e090ff) hue-rotate(60deg)}}
@keyframes demonicPulse{0%{filter:drop-shadow(0 0 8px #cc0020) brightness(1)}50%{filter:drop-shadow(0 0 28px #ff0030) brightness(1.4) saturate(1.5)}100%{filter:drop-shadow(0 0 8px #cc0020) brightness(1)}}
@keyframes godlyShine{0%{filter:drop-shadow(0 0 16px #ffd700) brightness(1.2)}50%{filter:drop-shadow(0 0 50px #fff8a0) brightness(1.8) saturate(1.2)}100%{filter:drop-shadow(0 0 16px #ffd700) brightness(1.2)}}
/* Big rod cards for ultra rods */
.shop-item.ultra-rod {
  background: linear-gradient(135deg, rgba(20,10,5,.95) 0%, rgba(40,20,10,.9) 100%);
  border-width: 2px;
  padding: 10px 10px 10px 8px;
  gap: 10px;
  position: relative;
  overflow: hidden;
}
.shop-item.ultra-rod::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 60%, rgba(255,200,50,.06));
  pointer-events: none;
}
.shop-item.ultra-rod .shop-item-icon {
  width: 72px;
  height: 72px;
  flex-shrink: 0;
}
.shop-item.ultra-rod .shop-item-icon svg {
  width: 72px !important;
  height: 72px !important;
}
.shop-item.ultra-rod .shop-item-name {
  font-size: 15px;
  font-weight: bold;
  text-shadow: 0 0 8px currentColor;
}
.shop-item.ultra-rod .shop-item-stats {
  font-size: 10px;
  color: #a0d070;
}
.rod-tier-badge {
  display: inline-block;
  font-size: 8px;
  padding: 1px 6px;
  border-radius: 8px;
  vertical-align: middle;
  margin-left: 4px;
  font-family: 'Neucha', cursive;
  letter-spacing: 0.5px;
  font-weight: bold;
}
.rod-tier-mech    { background: linear-gradient(135deg,#1a6080,#40c0e0); color:#ffffff; border:1px solid #00f8ff; }
.rod-tier-cosmic  { background: linear-gradient(135deg,#200840,#8040d0); color:#e0c0ff; border:1px solid #c060ff; }
.rod-tier-demonic { background: linear-gradient(135deg,#300010,#880020); color:#ffaaaa; border:1px solid #cc0030; }
.rod-tier-godly   { background: linear-gradient(135deg,#402000,#c08000); color:#fff8a0; border:1px solid #ffd700; box-shadow:0 0 6px rgba(255,215,0,.4); }
.rod-tier-pharaoh { background: linear-gradient(135deg,#402000,#d09010,#402000); background-size:200%;animation:ogRainbow 2s linear infinite; color:#fffbe0; border:1px solid #ffe060; box-shadow:0 0 8px rgba(255,200,0,.5); }
.rod-tier-neon    { background: linear-gradient(135deg,#001a14,#00805040); color:#00ffcc; border:1px solid #00ffcc; box-shadow:0 0 8px rgba(0,255,200,.5); animation:neonScan 2s ease-in-out infinite; }
.rod-tier-kraken  { background: linear-gradient(135deg,#100030,#4010a0); color:#c080ff; border:1px solid #7030d0; box-shadow:0 0 8px rgba(100,0,200,.6); }
.rod-tier-time    { background: linear-gradient(135deg,#101828,#c0d8ff50); color:#c0e0ff; border:1px solid #c0d8ff; box-shadow:0 0 10px rgba(180,220,255,.6); }
</style>
<!-- Firebase compat SDK v9 â€” reliable CDN URLs, no dynamic import() needed -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<div id="game-scale-wrapper">
<div id="game">

  <!-- ===== STATUS BAR ===== -->
  <div id="statusbar">
    <div id="statusbar-bg"></div>
    <div class="s-nail tl"></div>
    <div class="s-nail tr"></div>
    <div id="time-box">
      <span id="weather-icon">ðŸŒ™</span>
      <span id="game-time">00:00</span>
    </div>
    <div id="coins-box">
      <span class="coin-spin">ðŸª™</span>
      <span id="coins-display">150</span>
    </div>
    <!-- Pika coins (pokemon mode) -->
    <div id="pika-coins-box">
      <span>âš¡</span>
      <span id="pika-coins-display">0</span>
    </div>
  </div>
  <div id="energybar"><div id="energyfill"></div></div>

  <!-- ===== FISHING SCREEN ===== -->
  <div id="fishing-screen" class="screen active">
    <!-- Sky -->
    <div id="sky">
      <div id="sky-overlay"></div>
      <div id="stars"></div>
      <div id="moon"><div id="moon-circle"></div><div id="moon-shadow"></div></div>
      <div id="sun">
        <div id="sun-circle"></div>
        <div id="sun-rays"></div>
      </div>
      <div id="clouds"></div>
    </div>
    <!-- Mountains -->
    <div id="mountains">
      <svg viewBox="0 0 360 200" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="-30,200 130,0 236,200" fill="#071008"/>
        <polygon points="80,200 210,40 340,200" fill="#050c06"/>
        <polygon points="200,200 310,20 410,200" fill="#060e08"/>
        <polygon points="130,0 152,0 158,32 148,32" fill="rgba(200,220,210,.2)"/>
      </svg>
    </div>
    <!-- Forest -->
    <div id="forest">
      <svg viewBox="0 0 360 90" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <g id="forest-trees-back" fill="#08160a">
          <polygon points="0,90 18,18 36,90"/><polygon points="22,90 38,28 54,90"/>
          <polygon points="42,90 60,12 78,90"/><polygon points="62,90 78,25 96,90"/>
          <polygon points="80,90 98,8 116,90"/><polygon points="100,90 116,20 134,90"/>
          <polygon points="118,90 136,16 154,90"/><polygon points="138,90 154,22 172,90"/>
          <polygon points="156,90 172,10 190,90"/><polygon points="174,90 192,25 208,90"/>
          <polygon points="194,90 210,14 228,90"/><polygon points="212,90 230,20 246,90"/>
          <polygon points="232,90 248,12 266,90"/><polygon points="250,90 268,28 284,90"/>
          <polygon points="268,90 286,18 302,90"/><polygon points="288,90 304,16 322,90"/>
          <polygon points="306,90 322,22 342,90"/><polygon points="326,90 344,8 360,90"/>
        </g>
        <g id="forest-trees-front" fill="#0e2210" opacity="0.85">
          <polygon points="0,90 12,36 26,90"/><polygon points="30,90 44,28 58,90"/>
          <polygon points="58,90 74,20 90,90"/><polygon points="88,90 104,33 120,90"/>
          <polygon points="116,90 132,26 148,90"/><polygon points="148,90 164,18 180,90"/>
          <polygon points="178,90 192,30 210,90"/><polygon points="208,90 224,24 240,90"/>
          <polygon points="238,90 256,16 272,90"/><polygon points="268,90 284,28 300,90"/>
          <polygon points="296,90 314,20 330,90"/><polygon points="328,90 346,33 360,90"/>
        </g>
        <g fill="#3a2008" opacity="0.45">
          <rect x="17" y="78" width="3" height="12"/><rect x="59" y="76" width="3" height="14"/>
          <rect x="97" y="74" width="3" height="16"/><rect x="153" y="76" width="3" height="14"/>
          <rect x="209" y="74" width="3" height="16"/>
        </g>
      </svg>
    </div>
    <!-- Water -->
    <div id="water">
      <div id="water-bg"></div>
      <div id="water-lines"></div>
      <div id="moon-reflection"></div>
      <div id="sun-reflection"></div>
      <div id="water-shimmer"></div>
      <!-- Swimming fish -->
      <svg class="swimming-fish" style="bottom:28%;--sd:16s;" width="38" height="18" viewBox="0 0 38 18"><ellipse cx="16" cy="9" rx="13" ry="6" fill="rgba(80,140,70,.5)"/><polygon points="29,9 38,4 38,14" fill="rgba(80,140,70,.4)"/></svg>
      <svg class="swimming-fish" style="bottom:52%;--sd:23s;--sdelay:-9s;" width="28" height="14" viewBox="0 0 28 14"><ellipse cx="11" cy="7" rx="9" ry="4.5" fill="rgba(60,100,180,.4)"/><polygon points="20,7 28,3 28,11" fill="rgba(60,100,180,.35)"/></svg>
      <svg class="swimming-fish" style="bottom:70%;--sd:20s;--sdelay:-13s;" width="48" height="24" viewBox="0 0 48 24"><ellipse cx="20" cy="12" rx="17" ry="8.5" fill="rgba(100,60,40,.4)"/><polygon points="37,12 48,6 48,18" fill="rgba(100,60,40,.35)"/></svg>
      <!-- Lily pads -->
      <svg class="lily" style="left:13%;bottom:18%;" width="28" height="16" viewBox="0 0 28 16"><ellipse cx="14" cy="10" rx="13" ry="6" fill="#1a5a18" stroke="#0a3010" stroke-width="1"/><path d="M14,10 L14,0" stroke="#0a3010" stroke-width="1"/><circle cx="14" cy="5" r="3" fill="#e85080" opacity=".8"/></svg>
      <svg class="lily" style="right:28%;bottom:32%;animation-delay:-2s;" width="22" height="12" viewBox="0 0 22 12"><ellipse cx="11" cy="8" rx="10" ry="5" fill="#154a14" stroke="#082008" stroke-width="1"/><path d="M11,8 L11,0" stroke="#082008" stroke-width="1"/></svg>
    </div>
    <!-- Fog overlay -->
    <div id="fog"></div>
    <!-- Rain canvas -->
    <canvas id="rain-canvas"></canvas>

    <!-- Dock -->
    <div id="dock">
      <svg viewBox="0 0 90 300" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="plankG" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#2e1604"/><stop offset="30%" stop-color="#7a4e22"/><stop offset="70%" stop-color="#5a3010"/><stop offset="100%" stop-color="#2e1604"/></linearGradient></defs>
        <rect x="10" y="0" width="8" height="300" fill="url(#plankG)" rx="3"/>
        <rect x="72" y="0" width="8" height="300" fill="url(#plankG)" rx="3"/>
        <rect x="6" y="20" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="58" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="96" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="134" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="172" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="210" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <rect x="6" y="248" width="78" height="9" fill="url(#plankG)" rx="2"/>
        <circle cx="14" cy="24" r="2.5" fill="#888"/><circle cx="76" cy="24" r="2.5" fill="#888"/>
        <circle cx="14" cy="62" r="2.5" fill="#888"/><circle cx="76" cy="62" r="2.5" fill="#888"/>
        <circle cx="14" cy="100" r="2.5" fill="#888"/><circle cx="76" cy="100" r="2.5" fill="#888"/>
      </svg>
    </div>

    <!-- Rod -->
    <div id="rod-wrapper">
      <div id="rod-body">
        <div class="rod-ring" style="bottom:88%;"></div>
        <div class="rod-ring" style="bottom:74%;"></div>
        <div class="rod-ring" style="bottom:59%;"></div>
        <div class="rod-ring" style="bottom:44%;"></div>
        <div class="rod-ring" style="bottom:31%;"></div>
      </div>
      <div id="rod-reel">
        <svg viewBox="0 0 30 22" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="reelG" cx="40%" cy="35%"><stop offset="0%" stop-color="#aaa"/><stop offset="100%" stop-color="#444"/></radialGradient></defs>
          <ellipse cx="15" cy="11" rx="13" ry="9" fill="url(#reelG)" stroke="#333" stroke-width="1.5"/>
          <ellipse cx="15" cy="11" rx="7" ry="5" fill="#555" stroke="#333" stroke-width="1"/>
          <ellipse cx="15" cy="11" rx="3" ry="2" fill="#777"/>
          <line x1="15" y1="2" x2="15" y2="20" stroke="#333" stroke-width=".5" opacity=".5"/>
          <line x1="2" y1="11" x2="28" y2="11" stroke="#333" stroke-width=".5" opacity=".5"/>
          <circle cx="22" cy="4" r="2" fill="#888" stroke="#555" stroke-width=".5"/>
        </svg>
      </div>
    </div>

    <!-- Rod 2 (multiplayer partner) -->
    <div id="rod-wrapper2" style="display:none;left:18px;right:auto;">
      <div id="rod-body2" style="left:6px;right:auto;">
        <div class="rod-ring" style="bottom:88%;"></div>
        <div class="rod-ring" style="bottom:74%;"></div>
        <div class="rod-ring" style="bottom:59%;"></div>
      </div>
    </div>

    <!-- Line canvas -->
    <canvas id="linecanvas"></canvas>
    <!-- Second line canvas (multiplayer) -->
    <canvas id="linecanvas2" style="display:none;"></canvas>
    <!-- Bobber -->
    <div id="bobber-wrap">
      <div id="bobber-top"><div id="bobber-antenna"></div></div>
      <div id="bobber-bottom"></div>
      <div id="bobber-ring"></div>
    </div>

    <!-- Stats -->
    <div id="stats">
      <div class="stat-plank">ðŸŸ <span id="fish-count">0</span></div>
      <div class="stat-plank">â­ <span id="score-val">0</span></div>
    </div>

    <!-- Weather badge -->
    <div id="weather-badge">ðŸŒ™ ÐÐ¾Ñ‡ÑŒ</div>

    <!-- Time period label -->
    <div id="time-period-label"></div>

    <!-- Current rod name -->
    <div id="current-rod-name">Ð£Ð´Ð¾Ñ‡ÐºÐ°: Ð”ÐµÑ€ÐµÐ²ÐµÐ½ÑÐºÐ°Ñ</div>
    <div id="current-rod-stats"></div>

    <!-- Hint -->
    <div id="cast-hint">ÐÐ°Ð¶Ð¼Ð¸ Ð½Ð° Ð²Ð¾Ð´Ñƒ Ð´Ð»Ñ Ð·Ð°Ð±Ñ€Ð¾ÑÐ°</div>

    <!-- Pokemon mode badge -->
    <div id="poke-mode-badge">âš¡ ÐŸÐžÐšÐ•ÐœÐžÐ Ð Ð•Ð–Ð˜Ðœ</div>
    <div id="coast-mode-badge">ðŸ–ï¸ ÐŸÐžÐ‘Ð•Ð Ð•Ð–Ð¬Ð• Ð›Ð•Ð“Ð•ÐÐ”ÐÐ ÐžÐš</div>
    <div id="hardcore-mode-badge">ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð â€” Ð‘ÐžÐ¡Ð¡Ð« ÐÐ¢ÐÐšÐ£Ð®Ð¢!</div>
    <div id="bum-mode-badge">ðŸ§Ÿ Ð‘ÐžÐœÐ–ÐÐ¢Ð¡ÐšÐÐ¯ ÐšÐÐ Ð¢Ð â€” Ð½Ð°ÐºÐ¾Ð¿Ð¸ 1000ðŸª™ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ¹Ñ‚Ð¸!</div>
    <!-- HC Boss bar (shown during hardcore boss encounter) -->
    <div id="hc-boss-bar">
      <div id="hc-boss-name">ðŸ‘¹ ???</div>
      <div id="hc-boss-hp-bg"><div id="hc-boss-hp-fill" style="width:100%"></div></div>
    </div>

    <!-- Ð¡Ð¢ÐÐ Ð¢ÐžÐ’Ð«Ð™ ÐŸÐžÐ”ÐÐ ÐžÐš (Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð·) -->
    <div id="gift-overlay" style="display:none;">
      <div id="gift-box">
        <div id="gift-title">ðŸŽ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ!</div>
        <div id="gift-subtitle">Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ñ‡Ñ‚Ð¾ Ð¸Ð³Ñ€Ð°ÐµÑ‚Ðµ Ð² Ð½Ð°ÑˆÑƒ Ð¸Ð³Ñ€Ñƒ!<br>ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº:</div>
        <ul id="gift-items">
          <li class="gift-item" style="animation-delay:.1s">ðŸ¦† Ð£Ð´Ð¾Ñ‡ÐºÐ°: <b>Ð ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ Ð£Ñ‚ÐºÐ°</b></li>
          <li class="gift-item" style="animation-delay:.2s">ðŸŒŠ ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½: <b>ÐœÐ°Ð±Ð¾Ð¹</b> Ð¿Ð¾Ð¹Ð¼Ð°Ð½!</li>
          <li class="gift-item" style="animation-delay:.3s">ðŸ–ï¸ ÐšÐ°Ñ€Ñ‚Ð°: <b>ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð¾Ðº</b> Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°!</li>
          <li class="gift-item" style="animation-delay:.4s" id="gift-bot-item">ðŸ¤– Ð‘Ð¾Ñ‚ ÐºÑƒÐ¿Ð¸Ð» Ð²ÐµÑ‰ÑŒ Ð·Ð° <b>4000ðŸª™</b> â€” Ð·Ð°Ð±ÐµÑ€Ð¸ Ð² ÐºÐ¸Ð¾ÑÐºÐµ!</li>
        </ul>
        <button id="gift-claim-btn" onclick="claimGift()">âœ¨ Ð—Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¸!</button>
      </div>
    </div>

    <!-- Fortune Wheel button -->
    <div id="fortune-btn" onclick="openFortune()" title="ÐšÐ¾Ð»ÐµÑÐ¾ Ð¤Ð¾Ñ€Ñ‚ÑƒÐ½Ñ‹">ðŸŽ¡</div>
    <!-- Quest button -->
    <div id="quest-btn" onclick="toggleQuestPanel()" title="Ð—Ð°Ð´Ð°Ð½Ð¸Ñ Ð´Ð½Ñ" style="position:absolute;bottom:310px;left:10px;background:linear-gradient(135deg,#1a2a10,#0a1808);border:2px solid #60c040;border-radius:50%;width:42px;height:42px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;box-shadow:0 2px 10px rgba(60,180,40,.4);z-index:30;">ðŸ“‹</div>
    <!-- Quest panel -->
    <div id="quest-panel" style="display:none;position:absolute;bottom:360px;left:10px;width:180px;background:rgba(5,15,5,.92);border:1.5px solid #3a6020;border-radius:12px;padding:8px;z-index:80;box-shadow:0 4px 20px rgba(0,60,0,.7);"></div>
    <!-- Achievement button -->
    <div id="achieve-btn" onclick="showAchievements()" title="Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ" style="position:absolute;bottom:365px;right:10px;background:linear-gradient(135deg,#2a1a00,#1a0a00);border:2px solid #c0a030;border-radius:50%;width:42px;height:42px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;box-shadow:0 2px 10px rgba(200,160,0,.4);z-index:30;">ðŸ…</div>
    <!-- Achievement popup -->
    <div id="achieve-popup" style="display:none;position:absolute;top:54px;left:8px;right:8px;background:rgba(5,5,20,.95);border:2px solid #c0a030;border-radius:14px;padding:10px;z-index:200;max-height:400px;overflow-y:auto;"></div>

    <!-- Map selector -->
    <div id="map-selector">
      <div id="easter-mode-badge">ðŸ° ÐšÐ°Ñ€Ñ‚Ð° ÐŸÐ°ÑÑ…Ð° â€” Ð›Ð¾Ð²Ð¸Ð¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð²!</div>
      <div class="map-btn active" id="map-btn-normal" onclick="setMap('normal')">ðŸŒŠ ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ</div>
      <div class="map-btn" id="map-btn-pokemon" onclick="setMap('pokemon')">âš¡ ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½</div>
      <div class="map-btn" id="map-btn-coast" onclick="setMap('coast')" style="color:#60c0ff;border-color:#2080c0;">ðŸ–ï¸ ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ</div>
      <div class="map-btn" id="map-btn-easter" onclick="setMap('easter')" style="color:#ff80c0;border-color:#c04090;">ðŸ° ÐŸÐ°ÑÑ…Ð°</div>
      <div class="map-btn" id="map-btn-hardcore" onclick="setMap('hardcore')" style="color:#ff4040;border-color:#aa0000;display:none;">ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ </div>
      <div class="map-btn" id="map-btn-hobo" onclick="setMap('hobo')" style="color:#a08060;border-color:#604020;display:none;">ðŸšï¸ Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ñ</div>
      <div class="map-btn" id="map-btn-bum" onclick="tryLeaveBumMap()" style="color:#a06020;border-color:#604010;display:none;">ðŸ§Ÿ Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ð¸Ðº</div>
    </div>

    <!-- Streak display -->
    <div id="streak-display"></div>
    <!-- Bite indicator -->
    <div id="bite-indicator"><div id="bite-plank">ðŸŽ£ ÐšÐ›Ð®ÐÐ¢! ÐŸÐ¾Ð´ÑÐµÐºÐ°Ð¹!</div></div>

    <!-- Toolbar -->
    <div id="toolbar">
      <div id="toolbar-bg"></div>
      <div class="tnail" style="left:15px;"></div>
      <div class="tnail" style="left:50%;transform:translateX(-50%);"></div>
      <div class="tnail" style="right:15px;"></div>
      <!-- Rod button -->
      <div class="tool-btn active" id="btn-rod" onclick="selectTool('rod')">
        <div class="tool-btn-ring"></div>
        <svg viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="tb2" cx="40%" cy="35%"><stop offset="0%" stop-color="#4a7a30"/><stop offset="100%" stop-color="#1e3a10"/></radialGradient></defs>
          <circle cx="29" cy="29" r="27" fill="url(#tb2)"/>
          <g class="tool-icon-rod">
            <line x1="44" y1="14" x2="14" y2="44" stroke="#8b5e2a" stroke-width="5" stroke-linecap="round"/>
            <path d="M 44,14 Q 48,28 40,44" stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="3,2"/>
            <rect x="37" y="40" width="6" height="8" rx="3" fill="#ee2222"/>
            <rect x="37" y="48" width="6" height="5" rx="2" fill="#ffdd00"/>
            <circle cx="24" cy="34" r="5" fill="none" stroke="#888" stroke-width="2"/>
            <circle cx="24" cy="34" r="2" fill="#888"/>
          </g>
        </svg>
      </div>
      <!-- Bait button -->
      <div class="tool-btn" id="btn-bait" onclick="selectTool('bait')">
        <div class="tool-btn-ring"></div>
        <svg viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="tb1" cx="40%" cy="35%"><stop offset="0%" stop-color="#4a7a30"/><stop offset="100%" stop-color="#1e3a10"/></radialGradient></defs>
          <circle cx="29" cy="29" r="27" fill="url(#tb1)"/>
          <g class="tool-icon-bait">
            <rect x="17" y="22" width="24" height="14" rx="3" fill="#c8a450" stroke="#7a5018" stroke-width="1.5"/>
            <path d="M 23,29 Q 26,24 29,29 Q 32,34 35,29" stroke="#8b4020" stroke-width="2.5" fill="none" stroke-linecap="round"/>
            <path d="M 42,27 Q 48,27 48,33 Q 48,39 42,39" stroke="#aaa" stroke-width="2" fill="none" stroke-linecap="round"/>
          </g>
        </svg>
      </div>
      <!-- Lure button -->
      <div class="tool-btn" id="btn-lure" onclick="selectTool('lure')">
        <div class="tool-btn-ring"></div>
        <svg viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">
          <defs><radialGradient id="tb3" cx="40%" cy="35%"><stop offset="0%" stop-color="#4a7a30"/><stop offset="100%" stop-color="#1e3a10"/></radialGradient></defs>
          <circle cx="29" cy="29" r="27" fill="url(#tb3)"/>
          <g class="tool-icon-lure">
            <rect x="18" y="23" width="22" height="20" rx="4" fill="rgba(200,230,200,.2)" stroke="#8b6a30" stroke-width="2"/>
            <rect x="16" y="17" width="26" height="8" rx="3" fill="#8b6a30" stroke="#5a3808" stroke-width="1.5"/>
            <path d="M 22,32 Q 25,28 28,32 Q 31,36 34,32 Q 37,28 40,32" stroke="#7a3818" stroke-width="2" fill="none" stroke-linecap="round" opacity=".8"/>
          </g>
        </svg>
      </div>
    </div>
    <!-- ÐžÐ‘Ð©Ð˜Ð™ Ð§ÐÐ¢ -->
    <div id="global-chat">
      <div id="chat-toggle" onclick="toggleChat()">ðŸ’¬ <span id="chat-unread"></span></div>
      <div id="chat-box" style="display:none;">
        <div id="chat-messages"></div>
        <div id="chat-input-row">
          <input id="chat-input" maxlength="80" placeholder="ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ..."/>
          <button id="chat-send" onclick="sendChatMsg()">âž¤</button>
        </div>
      </div>
    </div>
  </div><!-- /fishing-screen -->

  <!-- ===== SHOP SCREEN ===== -->
  <div id="shop-screen" class="screen">
    <div class="shop-header"><div class="shop-title">ðŸª Ð›Ð°Ð²ÐºÐ° Ð Ñ‹Ð±Ð°ÐºÐ°</div></div>
    <div class="shop-banner" id="shop-tabs">
      <div class="shop-tab active" onclick="switchShopTab('rods',this)">ðŸŽ£ Ð£Ð´Ð¾Ñ‡ÐºÐ¸</div>
      <div class="shop-tab" onclick="switchShopTab('bait',this)">ðŸª± ÐÐ°Ð¶Ð¸Ð²ÐºÐ°</div>
      <div class="shop-tab" onclick="switchShopTab('lures',this)">ðŸª ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ¸</div>
      <div class="shop-tab" onclick="switchShopTab('upgrades',this)">âš¡ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ</div>
      <div class="shop-tab" onclick="switchShopTab('pikabufs',this)">âš¡ ÐŸÐ¸ÐºÐ°Ð‘Ð°Ñ„Ñ„Ñ‹</div>
    </div>
    <div class="shop-body" id="shop-body"></div>
  </div>

  <!-- ===== INVENTORY SCREEN ===== -->
  <div id="inventory-screen" class="screen">
    <div class="inv-header">
      <div class="inv-title">ðŸŽ’ Ð£Ð»Ð¾Ð²</div>
      <div class="inv-total-badge">ðŸª™ <span id="inv-total">0</span></div>
    </div>
    <div class="inv-body" id="inv-body"></div>
    <div class="sell-all-btn" onclick="sellAll()">ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ Ð²ÑÑ‘ ðŸª™<span id="sell-all-amount">0</span></div>
  </div>

  <!-- ===== MULTIPLAYER / ONLINE SCREEN ===== -->
  <div id="multi-screen" class="screen">
    <div class="multi-header">ðŸŒ ÐžÐ½Ð»Ð°Ð¹Ð½</div>

    <!-- Room -->
    <div class="multi-section">
      <div class="multi-section-title">ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð°</div>
      <div class="multi-room-input">
        <input id="room-code-input" placeholder="ÐšÐ¾Ð´ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ (4 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°)" maxlength="6"/>
        <button class="multi-btn" onclick="joinRoom()">Ð’Ð¾Ð¹Ñ‚Ð¸</button>
      </div>
      <button class="multi-btn" style="width:100%;margin-bottom:6px;" onclick="createRoom()">âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ</button>
      <button class="multi-btn" style="width:100%;margin-bottom:6px;border-color:#703030;color:#c06060;" onclick="leaveRoom()">ðŸšª Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹</button>
      <div class="multi-session-id" id="session-label">ðŸ”´ ÐÐµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ñ‘Ð½</div>
    </div>

    <!-- Full multiplayer toggle -->
    <div class="multi-section">
      <div class="multi-section-title">Ð ÐµÐ¶Ð¸Ð¼ Ð¸Ð³Ñ€Ñ‹</div>
      <div class="multi-toggle-row">
        <div>
          <div class="multi-toggle-label">ðŸ‘¥ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐµÑ€</div>
          <div class="multi-toggle-desc">ÐžÐ±Ñ‰Ð¸Ð¹ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ, ÑÐ°Ð´ Ð¸ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="full-multi-toggle" onchange="toggleFullMulti(this.checked)">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div id="full-multi-note" style="display:none;padding:6px 10px;background:rgba(80,100,255,.1);border-radius:8px;font-family:'Neucha',cursive;font-size:11px;color:#5060a0;margin-bottom:6px;">
        ÐŸÑ€Ð¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ ÑÐ²Ð¾ÑŽ Ñ‡ÐµÑÑ‚Ð½ÑƒÑŽ Ð´Ð¾Ð»ÑŽ Ð¼Ð¾Ð½ÐµÑ‚, Ñ€Ñ‹Ð±Ñ‹ Ð¸ Ñ†Ð²ÐµÑ‚Ð¾Ð²!
      </div>
    </div>

    <!-- Shared stats (visible in full multi) -->
    <div class="multi-section" id="shared-stats-section" style="display:none;">
      <div class="multi-section-title">ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
      <div class="multi-shared-stats">
        <div class="shared-stat"><div class="shared-stat-val" id="shared-coins">0</div><div class="shared-stat-lbl">ðŸª™ ÐœÐ¾Ð½ÐµÑ‚Ñ‹</div></div>
        <div class="shared-stat"><div class="shared-stat-val" id="shared-fish">0</div><div class="shared-stat-lbl">ðŸŸ Ð Ñ‹Ð±</div></div>
        <div class="shared-stat"><div class="shared-stat-val" id="shared-flowers">0</div><div class="shared-stat-lbl">ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ð²</div></div>
      </div>
    </div>

    <!-- Players online -->
    <div class="multi-section">
      <div class="multi-section-title">Ð˜Ð³Ñ€Ð¾ÐºÐ¸ Ð¾Ð½Ð»Ð°Ð¹Ð½</div>
      <div id="players-list">
        <div style="font-family:'Neucha',cursive;font-size:12px;color:#3040a0;padding:6px 0;">Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²</div>
      </div>
    </div>

    <div class="multi-fish-parade" id="multi-parade"></div>
  </div>

  <!-- ===== LEADERBOARD SCREEN ===== -->
  <div id="achievements-screen" class="screen" style="background:linear-gradient(to bottom,#08080a,#04040a);overflow-y:auto;padding:54px 8px 70px;">
  <div style="font-family:'UnifrakturMaguntia',cursive;font-size:22px;color:#f0c840;text-align:center;padding:10px 0 8px;">ðŸ… Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ</div>
  <div id="achievements-list" style="padding:0 2px;"></div>
  <div style="font-family:'UnifrakturMaguntia',cursive;font-size:18px;color:#60a060;text-align:center;padding:12px 0 6px;">ðŸ“‹ Ð—Ð°Ð´Ð°Ð½Ð¸Ñ Ð´Ð½Ñ</div>
  <div id="quest-panel-screen" style="padding:0 4px;"></div>
  <div style="font-family:'UnifrakturMaguntia',cursive;font-size:18px;color:#4090f0;text-align:center;padding:12px 0 6px;">ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
  <div id="stats-panel" style="font-family:'Neucha',cursive;font-size:13px;color:#c0d0e0;background:rgba(0,0,0,.3);border-radius:12px;padding:10px;margin:0 2px;"></div>
</div>
<div id="leaderboard-screen" class="screen">
    <div class="lb-header">ðŸ† Ð›Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´</div>
    <div class="lb-tabs">
      <div class="lb-tab active" id="lb-tab-fish" onclick="switchLbTab('fish',this)">ðŸŸ Ð Ñ‹Ð±Ñ‹</div>
      <div class="lb-tab" id="lb-tab-pika" onclick="switchLbTab('pika',this)">âš¡ ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ</div>
      <div class="lb-tab" id="lb-tab-coins" onclick="switchLbTab('coins',this)">ðŸª™ ÐœÐ¾Ð½ÐµÑ‚Ñ‹</div>
    </div>
    <div id="lb-list" style="width:100%;padding:0 8px;"></div>
    <div style="font-family:'Neucha',cursive;font-size:10px;color:#3a3a6a;text-align:center;margin-top:8px;padding:0 16px;">
      Ð›Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ñ‡ÐµÑ€ÐµÐ· Firebase
    </div>
  </div>

  <!-- ===== GARDEN SCREEN ===== -->
  <div id="garden-screen" class="screen">
    <!-- Scene: main garden view -->
    <div id="gscene-garden" class="garden-scene">
      <div class="gdn-sky"></div>

      <!-- Decorative trees -->
      <div class="gdn-tree" style="left:10px;">
        <div class="gdn-tree-top"></div><div class="gdn-tree-trunk"></div>
      </div>
      <div class="gdn-tree" style="right:10px;">
        <div class="gdn-tree-top"></div><div class="gdn-tree-trunk"></div>
      </div>
      <div class="gdn-tree" style="left:30px;bottom:120px;">
        <div class="gdn-tree-top" style="width:46px;height:55px;"></div><div class="gdn-tree-trunk" style="width:11px;height:38px;"></div>
      </div>
      <div class="gdn-tree" style="right:28px;bottom:130px;">
        <div class="gdn-tree-top" style="width:50px;height:60px;"></div><div class="gdn-tree-trunk" style="width:12px;height:42px;"></div>
      </div>

      <div class="gdn-ground"></div>

      <!-- Flower plots - left side -->
      <div class="gdn-flower-bed" id="garden-plots-left" style="left:10px;bottom:120px;width:130px;"></div>
      <!-- Flower plots - right side -->
      <div class="gdn-flower-bed" id="garden-plots-right" style="right:10px;bottom:120px;width:130px;"></div>

      <!-- Path to shop -->
      <div class="gdn-path" id="garden-path" onclick="walkToShop()">
        <div class="gdn-path-label">â¬†ï¸ Ð’ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½</div>
      </div>

      <!-- Garden UI bar -->
      <div style="position:absolute;bottom:68px;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:0 12px;z-index:20;">
        <div style="font-family:'Neucha',cursive;font-size:12px;color:rgba(200,255,150,.7);">ðŸŒ¸ Ð¡Ð°Ð´</div>
        <button onclick="harvestAll()" style="background:rgba(40,80,20,.8);border:1.5px solid #4a7a20;border-radius:8px;padding:4px 12px;font-family:'Neucha',cursive;font-size:11px;color:#a0e040;cursor:pointer;">Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÑ‘ ðŸŒº</button>
      </div>
    </div>

    <!-- Scene: road walk animation -->
    <div id="gscene-road" class="garden-scene" style="display:none;">
      <!-- Side grass -->
      <div class="road-grass-left"></div>
      <div class="road-grass-right"></div>
      <!-- Road -->
      <div class="road-path-visual"></div>
      <!-- Ground strip -->
      <div class="shop-ground"></div>
      <!-- Side flowers -->
      <div class="road-flower" style="left:22%;top:38%;">ðŸŒ¸</div>
      <div class="road-flower" style="right:18%;top:42%;animation-delay:1s;">ðŸŒ¼</div>
      <div class="road-flower" style="left:14%;top:55%;animation-delay:1.5s;">ðŸŒ¿</div>
      <div class="road-flower" style="right:22%;top:52%;animation-delay:.5s;">ðŸŒº</div>
      <!-- Shop building: ROOF on top, WALLS below -->
      <div class="shop-building">
        <div class="shop-sign" id="road-building-sign">ðŸŒ± Ð›Ð°Ð²ÐºÐ° Ð¡ÐµÐ¼ÑÐ½</div>
        <!-- Chimney -->
        <div class="shop-chimney"></div>
        <!-- Roof SVG -->
        <svg class="shop-roof-svg" viewBox="0 0 180 60" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="roofG" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#c03010"/>
              <stop offset="100%" stop-color="#7a1a06"/>
            </linearGradient>
          </defs>
          <polygon points="0,60 90,4 180,60" fill="url(#roofG)" stroke="#5a1006" stroke-width="2"/>
          <line x1="90" y1="4" x2="90" y2="60" stroke="rgba(0,0,0,.15)" stroke-width="2"/>
          <line x1="45" y1="34" x2="45" y2="60" stroke="rgba(0,0,0,.1)" stroke-width="1"/>
          <line x1="135" y1="34" x2="135" y2="60" stroke="rgba(0,0,0,.1)" stroke-width="1"/>
          <!-- Roof ridge cap -->
          <rect x="82" y="2" width="16" height="6" rx="3" fill="#e04020" stroke="#8a2010" stroke-width="1"/>
        </svg>
        <!-- Walls -->
        <div class="shop-walls">
          <div class="shop-window left cross"></div>
          <div class="shop-window right cross"></div>
          <div class="shop-door" id="shop-door" onclick="enterShopFromRoad()"></div>
        </div>
        <!-- Base/foundation -->
        <div class="shop-walls-base"></div>
      </div>
      <!-- Walker -->
      <div class="walker" id="walker" style="bottom:160px;">ðŸš¶</div>
      <!-- Road choice (shown when arrived) -->
      <div id="road-choice">
        <div style="font-family:'Neucha',cursive;font-size:13px;color:rgba(240,210,140,.9);margin-bottom:6px;text-align:center;">ÐšÑƒÐ´Ð° Ð¸Ð´Ñ‘Ð¼?</div>
        <div class="road-choice-btn road-choice-plant" onclick="enterShop()">ðŸŒ± ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ Ð Ð°ÑÑ‚ÐµÐ½Ð¸Ð¹</div>
        <div class="road-choice-btn road-choice-kiosk" onclick="enterKiosk()">ðŸ›– ÐšÐ¸Ð¾ÑÐº (Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ)</div>
      </div>
      <!-- Hint -->
      <div style="position:absolute;bottom:72px;left:50%;transform:translateX(-50%);font-family:'Neucha',cursive;font-size:13px;color:rgba(220,200,140,.9);white-space:nowrap;background:rgba(0,0,0,.5);padding:4px 12px;border-radius:10px;" id="road-hint">Ð˜Ð´Ñ‘Ð¼ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½...</div>
    </div>
    <!-- Scene: seed shop interior -->
    <div id="gscene-seedshop" class="garden-scene" style="display:none;">
      <div class="seedshop-counter">
        <div class="seedshop-counter-img">ðŸª</div>
        <div>
          <div class="seedshop-title">Ð›Ð°Ð²ÐºÐ° Ð¡ÐµÐ¼ÑÐ½</div>
          <div class="seedshop-sub">Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð°ÐºÐµÑ‚ Ñ ÑÐµÐ¼ÐµÐ½Ð°Ð¼Ð¸</div>
        </div>
      </div>
      <div id="seedshop-items"></div>
      <button onclick="leaveShop()" style="position:fixed;bottom:70px;left:50%;transform:translateX(-50%);background:rgba(60,30,5,.8);border:1.5px solid #5a3010;border-radius:10px;padding:8px 24px;font-family:'Neucha',cursive;font-size:13px;color:#c09040;cursor:pointer;">ðŸšª Ð’Ñ‹Ð¹Ñ‚Ð¸</button>
    </div>

    <!-- Scene: kiosk (player marketplace) -->
    <div id="gscene-kiosk" class="garden-scene" style="display:none;">
      <div class="kiosk-header">
        <div style="font-size:32px;">ðŸ›–</div>
        <div>
          <div class="kiosk-title">Ð Ñ‹Ð±Ð°Ñ†ÐºÐ¸Ð¹ ÐšÐ¸Ð¾ÑÐº</div>
          <div class="kiosk-subtitle">Ð¢Ð¾Ñ€Ð³ÑƒÐ¹ Ñ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð¸Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸!</div>
        </div>
      </div>
      <!-- Sell form -->
      <div class="kiosk-section-title">ðŸ“¦ Ð’Ñ‹ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ</div>
      <div id="kiosk-sell-section" style="width:94%;margin-bottom:8px;"></div>
      <!-- Market listings from other players -->
      <div class="kiosk-section-title">ðŸ›’ Ð Ñ‹Ð½Ð¾Ðº Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²</div>
      <div id="kiosk-market-list" style="width:94%;"></div>
      <button onclick="leaveKiosk()" style="position:fixed;bottom:70px;left:50%;transform:translateX(-50%);background:rgba(60,30,5,.8);border:1.5px solid #5a3010;border-radius:10px;padding:8px 24px;font-family:'Neucha',cursive;font-size:13px;color:#c09040;cursor:pointer;">ðŸšª Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· ÐºÐ¸Ð¾ÑÐºÐ°</button>
    </div>

    <!-- Black fade overlay -->
    <div id="scene-fade"></div>
  </div>

  <!-- ===== FORTUNE WHEEL OVERLAY ===== -->
  <div id="fortune-overlay">
    <div id="fortune-title">ðŸŽ¡ ÐšÐ¾Ð»ÐµÑÐ¾ Ð¤Ð¾Ñ€Ñ‚ÑƒÐ½Ñ‹</div>
    <div id="fortune-wheel-wrap">
      <canvas id="fortune-wheel-canvas" width="260" height="260"></canvas>
      <div id="fortune-wheel-pointer"></div>
    </div>
    <div id="fortune-result"></div>
    <div id="fortune-cost">Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 50ðŸª™ Ð·Ð° Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ</div>
    <button id="fortune-spin-btn" onclick="spinFortune()">ðŸŽ² ÐšÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ!</button>
    <div id="fortune-close-btn" onclick="closeFortune()">Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ</div>
  </div>

  <!-- ===== CATCH POPUP ===== -->
  <div id="catch-popup">
    <div id="catch-board">
      <div class="board-nail tl"></div><div class="board-nail tr"></div>
      <div class="board-nail bl"></div><div class="board-nail br"></div>
      <div id="easter-rabbit-bonus" class="easter-rabbit-bonus" style="display:none">ðŸ°+10000ðŸª™</div>
      <div id="catch-header">ðŸŽ‰ Ð£Ð»Ð¾Ð²!</div>
      <svg id="catch-fish-svg" width="100" height="55" viewBox="0 0 100 55" xmlns="http://www.w3.org/2000/svg">
        <defs><radialGradient id="fishG" cx="40%" cy="40%"><stop offset="0%" stop-color="#e0a030"/><stop offset="100%" stop-color="#905010"/></radialGradient></defs>
        <!-- Body â€” wiggles -->
        <g style="animation:fishWiggle 0.9s ease-in-out infinite;transform-origin:48px 28px;">
          <ellipse cx="48" cy="28" rx="32" ry="18" fill="url(#fishG)" stroke="#6a3808" stroke-width="1.5"/>
          <!-- Scales -->
          <path d="M 36,22 Q 42,17 48,22" stroke="#7a4818" stroke-width="1" fill="none" opacity=".6"/>
          <path d="M 48,22 Q 54,17 60,22" stroke="#7a4818" stroke-width="1" fill="none" opacity=".6"/>
          <path d="M 30,28 Q 40,24 50,28" stroke="#7a4818" stroke-width="1" fill="none" opacity=".6"/>
          <!-- Mouth -->
          <path d="M 16,28 Q 18,32 21,28" stroke="#6a3808" stroke-width="1.5" fill="none"/>
        </g>
        <!-- Tail fin â€” waves -->
        <g style="animation:finWave 0.6s ease-in-out infinite alternate;transform-origin:80px 28px;">
          <polygon points="80,28 98,14 98,42" fill="#c07820" stroke="#6a3808" stroke-width="1"/>
        </g>
        <!-- Dorsal fin â€” sways -->
        <g style="animation:finWave 0.8s 0.2s ease-in-out infinite alternate;transform-origin:48px 10px;">
          <path d="M 36,12 Q 48,4 60,12" stroke="#a06018" stroke-width="2" fill="rgba(180,100,20,.3)"/>
        </g>
        <!-- Eye â€” blinks -->
        <circle cx="22" cy="24" r="4.5" fill="#fff" stroke="#3a2008" stroke-width="1"/>
        <circle cx="21" cy="24" r="2.2" fill="#1a1008" style="animation:fishBlink 3s ease-in-out infinite;"/>
        <!-- Eye highlight -->
        <circle cx="22" cy="22.5" r="1" fill="rgba(255,255,255,.7)"/>
      </svg>
      <div id="catch-pokemon-emoji" style="display:none;font-size:58px;line-height:1;text-align:center;margin:4px 0;filter:drop-shadow(0 2px 8px rgba(100,80,255,.5));"></div>
      <div id="catch-name-txt">ÐšÐ°Ñ€Ð°ÑÑŒ</div>
      <div id="catch-weight-txt">0.5 ÐºÐ³ â€¢ +10 Ð¾Ñ‡ÐºÐ¾Ð²</div>
      <div id="catch-rarity" class="rarity-common">ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹</div>
      <div class="catch-btns">
        <div class="catch-btn btn-keep" onclick="keepFish()">ðŸŽ’ Ð¡ÑƒÐ¼ÐºÐ°</div>
        <div class="catch-btn btn-sell-pop" id="catch-sell-btn" onclick="sellFish()">ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ ðŸª™<span id="popup-sell-price">0</span></div>
      </div>
    </div>
  </div>

  <!-- ===== EASTER EVENT SCREEN ===== -->
  <div class="screen easter-screen" id="event-screen">
    <div style="padding:10px;overflow-y:auto;height:100%;">
      <div style="text-align:center;margin-bottom:10px;">
        <div style="font-family:'UnifrakturMaguntia',cursive;font-size:26px;color:#ff80c0;text-shadow:0 0 12px #ff80c055;">ðŸ° ÐŸÐ°ÑÑ…Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð˜Ð²ÐµÐ½Ñ‚</div>
        <div style="font-family:'Neucha',cursive;font-size:12px;color:#c080a0;margin-top:3px;">Ð›Ð¾Ð²Ð¸ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð² Ñ Ð±Ð°Ñ„Ñ„Ð¾Ð¼ Cha Cha!</div>
      </div>
      <div id="easter-event-content"></div>
    </div>
  </div>

  <!-- ===== NAV TABS ===== -->
  <div id="navtabs">
    <div class="navtab" id="nav-fisher" onclick="switchScreen('fisher')" style="color:#90d040;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="7" r="4"/>
        <path d="M6 21v-2a6 6 0 0112 0v2"/>
        <circle cx="12" cy="7" r="1.5" fill="currentColor" stroke="none"/>
      </svg>
      Ð Ñ‹Ð±Ð°Ðº
    </div>
    <div class="navtab active" id="nav-fish" onclick="switchScreen('fishing')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9.5Q7 4 12 9.5Q17 15 21 9.5"/><path d="M21 9.5 L18 6.5 M21 9.5 L18 12.5"/></svg>
      Ð Ñ‹Ð±Ð°Ð»ÐºÐ°
      <div class="nav-player-dot" id="nav-fish-dot"></div>
    </div>
    <div class="navtab" id="nav-shop" onclick="switchScreen('shop')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18l-2 9H5L3 3z"/><circle cx="9" cy="20" r="1"/><circle cx="17" cy="20" r="1"/></svg>
      Ð›Ð°Ð²ÐºÐ°
      <div class="nav-player-dot" id="nav-shop-dot"></div>
    </div>
    <div class="navtab" id="nav-inv" onclick="switchScreen('inventory')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ
      <div class="nav-player-dot" id="nav-inv-dot"></div>
    </div>
    <div class="navtab" id="nav-garden" onclick="switchScreen('garden')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C6 8 4 14 12 22c8-8 6-14 0-22z"/><path d="M12 22V10"/></svg>
      Ð¡Ð°Ð´
      <div class="nav-player-dot" id="nav-garden-dot"></div>
    </div>
    <div class="navtab" id="nav-multi" onclick="switchScreen('multi')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="7" r="4"/><circle cx="15" cy="7" r="4"/><path d="M3 21v-2a7 7 0 0114 0v2"/></svg>
      ÐžÐ½Ð»Ð°Ð¹Ð½
      <div class="nav-player-dot" id="nav-multi-dot"></div>
    </div>
    <div class="navtab" id="nav-achieve" onclick="switchScreen('achievements')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
      Ð£ÑÐ¿ÐµÑ…Ð¸
    </div>
    <div class="navtab" id="nav-lb" onclick="switchScreen('leaderboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="12" width="4" height="9"/><rect x="10" y="6" width="4" height="15"/><rect x="17" y="2" width="4" height="19"/></svg>
      Ð¢Ð¾Ð¿
    </div>
    <div class="navtab" id="nav-event" onclick="switchScreen('event')" style="color:#ff80c0;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="5"/><path d="M6 8 Q4 14 12 20 Q20 14 18 8"/><path d="M9 8 Q12 12 15 8"/></svg>
      Ð˜Ð²ÐµÐ½Ñ‚
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• ðŸŸ ÐŸÐ˜Ð ÐÐÐ¬Ð¯ ÐÐ¢ÐÐšÐ â•â•â•â•â•â•â•â•â•â•â• -->


  <!-- â•â•â•â•â•â•â•â•â•â•â• âš½ ÐŸÐžÐšÐ•Ð‘ÐžÐ› Ð¡ Ð‘Ð£Ð¡Ð¢ÐžÐœ â•â•â•â•â•â•â•â•â•â•â• -->  <div id="pokeball-catch-overlay" style="display:none;position:absolute;inset:0;z-index:7500;pointer-events:auto;background:rgba(0,0,0,.7);">
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
      <div id="pokeball-anim" style="font-size:70px;animation:pokeballSpin 0.6s linear infinite;display:inline-block">âš½</div>
      <div style="font-family:UnifrakturMaguntia,cursive;font-size:22px;color:#f0e040;text-shadow:0 0 16px #f0c000;margin-top:8px">ÐŸÐžÐšÐ•Ð‘ÐžÐ› ÐŸÐžÐ™ÐœÐÐ› Ð‘Ð£Ð¡Ð¢!</div>
      <div id="pokeball-boost-txt" style="font-family:Neucha,cursive;font-size:15px;color:#c0f0ff;margin-top:6px"></div>
      <button onclick="collectPokeball()" style="font-family:UnifrakturMaguntia,cursive;font-size:16px;background:linear-gradient(135deg,#cc0000,#880000);border:3px solid #ff8040;border-radius:14px;padding:10px 28px;color:#fff;cursor:pointer;margin-top:14px;box-shadow:0 0 16px rgba(255,100,0,.5)">ðŸŽ¯ Ð’Ð·ÑÑ‚ÑŒ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ!</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ðŸ¦ˆ BOSS FIGHT â€” Ð“Ð˜Ð‘Ð Ð˜Ð” ÐÐšÐ£Ð›Ð
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="boss-overlay">
    <!-- Ocean background -->
    <div id="boss-ocean">
      <div class="boss-wave" style="top:40%;--bwt:5s"></div>
      <div class="boss-wave" style="top:55%;--bwt:7s;opacity:.6"></div>
      <div class="boss-wave" style="top:65%;--bwt:9s;opacity:.4"></div>
    </div>

    <!-- HP Bar (shown during fight) -->
    <div id="boss-hp-wrap" style="display:none">
      <div id="boss-hp-label">ðŸ¦ˆ Ð“Ð˜Ð‘Ð Ð˜Ð” ÐÐšÐ£Ð›Ð â€” BOSS</div>
      <div id="boss-hp-bar-bg"><div id="boss-hp-fill"></div></div>
      <div id="boss-hp-text" style="font-family:Neucha,cursive;font-size:11px;color:#ff8060;text-align:right;margin-top:2px">1000/1000 HP</div>
    </div>

    <!-- Phase message -->
    <div id="boss-phase-msg"></div>

    <!-- Cutscene layer -->
    <div id="boss-cutscene"></div>

    <!-- Attack zone (shown during fight) -->
    <div id="boss-attack-zone" style="display:none">
      <div id="boss-attack-hint">ÐÐ°Ð¶Ð¸Ð¼Ð°Ð¹ Ð£Ð”ÐÐ  Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ð½ÐµÑÑ‚Ð¸ ÑƒÑ€Ð¾Ð½!</div>
      <button class="boss-attack-btn" onclick="bossAttack()">âš”ï¸ Ð£Ð”ÐÐ !</button>
      <div id="boss-combo-txt" style="font-family:Neucha,cursive;font-size:12px;color:#ffd060;margin-top:6px;height:16px"></div>
    </div>

    <!-- Victory screen -->
    <div id="boss-victory">
      <div class="boss-victory-title">ðŸ† ÐŸÐžÐ‘Ð•Ð”Ð!</div>
      <div style="font-size:48px;animation:sharkFloat 1.5s ease-in-out infinite alternate">ðŸ¦ˆ</div>
      <div id="boss-reward-list"></div>
      <button class="boss-close-btn" onclick="closeBossFight()">ðŸŽ£ ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ñ€Ñ‹Ð±Ð°Ð»ÐºÑƒ!</button>
    </div>
  </div>

  <!-- ===== ðŸŽ£ FISHER SCREEN â€” Ð­ÐºÑ€Ð°Ð½ Ñ€Ñ‹Ð±Ð°ÐºÐ° ===== -->
  <div id="fisher-screen" class="screen">
    <!-- ÐÐ½Ð¸Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ Ñ„Ð¾Ð½Ð° -->
    <div id="fisher-bg-anim"></div>

    <!-- Ð¨Ð°Ð¿ÐºÐ° -->
    <div id="fisher-header">
      <div id="fisher-title">âš”ï¸ Ð Ñ‹Ð±Ð°Ðº</div>
      <div id="fisher-subtitle">Ð¡Ð½Ð°Ñ€ÑÐ¶ÐµÐ½Ð¸Ðµ Ð¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
    </div>

    <!-- Ð—ÐžÐÐ ÐŸÐ•Ð Ð¡ÐžÐÐÐ–Ð -->
    <div id="fisher-character-zone">
      <div id="fisher-scene-bg">
        <!-- ÐÑ‚Ð¼Ð¾ÑÑ„ÐµÑ€Ð½Ñ‹Ðµ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ñ -->
        <div class="fisher-scene-glow" id="fisher-glow-1" style="width:160px;height:80px;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(40,120,20,.2);"></div>
        <div class="fisher-scene-glow" id="fisher-glow-2" style="width:80px;height:80px;bottom:60px;left:50%;transform:translateX(-50%);background:var(--rod-aura, rgba(40,120,20,.15));"></div>
      </div>
      <div id="fisher-platform"></div>
      <!-- ÐŸÐ»Ð°Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ñ€Ñ‹Ð±ÐºÐ¸ -->
      <div class="fisher-float-fish" style="left:30%;bottom:160px;--ff-dur:5s;--ff-delay:0s;--ff-tx:-20px;">ðŸŸ</div>
      <div class="fisher-float-fish" style="left:60%;bottom:140px;--ff-dur:4.5s;--ff-delay:1.5s;--ff-tx:25px;">ðŸ </div>
      <div class="fisher-float-fish" style="left:45%;bottom:180px;--ff-dur:6s;--ff-delay:2.5s;--ff-tx:-15px;">ðŸ¡</div>

      <div id="fisher-char-wrap">
        <!-- SVG Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶Ð° -->
        <svg id="fisher-char-svg" viewBox="0 0 120 240" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <radialGradient id="faceGrad" cx="40%" cy="35%">
              <stop offset="0%" stop-color="#ffe0b0"/>
              <stop offset="100%" stop-color="#c89060"/>
            </radialGradient>
            <linearGradient id="bodyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#3a6a20"/>
              <stop offset="100%" stop-color="#1e3a10"/>
            </linearGradient>
            <radialGradient id="hatGrad" cx="50%" cy="30%">
              <stop offset="0%" stop-color="#7a5520"/>
              <stop offset="100%" stop-color="#3a2508"/>
            </radialGradient>
            <filter id="charShadow">
              <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="rgba(0,0,0,.5)"/>
            </filter>
          </defs>
          <!-- Ð¢ÐµÐ½ÑŒ Ð¿Ð¾Ð´ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶ÐµÐ¼ -->
          <ellipse cx="60" cy="238" rx="35" ry="6" fill="rgba(0,0,0,.4)"/>

          <!-- ÐÐ¾Ð³Ð¸ -->
          <rect x="42" y="190" width="16" height="45" rx="6" fill="#2a4a18"/>
          <rect x="62" y="190" width="16" height="45" rx="6" fill="#2a4a18"/>
          <!-- Ð‘Ð¾Ñ‚Ð¸Ð½ÐºÐ¸ -->
          <ellipse cx="50" cy="235" rx="12" ry="6" fill="#2a1a08"/>
          <ellipse cx="70" cy="235" rx="12" ry="6" fill="#2a1a08"/>
          <rect x="38" y="228" width="24" height="7" rx="4" fill="#3a2808"/>
          <rect x="58" y="228" width="24" height="7" rx="4" fill="#3a2808"/>

          <!-- Ð¢ÐµÐ»Ð¾ â€” ÐºÑƒÑ€Ñ‚ÐºÐ° Ñ€Ñ‹Ð±Ð°ÐºÐ° -->
          <rect x="30" y="130" width="60" height="65" rx="10" fill="url(#bodyGrad)" filter="url(#charShadow)"/>
          <!-- ÐšÐ°Ñ€Ð¼Ð°Ð½ Ð½Ð° ÐºÑƒÑ€Ñ‚ÐºÐµ -->
          <rect x="35" y="155" width="18" height="14" rx="3" fill="rgba(0,0,0,.25)" stroke="rgba(100,180,50,.3)" stroke-width="1"/>
          <line x1="35" y1="162" x2="53" y2="162" stroke="rgba(100,180,50,.2)" stroke-width="1"/>
          <!-- ÐŸÑƒÐ³Ð¾Ð²Ð¸Ñ†Ñ‹ -->
          <circle cx="60" cy="145" r="2.5" fill="#1a3008" stroke="rgba(100,180,50,.4)" stroke-width="1"/>
          <circle cx="60" cy="158" r="2.5" fill="#1a3008" stroke="rgba(100,180,50,.4)" stroke-width="1"/>
          <circle cx="60" cy="171" r="2.5" fill="#1a3008" stroke="rgba(100,180,50,.4)" stroke-width="1"/>
          <!-- Ð’Ð¾Ñ€Ð¾Ñ‚Ð½Ð¸Ðº -->
          <path d="M45,130 Q60,122 75,130 L72,140 Q60,133 48,140Z" fill="#2a5018"/>
          <!-- Ð—Ð½Ð°Ñ‡Ð¾Ðº Ð½Ð° ÐºÑƒÑ€Ñ‚ÐºÐµ -->
          <circle cx="75" cy="150" r="6" fill="rgba(200,160,40,.3)" stroke="rgba(200,160,40,.5)" stroke-width="1"/>
          <text x="75" y="154" text-anchor="middle" font-size="7" fill="#c0a030">ðŸŽ£</text>

          <!-- Ð ÑƒÐºÐ°Ð²Ð° -->
          <rect x="15" y="130" width="22" height="50" rx="8" fill="#2a5018"/>
          <rect x="83" y="130" width="22" height="50" rx="8" fill="#2a5018"/>
          <!-- ÐœÐ°Ð½Ð¶ÐµÑ‚Ñ‹ -->
          <rect x="13" y="168" width="26" height="12" rx="6" fill="#1e3a10"/>
          <rect x="81" y="168" width="26" height="12" rx="6" fill="#1e3a10"/>
          <!-- Ð ÑƒÐºÐ¸ (Ð»Ð°Ð´Ð¾Ð½Ð¸) -->
          <ellipse cx="26" cy="185" rx="11" ry="9" fill="url(#faceGrad)"/>
          <ellipse cx="94" cy="185" rx="11" ry="9" fill="url(#faceGrad)"/>

          <!-- Ð¨ÐµÑ -->
          <rect x="51" y="110" width="18" height="22" rx="6" fill="url(#faceGrad)"/>

          <!-- Ð“Ð¾Ð»Ð¾Ð²Ð° -->
          <ellipse cx="60" cy="96" rx="28" ry="30" fill="url(#faceGrad)" filter="url(#charShadow)"/>

          <!-- Ð¨Ð»ÑÐ¿Ð° -->
          <ellipse cx="60" cy="72" rx="34" ry="7" fill="url(#hatGrad)"/>
          <rect x="36" y="44" width="48" height="30" rx="8" fill="url(#hatGrad)"/>
          <!-- Ð›ÐµÐ½Ñ‚Ð° Ð½Ð° ÑˆÐ»ÑÐ¿Ðµ -->
          <rect x="36" y="60" width="48" height="8" rx="2" fill="#c08020" opacity=".7"/>
          <!-- ÐŸÐµÑ€Ð¾ Ð² ÑˆÐ»ÑÐ¿Ðµ -->
          <path d="M80,44 Q90,30 84,20 Q78,30 76,42" fill="rgba(200,100,40,.5)" stroke="#c06020" stroke-width="1"/>

          <!-- Ð›Ð¸Ñ†Ð¾ â€” Ð³Ð»Ð°Ð·Ð° -->
          <ellipse cx="49" cy="95" rx="6" ry="7" fill="white"/>
          <ellipse cx="71" cy="95" rx="6" ry="7" fill="white"/>
          <ellipse cx="50" cy="96" rx="3.5" ry="4.5" fill="#1a1008"/>
          <ellipse cx="72" cy="96" rx="3.5" ry="4.5" fill="#1a1008"/>
          <!-- Ð‘Ð»Ð¸ÐºÐ¸ Ð³Ð»Ð°Ð· -->
          <circle cx="51.5" cy="94" r="1.5" fill="rgba(255,255,255,.8)"/>
          <circle cx="73.5" cy="94" r="1.5" fill="rgba(255,255,255,.8)"/>
          <!-- Ð‘Ñ€Ð¾Ð²Ð¸ â€” Ð´Ð¾Ð²Ð¾Ð»ÑŒÐ½Ð¾Ðµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ -->
          <path d="M44,87 Q49,84 54,87" stroke="#6a3808" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M66,87 Q71,84 76,87" stroke="#6a3808" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- ÐÐ¾Ñ -->
          <circle cx="60" cy="102" r="2.5" fill="rgba(180,120,60,.6)"/>
          <!-- Ð£Ð»Ñ‹Ð±ÐºÐ° -->
          <path d="M51,110 Q60,118 69,110" stroke="#8a5030" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- Ð ÑƒÐ¼ÑÐ½ÐµÑ† -->
          <ellipse cx="45" cy="107" rx="7" ry="4" fill="rgba(255,100,80,.15)"/>
          <ellipse cx="75" cy="107" rx="7" ry="4" fill="rgba(255,100,80,.15)"/>
          <!-- Ð£Ñ…Ð¾ -->
          <ellipse cx="32" cy="96" rx="5" ry="7" fill="url(#faceGrad)"/>
          <ellipse cx="88" cy="96" rx="5" ry="7" fill="url(#faceGrad)"/>

          <!-- ÐŸÑ€Ð°Ð²Ð°Ñ Ñ€ÑƒÐºÐ° Ð´ÐµÑ€Ð¶Ð¸Ñ‚ ÑƒÐ´Ð¾Ñ‡ÐºÑƒ (Ð¿Ð¾Ð´Ð½ÑÑ‚Ð° Ð²Ð²ÐµÑ€Ñ…) -->
          <line x1="94" y1="178" x2="110" y2="80" stroke="#7a4a18" stroke-width="6" stroke-linecap="round"/>
          <line x1="110" y1="80" x2="115" y2="20" stroke="#5a3410" stroke-width="4" stroke-linecap="round"/>

          <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ -->
          <line x1="110" y1="75" x2="117" y2="75" stroke="#aaa" stroke-width="2" stroke-linecap="round"/>
          <line x1="112" y1="55" x2="118" y2="55" stroke="#aaa" stroke-width="1.5" stroke-linecap="round"/>
          <line x1="113" y1="38" x2="118" y2="38" stroke="#aaa" stroke-width="1.5" stroke-linecap="round"/>

          <!-- Ð›ÐµÑÐºÐ° -->
          <path d="M115,20 Q120,40 118,55 Q116,68 115,80" stroke="rgba(200,190,150,.6)" stroke-width="1" fill="none" stroke-dasharray="3,2"/>

          <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ -->
          <circle cx="100" cy="162" r="9" fill="rgba(0,0,0,.5)" stroke="#888" stroke-width="2"/>
          <circle cx="100" cy="162" r="5.5" fill="#666" stroke="#444" stroke-width="1"/>
          <circle cx="100" cy="162" r="2" fill="#ccc"/>

          <!-- Ð—Ð½Ð°Ñ‡Ð¾Ðº ÑƒÑ€Ð¾Ð²Ð½Ñ Ð½Ð°Ð´ Ð³Ð¾Ð»Ð¾Ð²Ð¾Ð¹ -->
          <g id="fisher-lvl-badge-svg">
            <rect x="42" y="28" width="36" height="14" rx="7" fill="rgba(0,0,0,.7)" stroke="#c0a030" stroke-width="1"/>
            <text id="fisher-lvl-txt-svg" x="60" y="39" text-anchor="middle" font-family="Neucha, cursive" font-size="9" fill="#f0d050">Ð£Ñ€. 1</text>
          </g>
        </svg>
      </div>
    </div>

    <!-- â”€â”€ Ð­ÐšÐ˜ÐŸÐ˜Ð ÐžÐ’ÐšÐ â”€â”€ -->
    <div id="fisher-equip-panel">

      <!-- Ð£Ð´Ð¾Ñ‡ÐºÐ° -->
      <div class="fisher-equip-section">
        <div class="fisher-equip-section-title">ðŸŽ£ Ð£Ð´Ð¾Ñ‡ÐºÐ°</div>
        <div id="fisher-rod-card">
          <div id="fisher-rod-icon-big"></div>
          <div id="fisher-rod-info">
            <div id="fisher-rod-name-big">Ð”ÐµÑ€ÐµÐ²ÐµÐ½ÑÐºÐ°Ñ</div>
            <div id="fisher-rod-stats-big">ÐšÐ»Ñ‘Ð²: Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹</div>
            <div id="fisher-rod-rarity-badge" class="rarity-common">ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ</div>
          </div>
        </div>
        <div class="fisher-divider"></div>
        <!-- ÐŸÐ°ÑÑÐ¸Ð²ÐºÐ¸ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ -->
        <div id="fisher-passives-list"></div>
      </div>

      <!-- ÐÐ°Ð¶Ð¸Ð²ÐºÐ° Ð¸ ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ° -->
      <div class="fisher-equip-section">
        <div class="fisher-equip-section-title">ðŸª± Ð Ð°ÑÑ…Ð¾Ð´Ð½Ð¸ÐºÐ¸</div>
        <div id="fisher-bait-lure-row">
          <div class="fisher-item-slot" id="fisher-bait-slot">
            <div class="fisher-item-slot-icon">ðŸª±</div>
            <div class="fisher-item-slot-info">
              <div class="fisher-item-slot-name">ÐÐµÑ‚ Ð½Ð°Ð¶Ð¸Ð²ÐºÐ¸</div>
              <div class="fisher-item-slot-qty">0 ÑˆÑ‚</div>
            </div>
          </div>
          <div class="fisher-item-slot" id="fisher-lure-slot">
            <div class="fisher-item-slot-icon">ðŸª</div>
            <div class="fisher-item-slot-info">
              <div class="fisher-item-slot-name">ÐÐµÑ‚ Ð¿Ñ€Ð¸Ð¼Ð°Ð½ÐºÐ¸</div>
              <div class="fisher-item-slot-qty">0 ÑˆÑ‚</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ -->
      <div class="fisher-equip-section">
        <div class="fisher-equip-section-title">âš¡ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ</div>
        <div id="fisher-upgrades-grid"></div>
      </div>

    </div><!-- /equip-panel -->

    <!-- â”€â”€ Ð¡Ð¢ÐÐ¢Ð« â”€â”€ -->
    <div id="fisher-stats-panel">
      <div class="fisher-equip-section" style="margin:0 0 8px;">
        <div class="fisher-equip-section-title">ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
        <!-- Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ + XP -->
        <div id="fisher-level-bar-wrap">
          <div id="fisher-level-row">
            <div id="fisher-level-label">â­ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ <span id="fisher-lvl-num">1</span></div>
            <div id="fisher-xp-label"><span id="fisher-xp-cur">0</span> / <span id="fisher-xp-nxt">100</span> XP</div>
          </div>
          <div id="fisher-xp-bar-bg"><div id="fisher-xp-fill" style="width:0%"></div></div>
        </div>
        <div class="fisher-divider"></div>
        <div class="fisher-stats-grid">
          <div class="fisher-stat-card" style="--sc-delay:0s">
            <div class="fisher-stat-icon">ðŸŸ</div>
            <div>
              <div class="fisher-stat-val" id="fs-fish-count">0</div>
              <div class="fisher-stat-lbl">Ð Ñ‹Ð± Ð¿Ð¾Ð¹Ð¼Ð°Ð½Ð¾</div>
            </div>
          </div>
          <div class="fisher-stat-card" style="--sc-delay:.2s">
            <div class="fisher-stat-icon">ðŸª™</div>
            <div>
              <div class="fisher-stat-val" id="fs-coins">0</div>
              <div class="fisher-stat-lbl">ÐœÐ¾Ð½ÐµÑ‚</div>
            </div>
          </div>
          <div class="fisher-stat-card" style="--sc-delay:.4s">
            <div class="fisher-stat-icon">â­</div>
            <div>
              <div class="fisher-stat-val" id="fs-score">0</div>
              <div class="fisher-stat-lbl">ÐžÑ‡ÐºÐ¾Ð²</div>
            </div>
          </div>
          <div class="fisher-stat-card" style="--sc-delay:.6s">
            <div class="fisher-stat-icon">ðŸ”¥</div>
            <div>
              <div class="fisher-stat-val" id="fs-streak">0</div>
              <div class="fisher-stat-lbl">Ð¡ÐµÑ€Ð¸Ñ</div>
            </div>
          </div>
          <div class="fisher-stat-card" style="--sc-delay:.8s">
            <div class="fisher-stat-icon">âš¡</div>
            <div>
              <div class="fisher-stat-val" id="fs-energy">0%</div>
              <div class="fisher-stat-lbl">Ð­Ð½ÐµÑ€Ð³Ð¸Ñ</div>
            </div>
          </div>
          <div class="fisher-stat-card" style="--sc-delay:1s">
            <div class="fisher-stat-icon">ðŸŽ’</div>
            <div>
              <div class="fisher-stat-val" id="fs-inv">0</div>
              <div class="fisher-stat-lbl">Ð£Ð»Ð¾Ð² Ð² ÑÑƒÐ¼ÐºÐµ</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="height:10px;"></div>
  </div><!-- /fisher-screen -->

</div><!-- /game -->
</div><!-- /scale-wrapper -->

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
'use strict';

// ============================================================
// SCALING â€” fit game into any screen
// ============================================================
function applyScale() {
  const wrapper = document.getElementById('game-scale-wrapper');
  const W = 360, H = 700;
  const scaleX = window.innerWidth / W;
  const scaleY = window.innerHeight / H;
  const scale  = Math.min(scaleX, scaleY);
  wrapper.style.transform = `scale(${scale})`;
  wrapper.style.width  = W + 'px';
  wrapper.style.height = H + 'px';
  // Center
  wrapper.style.marginLeft = `${(window.innerWidth  - W * scale) / 2 / scale}px`;
  wrapper.style.marginTop  = `${(window.innerHeight - H * scale) / 2 / scale}px`;
}
applyScale();
window.addEventListener('resize', applyScale);
window.addEventListener('orientationchange', ()=>{ setTimeout(applyScale, 200); });

// ============================================================
// DATA â€” FISH (18 types)
// ============================================================
const FISH_DATA = [
  {name:'ÐšÐ°Ñ€Ð°ÑÑŒ',       w:[.15,.8],  pts:10, coins:5,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#d4902a', col2:'#a06010'},
  {name:'ÐžÐºÑƒÐ½ÑŒ',        w:[.3,1.5],  pts:20, coins:10,  rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c04030', col2:'#802020'},
  {name:'ÐŸÐ»Ð¾Ñ‚Ð²Ð°',       w:[.1,.6],   pts:8,  coins:4,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c0a040', col2:'#808020'},
  {name:'ÐšÑ€Ð°ÑÐ½Ð¾Ð¿ÐµÑ€ÐºÐ°',  w:[.2,.9],   pts:12, coins:6,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#e05028', col2:'#a03018'},
  {name:'Ð•Ñ€Ñˆ',          w:[.05,.3],  pts:6,  coins:3,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#708050', col2:'#404828'},
  {name:'Ð›ÐµÑ‰',          w:[.5,3.0],  pts:30, coins:18,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#c09040', col2:'#907020'},
  {name:'Ð›Ð¸Ð½ÑŒ',         w:[.4,2.5],  pts:28, coins:16,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#60a040', col2:'#306020'},
  {name:'Ð¯Ð·ÑŒ',          w:[.3,2.0],  pts:25, coins:14,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#a07840', col2:'#705020'},
  {name:'Ð“Ð¾Ð»Ð°Ð²Ð»ÑŒ',      w:[.4,2.8],  pts:30, coins:16,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#708060', col2:'#405040'},
  {name:'Ð¡ÑƒÐ´Ð°Ðº',        w:[.8,5.0],  pts:45, coins:28,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#a08858', col2:'#786038'},
  {name:'Ð©ÑƒÐºÐ°',         w:[1.0,6.0], pts:60, coins:40,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#507040', col2:'#304828'},
  {name:'Ð¤Ð¾Ñ€ÐµÐ»ÑŒ',       w:[.4,2.5],  pts:50, coins:35,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#e06040', col2:'#c03020'},
  {name:'ÐÐ°Ð»Ð¸Ð¼',        w:[.6,4.0],  pts:45, coins:30,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#506070', col2:'#304050'},
  {name:'Ð–ÐµÑ€ÐµÑ…',        w:[.5,4.5],  pts:48, coins:32,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#c0c0a0', col2:'#808070'},
  {name:'Ð¡Ð¾Ð¼',          w:[2.0,12.], pts:100,coins:80,  rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#504030', col2:'#302818'},
  {name:'Ð¡Ñ‚ÐµÑ€Ð»ÑÐ´ÑŒ',     w:[.5,3.0],  pts:90, coins:70,  rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#a09060', col2:'#706040'},
  {name:'Ð¡Ð°Ð·Ð°Ð½',        w:[1.5,10.], pts:85, coins:65,  rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#c0801a', col2:'#905010'},
  {name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ Ð Ñ‹Ð±ÐºÐ°',w:[.1,.5],   pts:200,coins:200, rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹!',col:'#ffd030', col2:'#c08010'},
  // === ÐÐžÐ’Ð«Ð• ÐžÐ‘Ð«Ð§ÐÐ«Ð• ===
  {name:'Ð£ÐºÐ»ÐµÐ¹ÐºÐ°',       w:[.05,.25], pts:5,  coins:2,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#b8d0e0', col2:'#7898a8'},
  {name:'ÐŸÐµÑÐºÐ°Ñ€ÑŒ',       w:[.05,.2],  pts:5,  coins:2,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c8b870', col2:'#887838'},
  {name:'Ð’ÐµÑ€Ñ…Ð¾Ð²ÐºÐ°',      w:[.03,.15], pts:4,  coins:1,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#d0c898', col2:'#908858'},
  // === ÐÐžÐ’Ð«Ð• Ð Ð•Ð”ÐšÐ˜Ð• ===
  {name:'Ð–Ð¸Ñ€Ð½Ñ‹Ð¹ ÐšÐ°Ñ€Ð¿',   w:[1.0,8.0], pts:40, coins:25,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#b08040', col2:'#705020'},
  {name:'ÐÐ°Ð»Ð¸Ð¼ Ð¢Ñ‘Ð¼Ð½Ñ‹Ð¹',  w:[0.8,5.0], pts:38, coins:22,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#304858', col2:'#182838'},
  // === ÐÐžÐ’Ð«Ð• Ð­ÐŸÐ˜Ð§Ð•Ð¡ÐšÐ˜Ð• ===
  {name:'Ð‘ÐµÐ»ÑƒÐ³Ð° ÐœÐ°Ð»Ð°Ñ',  w:[2.0,9.0], pts:80, coins:60,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#d0d0c0', col2:'#909088'},
  {name:'Ð¢Ð°Ð¹Ð¼ÐµÐ½Ñ‘Ð½Ð¾Ðº',    w:[1.5,7.0], pts:75, coins:55,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#c06030', col2:'#803010'},
  // === Ð‘ÐžÐ›Ð¬Ð¨ÐžÐ™ ÐŸÐÐšÐšÐ•Ð¢ ÐÐžÐ’Ð«Ð¥ Ð Ð«Ð‘ ===
  // ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ (common)
  {name:'Ð¡Ð½ÐµÑ‚Ð¾Ðº',         w:[.02,.1],  pts:3,  coins:1,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#e8e0c0', col2:'#a0988a'},
  {name:'Ð¢ÑŽÐ»ÑŒÐºÐ°',         w:[.04,.18], pts:4,  coins:2,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c0d0b0', col2:'#809070'},
  {name:'Ð‘Ñ‹ÑÑ‚Ñ€ÑÐ½ÐºÐ°',      w:[.03,.12], pts:4,  coins:1,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#d8c890', col2:'#908848'},
  {name:'Ð“Ð¾Ð»ÑŒÑÐ½',         w:[.02,.1],  pts:3,  coins:1,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#b8c8a0', col2:'#788860'},
  {name:'Ð“Ð¾Ñ€Ñ‡Ð°Ðº',         w:[.03,.15], pts:5,  coins:2,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#d0a0c0', col2:'#906090'},
  {name:'Ð•Ð»ÐµÑ†',           w:[.1,.6],   pts:8,  coins:4,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c8b070', col2:'#888030'},
  {name:'ÐŸÐµÑÐºÐ°Ñ€ÑŒ-Ð£ÑÐ°Ñ‡',   w:[.08,.4],  pts:7,  coins:3,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#c0a860', col2:'#807020'},
  {name:'Ð¡ÐµÑ€ÐµÐ±Ñ€ÑÐ½Ñ‹Ð¹ ÐšÐ°Ñ€Ð°ÑÑŒ',w:[.15,.8],pts:10, coins:5,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#d0d0b8', col2:'#909080'},
  {name:'Ð©Ð¸Ð¿Ð¾Ð²ÐºÐ°',        w:[.02,.08], pts:3,  coins:1,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#b8a888', col2:'#787048'},
  {name:'ÐŸÑƒÐ·Ð°Ð½Ð¾Ðº',        w:[.05,.2],  pts:5,  coins:2,   rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',     col:'#e0c8a0', col2:'#a08860'},
  // Ð ÐµÐ´ÐºÐ¸Ðµ (rare)
  {name:'Ð Ñ‹Ð±ÐµÑ†',          w:[.3,1.8],  pts:26, coins:14,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#a8c0a0', col2:'#608060'},
  {name:'Ð§ÐµÑ…Ð¾Ð½ÑŒ',         w:[.2,1.5],  pts:22, coins:12,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#c0d0c8', col2:'#809088'},
  {name:'Ð–ÐµÑ€ÐµÑ… Ð¡ÐµÑ€ÐµÐ±Ñ€ÑÐ½Ñ‹Ð¹',w:[.4,2.5], pts:28, coins:16,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#c8c8c0', col2:'#888880'},
  {name:'Ð£ÑÐ°Ñ‡',           w:[.5,3.0],  pts:32, coins:18,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#a09050', col2:'#706030'},
  {name:'Ð’Ñ‹Ñ€ÐµÐ·ÑƒÐ±',        w:[.8,5.0],  pts:38, coins:22,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#b0a070', col2:'#706040'},
  {name:'Ð¡Ð¸Ð½ÐµÑ†',          w:[.3,2.0],  pts:25, coins:13,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#8090b0', col2:'#405070'},
  {name:'Ð“ÑƒÑÑ‚ÐµÑ€Ð°',        w:[.2,1.2],  pts:20, coins:11,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#c0b890', col2:'#807850'},
  {name:'Ð£ÐºÐ»ÐµÑ',          w:[.1,.5],   pts:15, coins:8,   rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#e8e0d0', col2:'#a8a090'},
  {name:'ÐÐµÐ»ÑŒÐ¼Ð°',         w:[1.0,6.0], pts:42, coins:26,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#d0c8b0', col2:'#908870'},
  {name:'Ð Ð¸Ð¿ÑƒÑ',          w:[.3,2.5],  pts:27, coins:15,  rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',      col:'#b8d0e0', col2:'#7890a0'},
  // Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ (epic)
  {name:'Ð¡ÐµÐ²Ñ€ÑŽÐ³Ð° ÐœÐ°Ð»Ð°Ñ',  w:[1.5,8.0], pts:70, coins:52,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#a0a8b0', col2:'#606870'},
  {name:'ÐžÑÑ‘Ñ‚Ñ€ Ð ÐµÑ‡Ð½Ð¾Ð¹',   w:[2.0,10.], pts:85, coins:65,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#808898', col2:'#404858'},
  {name:'ÐÐµÑ€ÐºÐ°',          w:[1.0,5.0], pts:55, coins:40,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#e05050', col2:'#a02020'},
  {name:'Ð“Ð¾Ñ€Ð±ÑƒÑˆÐ°',        w:[.8,4.0],  pts:50, coins:36,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#d08050', col2:'#905020'},
  {name:'ÐšÐµÑ‚Ð°',           w:[1.5,6.0], pts:60, coins:44,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#c06040', col2:'#803020'},
  {name:'Ð§Ð°Ð²Ñ‹Ñ‡Ð°',         w:[3.0,12.], pts:90, coins:70,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#902040', col2:'#501020'},
  {name:'Ð“Ð¾Ð»ÐµÑ† ÐÑ€ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',w:[.5,3.0],pts:48, coins:33,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#9090c0', col2:'#505080'},
  {name:'Ð¥Ð°Ñ€Ð¸ÑƒÑ',         w:[.3,2.0],  pts:45, coins:30,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#6090a0', col2:'#305060'},
  {name:'Ð›ÐµÐ½Ð¾Ðº',          w:[.5,3.5],  pts:52, coins:38,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#d07040', col2:'#904020'},
  {name:'ÐžÐ¼ÑƒÐ»ÑŒ',          w:[.4,2.5],  pts:46, coins:31,  rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',   col:'#90b0c0', col2:'#507080'},
  // Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ðµ (legend)
  {name:'Ð‘ÐµÐ»ÑƒÐ³Ð°',         w:[10.,50.], pts:200, coins:160, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#c0c8d0', col2:'#808890'},
  {name:'ÐžÑÑ‘Ñ‚Ñ€ Ð“Ð¸Ð³Ð°Ð½Ñ‚',   w:[5.0,30.], pts:180, coins:140, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#708090', col2:'#384050'},
  {name:'Ð¢ÑƒÐ½ÐµÑ† ÐÑ‚Ð»Ð°Ð½Ñ‚Ð¸Ðº', w:[3.0,20.], pts:160, coins:120, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#405870', col2:'#202838'},
  {name:'Ð Ñ‹Ð±Ð°-Ð¼ÐµÑ‡',       w:[4.0,25.], pts:170, coins:130, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#6090c0', col2:'#305080'},
  {name:'Ð§Ñ‘Ñ€Ð½Ð°Ñ ÐÐºÑƒÐ»Ð°',   w:[8.0,40.], pts:250, coins:200, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹!', col:'#202830', col2:'#101418'},
  {name:'ÐÑ€Ð¾Ð²Ð°Ð½Ð° Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ',w:[.5,3.0],  pts:220, coins:180, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#f0c840', col2:'#b08020'},
  {name:'Ð¤Ð»Ð°Ð¹Ð¸Ð½Ð³ Ð¤Ð¸Ñˆ',    w:[.2,1.0],  pts:150, coins:110, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹', col:'#60c0e0', col2:'#208090'},
  {name:'Ð Ñ‹Ð±Ð° Ð”Ñ€Ð°ÐºÐ¾Ð½',    w:[1.0,6.0], pts:300, coins:250, rar:'legend', label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹!', col:'#c03020', col2:'#801000'},
  // === Ð›Ð•Ð“Ð•ÐÐ”Ð« ÐŸÐžÐ‘Ð•Ð Ð•Ð–Ð¬Ð¯ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ðµ "ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð¾Ðº") ===
  {name:'ÐœÐ¾Ñ€ÑÐºÐ¾Ð¹ Ð”Ñ€Ð°ÐºÐ¾Ð½',w:[3.0,15.], pts:300,coins:120, rar:'coastal_legend', label:'ðŸŒŠ Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑ', col:'#2060a0', col2:'#103060', coastal:true},
  {name:'ÐÐºÑƒÐ»Ð°-ÐŸÑ€Ð¸Ð·Ñ€Ð°Ðº', w:[5.0,20.], pts:350,coins:130, rar:'coastal_legend', label:'ðŸŒŠ Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑ', col:'#607080', col2:'#303848', coastal:true},
  {name:'Ð›ÐµÐ²Ð¸Ð°Ñ„Ð°Ð½',      w:[10.,40.], pts:500,coins:150, rar:'coastal_legend', label:'ðŸŒŠ Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑ', col:'#1a4020', col2:'#0a2010', coastal:true},
  {name:'ÐšÑ€Ð°ÐºÐµÐ½-Ð Ñ‹Ð±Ð°',   w:[8.0,30.], pts:450,coins:140, rar:'coastal_legend', label:'ðŸŒŠ Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑ', col:'#601060', col2:'#300830', coastal:true},
  // â•â•â• OG Ð Ð«Ð‘Ð« (Ð½Ð¾Ð²Ð°Ñ Ñ€ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ) â•â•â•
  {name:'ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹ Ð›ÐµÑ‰',   w:[2.0,8.0],  pts:500,  coins:400,  rar:'og', label:'ðŸ‘‘ OG', col:'#c0e8ff', col2:'#80b0d0', og:true},
  {name:'ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ð¹ ÐšÐ°Ñ€Ð¿',    w:[1.5,7.0],  pts:550,  coins:450,  rar:'og', label:'ðŸ‘‘ OG', col:'#ff6020', col2:'#c03010', og:true},
  {name:'Ð›ÑƒÐ½Ð½Ð°Ñ Ð¤Ð¾Ñ€ÐµÐ»ÑŒ',    w:[0.8,4.0],  pts:480,  coins:380,  rar:'og', label:'ðŸ‘‘ OG', col:'#e0d8ff', col2:'#8070c0', og:true},
  {name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ð¡Ð°Ð·Ð°Ð½',   w:[3.0,12.0], pts:600,  coins:500,  rar:'og', label:'ðŸ‘‘ OG', col:'#ff80ff', col2:'#c040c0', og:true},
  {name:'Ð—Ð²Ñ‘Ð·Ð´Ð½Ð°Ñ Ð©ÑƒÐºÐ°',    w:[2.0,10.0], pts:580,  coins:480,  rar:'og', label:'ðŸ‘‘ OG', col:'#ffffa0', col2:'#c0c030', og:true},
  {name:'Ð¢Ñ‘Ð¼Ð½Ñ‹Ð¹ Ð¡Ð¾Ð¼',       w:[5.0,20.0], pts:650,  coins:550,  rar:'og', label:'ðŸ‘‘ OG', col:'#3030a0', col2:'#101060', og:true},
  {name:'ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð Ñ‹Ð±Ð°', w:[0.5,3.0],  pts:520,  coins:420,  rar:'og', label:'ðŸ‘‘ OG', col:'#a0ffff', col2:'#30b0b0', og:true},
  {name:'Ð Ñ‹Ð±Ð° Ð”Ñ€ÐµÐ²Ð½Ð¾ÑÑ‚Ð¸',   w:[4.0,15.0], pts:700,  coins:600,  rar:'og', label:'ðŸ‘‘ OG', col:'#d4a820', col2:'#987020', og:true},
  {name:'ÐÐµÐ±ÐµÑÐ½Ñ‹Ð¹ ÐžÐºÑƒÐ½ÑŒ',   w:[1.0,5.0],  pts:510,  coins:410,  rar:'og', label:'ðŸ‘‘ OG', col:'#80c8ff', col2:'#3080c0', og:true},
  {name:'Ð’ÐµÑ‡Ð½Ð°Ñ Ð Ñ‹Ð±ÐºÐ°',     w:[0.2,1.0],  pts:999,  coins:999,  rar:'og', label:'ðŸ‘‘ OG ÐœÐÐšÐ¡', col:'#ffffff', col2:'#c0c0c0', og:true},
  // â•â•â• Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐ«Ð• Ð Ð«Ð‘Ð« â•â•â• (ÑÐºÑÐºÐ»ÑŽÐ·Ð¸Ð² Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ð£Ð´Ð¾Ñ‡ÐºÐ¸)
  {name:'Ð Ð¾Ð·Ð¾Ð²Ñ‹Ð¹ ÐšÐ°Ñ€Ð¿',      w:[1.0,5.0],  pts:800,  coins:700,  rar:'flower', label:'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ', col:'#ff80c0', col2:'#cc4080', og:true, flower:true,
   flowerAnim:'petalFloat'},
  {name:'Ð›Ð¸Ð»ÐµÐ¹Ð½Ð°Ñ Ð©ÑƒÐºÐ°',     w:[2.0,9.0],  pts:900,  coins:800,  rar:'flower', label:'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ', col:'#c060ff', col2:'#8020c0', og:true, flower:true,
   flowerAnim:'lilyPulse'},
  {name:'Ð Ð¾Ð¼Ð°ÑˆÐºÐ¾Ð²Ñ‹Ð¹ Ð¡Ð¾Ð¼',    w:[3.0,14.0], pts:1000, coins:950,  rar:'flower', label:'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ', col:'#fff060', col2:'#c0a000', og:true, flower:true,
   flowerAnim:'daisySpin'},
  {name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ð¢ÑŽÐ»ÑŒÐ¿Ð°Ð½',  w:[0.5,3.0],  pts:1100, coins:1000, rar:'flower', label:'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ', col:'#ff4080', col2:'#ff8000', og:true, flower:true,
   flowerAnim:'rainbowShimmer'},
  {name:'ÐžÑ€Ñ…Ð¸Ð´ÐµÑ-Ð Ñ‹Ð±Ð°',      w:[0.3,2.0],  pts:1200, coins:1100, rar:'flower', label:'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ', col:'#e040ff', col2:'#8000c0', og:true, flower:true,
   flowerAnim:'orchidGlow'},
  {name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ ÐŸÐ¾Ð´ÑÐ¾Ð»Ð½ÑƒÑ…',  w:[4.0,18.0], pts:1500, coins:1400, rar:'flower', label:'ðŸŒ» Ð¦Ð’Ð•Ð¢ÐžÐš Ð›Ð•Ð“Ð•ÐÐ”', col:'#ffd700', col2:'#ff8800', og:true, flower:true,
   flowerAnim:'sunflowerBlaze'},
  // â•â•â• Ð”ÐžÐŸÐžÐ›ÐÐ˜Ð¢Ð•Ð›Ð¬ÐÐ«Ð• OG Ð Ð«Ð‘Ð« â•â•â•
  {name:'ÐÐ»Ð¼Ð°Ð·Ð½Ñ‹Ð¹ ÐšÐ°Ñ€Ð°ÑÑŒ',    w:[0.1,0.5],  pts:800,  coins:700,  rar:'og', label:'ðŸ‘‘ OG', col:'#b0e0ff', col2:'#60a0d0', og:true},
  {name:'Ð ÑƒÐ±Ð¸Ð½Ð¾Ð²Ð°Ñ Ð¤Ð¾Ñ€ÐµÐ»ÑŒ',   w:[0.5,3.0],  pts:750,  coins:650,  rar:'og', label:'ðŸ‘‘ OG', col:'#ff3060', col2:'#c01030', og:true},
  {name:'Ð˜Ð·ÑƒÐ¼Ñ€ÑƒÐ´Ð½Ñ‹Ð¹ Ð¡Ð¾Ð¼',     w:[3.0,15.0], pts:900,  coins:800,  rar:'og', label:'ðŸ‘‘ OG', col:'#20e060', col2:'#108030', og:true},
  {name:'Ð¡Ð°Ð¿Ñ„Ð¸Ñ€Ð¾Ð²Ð°Ñ Ð©ÑƒÐºÐ°',    w:[1.5,8.0],  pts:850,  coins:750,  rar:'og', label:'ðŸ‘‘ OG', col:'#2080ff', col2:'#1040c0', og:true},
  {name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð›ÐµÐ²Ð¸Ð°Ñ„Ð°Ð½',   w:[20.0,80.0],pts:2000, coins:1800, rar:'og', label:'ðŸ‘‘ OG Ð‘ÐžÐ“', col:'#ffd700', col2:'#c09000', og:true},
  {name:'Ð¢ÐµÐ½ÐµÐ²Ð¾Ð¹ Ð£Ð³Ð¾Ñ€ÑŒ',      w:[0.5,4.0],  pts:700,  coins:600,  rar:'og', label:'ðŸ‘‘ OG', col:'#201030', col2:'#100818', og:true},
  {name:'Ð¡Ð¾Ð»Ð½ÐµÑ‡Ð½Ð°Ñ ÐÑ€Ð¾Ð²Ð°Ð½Ð°',  w:[0.5,3.0],  pts:1000, coins:900,  rar:'og', label:'ðŸ‘‘ OG', col:'#fff080', col2:'#d0a000', og:true},
  {name:'ÐšÐ²Ð°Ð½Ñ‚Ð¾Ð²Ð°Ñ Ð Ñ‹Ð±ÐºÐ°',    w:[0.1,0.8],  pts:1300, coins:1200, rar:'og', label:'ðŸ‘‘ OG ÐšÐ’ÐÐÐ¢', col:'#ff00ff', col2:'#8000c0', og:true},
  {name:'Ð›ÐµÐ´ÑÐ½Ð¾Ð¹ Ð”Ñ€Ð°ÐºÐ¾Ð½',     w:[5.0,25.0], pts:1600, coins:1500, rar:'og', label:'ðŸ‘‘ OG', col:'#a0f0ff', col2:'#4090c0', og:true},
];

// ============================================================
// DATA â€” RODS
// ============================================================
const RODS = [
  {id:'wood',   name:'Ð”ÐµÑ€ÐµÐ²ÐµÐ½ÑÐºÐ°Ñ', desc:'ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð´ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ°', price:0,    biteChance:1.0, catchMult:1.0, stats:'ÐšÐ»Ñ‘Ð²: Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹'},
  {id:'bamboo', name:'Ð‘Ð°Ð¼Ð±ÑƒÐºÐ¾Ð²Ð°Ñ',  desc:'Ð›ÐµÐ³Ñ‡Ðµ Ð¸ Ð³Ð¸Ð±Ñ‡Ðµ',             price:80,   biteChance:1.2, catchMult:1.1, stats:'ÐšÐ»Ñ‘Ð²: +20%'},
  {id:'carbon', name:'ÐšÐ°Ñ€Ð±Ð¾Ð½Ð¾Ð²Ð°Ñ',  desc:'Ð¡Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»',      price:250,  biteChance:1.5, catchMult:1.3, stats:'ÐšÐ»Ñ‘Ð²: +50% â€¢ Ð£Ð»Ð¾Ð²: +30%'},
  {id:'magic',  name:'Ð’Ð¾Ð»ÑˆÐµÐ±Ð½Ð°Ñ',   desc:'Ð˜Ð· Ñ‡ÐµÐ³Ð¾ Ð¾Ð½Ð° ÑÐ´ÐµÐ»Ð°Ð½Ð°?',      price:800,  biteChance:2.5, catchMult:2.0, stats:'ÐšÐ»Ñ‘Ð²: x2.5 â€¢ Ð£Ð»Ð¾Ð²: x2'},
  {id:'golden',    name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ',        desc:'Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÑÑ€ÐµÐ´Ð¸ ÑƒÐ´Ð¾Ñ‡ÐµÐº',                  price:2000,  biteChance:4.0, catchMult:3.0, stats:'ÐšÐ»Ñ‘Ð²: x4 â€¢ Ð£Ð»Ð¾Ð²: x3'},
  {id:'rubberduck', name:'Ð ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ Ð£Ñ‚ÐºÐ°', desc:'Ð¡Ñ‚Ñ€Ð°Ð½Ð½Ð°Ñ... Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!',               price:5000,  biteChance:3.5, catchMult:2.5, stats:'ÐšÐ»Ñ‘Ð²: x3.5 â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð­ÐŸÐ˜ÐšÐ˜+ â€¢ +1-100ðŸª™/ÑƒÐ»Ð¾Ð²', special:'duck'},
  {id:'crystal',    name:'ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ',   desc:'Ð˜Ð· Ñ‡Ð¸ÑÑ‚ÐµÐ¹ÑˆÐµÐ³Ð¾ Ð³Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ñ…Ñ€ÑƒÑÑ‚Ð°Ð»Ñ',         price:8000,  biteChance:5.0, catchMult:4.0, stats:'ÐšÐ»Ñ‘Ð²: x5 â€¢ Ð£Ð»Ð¾Ð²: x4 â€¢ Ð ÐµÐ´Ðº. x2'},
  {id:'thunder',    name:'Ð“Ñ€Ð¾Ð¼Ð¾Ð²Ð°Ñ',      desc:'Ð—Ð°Ñ€ÑÐ¶ÐµÐ½Ð° Ð¼Ð¾Ð»Ð½Ð¸ÐµÐ¹ â€” Ñ€Ñ‹Ð±Ð° Ð½Ðµ ÑƒÐ±ÐµÐ¶Ð¸Ñ‚',      price:12000, biteChance:6.0, catchMult:5.0, stats:'ÐšÐ»Ñ‘Ð²: x6 â€¢ Ð£Ð»Ð¾Ð²: x5 â€¢ ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ»Ñ‘Ð²'},
  {id:'void',       name:'Ð‘ÐµÐ·Ð´Ð½Ñ‹',        desc:'Ð˜Ð· Ð³Ð»ÑƒÐ±Ð¸Ð½ Ð³Ð´Ðµ Ð½ÐµÑ‚ ÑÐ²ÐµÑ‚Ð°',                price:25000, biteChance:8.0, catchMult:7.0, stats:'ÐšÐ»Ñ‘Ð²: x8 â€¢ Ð£Ð»Ð¾Ð²: x7 â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹'},
  {id:'shark',      name:'ÐÐºÑƒÐ»ÑŒÑ',        desc:'Ð¡ÐºÑ€Ð°Ñ„Ñ‚Ð»ÐµÐ½Ð° Ð¸Ð· ÐšÐ¾Ð¶Ð¸ ÐÐºÑƒÐ»Ñ‹! ÐŸÑƒÑÐºÐ°ÐµÑ‚ Ð¼Ð¸Ð½Ð¸-Ð°ÐºÑƒÐ» Ð½Ð° Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€ÐºÐ¸', price:0, biteChance:10.0, catchMult:9.0, stats:'ÐšÐ»Ñ‘Ð²: x10 â€¢ ÐœÐ¸Ð½Ð¸-Ð°ÐºÑƒÐ»Ñ‹ Ð¸Ñ‰ÑƒÑ‚ OG! â€¢ Ð’ÑÐµÐ³Ð´Ð° OG', special:'shark', craftable:true},
  // â•â•â• Ð¥ÐÐ Ð”ÐšÐžÐ  Ð£Ð”ÐžÐ§ÐšÐ˜ â•â•â•
  {id:'meteor',     name:'ÐœÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚Ð½Ð°Ñ',   desc:'Ð¡ÐºÐ¾Ð²Ð°Ð½Ð° Ð¸Ð· ÑƒÐ¿Ð°Ð²ÑˆÐµÐ³Ð¾ Ð¼ÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚Ð°. Ð§ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑ‚ÑÑ Ð¶Ð°Ñ€ ÐºÐ¾ÑÐ¼Ð¾ÑÐ°',    price:50000,  biteChance:12.0, catchMult:10.0, stats:'ÐšÐ»Ñ‘Ð²: x12 â€¢ x10 ÑƒÐ»Ð¾Ð² â€¢ ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ñ‹', special:'meteor'},
  {id:'dragon',     name:'Ð”Ñ€Ð°ÐºÐ¾Ð½ÑŒÑ',      desc:'Ð’Ñ‹Ñ‚Ð¾Ñ‡ÐµÐ½Ð° Ð¸Ð· ÐºÐ¾ÑÑ‚Ð¸ Ð´Ñ€Ð°ÐºÐ¾Ð½Ð°. Ð”Ñ‹ÑˆÐ¸Ñ‚ Ð¾Ð³Ð½Ñ‘Ð¼ Ð¿Ñ€Ð¸ Ð·Ð°Ð±Ñ€Ð¾ÑÐµ',        price:80000,  biteChance:15.0, catchMult:12.0, stats:'ÐšÐ»Ñ‘Ð²: x15 â€¢ x12 â€¢ Ð”Ñ€Ð°ÐºÐ¾-ÑƒÐ»Ð¾Ð² (Ð¼ÐµÐ³Ð° Ñ€Ñ‹Ð±Ñ‹)', special:'dragon'},
  {id:'poseidon',   name:'Ð¢Ñ€ÐµÐ·ÑƒÐ±ÐµÑ† ÐŸÐ¾ÑÐµÐ¹Ð´Ð¾Ð½Ð°', desc:'Ð›Ð¸Ñ‡Ð½Ð¾Ðµ Ð¾Ñ€ÑƒÐ¶Ð¸Ðµ Ð±Ð¾Ð³Ð° Ð¼Ð¾Ñ€ÐµÐ¹. Ð Ñ‹Ð±Ñ‹ ÑÐ°Ð¼Ð¸ Ð¿Ñ€Ñ‹Ð³Ð°ÑŽÑ‚ Ð½Ð° ÐºÑ€ÑŽÑ‡Ð¾Ðº',price:120000, biteChance:18.0, catchMult:15.0, stats:'ÐšÐ»Ñ‘Ð²: x18 â€¢ x15 â€¢ ÐÐ²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑÐµÐº', special:'poseidon'},
  {id:'quantum',    name:'ÐšÐ²Ð°Ð½Ñ‚Ð¾Ð²Ð°Ñ',     desc:'Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸ÑÑ… Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾',           price:200000, biteChance:20.0, catchMult:18.0, stats:'ÐšÐ»Ñ‘Ð²: x20 â€¢ x18 â€¢ 2 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð·!', special:'quantum'},
  {id:'celestial',  name:'ÐÐµÐ±ÐµÑÐ½Ð°Ñ',      desc:'Ð£Ð¿Ð°Ð»Ð° Ñ Ð½ÐµÐ±ÐµÑ. Ð›Ð¾Ð²Ð¸Ñ‚ Ñ€Ñ‹Ð± Ð¸Ð· Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð²ÑÐµÐ»ÐµÐ½Ð½Ñ‹Ñ…',        price:350000, biteChance:25.0, catchMult:22.0, stats:'ÐšÐ»Ñ‘Ð²: x25 â€¢ x22 â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG+Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹', special:'celestial'},
  {id:'apocalypse', name:'ÐÐ¿Ð¾ÐºÐ°Ð»Ð¸Ð¿ÑÐ¸Ñ',   desc:'ÐšÐžÐÐ•Ð¦ Ð’Ð¡Ð•ÐœÐ£. Ð›Ð¾Ð¼Ð°ÐµÑ‚ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð·Ð°Ð±Ñ€Ð¾ÑÐµ',         price:999999, biteChance:50.0, catchMult:50.0, stats:'ÐšÐ»Ñ‘Ð²: x50 â€¢ x50 â€¢ Ð’Ð¡Ð Ð¡Ð ÐÐ—Ð£ â€¢ ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ»Ñ‘Ð²', special:'apocalypse'},
  // â•â•â• Ð£Ð›Ð¬Ð¢Ð Ð Ð£Ð”ÐžÐ§ÐšÐ˜ â•â•â•
  {id:'mech',    name:'ÐœÐµÑ…Ð£Ð´Ð¾Ñ‡ÐºÐ° 9000',     desc:'ÐœÐµÑ…Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑˆÐµÐ´ÐµÐ²Ñ€ Ñ ÑˆÐµÑÑ‚ÐµÑ€Ñ‘Ð½ÐºÐ°Ð¼Ð¸, Ð¿Ð¾Ñ€ÑˆÐ½ÑÐ¼Ð¸ Ð¸ Ð˜Ð˜-Ñ‡Ð¸Ð¿Ð¾Ð¼.',        price:80000,  biteChance:15.0, catchMult:12.0, stats:'ÐšÐ»Ñ‘Ð²: x15 â€¢ ÐÐ²Ñ‚Ð¾-Ð¿Ñ€Ð¸Ñ†ÐµÐ» â€¢ OG+10% â€¢ ÐœÐµÑ…-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°',    detail:'Ð“Ð¸Ð¿ÐµÑ€-Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ', owned:false, equipped:false},
  {id:'cosmic',  name:'ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ',         desc:'Ð¡Ð´ÐµÐ»Ð°Ð½Ð° Ð¸Ð· Ð¼ÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚Ð°. Ð˜ÑÐºÑ€Ð¸Ð²Ð»ÑÐµÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚ÑŒ Ñ€Ñ‹Ð±Ñƒ.', price:120000, biteChance:20.0, catchMult:15.0, stats:'ÐšÐ»Ñ‘Ð²: x20 â€¢ Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ñ Ñ€Ñ‹Ð±Ñ‹ â€¢ OG Ð²ÑÐµÐ³Ð´Ð° â€¢ ÐšÐ¾ÑÐ¼Ð¾Ñ',    detail:'Ð“Ð¸Ð¿ÐµÑ€-Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ', owned:false, equipped:false},
  {id:'demonic', name:'Ð”ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ',        desc:'ÐŸÑ€Ð¾Ð¿Ð¸Ñ‚Ð°Ð½Ð° ÐºÑ€Ð¾Ð²ÑŒÑŽ Ñ‚Ñ‘Ð¼Ð½Ñ‹Ñ… ÑÑƒÑ‰ÐµÑÑ‚Ð². Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð›Ð•Ð“Ð•ÐÐ”Ð« Ð¸ OG.',            price:200000, biteChance:25.0, catchMult:20.0, stats:'ÐšÐ»Ñ‘Ð²: x25 â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG/Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ â€¢ +666ðŸª™ Ð·Ð° ÑƒÐ»Ð¾Ð²',       detail:'Ð“Ð¸Ð¿ÐµÑ€-Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ', owned:false, equipped:false},
  {id:'godly',   name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð¾Ð³Ð¾Ð²',        desc:'ÐœÐÐšÐ¡Ð˜ÐœÐÐ›Ð¬ÐÐÐ¯ Ð£Ð”ÐžÐ§ÐšÐ. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð° ÑÐ°Ð¼Ð¸Ð¼Ð¸ Ð±Ð¾Ð³Ð°Ð¼Ð¸ Ñ€Ñ‹Ð±Ð°Ð»ÐºÐ¸.',               price:500000, biteChance:50.0, catchMult:30.0, stats:'ÐšÐ»Ñ‘Ð²: x50 â€¢ x30 ÑƒÐ»Ð¾Ð² â€¢ Ð’Ð¡Ð• Ð Ð«Ð‘Ð« â€¢ Ð‘ÐžÐ“ Ð Ð«Ð‘ÐÐ›ÐšÐ˜',       detail:'Ð‘ÐžÐ“-Ð¢Ð˜Ð•Ð ',        owned:false, equipped:false},
  {id:'flower',  name:'Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',    desc:'Ð¡Ð¾Ð·Ð´Ð°Ð½Ð° Ð¸Ð· Ð¶Ð¸Ð²Ñ‹Ñ… Ñ†Ð²ÐµÑ‚Ð¾Ð². Ð›Ð¾Ð²Ð¸Ñ‚ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ð Ñ‹Ð± Ð¸ Ð±Ð°Ñ„Ñ„Ð¸Ñ‚ ÑÐ°Ð´ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ!', price:0, biteChance:30.0, catchMult:25.0, stats:'ÐšÐ»Ñ‘Ð²: x30 â€¢ x25 â€¢ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð Ñ‹Ð±Ñ‹ â€¢ Ð‘Ð°Ñ„Ñ„ Ð¡Ð°Ð´Ð° â€¢ ÐÐ½Ð¸Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ!', detail:'ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐš', owned:false, equipped:false, craftable:true, craftType:'flower'},
  {id:'easter',  name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° ÐŸÐ°ÑÑ…Ð¸',         desc:'Ð¡ÐºÑ€Ð°Ñ„Ñ‚Ð»ÐµÐ½Ð° Ð¸Ð· 30 ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð² Ñ Ð±Ð°Ñ„Ñ„Ð¾Ð¼ Cha Cha! ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ â€” Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº +10000ðŸª™!', price:0, biteChance:8.0, catchMult:6.0, stats:'ÐšÐ»Ñ‘Ð²: x8 â€¢ x6 â€¢ +10000ðŸª™ Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº â€¢ ðŸ’ƒ Cha Cha Ð±Ð°Ñ„Ñ„', detail:'ðŸ° ÐŸÐÐ¡Ð¥Ð', owned:false, equipped:false, craftable:true, craftType:'easter'},
  {id:'marble',  name:'ÐœÑ€Ð°Ð¼Ð¾Ñ€Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',    desc:'Ð’Ñ‹ÑÐµÑ‡ÐµÐ½Ð° Ð¸Ð· Ñ‡Ð¸ÑÑ‚ÐµÐ¹ÑˆÐµÐ³Ð¾ Ð¼Ñ€Ð°Ð¼Ð¾Ñ€Ð°. Ð‘Ñ€Ð¾ÑÐ°ÐµÑ‚ Ð¼Ñ€Ð°Ð¼Ð¾Ñ€Ð½Ñ‹Ð¹ ÑˆÐ°Ñ€ Ð² Ð²Ð¾Ð´Ñƒ â€” Ã—2 Ðº Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ðµ!', price:750000, biteChance:40.0, catchMult:35.0, stats:'ÐšÐ»Ñ‘Ð²: x40 â€¢ x35 ÑƒÐ»Ð¾Ð² â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG+Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ â€¢ Ã—2 Ñ†ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸', detail:'ðŸª¨ ÐœÐ ÐÐœÐžÐ ', owned:false, equipped:false, special:'marble'},
  // â•â•â• ÐŸÐ Ð˜Ð—Ð ÐÐš â•â•â•
  {id:'ghost',   name:'ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',   desc:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¸Ð· Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ. ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð·Ð°Ð±Ñ€Ð¾Ñ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾ Ð¼ÐµÐ½ÑÐµÑ‚ ÑÐ¸Ð»Ñƒ ÐºÐ»Ñ‘Ð²Ð° â€” Ð¾Ñ‚ ÑÐ»Ð°Ð±Ð¾Ð¹ Ð´Ð¾ x3!', price:15000, biteChance:1.0, catchMult:2.0, stats:'ÐšÐ»Ñ‘Ð²: Ð¡Ð›Ð£Ð§ÐÐ™ÐÐ«Ð™ (x0.3â€“x3) â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ Ð¸ Ð½Ð¸Ð¶Ðµ â€¢ ÐÐ²Ð°Ð½Ñ‚ÑŽÑ€Ð°!', detail:'ðŸ‘» ÐŸÐ Ð˜Ð—Ð ÐÐš', owned:false, equipped:false, special:'ghost'},

  // â•â•â• ÐÐžÐ’Ð«Ð• Ð¡Ð£ÐŸÐ•Ð Ð£Ð”ÐžÐ§ÐšÐ˜ â•â•â•
  {id:'pharaoh',  name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð°',      desc:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾ Ð•Ð³Ð¸Ð¿Ñ‚Ð°, Ð¿Ñ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ Ð¿Ð¸Ñ€Ð°Ð¼Ð¸Ð´! ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ â€” Ð²ÑÐµ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ ÑƒÐ´Ð²Ð°Ð¸Ð²Ð°ÑŽÑ‚ÑÑ! ÐÐ¾ Ð¸Ð½Ð¾Ð³Ð´Ð° Ñ€Ñ‹Ð±Ð° ÐŸÐ ÐžÐšÐ›Ð˜ÐÐÐ•Ð¢ Ñ‚ÐµÐ±Ñ...', price:400000, biteChance:22.0, catchMult:18.0, stats:'ÐšÐ»Ñ‘Ð²: x22 â€¢ Ð£Ð»Ð¾Ð²: x18 â€¢ Ã—2 Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ â€¢ ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ (Ñ€ÐµÐ´.) â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG+Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹', detail:'ðŸº Ð¤ÐÐ ÐÐžÐ', owned:false, equipped:false, special:'pharaoh'},
  {id:'neon',     name:'ÐÐµÐ¾Ð½-Ð¢ÑƒÑ€Ð±Ð¾ Ð£Ð´Ð¾Ñ‡ÐºÐ°',   desc:'Ð˜Ð· 2077 Ð³Ð¾Ð´Ð°! ÐšÐ°Ð¶Ð´Ñ‹Ð¹ 5Ð¹ Ð·Ð°Ð±Ñ€Ð¾Ñ â€” ÐÐ’Ð¢Ðž-Ð£Ð›ÐžÐ’ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾. Ð§Ð¸Ð¿ ÑƒÐ»Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ Ð±Ð¸Ð¾ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹ Ñ€Ñ‹Ð± Ñ‡ÐµÑ€ÐµÐ· Wi-Fi!', price:300000, biteChance:28.0, catchMult:20.0, stats:'ÐšÐ»Ñ‘Ð²: x28 â€¢ ÐÐ²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² ÐºÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð·Ð°Ð±Ñ€Ð¾ÑÐ¾Ð² â€¢ Wi-Fi ÑÐºÐ°Ð½ÐµÑ€ Ñ€Ñ‹Ð± â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG', detail:'ðŸ’» ÐÐ•ÐžÐ', owned:false, equipped:false, special:'neon'},
  {id:'kraken',   name:'Ð©ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ ÐšÑ€Ð°ÐºÐµÐ½Ð°',    desc:'Ð’Ñ‹Ñ€Ð²Ð°Ð½Ð¾ Ñƒ Ð¶Ð¸Ð²Ð¾Ð³Ð¾ ÐºÑ€Ð°ÐºÐµÐ½Ð°! ÐŸÑ€Ð¸ Ð¿Ð¾Ð¸Ð¼ÐºÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹/OG â€” ÐžÐ“Ð ÐžÐœÐÐ«Ð™ Ð’Ð—Ð Ð«Ð’ Ð¼Ð¾Ð½ÐµÑ‚ +5000ðŸª™ Ð¸ Ð¼Ð¸Ð½Ð¸-ÐºÑ€Ð°ÐºÐµÐ½ Ð¿Ð¾Ð¶Ð¸Ñ€Ð°ÐµÑ‚ ÑÐ»Ð°Ð±Ñ‹Ñ… Ñ€Ñ‹Ð±!', price:600000, biteChance:35.0, catchMult:28.0, stats:'ÐšÐ»Ñ‘Ð²: x35 â€¢ Ð£Ð»Ð¾Ð²: x28 â€¢ +5000ðŸª™ Ð½Ð° OG/Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ â€¢ ÐœÐ¸Ð½Ð¸-ÐºÑ€Ð°ÐºÐµÐ½ â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG', detail:'ðŸ™ ÐšÐ ÐÐšÐ•Ð', owned:false, equipped:false, special:'kraken'},
  {id:'time',     name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð’Ñ€ÐµÐ¼ÐµÐ½Ð¸',      desc:'ÐžÐ¡Ð¢ÐÐÐÐ’Ð›Ð˜Ð’ÐÐ•Ð¢ Ð’Ð Ð•ÐœÐ¯ Ð¿Ñ€Ð¸ Ð¿Ð¾ÐºÐ»Ñ‘Ð²ÐºÐµ! 10 ÑÐµÐºÑƒÐ½Ð´ Ð½Ð° Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÑƒ. Ð›Ð¾Ð²Ð¸Ñ‚ Ñ€Ñ‹Ð± Ð¸Ð· ÐŸÐ ÐžÐ¨Ð›ÐžÐ“Ðž Ð¸ Ð‘Ð£Ð”Ð£Ð©Ð•Ð“Ðž â€” 3 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð·!', price:888888, biteChance:45.0, catchMult:35.0, stats:'ÐšÐ»Ñ‘Ð²: x45 â€¢ Ð£Ð»Ð¾Ð²: x35 â€¢ Ð¡Ð¢ÐžÐŸ-Ð’Ð Ð•ÐœÐ¯ Ð¿Ñ€Ð¸ ÐºÐ»Ñ‘Ð²Ðµ â€¢ 3 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð· â€¢ Ð›ÑŽÐ±Ð°Ñ Ñ€ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ', detail:'â³ Ð’Ð Ð•ÐœÐ¯', owned:false, equipped:false, special:'time'},

  // â•â•â• ÐÐžÐ’Ð«Ð• Ð£Ð”ÐžÐ§ÐšÐ˜ Ð’ ÐœÐÐ“ÐÐ—Ð• (4 ÑˆÑ‚ÑƒÐºÐ¸ Ñ Ð½ÐµÐ¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¼Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸) â•â•â•
  {id:'blackhole', name:'Ð§Ñ‘Ñ€Ð½Ð°Ñ Ð”Ñ‹Ñ€Ð°',         desc:'Ð—Ð°ÑÐ°ÑÑ‹Ð²Ð°ÐµÑ‚ Ñ€Ñ‹Ð±Ñƒ Ð¸Ð· ÑÐ¾ÑÐµÐ´Ð½Ð¸Ñ… Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ð¹! ÐšÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑƒÐ»Ð¾Ð²Ð° â€” Ð“Ð ÐÐ’Ð˜Ð¢ÐÐ¦Ð˜ÐžÐÐÐ«Ð™ Ð’Ð—Ð Ð«Ð’ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ 5 ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ñ… Ñ€Ñ‹Ð± Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ!', price:999000, biteChance:60.0, catchMult:40.0, stats:'ÐšÐ»Ñ‘Ð²: x60 â€¢ x40 ÑƒÐ»Ð¾Ð² â€¢ Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ñ: +5 Ñ€Ñ‹Ð± ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑƒÐ»Ð¾Ð²Ð° â€¢ Ð›ÑŽÐ±Ñ‹Ðµ Ñ€Ñ‹Ð±Ñ‹', detail:'ðŸ•³ï¸ Ð“Ð˜ÐŸÐ•Ð Ð£Ð›Ð¬Ð¢Ð Ð', owned:false, equipped:false, special:'blackhole', newrod:true},
  {id:'rainbow',   name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',      desc:'ÐŸÐµÑ€ÐµÐ»Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð²ÑÐµÐ¼Ð¸ Ñ†Ð²ÐµÑ‚Ð°Ð¼Ð¸! ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð² Ð¼ÐµÐ½ÑÐµÑ‚ Ñ†Ð²ÐµÑ‚ Ð²Ð¾Ð´Ñ‹ Ð¸ Ð´Ð°Ñ‘Ñ‚ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ: Ð¼Ð¾Ð½ÐµÑ‚Ñ‹, XP, Ð±ÑƒÑÑ‚ÐµÑ€ ÐºÐ»Ñ‘Ð²Ð° Ð¸Ð»Ð¸ Ñ€ÐµÐ´ÐºÐ°Ñ Ñ€Ñ‹Ð±Ð°!', price:444444, biteChance:30.0, catchMult:22.0, stats:'ÐšÐ»Ñ‘Ð²: x30 â€¢ x22 ÑƒÐ»Ð¾Ð² â€¢ Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð² â€¢ Ð Ð°Ð´ÑƒÐ³Ð° Ð² Ð²Ð¾Ð´Ðµ', detail:'ðŸŒˆ Ð ÐÐ”Ð£Ð“Ð', owned:false, equipped:false, special:'rainbow', newrod:true},
  {id:'magnet',    name:'ÐœÐ°Ð³Ð½Ð¸Ñ‚Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',     desc:'ÐŸÑ€Ð¸Ñ‚ÑÐ³Ð¸Ð²Ð°ÐµÑ‚ Ð²ÑÐµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ñ‹! Ð˜Ð½Ð¾Ð³Ð´Ð° Ð²Ñ‹Ñ‚Ð°ÑÐºÐ¸Ð²Ð°ÐµÑ‚ ÑÑƒÐ½Ð´ÑƒÐºÐ¸ Ñ Ð¼Ð¾Ð½ÐµÑ‚Ð°Ð¼Ð¸, Ð±ÑƒÑÑ‚ÐµÑ€Ð°Ð¼Ð¸ Ð¸ ÑÐºÐ¸Ð½Ð°Ð¼Ð¸ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐ¾ Ð´Ð½Ð° Ñ€ÐµÐºÐ¸!', price:666666, biteChance:40.0, catchMult:30.0, stats:'ÐšÐ»Ñ‘Ð²: x40 â€¢ x30 â€¢ Ð¨Ð°Ð½Ñ Ð²Ñ‹Ñ‚Ð°Ñ‰Ð¸Ñ‚ÑŒ Ð¡Ð£ÐÐ”Ð£Ðš (Ð¼Ð¾Ð½ÐµÑ‚Ñ‹/Ð±ÑƒÑÑ‚ÐµÑ€/ÑÐºÐ¸Ð½)', detail:'ðŸ§² ÐœÐÐ“ÐÐ˜Ð¢', owned:false, equipped:false, special:'magnet', newrod:true},
  {id:'laser',     name:'Ð›Ð°Ð·ÐµÑ€Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ°',      desc:'ÐÐ°Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð»Ð°Ð·ÐµÑ€Ð½Ñ‹Ð¼ Ð¿Ñ€Ð¸Ñ†ÐµÐ»Ð¾Ð¼! ÐŸÑ€Ð¸ Ð¿Ð¾Ð¸Ð¼ÐºÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹ â€” Ð›ÐÐ—Ð•Ð ÐÐ«Ð™ Ð›Ð£Ð§ Ð¸ÑÐ¿Ð°Ñ€ÑÐµÑ‚ Ð²Ð¾Ð´Ñƒ Ð¸ Ð¿Ð¾ÑÐ²Ð»ÑÑŽÑ‚ÑÑ 3 OG Ñ€Ñ‹Ð±Ñ‹ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾!', price:777777, biteChance:50.0, catchMult:38.0, stats:'ÐšÐ»Ñ‘Ð²: x50 â€¢ x38 â€¢ ÐÐ° Ð›ÐµÐ³ÐµÐ½Ð´Ñƒ â†’ 3 OG Ñ€Ñ‹Ð±Ñ‹ â€¢ Ð›Ð°Ð·ÐµÑ€-ÑÑ„Ñ„ÐµÐºÑ‚', detail:'ðŸ”´ Ð›ÐÐ—Ð•Ð ', owned:false, equipped:false, special:'laser', newrod:true},

  // â•â•â• Ð›Ð˜ÐœÐ˜Ð¢Ð˜Ð ÐžÐ’ÐÐÐÐ«Ð• Ð£Ð”ÐžÐ§ÐšÐ˜ (Ð²Ñ‹Ð´Ð°ÑŽÑ‚ÑÑ Ð½Ð° Ð¸Ð²ÐµÐ½Ñ‚Ðµ) â•â•â•
  {id:'bakintsa',  name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð°ÐºÐ¸Ð½Ñ†Ð°',       desc:'Ð›Ð˜ÐœÐ˜Ð¢Ð˜Ð ÐžÐ’ÐÐÐÐÐ¯! Ð’Ñ‹Ð´Ð°Ð½Ð° ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼! Ð¡Ð´ÐµÐ»Ð°Ð½Ð° Ð¸Ð· Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐ³Ð¾ Ð·Ð¾Ð»Ð¾Ñ‚Ð° Ð‘Ð°ÐºÑƒ! ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ â€” 2500ðŸª™ Ð¸ Ð¼Ð¸Ð½Ð¸-ÑˆÐ¾Ñƒ Ð½Ð¾Ñ‚Ñƒ!', price:0, biteChance:100.0, catchMult:80.0, stats:'ÐšÐ»Ñ‘Ð²: x100 â€¢ x80 ÑƒÐ»Ð¾Ð² â€¢ +2500ðŸª™/ÑƒÐ»Ð¾Ð² â€¢ Ð›Ð˜ÐœÐ˜Ð¢ â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñƒ Ð¸Ð·Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ…', detail:'ðŸ‘‘ Ð›Ð˜ÐœÐ˜Ð¢-Ð‘ÐÐšÐ£', owned:false, equipped:false, special:'bakintsa', limited:true},
  {id:'hugiwugi',  name:'Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸',    desc:'Ð›Ð˜ÐœÐ˜Ð¢Ð˜Ð ÐžÐ’ÐÐÐÐÐ¯! Ð’Ñ‹Ð´Ð°Ð½Ð° ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼! ÐžÐ±Ð¼Ð¾Ñ‚Ð°Ð½Ð° Ð² ÑÐ¸Ð½ÑŽÑŽ Ñ‚ÐºÐ°Ð½ÑŒ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸! Ð›Ð¾Ð²Ð¸Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ ÑƒÐ¶Ð°ÑÐ°ÑŽÑ‰Ð¸Ð¹ ÐºÑ€Ð¸Ðº Ð¿Ñ€Ð¸ Ð¿Ð¾ÐºÐ»Ñ‘Ð²ÐºÐµ!', price:0, biteChance:120.0, catchMult:100.0, stats:'ÐšÐ»Ñ‘Ð²: x120 â€¢ x100 ÑƒÐ»Ð¾Ð² â€¢ Ð›Ð˜ÐœÐ˜Ð¢ â€¢ Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG â€¢ Ð¡ÐºÐ¸Ð½ ÐšÐ¸ÑÐ¸Ð¼Ð¸ÑÐ¸', detail:'ðŸ’™ Ð›Ð˜ÐœÐ˜Ð¢-Ð¥ÐÐ“Ð˜', owned:false, equipped:false, special:'hugiwugi', limited:true},
];

// ============================================================
// DATA â€” BAIT
// ============================================================
const BAITS = [
  {id:'worm',   name:'Ð§ÐµÑ€Ð²ÑÐº',       desc:'ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ°Ñ Ð½Ð°Ð¶Ð¸Ð²ÐºÐ°',  price:15, qty:0, biteBonus:.10, icon:'ðŸª±'},
  {id:'maggot', name:'ÐžÐ¿Ð°Ñ€Ñ‹Ñˆ',       desc:'ÐœÐ¾Ñ‚Ñ‹Ð»ÑŒ Ð´Ð»Ñ Ð¾ÐºÑƒÐ½Ñ',      price:20, qty:0, biteBonus:.20, icon:'ðŸ›'},
  {id:'bread',  name:'Ð¥Ð»ÐµÐ±Ð½Ñ‹Ð¹ Ð¼ÑÐºÐ¸Ñˆ',desc:'Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾ Ð´Ð»Ñ ÐºÐ°Ñ€Ð°ÑÑ',     price:10, qty:0, biteBonus:.15, icon:'ðŸž'},
  {id:'corn',   name:'ÐšÑƒÐºÑƒÑ€ÑƒÐ·Ð°',     desc:'Ð”Ð»Ñ ÐºÑ€ÑƒÐ¿Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹',      price:25, qty:0, biteBonus:.25, icon:'ðŸŒ½'},
  {id:'cheese', name:'Ð¡Ñ‹Ñ€',          desc:'Ð ÐµÐ´ÐºÐ°Ñ Ñ€Ñ‹Ð±Ð° ÐºÐ»ÑŽÑ‘Ñ‚ Ñ‡Ð°Ñ‰Ðµ',price:35, qty:0, biteBonus:.30, icon:'ðŸ§€'},
];

// ============================================================
// DATA â€” LURES
// ============================================================
const LURES = [
  {id:'spinner', name:'Ð’ÐµÑ€Ñ‚ÑƒÑˆÐºÐ° â„–1', desc:'Ð”Ð»Ñ Ñ‰ÑƒÐºÐ¸ Ð¸ Ð¾ÐºÑƒÐ½Ñ',  price:50, qty:0, rareBonus:.10, icon:'ðŸŒ€'},
  {id:'wobbler', name:'Ð’Ð¾Ð±Ð»ÐµÑ€',      desc:'Ð˜Ð¼Ð¸Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ñ€Ñ‹Ð±ÐºÑƒ',   price:80, qty:0, rareBonus:.20, icon:'ðŸ '},
  {id:'jig',     name:'Ð”Ð¶Ð¸Ð³',        desc:'Ð”Ð»Ñ ÑÑƒÐ´Ð°ÐºÐ° Ð¸ Ñ‰ÑƒÐºÐ¸', price:60, qty:0, rareBonus:.15, icon:'ðŸ’ '},
  {id:'spoon',   name:'Ð‘Ð»ÐµÑÐ½Ð°',      desc:'Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð°Ñ',     price:45, qty:0, rareBonus:.12, icon:'ðŸ¥„'},
];

// ============================================================
// DATA â€” UPGRADES
// ============================================================
const UPGRADES = [
  {id:'bigger_bag',  name:'Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ ÑÑƒÐ¼ÐºÐ°',    desc:'Ð‘Ð¾Ð»ÑŒÑˆÐµ Ñ€Ñ‹Ð±Ñ‹ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ðµ',      price:120, effect:'Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ: 30 ÑÐ»Ð¾Ñ‚Ð¾Ð²'},
  {id:'fish_radar',  name:'Ð Ñ‹Ð±Ð¸Ð¹ Ñ€Ð°Ð´Ð°Ñ€',      desc:'Ð’Ð¸Ð´Ð¸ÑˆÑŒ Ñ‚ÐµÐ½Ð¸ Ñ€Ñ‹Ð± Ð¿Ð¾Ð´ Ð²Ð¾Ð´Ð¾Ð¹',    price:300, effect:'Ð Ñ‹Ð±Ñ‹ Ð²Ð¸Ð´Ð½Ñ‹'},
  {id:'auto_reel',   name:'Ð­Ð»ÐµÐºÑ‚Ñ€Ð¾ÐºÐ°Ñ‚ÑƒÑˆÐºÐ°',   desc:'ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð´ÑÐµÐºÐ°ÐµÑ‚',      price:500, effect:'ÐÐ²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°'},
  {id:'lucky_charm', name:'Ð Ñ‹Ð±Ð°Ñ†ÐºÐ¸Ð¹ Ð°Ð¼ÑƒÐ»ÐµÑ‚',  desc:'ÐŸÐ¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑˆÐ°Ð½Ñ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ñ…',    price:400, effect:'Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹: +50%'},
  {id:'fast_bite',   name:'Ð§ÑƒÐ´Ð¾-Ð½Ð°Ð¶Ð¸Ð²ÐºÐ°',     desc:'Ð Ñ‹Ð±Ð° ÐºÐ»ÑŽÑ‘Ñ‚ Ð½Ð°Ð¼Ð½Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‰Ðµ',     price:350, effect:'ÐšÐ»Ñ‘Ð²: +100%'},
];

// ============================================================
// SAVE / LOAD  (localStorage)
// ============================================================
const SAVE_KEY = 'fishing_reborn_v3';

function saveGame() {
  const data = {
    coins: gs.coins,
    score: gs.score,
    fishCount: gs.fishCount,
    energy: gs.energy,
    inventory: gs.inventory,
    maxInv: gs.maxInv,
    currentRodId: gs.currentRod ? gs.currentRod.id : 'wood',
    rods: RODS.map(r=>({id:r.id,owned:r.owned||false,equipped:r.equipped||false})),
    baits: BAITS.map(b=>({id:b.id,qty:b.qty})),
    lures: LURES.map(l=>({id:l.id,qty:l.qty})),
    upgrades: UPGRADES.map(u=>({id:u.id,owned:u.owned||false})),
  };
  try { localStorage.setItem(SAVE_KEY, JSON.stringify(data)); } catch(e){}
  try {
    const extra = {
      pikaCoins: gs.pikaCoins || 0,
      pikaCatchCount: gs.pikaCatchCount || 0,
      mapMode: (gs.mapMode==='bum') ? 'normal' : (gs.mapMode || 'normal'),
      coastUnlocked: gs.coastUnlocked || false,
      hardcoreUnlocked: gs.hardcoreUnlocked || false,
      caughtPokemon: gs.caughtPokemon || [],
      xp: gs.xp || 0,
      achievements: gs.achievements || {},
      catchStreak: gs.catchStreak || 0,
      _caughtLegend: gs._caughtLegend || false,
      _coastCatch: gs._coastCatch || false,
      _duckCatches: gs._duckCatches || 0,
      _soldAll: gs._soldAll || false,
      sharkSkins: gs.sharkSkins || 0,
      easterChaChaKills: gs.easterChaChaKills || 0,
      easterRodsUnlocked: gs.easterRodsUnlocked || false,
    };
    localStorage.setItem('fishing_reborn_extra', JSON.stringify(extra));
  } catch(e){}
}

function loadGame() {
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if(!raw) return;
    const data = JSON.parse(raw);
    gs.coins    = data.coins    ?? 150;
    gs.score    = data.score    ?? 0;
    gs.fishCount= data.fishCount?? 0;
    gs.energy   = data.energy   ?? 65;
    gs.inventory= data.inventory?? [];
    gs.maxInv   = data.maxInv   ?? 20;
    // Rods â€” ÑÐ½Ð°Ñ‡Ð°Ð»Ð° ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²ÑÐµ Ñ„Ð»Ð°Ð³Ð¸, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ
    RODS.forEach(r=>{ r.owned=false; r.equipped=false; });
    if(data.rods) data.rods.forEach(dr=>{ const r=RODS.find(x=>x.id===dr.id); if(r){r.owned=dr.owned;r.equipped=dr.equipped;} });
    // ðŸ”’ Ð›Ð¸Ð¼Ð¸Ñ‚Ð½Ñ‹Ðµ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐ¹Ð²Ð°
    // ÐžÐ½Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð¸Ð²ÐµÐ½Ñ‚ Ð¸Ñ… Ð²Ñ‹Ð´Ð°Ð²Ð°Ð» (_hugiwugiGiven/_bakintsaGiven)
    try {
      const _ex2raw = localStorage.getItem('fishing_reborn_extra2');
      const _ex2 = _ex2raw ? JSON.parse(_ex2raw) : {};
      RODS.forEach(r => {
        if(!r.limited) return;
        if(r.id === 'hugiwugi' && _ex2._hugiwugiGiven) return;
        if(r.id === 'bakintsa' && _ex2._bakintsaGiven) return;
        r.owned = false;
        r.equipped = false;
      });
    } catch(e) {}
    // Baits
    if(data.baits) data.baits.forEach(db=>{ const b=BAITS.find(x=>x.id===db.id); if(b) b.qty=db.qty; });
    // Lures
    if(data.lures) data.lures.forEach(dl=>{ const l=LURES.find(x=>x.id===dl.id); if(l) l.qty=dl.qty; });
    // Upgrades
    if(data.upgrades) data.upgrades.forEach(du=>{ const u=UPGRADES.find(x=>x.id===du.id); if(u) u.owned=du.owned; });
    // Current rod â€” Ð¿Ð¾ equipped, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾ currentRodId, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿ÐµÑ€Ð²Ð°Ñ
    let equippedRod = RODS.find(r=>r.equipped);
    if(!equippedRod && data.currentRodId) equippedRod = RODS.find(r=>r.id===data.currentRodId);
    if(!equippedRod) equippedRod = RODS[0];
    equippedRod.equipped = true;
    equippedRod.owned = true;
    gs.currentRod = equippedRod;
    RODS[0].owned = true;
    // Apply upgrade effects silently
    if(UPGRADES.find(u=>u.id==='bigger_bag')?.owned) gs.maxInv=30;
  } catch(e) { console.warn('Load failed', e); }
  // Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ extra Ð¿Ð¾Ð»Ñ
  try {
    const rawExtra = localStorage.getItem('fishing_reborn_extra');
    if(rawExtra) {
      const extra = JSON.parse(rawExtra);
      gs.pikaCoins        = extra.pikaCoins       ?? 0;
      gs.pikaCatchCount   = extra.pikaCatchCount   ?? 0;
      gs.mapMode          = extra.mapMode          ?? 'normal';
      gs.coastUnlocked    = extra.coastUnlocked    ?? false;
      gs.hardcoreUnlocked = extra.hardcoreUnlocked ?? false;
      gs.caughtPokemon    = extra.caughtPokemon    ?? [];
      gs.xp               = extra.xp               ?? 0;
      gs.achievements     = extra.achievements     ?? {};
      gs.catchStreak      = extra.catchStreak      ?? 0;
      gs._caughtLegend    = extra._caughtLegend    ?? false;
      gs._coastCatch      = extra._coastCatch      ?? false;
      gs._duckCatches     = extra._duckCatches     ?? 0;
      gs._soldAll         = extra._soldAll         ?? false;
      gs.sharkSkins       = extra.sharkSkins       ?? 0;
      gs.easterChaChaKills  = extra.easterChaChaKills  ?? 0;
      gs.easterRodsUnlocked = extra.easterRodsUnlocked ?? false;
    }
  } catch(e) { console.warn('Load extra failed', e); }
  // ÐšÐžÐœÐŸÐ•ÐÐ¡ÐÐ¦Ð˜Ð¯ v2: +1 000 000 Ð¼Ð¾Ð½ÐµÑ‚ + Ð²ÑÐµ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡)
  const compDone = localStorage.getItem('fishing_rod_compensation_v3');
  if(!compDone) {
    gs.coins = (gs.coins || 0) + 1000000;
    RODS.forEach(r => { if(r.id !== 'shark' && !r.limited) r.owned = true; });
    // Ð¡Ð±Ñ€Ð¾Ñ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ðº â€” Ð¾Ð½Ð¸ Ð¼Ð¾Ð³Ð»Ð¸ Ð¿Ð¾Ð¿Ð°ÑÑ‚ÑŒ Ñ‚ÑƒÐ´Ð° Ð¿Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐµ
    RODS.forEach(r => { if(r.limited) r.owned = false; });
    localStorage.setItem('fishing_rod_compensation_v3', '1');
    localStorage.removeItem('fishing_rod_compensation_v2');
    localStorage.removeItem('fishing_rod_compensation_v1');
    localStorage.removeItem('fishing_comp_toast_shown');
  }
}

// Auto-save every 15 seconds
setInterval(saveGame, 15000);

// ============================================================
// GAME STATE
// ============================================================
const gs = {
  phase:'idle',
  bobX:0, bobY:0,
  fishCount:0, score:0, energy:65, coins:150,
  fish:null, currentCatch:null,
  biteTimer:null, biteTimeout:null,
  inventory:[], maxInv:20,
  currentRod:RODS[0],
  currentScreen:'fishing',
  shopTab:'rods',
  weather:'night', // night | dawn | day | dusk | rain | storm | fog | snow
  weatherTimer:null,
  rainActive:false,
};

// Default rod 0 owned
RODS[0].owned    = true;
RODS[0].equipped = true;

// ============================================================
// DOM REFS
// ============================================================
const fishingScreen = document.getElementById('fishing-screen');
const bobWrap  = document.getElementById('bobber-wrap');
const linecanvas = document.getElementById('linecanvas');
const lctx     = linecanvas.getContext('2d');
const hint     = document.getElementById('cast-hint');
const biteEl   = document.getElementById('bite-indicator');
const rodBody  = document.getElementById('rod-body');
const reelSvg  = document.querySelector('#rod-reel svg');
const rainCanvas = document.getElementById('rain-canvas');
const rctx     = rainCanvas.getContext('2d');

function resizeCanvases() {
  linecanvas.width  = 360;
  linecanvas.height = 700;
  rainCanvas.width  = 360;
  rainCanvas.height = 700;
}
resizeCanvases();

// ============================================================
// LOAD SAVE DATA
// ============================================================
loadGame();

// ============================================================
// TIME
// ============================================================
function updateTime() {
  const n = new Date();
  document.getElementById('game-time').textContent =
    String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0');
}
updateTime();
setInterval(updateTime, 20000);

// ============================================================
// STARS
// ============================================================
(function createStars() {
  const c = document.getElementById('stars');
  for(let i=0;i<70;i++){
    const s = document.createElement('div'); s.className='star';
    const sz = .6+Math.random()*2;
    s.style.cssText=`width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${Math.random()*90}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*5}s;`;
    c.appendChild(s);
  }
})();

// ============================================================
// CLOUDS
// ============================================================
(function createClouds() {
  const c = document.getElementById('clouds');
  for(let i=0;i<5;i++){
    const cl = document.createElement('div'); cl.className='cloud';
    const w=80+Math.random()*120, h=30+Math.random()*50;
    cl.style.cssText=`width:${w}px;height:${h}px;top:${10+Math.random()*50}%;left:${Math.random()*300}px;opacity:0;--cd:${25+Math.random()*20}s;--cdelay:${Math.random()*-30}s;`;
    c.appendChild(cl);
  }
})();

// ============================================================
// FIREFLIES
// ============================================================
(function createFireflies() {
  for(let i=0;i<8;i++){
    const f=document.createElement('div'); f.className='firefly';
    f.style.cssText=`left:${10+Math.random()*60}%;top:${58+Math.random()*25}%;--fd:${5+Math.random()*7}s;--fdelay:${Math.random()*8}s;--fx:${-15+Math.random()*30}px;--fy:${-15+Math.random()*15}px;--fx2:${-10+Math.random()*25}px;--fy2:${-20+Math.random()*10}px;--fx3:${-8+Math.random()*20}px;--fy3:${-12+Math.random()*8}px;`;
    fishingScreen.appendChild(f);
  }
})();

// ============================================================
// BIRDS
// ============================================================
(function createBirds() {
  for(let i=0;i<3;i++){
    const b=document.createElement('div'); b.className='bird';
    b.innerHTML=`<svg viewBox="0 0 20 10" width="18" height="9"><path d="M0,5 Q5,0 10,5 Q15,0 20,5" stroke="#0a1810" stroke-width="1.5" fill="none"/></svg>`;
    b.style.cssText=`top:${8+i*5}%;--bd:${18+i*6}s;--bdelay:${-i*6}s;opacity:0;`;
    fishingScreen.appendChild(b);
  }
})();

// ============================================================
// MULTIPLAYER PARADE
// ============================================================
(function createParade() {
  const p = document.getElementById('multi-parade');
  if(!p) return;
  ['ðŸŸ','ðŸ ','ðŸ¡','ðŸ¦ˆ','ðŸ™'].forEach((e,i)=>{
    const f=document.createElement('div');
    f.style.cssText=`position:absolute;font-size:24px;animation:swimAcross ${14+i*4}s linear infinite;animation-delay:${-i*3}s;top:${6+i*8}px;`;
    f.textContent=e;
    p.appendChild(f);
  });
})();

// ============================================================
// WEATHER SYSTEM
// ============================================================
const WEATHERS = {
  night: {
    skyTop:'#020609', skyBot:'#050e0c', waterTop:'#082e18', waterBot:'#030e07',
    moonOpacity:1, sunOpacity:0, starsOpacity:1, cloudsOpacity:.1,
    firefliesOpacity:1, birdsOpacity:0, fogOpacity:0, rainOpacity:0,
    ambLight:'rgba(0,0,0,0)', label:'ðŸŒ™ ÐÐ¾Ñ‡ÑŒ', icon:'ðŸŒ™',
    biteBonus:1.0, forestFill:'#08160a'
  },
  dawn: {
    skyTop:'#2a0e18', skyBot:'#8a3820', waterTop:'#1e3838', waterBot:'#081820',
    moonOpacity:.3, sunOpacity:.6, starsOpacity:.2, cloudsOpacity:.4,
    firefliesOpacity:.2, birdsOpacity:.3, fogOpacity:.4, rainOpacity:0,
    ambLight:'rgba(180,80,20,.08)', label:'ðŸŒ… Ð Ð°ÑÑÐ²ÐµÑ‚', icon:'ðŸŒ…',
    biteBonus:1.3, forestFill:'#0e2210'
  },
  day: {
    skyTop:'#1a4870', skyBot:'#4a9ab0', waterTop:'#1a5060', waterBot:'#0c2030',
    moonOpacity:0, sunOpacity:1, starsOpacity:0, cloudsOpacity:.6,
    firefliesOpacity:0, birdsOpacity:.8, fogOpacity:0, rainOpacity:0,
    ambLight:'rgba(100,180,220,.06)', label:'â˜€ï¸ Ð”ÐµÐ½ÑŒ', icon:'â˜€ï¸',
    biteBonus:0.9, forestFill:'#154a18'
  },
  dusk: {
    skyTop:'#180e28', skyBot:'#6a2810', waterTop:'#1c2a30', waterBot:'#080a10',
    moonOpacity:.7, sunOpacity:.2, starsOpacity:.5, cloudsOpacity:.5,
    firefliesOpacity:.6, birdsOpacity:.4, fogOpacity:.1, rainOpacity:0,
    ambLight:'rgba(150,60,20,.07)', label:'ðŸŒ‡ Ð—Ð°ÐºÐ°Ñ‚', icon:'ðŸŒ‡',
    biteBonus:1.2, forestFill:'#0e1c0e'
  },
  rain: {
    skyTop:'#0a0e18', skyBot:'#141e24', waterTop:'#0e2a1e', waterBot:'#060e08',
    moonOpacity:.1, sunOpacity:0, starsOpacity:0, cloudsOpacity:.95,
    firefliesOpacity:0, birdsOpacity:0, fogOpacity:.3, rainOpacity:.9,
    ambLight:'rgba(20,40,60,.1)', label:'ðŸŒ§ï¸ Ð”Ð¾Ð¶Ð´ÑŒ', icon:'ðŸŒ§ï¸',
    biteBonus:1.5, forestFill:'#081008'
  },
  storm: {
    skyTop:'#050810', skyBot:'#0c1018', waterTop:'#0a1a14', waterBot:'#040a06',
    moonOpacity:0, sunOpacity:0, starsOpacity:0, cloudsOpacity:1,
    firefliesOpacity:0, birdsOpacity:0, fogOpacity:.5, rainOpacity:1,
    ambLight:'rgba(10,20,40,.15)', label:'â›ˆï¸ Ð“Ñ€Ð¾Ð·Ð°', icon:'â›ˆï¸',
    biteBonus:2.0, forestFill:'#060e06'
  },
  fog: {
    skyTop:'#0c1210', skyBot:'#181e18', waterTop:'#0e2018', waterBot:'#060e08',
    moonOpacity:.4, sunOpacity:0, starsOpacity:.2, cloudsOpacity:.8,
    firefliesOpacity:.3, birdsOpacity:0, fogOpacity:.85, rainOpacity:0,
    ambLight:'rgba(150,180,150,.05)', label:'ðŸŒ«ï¸ Ð¢ÑƒÐ¼Ð°Ð½', icon:'ðŸŒ«ï¸',
    biteBonus:0.8, forestFill:'#0a1808'
  },
};
const WEATHER_ORDER = ['night','night','night','dawn','day','day','dusk','dusk','night','rain','fog','storm','night'];

let weatherIdx = 0;
gs.weather = WEATHER_ORDER[0];

function applyWeather(name, fast) {
  const w = WEATHERS[name] || WEATHERS.night;
  const root = document.documentElement;
  // CSS vars
  root.style.setProperty('--sky-top', w.skyTop);
  root.style.setProperty('--sky-bot', w.skyBot);
  root.style.setProperty('--water-top', w.waterTop);
  root.style.setProperty('--water-bot', w.waterBot);
  root.style.setProperty('--amb-light', w.ambLight);
  // Elements
  document.getElementById('moon').style.opacity = w.moonOpacity;
  document.getElementById('sun').style.opacity  = w.sunOpacity;
  // Stars
  document.getElementById('stars').style.opacity = w.starsOpacity;
  // Clouds
  document.querySelectorAll('.cloud').forEach(c=>{ c.style.opacity = w.cloudsOpacity * (.3+Math.random()*.7); });
  // Fireflies
  document.querySelectorAll('.firefly').forEach(f=>{ f.style.opacity = w.firefliesOpacity; });
  // Birds
  document.querySelectorAll('.bird').forEach(b=>{ b.style.opacity = w.birdsOpacity; });
  // Fog
  document.getElementById('fog').style.opacity = w.fogOpacity;
  // Rain
  document.getElementById('rain-canvas').style.opacity = w.rainOpacity;
  gs.rainActive = w.rainOpacity > 0.1;
  // Sun position animation
  if(name === 'day') {
    document.getElementById('sun').style.left = '80px';
    document.getElementById('sun').style.top  = '35px';
  } else if(name === 'dawn' || name === 'dusk') {
    document.getElementById('sun').style.left = '30px';
    document.getElementById('sun').style.top  = '60px';
  }
  // Moon reflection / sun reflection
  document.getElementById('moon-reflection').style.opacity = w.moonOpacity;
  document.getElementById('sun-reflection').style.opacity  = w.sunOpacity * .8;
  // Forest color
  document.getElementById('forest-trees-back').setAttribute('fill', w.forestFill);
  // Badge & icon
  document.getElementById('weather-badge').textContent = w.label;
  document.getElementById('weather-icon').textContent  = w.icon;
  // Label flash
  const lbl = document.getElementById('time-period-label');
  lbl.textContent = w.label;
  lbl.style.opacity = '1';
  setTimeout(()=>lbl.style.opacity='0', 3000);

  gs.weather = name;
  gs.weatherBiteBonus = w.biteBonus;
}

function nextWeather() {
  weatherIdx = (weatherIdx + 1) % WEATHER_ORDER.length;
  const name = WEATHER_ORDER[weatherIdx];
  applyWeather(name);
  showToast(`ÐŸÐ¾Ð³Ð¾Ð´Ð°: ${WEATHERS[name].label}`);
}

// Initial weather
applyWeather('night', true);
// Change weather every 90 seconds (game time is fast)
setInterval(nextWeather, 90000);

// ============================================================
// RAIN ANIMATION
// ============================================================
let rainDrops = [];
function initRain() {
  rainDrops = [];
  for(let i=0;i<120;i++) {
    rainDrops.push({
      x: Math.random()*360, y: Math.random()*700,
      len: 8+Math.random()*12, spd: 8+Math.random()*8,
      op: .3+Math.random()*.5
    });
  }
}
initRain();

function drawRain() {
  rctx.clearRect(0,0,360,700);
  if(!gs.rainActive) return;
  rctx.strokeStyle='rgba(150,190,220,.5)'; rctx.lineWidth=1;
  rainDrops.forEach(d=>{
    rctx.globalAlpha = d.op;
    rctx.beginPath();
    rctx.moveTo(d.x, d.y);
    rctx.lineTo(d.x+d.len*.3, d.y+d.len);
    rctx.stroke();
    d.y += d.spd;
    d.x += d.spd*.2;
    if(d.y > 700) { d.y=-10; d.x=Math.random()*360; }
    if(d.x > 360) { d.x=0; }
  });
  rctx.globalAlpha=1;
}

// ============================================================
// LIGHTNING (storm)
// ============================================================
function doLightning() {
  if(gs.weather !== 'storm') return;
  const overlay = document.getElementById('sky-overlay');
  overlay.style.background='rgba(200,220,255,.4)';
  setTimeout(()=>{ overlay.style.background=WEATHERS.storm.ambLight; }, 80);
  setTimeout(doLightning, 4000+Math.random()*8000);
}
setTimeout(doLightning, 5000);

// ============================================================
// DRAW FISHING LINE
// ============================================================
function drawLine() {
  lctx.clearRect(0,0,360,700);
  if(gs.phase==='idle') return;
  // Rod tip â€” approximate coords
  const tipX = 330;
  const tipY = 90;
  const bX = gs.bobX;
  const bY = gs.bobY - 22;
  lctx.beginPath();
  lctx.moveTo(tipX, tipY);
  const cpX = bX + 25;
  const cpY = tipY - 25;
  lctx.quadraticCurveTo(cpX, cpY, bX, bY);
  lctx.strokeStyle='rgba(210,200,170,.75)';
  lctx.lineWidth=1.2;
  lctx.setLineDash([4,3]);
  lctx.stroke(); lctx.setLineDash([]);
}
setInterval(drawLine, 60);

// ============================================================
// RIPPLE
// ============================================================
function makeRipple(x, y, size) {
  const water = document.getElementById('water');
  const waterTop = fishingScreen.offsetHeight * 0.39 + 54;
  const wy = y - waterTop + 54;
  for(let i=0;i<3;i++) {
    setTimeout(()=>{
      const r=document.createElement('div'); r.className='ripple';
      const s=(size||50)+i*22;
      r.style.cssText=`left:${x}px;top:${wy}px;width:${s}px;height:${s*.38}px;`;
      water.appendChild(r);
      setTimeout(()=>r.remove(), 1800);
    }, i*320);
  }
}

// ============================================================
// TOAST
// ============================================================
let toastTimer;
function showToast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'), 2600);
}

// ============================================================
// COIN BURST ANIMATION
// ============================================================
function coinBurst(x, y) {
  for(let i=0;i<5;i++) {
    const c=document.createElement('div'); c.className='coin-burst';
    const angle = -90 + (i-2)*35;
    const dist  = 40+Math.random()*30;
    const cx = Math.cos(angle*Math.PI/180)*dist;
    const cy = Math.sin(angle*Math.PI/180)*dist;
    c.style.cssText=`left:${x}px;top:${y}px;--cx:${cx}px;--cy:${cy}px;animation-delay:${i*60}ms;`;
    c.textContent='ðŸª™';
    document.getElementById('game').appendChild(c);
    setTimeout(()=>c.remove(), 1200);
  }
}

// ============================================================
// CAST ANIMATION
// ============================================================
function animateCast(targetX, targetY, callback) {
  rodBody.classList.add('casting');
  reelSvg.classList.add('spinning');
  const tipX=330, tipY=90;
  const dur=580;
  const start=Date.now();
  function fly() {
    const t = Math.min(1,(Date.now()-start)/dur);
    const ease = t<.5?2*t*t:-1+(4-2*t)*t;
    const cpX=(tipX+targetX)/2, cpY=Math.min(tipY,targetY)-90;
    const bx=(1-ease)*(1-ease)*tipX + 2*(1-ease)*ease*cpX + ease*ease*targetX;
    const by=(1-ease)*(1-ease)*tipY + 2*(1-ease)*ease*cpY + ease*ease*targetY;
    lctx.clearRect(0,0,360,700);
    lctx.beginPath(); lctx.moveTo(tipX,tipY);
    lctx.quadraticCurveTo(cpX,cpY,bx,by);
    lctx.strokeStyle='rgba(210,200,170,.6)'; lctx.lineWidth=1.2;
    lctx.setLineDash([3,2]); lctx.stroke(); lctx.setLineDash([]);
    // Flying bobber dots
    lctx.fillStyle='#ee2222'; lctx.beginPath(); lctx.arc(bx,by,5,0,Math.PI*2); lctx.fill();
    lctx.fillStyle='#ffdd00'; lctx.beginPath(); lctx.arc(bx,by+7,4,0,Math.PI*2); lctx.fill();
    if(t<1) requestAnimationFrame(fly);
    else {
      rodBody.classList.remove('casting');
      reelSvg.classList.remove('spinning');
      callback();
    }
  }
  requestAnimationFrame(fly);
}

// ============================================================
// CAST
// ============================================================
function castTo(x, y) {
  gs.phase='casting';
  hint.style.display='none';
  animateCast(x, y, ()=>{
    gs.phase='waiting';
    gs.bobX=x; gs.bobY=y;
    bobWrap.style.left=x+'px';
    bobWrap.style.top =y+'px';
    bobWrap.style.display='block';
    bobWrap.style.animation='floatBob 2.2s ease-in-out infinite';
    makeRipple(x, y, 40);
    const weatherBonus = gs.weatherBiteBonus || 1.0;
    const eventMult    = getEventBiteMult();
    const rodMult      = gs.currentRod.biteChance;
    const upgBonus     = UPGRADES.find(u=>u.id==='fast_bite')?.owned ? 2 : 1;
    const activeBait   = BAITS.reduce((s,b)=>s+(b.qty>0?b.biteBonus:0), 0);
    const total        = rodMult * weatherBonus * upgBonus * (1+activeBait);
    const delay        = (3000+Math.random()*10000) / total;
    gs.biteTimer = setTimeout(triggerBite, delay);
  });
}

// ============================================================
// BITE
// ============================================================
function triggerBite() {
  if(gs.phase!=='waiting') return;
  gs.phase='bite';

  // â”€â”€ Pokemon mode â”€â”€
  if(gs.mapMode === 'pokemon') {
    const pool = getPokemonPool();
    const poke = pool[Math.floor(Math.random()*pool.length)];
    gs.currentCatch = {...poke, isPokemon:true, weight: (0.5 + Math.random()*2).toFixed(1)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([80,30,80,30,80]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // â”€â”€ ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð¾Ðº â”€â”€
  if(gs.mapMode === 'coast') {
    const coastPool = FISH_DATA.filter(f=>f.coastal);
    const f = coastPool[Math.floor(Math.random()*coastPool.length)];
    gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100,50,100]);
    // ÐŸÑ€Ð¸Ð±Ñ€ÐµÐ¶Ð½Ñ‹Ðµ Ñ€Ñ‹Ð±Ñ‹ Ð½ÑƒÐ¶Ð½Ð¾ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð· Ñ‚Ñ‹ÐºÐ°Ñ‚ÑŒ
    gs.coastTapNeeded = 5 + Math.floor(Math.random()*6); // 5-10 Ñ‚Ð°Ð¿Ð¾Ð²
    gs.coastTapCount = 0;
    showCoastTapBar();
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite'){ hideCoastTapBar(); miss(); } }, 7000);
    return;
  }

  // â”€â”€ Ð¥ÐÐ Ð”ÐšÐžÐ  â”€â”€
  if(gs.mapMode === 'hardcore') {
    const hcPool = HARDCORE_FISH.concat(FISH_DATA.filter(f=>f.rar==='legend'||f.rar==='og'));
    const f = hcPool[Math.floor(Math.random()*hcPool.length)];
    gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100,50,100]);
    if(Math.random() < 0.40) {
      setTimeout(startPiranhaAttack, 500);
    }
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 6000);
    return;
  }

  // â”€â”€ Ð‘ÐžÐœÐ–ÐÐ¢ÐÐ¯ â”€â”€
  if(gs.mapMode === 'hobo') {
    const hoboPool = HOBO_FISH;
    const f = hoboPool[Math.floor(Math.random()*hoboPool.length)];
    gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([50]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 4000);
    return;
  }

  // â”€â”€ ÐŸÐÐ¡Ð¥Ð â”€â”€
  if(gs.mapMode === 'easter') {
    const eRarRoll = Math.random();
    let ePool;
    if(eRarRoll < 0.01) ePool = EASTER_RABBITS.filter(r=>r.rar==='legend');
    else if(eRarRoll < 0.03) ePool = EASTER_RABBITS.filter(r=>r.rar==='epic');
    else if(eRarRoll < 0.18) ePool = EASTER_RABBITS.filter(r=>r.rar==='rare');
    else ePool = EASTER_RABBITS.filter(r=>r.rar==='common');
    if(!ePool||!ePool.length) ePool = EASTER_RABBITS;
    const rabbit = ePool[Math.floor(Math.random()*ePool.length)];
    const hasChacha = Math.random() < 0.5;
    gs.currentCatch = {...rabbit, isRabbit:true, hasChacha, weight:(0.5+Math.random()*2).toFixed(1)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([80,30,80]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }
  const hasLucky = UPGRADES.find(u=>u.id==='lucky_charm')?.owned;
  const lureBonus = LURES.reduce((s,l)=>s+(l.qty>0?l.rareBonus:0),0);
  const pool=[];
  const legendOnly = isLegendOnlyEvent();
  const isDuck = gs.currentRod.id === 'rubberduck';
  const isVoid = gs.currentRod.id === 'void';
  const isShark = gs.currentRod.id === 'shark';
  const ogLureActive = gs._ogLureActive && Date.now() < gs._ogLureActive;

  // ðŸ¦ˆ ÐÐºÑƒÐ»ÑŒÑ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” Ð²ÑÐµÐ³Ð´Ð° OG Ñ€Ñ‹Ð±Ð° + Ð¼Ð¸Ð½Ð¸ Ð°ÐºÑƒÐ»Ñ‹
  if(isShark) {
    const ogFish = FISH_DATA.filter(f=>f.og||f.rar==='coastal_legend');
    gs.fish = ogFish[Math.floor(Math.random()*ogFish.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    setTimeout(()=>{ for(let i=0;i<5;i++) setTimeout(spawnMiniSharkOnScreen, i*200); }, 100);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }
  
  // ðŸ‘» ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ ÐºÐ»Ñ‘Ð², Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹ Ð¸ Ð½Ð¸Ð¶Ðµ
  const isGhost = gs.currentRod.id === 'ghost';
  if(isGhost) {
    // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð¼Ð½Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒ ÐºÐ»Ñ‘Ð²Ð°: Ð¾Ñ‚ x0.3 Ð´Ð¾ x3
    const ghostRoll = 0.3 + Math.random() * 2.7;
    const ghostPool = FISH_DATA.filter(f=>!f.coastal && !f.og && f.rar !== 'og');
    const ghostWeighted = [];
    ghostPool.forEach(f=>{
      let w = f.rar==='common'?40 : f.rar==='rare'?30 : f.rar==='epic'?20 : f.rar==='legend'?10 : 0;
      for(let i=0;i<Math.round(w);i++) ghostWeighted.push(f);
    });
    if(ghostWeighted.length === 0) ghostPool.forEach(f=>ghostWeighted.push(f));
    gs.fish = ghostWeighted[Math.floor(Math.random()*ghostWeighted.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2), ghostMult: ghostRoll};
    // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°ÐºÐ¾Ð¹ Ð¼Ð½Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒ Ð²Ñ‹Ð¿Ð°Ð»
    const ghostEmoji = ghostRoll < 0.8 ? 'ðŸ’€' : ghostRoll < 1.5 ? 'ðŸ‘»' : ghostRoll < 2.5 ? 'âœ¨' : 'ðŸŒŸ';
    showToast(`${ghostEmoji} ÐŸÑ€Ð¸Ð·Ñ€Ð°Ðº Ð±Ñ€Ð¾ÑÐ°ÐµÑ‚... ÐšÐ»Ñ‘Ð² x${ghostRoll.toFixed(1)}!`);
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([60,20,60]);
    const autoReel = UPGRADES.find(u=>u.id==='auto_reel')?.owned;
    if(autoReel) {
      setTimeout(()=>{ if(gs.phase==='bite') catchFish(); }, 1000);
    } else {
      gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, ghostRoll < 1.0 ? 3000 : 6000);
    }
    return;
  }

  // ðŸº Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð° â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG + Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹
  if(gs.currentRod.id === 'pharaoh') {
    const phPool = FISH_DATA.filter(f=>f.og||f.rar==='legend'||f.rar==='coastal_legend');
    gs.fish = phPool[Math.floor(Math.random()*phPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // ðŸ’» ÐÐµÐ¾-Ð¢ÑƒÑ€Ð±Ð¾ â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG Ñ€Ñ‹Ð±Ñ‹
  if(gs.currentRod.id === 'neon') {
    const neonPool = FISH_DATA.filter(f=>f.og);
    const fallback = FISH_DATA.filter(f=>f.rar==='legend'||f.rar==='coastal_legend');
    const nFish = neonPool.length > 0 ? neonPool : fallback;
    gs.fish = nFish[Math.floor(Math.random()*nFish.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // ðŸ™ ÐšÑ€Ð°ÐºÐµÐ½ â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG Ñ€Ñ‹Ð±Ñ‹
  if(gs.currentRod.id === 'kraken') {
    const kPool = FISH_DATA.filter(f=>f.og);
    const kFallback = FISH_DATA.filter(f=>f.rar==='legend'||f.rar==='coastal_legend');
    const kFish = kPool.length > 0 ? kPool : kFallback;
    gs.fish = kFish[Math.floor(Math.random()*kFish.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // â³ Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð’Ñ€ÐµÐ¼ÐµÐ½Ð¸ â€” Ð²ÑÑ‘: Ð¾Ñ‚ common Ð´Ð¾ OG, Ð±ÐµÐ· Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹
  // (Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð¿ÑƒÐ», Ð½Ð¾ Ñ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð½Ñ‹Ð¼ ÑˆÐ°Ð½ÑÐ¾Ð¼ Ñ€ÐµÐ´ÐºÐ¸Ñ… Ñ‡ÐµÑ€ÐµÐ· catchMult - ÑƒÐ¶Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¾)

  // ðŸŒŒ ÐÐµÐ±ÐµÑÐ½Ð°Ñ â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG + Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹
  if(gs.currentRod.id === 'celestial') {
    const celPool = FISH_DATA.filter(f=>f.og||f.rar==='legend'||f.rar==='coastal_legend');
    gs.fish = celPool[Math.floor(Math.random()*celPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // ðŸ˜ˆ Ð”ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG + Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹, +666ðŸª™ ÑƒÐ¶Ðµ Ð² catchFish
  if(gs.currentRod.id === 'demonic') {
    const demPool = FISH_DATA.filter(f=>f.og||f.rar==='legend'||f.rar==='coastal_legend');
    gs.fish = demPool[Math.floor(Math.random()*demPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // ðŸŒŒ ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ â€” Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµÐ³Ð´Ð° OG: 70% OG, 30% Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹
  if(gs.currentRod.id === 'cosmic') {
    const ogFish = FISH_DATA.filter(f=>f.og);
    const legFish = FISH_DATA.filter(f=>f.rar==='legend'||f.rar==='coastal_legend');
    const cosmPool = Math.random() < 0.70 && ogFish.length > 0 ? ogFish : legFish;
    gs.fish = cosmPool[Math.floor(Math.random()*cosmPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // âš™ï¸ ÐœÐµÑ…-ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” OG 10% + Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ 50% + Ð­Ð¿Ð¸ÐºÐ¸ 40%
  if(gs.currentRod.id === 'mech') {
    const r = Math.random();
    let mechPool;
    if(r < 0.10) mechPool = FISH_DATA.filter(f=>f.og);
    else if(r < 0.60) mechPool = FISH_DATA.filter(f=>f.rar==='legend'||f.rar==='coastal_legend');
    else mechPool = FISH_DATA.filter(f=>f.rar==='epic');
    if(!mechPool || mechPool.length===0) mechPool = FISH_DATA.filter(f=>f.rar==='epic');
    gs.fish = mechPool[Math.floor(Math.random()*mechPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  // ðŸª¨ ÐœÑ€Ð°Ð¼Ð¾Ñ€Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG+Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹, Ð¼Ñ€Ð°Ð¼Ð¾Ñ€ Ð´Ð°Ñ‘Ñ‚ Ã—2 Ðº Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ðµ
  const isMarble = gs.currentRod.id === 'marble';
  if(isMarble) {
    const mPool = FISH_DATA.filter(f=>f.og||f.rar==='legend'||f.rar==='coastal_legend');
    gs.fish = mPool[Math.floor(Math.random()*mPool.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2), marbleBonus:true};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([80,40,80,40,80]);
    // Spawn marble splash particles
    setTimeout(()=>{
      for(let i=0;i<6;i++) setTimeout(()=>spawnMarbleSplash(), i*150);
    },100);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
    return;
  }

  FISH_DATA.filter(f=>!f.coastal).forEach(f=>{
    let w = f.rar==='common'?60 : f.rar==='rare'?30 : f.rar==='epic'?8 : f.rar==='og'?0.5 : 2;
    if(isDuck && (f.rar==='common'||f.rar==='rare')) w=0; // ÑƒÑ‚ÐºÐ° â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÐ¿Ð¸ÐºÐ¸+
    if(legendOnly && f.rar!=='legend'&&f.rar!=='og') w=0; // ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð»ÐµÐ³ÐµÐ½Ð´
    if(isVoid && f.rar!=='legend'&&f.rar!=='og') w=0; // Ð±ÐµÐ·Ð´Ð½Ð° â€” Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹
    if(f.rar==='legend' && hasLucky) w*=1.5;
    if(f.rar!=='common') w *= (1+lureBonus);
    // âœ¨ ÐšÐ Ð˜Ð¡Ð¢ÐÐ›Ð¬ÐÐÐ¯: ÑƒÐ´Ð²Ð¾ÐµÐ½Ð½Ñ‹Ð¹ ÑˆÐ°Ð½Ñ Ñ€ÐµÐ´ÐºÐ¸Ñ…, ÑÐ¿Ð¸ÐºÐ¾Ð², Ð»ÐµÐ³ÐµÐ½Ð´
    if(gs._crystalRareBoost && f.rar!=='common') w *= 2;
    // OG Ð»ÑƒÑ€Ð°: Ð² 35% ÑÐ»ÑƒÑ‡Ð°ÐµÐ² Ð»Ð¾Ð²Ð¸Ñ‚ OG
    if(ogLureActive && f.rar==='og') w = 35;
    // catchMult Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑˆÐ°Ð½ÑÑ‹ Ñ€ÐµÐ´ÐºÐ¸Ñ… Ñ€Ñ‹Ð±
    const cm = gs.currentRod.catchMult || 1;
    if(cm >= 5  && (f.rar==='common'||f.rar==='rare')) w *= Math.max(0.1, 1 - (cm-1)*0.15);
    if(cm >= 5  && f.rar==='epic')   w *= 1 + (cm-1)*0.3;
    if(cm >= 5  && f.rar==='legend') w *= 1 + (cm-1)*0.5;
    if(cm >= 15 && f.rar==='og')     w *= 1 + (cm-10)*0.8;
    for(let i=0;i<Math.round(w);i++) pool.push(f);
  });
  if(pool.length===0) FISH_DATA.filter(f=>!f.coastal && f.rar==='epic').forEach(f=>pool.push(f));
  gs.fish = pool[Math.floor(Math.random()*pool.length)];
  gs.currentCatch = {
    ...gs.fish,
    weight: (gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)
  };
  bobWrap.style.animation='floatBite .9s ease-in-out 4';
  biteEl.classList.add('visible');
  if(navigator.vibrate) navigator.vibrate([100,50,100]);
  const autoReel = UPGRADES.find(u=>u.id==='auto_reel')?.owned;
  const isThunder = gs.currentRod.id === 'thunder';
  const isMech    = gs._mechAutoTarget;   // âš™ï¸ ÐœÐµÑ…: Ð°Ð²Ñ‚Ð¾-Ð¿Ñ€Ð¸Ñ†ÐµÐ» = Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð°Ñ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°
  const isNeonAR  = gs._neonAutoReel;    // ðŸ’» ÐÐµÐ¾Ð½: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°
  const isMarbleAR= gs._marbleAutoReel;  // ðŸª¨ ÐœÑ€Ð°Ð¼Ð¾Ñ€: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°
  const isApoc    = gs._apocalypseMode;  // ðŸ’€ ÐÐ¿Ð¾Ðº: ÑƒÐ¶Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð²Ñ‹ÑˆÐµ
  // â³ Ð’Ñ€ÐµÐ¼Ñ: 10 ÑÐµÐº Ð¾ÐºÐ½Ð¾ Ð²Ð¼ÐµÑÑ‚Ð¾ 5
  const biteWindow = gs._timeFreezeWindow ? 10000 : 5000;
  if(autoReel || isThunder || isMech || isNeonAR || isMarbleAR) {
    const delay = isThunder||isMech||isNeonAR||isMarbleAR ? 200 : 1200;
    setTimeout(()=>{ if(gs.phase==='bite') catchFish(); }, delay);
  } else {
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, biteWindow);
  }
}


function miss() {
  gs.phase='idle';
  gs.catchStreak = 0; // ÑÐ±Ñ€Ð¾Ñ ÑÐµÑ€Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð¼Ð°Ñ…Ðµ
  updateStreakUI();
  biteEl.classList.remove('visible');
  bobWrap.style.display='none'; bobWrap.style.animation='';
  hint.style.display='block'; hint.textContent='Ð£ÑˆÐ»Ð°... Ð—Ð°Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÑÐ½Ð¾Ð²Ð°?';
  lctx.clearRect(0,0,360,700);
}

// ============================================================
// CATCH FISH
// ============================================================
function showCoastTapBar() {
  let bar = document.getElementById('coast-tap-bar');
  if(!bar) {
    bar = document.createElement('div');
    bar.id = 'coast-tap-bar';
    bar.style.cssText='position:absolute;bottom:145px;left:50%;transform:translateX(-50%);background:rgba(0,20,60,.85);border:2px solid #4090f0;border-radius:12px;padding:8px 18px;z-index:100;font-family:Neucha,cursive;color:#60c0ff;font-size:13px;text-align:center;pointer-events:none;';
    document.getElementById('fishing-screen').appendChild(bar);
  }
  bar.style.display='block';
  updateCoastTapBar();
}
function updateCoastTapBar() {
  const bar = document.getElementById('coast-tap-bar');
  if(!bar) return;
  const left = (gs.coastTapNeeded||0) - (gs.coastTapCount||0);
  const filled = 'â–“'.repeat(Math.max(0,(gs.coastTapCount||0)));
  const empty  = 'â–‘'.repeat(Math.max(0,left));
  bar.innerHTML = `ðŸ–ï¸ ÐŸÐ¾Ð´ÑÐµÐºÐ°Ð¹! ${filled}${empty}<br><span style="font-size:11px;color:#90d0ff;">ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹: ${left}</span>`;
}
function hideCoastTapBar() {
  const bar = document.getElementById('coast-tap-bar');
  if(bar) bar.style.display='none';
}

function catchFish() {
  // ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ â€” Ð½ÑƒÐ¶Ð½Ð¾ Ð¼Ð½Ð¾Ð³Ð¾ Ñ‚Ð°Ð¿Ð¾Ð²
  if(gs.mapMode === 'coast' && gs.phase === 'bite') {
    gs.coastTapCount = (gs.coastTapCount||0) + 1;
    updateCoastTapBar();
    if(navigator.vibrate) navigator.vibrate(30);
    if(gs.coastTapCount < gs.coastTapNeeded) return; // ÐµÑ‰Ñ‘ Ñ‚Ð°Ð¿Ñ‹ Ð½ÑƒÐ¶Ð½Ñ‹
    hideCoastTapBar();
    // Ð”Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ñ‚Ð°Ð¿Ð¾Ð² â€” Ð»Ð¾Ð²Ð¸Ð¼ (Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ðº Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ ÑƒÐ»Ð¾Ð²Ñƒ)
    clearTimeout(gs.biteTimeout);
    gs.phase='idle';
    biteEl.classList.remove('visible');
    reelSvg.classList.add('spinning');
    setTimeout(()=>reelSvg.classList.remove('spinning'), 900);
    bobWrap.style.display='none'; bobWrap.style.animation='';
    lctx.clearRect(0,0,360,700);
    // Use the already-selected catch
    const f=gs.currentCatch;
    gs.fishCount++;
    gs.score+=f.pts;
    document.getElementById('fish-count').textContent=gs.fishCount;
    document.getElementById('score-val').textContent=gs.score;
    updateCatchPopupFish(f);
    document.getElementById('catch-header').textContent = 'ðŸŽ‰ Ð£Ð»Ð¾Ð²!';
    document.getElementById('catch-name-txt').textContent=f.name;
    document.getElementById('catch-weight-txt').textContent=`${f.weight} ÐºÐ³ â€¢ +${f.pts} â˜…`;
    const rarEl2=document.getElementById('catch-rarity');
    rarEl2.textContent=f.label;
    rarEl2.className = 'rarity-coastal_legend';
    const price2=Math.round(calcPrice(f) * getEventCoinMult());
    document.getElementById('popup-sell-price').textContent=' '+price2;
    document.getElementById('catch-sell-btn').style.display = '';
    document.getElementById('catch-popup').classList.add('show');
    showScorePop('+'+f.pts, gs.bobX, gs.bobY);
    makeRipple(gs.bobX, gs.bobY, 65);
    gs.catchStreak = (gs.catchStreak||0) + 1;
    updateStreakUI();
    gs._coastCatch = true;
    updateQuestProgress('fish');
    updateQuestProgress('legend');
    updateQuestProgress('epic');
    addXP(80);
    showXPPop(80, gs.bobX, gs.bobY);
    checkAchievements();
    saveGame();
    return;
  }
  if(gs.phase!=='bite') return;
  clearTimeout(gs.biteTimeout);
  gs.phase='idle';
  biteEl.classList.remove('visible');
  reelSvg.classList.add('spinning');
  setTimeout(()=>reelSvg.classList.remove('spinning'), 900);
  bobWrap.style.display='none'; bobWrap.style.animation='';
  lctx.clearRect(0,0,360,700);

  // â”€â”€ Pokemon mode â”€â”€
  if(gs.mapMode === 'pokemon') {
    catchPokemon(gs.currentCatch);
    return;
  }

  // â”€â”€ ÐŸÐ°ÑÑ…Ð° â€” Ð»Ð¾Ð²Ð¸Ð¼ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð² â”€â”€
  if(gs.mapMode === 'easter') {
    catchEasterRabbit(gs.currentCatch);
    return;
  }

  // â”€â”€ ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð¾Ðº â”€â”€
  if(gs.mapMode === 'coast') {
    const coastPool = FISH_DATA.filter(f=>f.coastal);
    const f = coastPool[Math.floor(Math.random()*coastPool.length)];
    gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([100,50,100,50,100]);
    // ÐŸÑ€Ð¸Ð±Ñ€ÐµÐ¶Ð½Ñ‹Ðµ Ñ€Ñ‹Ð±Ñ‹ Ð½ÑƒÐ¶Ð½Ð¾ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð· Ñ‚Ñ‹ÐºÐ°Ñ‚ÑŒ
    gs.coastTapNeeded = 5 + Math.floor(Math.random()*6); // 5-10 Ñ‚Ð°Ð¿Ð¾Ð²
    gs.coastTapCount = 0;
    showCoastTapBar();
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite'){ hideCoastTapBar(); miss(); } }, 7000);
    return;
  }

  // â”€â”€ Normal mode â”€â”€
  const f=gs.currentCatch;
  gs.fishCount++;
  gs.score+=f.pts;
  document.getElementById('fish-count').textContent=gs.fishCount;
  document.getElementById('score-val').textContent=gs.score;
  updateCatchPopupFish(f);
  document.getElementById('catch-header').textContent = 'ðŸŽ‰ Ð£Ð»Ð¾Ð²!';
  document.getElementById('catch-name-txt').textContent=f.name;
  document.getElementById('catch-weight-txt').textContent=`${f.weight} ÐºÐ³ â€¢ +${f.pts} â˜…`;
  const rarEl=document.getElementById('catch-rarity');
  rarEl.textContent=f.label;
  if(f.rar==='og'){
    rarEl.className='rarity-og';
    rarEl.textContent='ðŸ‘‘ OG â€” Ð›Ð•Ð“Ð•ÐÐ”Ð Ð›Ð•Ð“Ð•ÐÐ”!';
  } else {
    rarEl.className = f.rar==='coastal_legend' ? 'rarity-legend' : `rarity-${f.rar}`;
  }
  const price=Math.round(calcPrice(f) * getEventCoinMult());
  document.getElementById('popup-sell-price').textContent=' '+price+(getEventCoinMult()>1?' ðŸŒ…x2':'')+(f.marbleBonus?' ðŸª¨Ã—2':'');
  document.getElementById('catch-sell-btn').style.display = '';
  document.getElementById('catch-popup').classList.add('show');
  showScorePop('+'+f.pts, gs.bobX, gs.bobY);
  makeRipple(gs.bobX, gs.bobY, 65);
  const activeBaits=BAITS.filter(b=>b.qty>0);
  if(activeBaits.length>0) activeBaits[0].qty--;
  // Ð ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ ÑƒÑ‚ÐºÐ°: Ð±Ð¾Ð½ÑƒÑ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ 1-100 Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²
  if(gs.currentRod.id === 'rubberduck') {
    const bonus = 1 + Math.floor(Math.random()*100);
    gs.coins += bonus;
    updateCoins();
    showToast('ðŸ¦† Ð£Ñ‚Ð¸Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð½Ð¸Ñ‚: +'+bonus+'ðŸª™!');
  }
  // ðŸ° Ð£Ð´Ð¾Ñ‡ÐºÐ° ÐŸÐ°ÑÑ…Ð¸: +10000 Ð¼Ð¾Ð½ÐµÑ‚ + ÐºÑ€Ð¾Ð»Ð¸Ðº Ð² Ð¿Ð¾Ð¿Ð°Ð¿Ðµ
  if(gs.currentRod.id === 'easter') {
    gs.coins += 10000;
    updateCoins();
    const bonusBadge = document.getElementById('easter-rabbit-bonus');
    if(bonusBadge) bonusBadge.style.display = 'block';
    showToast('ðŸ° Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº! +10000ðŸª™! ðŸ’ƒ Cha Cha!');
    spawnEasterConfetti();
  } else {
    const bonusBadge = document.getElementById('easter-rabbit-bonus');
    if(bonusBadge) bonusBadge.style.display = 'none';
  }
  // ðŸª¨ ÐœÑ€Ð°Ð¼Ð¾Ñ€Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ°: Ã—2 Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð° â€” Ñ‚Ð¾ÑÑ‚
  if(gs.currentRod.id === 'marble' && f.marbleBonus) {
    showToast('ðŸª¨ ÐœÑ€Ð°Ð¼Ð¾Ñ€ Ð² Ð²Ð¾Ð´Ðµ! Ð¦ÐµÐ½Ð° Ã—2 â€” ' + Math.round(calcPrice(f)) + 'ðŸª™!');
  }

  // ðŸ‰ Ð”Ð ÐÐšÐžÐÐ¬Ð¯: Ð²ÐµÑ Ñ€Ñ‹Ð±Ñ‹ x3 = Ð¼ÐµÐ³Ð°-ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ
  if(gs._dragonMegaWeight && f) {
    const origWeight = parseFloat(f.weight);
    const megaWeight = (origWeight * 3).toFixed(2);
    // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð²ÐµÑ Ð´Ð»Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° Ñ†ÐµÐ½Ñ‹
    gs.currentCatch = {...gs.currentCatch, weight: megaWeight, _dragonBoosted: true};
    document.getElementById('catch-weight-txt').textContent = megaWeight + ' ÐºÐ³ â€¢ +' + f.pts*2 + ' â˜… ðŸ‰';
    const newPrice = Math.round(calcPrice(gs.currentCatch) * getEventCoinMult());
    document.getElementById('popup-sell-price').textContent = ' ' + newPrice + ' ðŸ‰Ã—3';
    showToast('ðŸ‰ Ð”Ñ€Ð°ÐºÐ¾-ÑƒÐ»Ð¾Ð²! Ð’ÐµÑ x3: ' + megaWeight + 'ÐºÐ³!');
  }

  // â˜„ï¸ ÐœÐ•Ð¢Ð•ÐžÐ Ð˜Ð¢ÐÐÐ¯: ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ Ð¼Ð¾Ð½ÐµÑ‚ 100-500 Ð·Ð° ÑƒÐ»Ð¾Ð²
  if(gs._meteorBonus) {
    const mBonus = 100 + Math.floor(Math.random()*401);
    gs.coins += mBonus;
    updateCoins();
    showToast('â˜„ï¸ ÐœÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚Ð½Ñ‹Ð¹ ÑƒÐ´Ð°Ñ€! +' + mBonus + 'ðŸª™ Ð¾Ð³Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ!');
  }

  // ðŸ˜ˆ Ð”ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ°: +666ðŸª™ Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²
  if(gs.currentRod.id === 'demonic') {
    gs.coins += 666;
    updateCoins();
    showToast('ðŸ˜ˆ Ð¢Ñ‘Ð¼Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ: +666ðŸª™! Ð¡Ð¸Ð»Ð° Ñ‚ÑŒÐ¼Ñ‹ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹!');
  }

  // ðŸº Ð£Ð”ÐžÐ§ÐšÐ Ð¤ÐÐ ÐÐžÐÐ: ÑƒÐ´Ð²Ð¾ÐµÐ½Ð¸Ðµ Ð¼Ð¾Ð½ÐµÑ‚ + Ñ€ÐµÐ´ÐºÐ¾Ðµ Ð¿Ñ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ
  if(gs.currentRod.id === 'pharaoh') {
    const cursed = Math.random() < 0.08; // 8% Ð¿Ñ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ
    if(cursed) {
      // ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ: Ñ‚ÐµÑ€ÑÐµÐ¼ 20% Ð¼Ð¾Ð½ÐµÑ‚
      const lost = Math.floor(gs.coins * 0.2);
      gs.coins = Math.max(0, gs.coins - lost);
      updateCoins();
      showToast('ðŸ’€ ÐŸÐ ÐžÐšÐ›Ð¯Ð¢Ð˜Ð• Ð¤ÐÐ ÐÐžÐÐ! -'+lost+'ðŸª™! Ð‘ÐµÑ€ÐµÐ³Ð¸Ñ‚ÐµÑÑŒ Ð³Ð½ÐµÐ²Ð° Ð±Ð¾Ð³Ð¾Ð²!');
      // ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ñ
      const game = document.getElementById('game');
      const curse = document.createElement('div');
      curse.style.cssText='position:absolute;inset:0;background:rgba(100,0,150,.3);z-index:9000;pointer-events:none;animation:pharaohCurse 1.5s ease-out forwards;border-radius:12px;';
      game.appendChild(curse);
      setTimeout(()=>curse.remove(), 1500);
    } else {
      // Ð£Ð´Ð²Ð¾ÐµÐ½Ð¸Ðµ Ð¼Ð¾Ð½ÐµÑ‚ Ð·Ð° ÑƒÐ»Ð¾Ð²
      const bonus = Math.floor(parseFloat(f.weight) * f.coins);
      gs.coins += bonus;
      updateCoins();
      spawnGoldCoins(gs.bobX, gs.bobY);
      showToast('ðŸº Ð—Ð¾Ð»Ð¾Ñ‚Ð¾ Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð°! Ã—2 Ð¼Ð¾Ð½ÐµÑ‚Ñ‹! +'+bonus+'ðŸª™! ð“¹');
    }
  }

  // ðŸ’» ÐÐ•ÐžÐ-Ð¢Ð£Ð Ð‘Ðž: ÐºÐ°Ð¶Ð´Ñ‹Ð¹ 5Ð¹ Ð·Ð°Ð±Ñ€Ð¾Ñ â€” Ð°Ð²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² Ð±Ð¾Ð½ÑƒÑ
  if(gs.currentRod.id === 'neon') {
    gs._neonCounter = (gs._neonCounter || 0) + 1;
    if(gs._neonCounter >= 5) {
      gs._neonCounter = 0;
      // ÐÐ²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð²: Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐµÑ‰Ñ‘ Ð¾Ð´Ð½Ñƒ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ OG Ñ€Ñ‹Ð±Ñƒ
      const ogFish = FISH_DATA.filter(x=>x.rar==='og');
      if(ogFish.length > 0) {
        const bonus = ogFish[Math.floor(Math.random()*ogFish.length)];
        const bw = bonus.w[0] + Math.random()*(bonus.w[1]-bonus.w[0]);
        gs.inventory.push({...bonus, weight: bw.toFixed(2), isBonus: true});
        showToast('ðŸ’» Wi-Fi Ð¡ÐšÐÐ! ÐÐ²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² OG: '+bonus.name+'! ðŸŒ');
        // ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚
        const game = document.getElementById('game');
        const flash = document.createElement('div');
        flash.style.cssText='position:absolute;inset:0;background:rgba(0,255,200,.15);z-index:9000;pointer-events:none;border-radius:12px;animation:neonScan .5s ease-out forwards;';
        game.appendChild(flash);
        setTimeout(()=>flash.remove(), 500);
      }
    } else {
      showToast('ðŸ’» ÐÐµÐ¾-ÑÐºÐ°Ð½: '+gs._neonCounter+'/5 Ð´Ð¾ Ð°Ð²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð²Ð°!');
    }
  }

  // ðŸ™ ÐšÐ ÐÐšÐ•Ð: Ð¿Ñ€Ð¸ Ð»ÐµÐ³ÐµÐ½Ð´Ðµ/OG â€” Ð²Ð·Ñ€Ñ‹Ð² Ð¼Ð¾Ð½ÐµÑ‚ +5000 Ð¸ Ð¼Ð¸Ð½Ð¸-ÐºÑ€Ð°ÐºÐµÐ½
  if(gs.currentRod.id === 'kraken' && (f.rar === 'legend' || f.rar === 'og' || f.rar === 'coastal_legend')) {
    gs.coins += 5000;
    updateCoins();
    spawnKrakenExplosion(gs.bobX, gs.bobY);
    showToast('ðŸ™ ÐšÐ ÐÐšÐ•Ð ÐÐ¢ÐÐšÐ£Ð•Ð¢! +5000ðŸª™! Ð¡Ð»Ð°Ð±Ð°Ñ Ñ€Ñ‹Ð±Ð° Ð¿Ð¾Ð³Ð»Ð¾Ñ‰ÐµÐ½Ð°!');
  } else if(gs.currentRod.id === 'kraken') {
    showToast('ðŸ™ ÐšÑ€Ð°ÐºÐµÐ½ Ð¶Ð´Ñ‘Ñ‚... ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ Ð»ÐµÐ³ÐµÐ½Ð´Ñƒ Ð¸Ð»Ð¸ OG Ð´Ð»Ñ Ð²Ð·Ñ€Ñ‹Ð²Ð°!');
  }

  // â³ Ð£Ð”ÐžÐ§ÐšÐ Ð’Ð Ð•ÐœÐ•ÐÐ˜: 3 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð·
  if(gs.currentRod.id === 'time') {
    // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐµÑ‰Ñ‘ 2 ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ðµ Ñ€Ñ‹Ð±Ñ‹
    for(let ti=0; ti<2; ti++) {
      const pool = FISH_DATA.filter(x=>x.rar!=='og' || Math.random()<.3);
      const bonus = pool[Math.floor(Math.random()*pool.length)];
      const bw = bonus.w[0] + Math.random()*(bonus.w[1]-bonus.w[0]);
      if(gs.inventory.length < gs.maxInv) gs.inventory.push({...bonus, weight: bw.toFixed(2)});
    }
    // Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° â€” Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ freeze
    const game = document.getElementById('game');
    const freeze = document.createElement('div');
    freeze.style.cssText='position:absolute;inset:0;background:rgba(180,220,255,.12);z-index:9000;pointer-events:none;border-radius:12px;border:2px solid rgba(180,220,255,.4);animation:timeFreeze .8s ease-out forwards;';
    game.appendChild(freeze);
    setTimeout(()=>freeze.remove(), 800);
    showToast('â³ Ð’Ð Ð•ÐœÐ¯ ÐžÐ¡Ð¢ÐÐÐžÐ’Ð˜Ð›ÐžÐ¡Ð¬! ÐŸÐ¾Ð¹Ð¼Ð°Ð½Ð¾ 3 Ñ€Ñ‹Ð±Ñ‹ ÑÑ€Ð°Ð·Ñƒ!');
  }
  // Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘ÐµÐ·Ð´Ð½Ñ‹: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹
  if(gs.currentRod.id === 'void' && f.rar !== 'legend' && f.rar !== 'coastal_legend') {
    gs.inventory.pop(); // ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ ÐµÑÐ»Ð¸ Ð½Ðµ Ð»ÐµÐ³ÐµÐ½Ð´Ð°
    showToast('ðŸŒ€ Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘ÐµÐ·Ð´Ð½Ñ‹ Ð²Ñ‹Ð±Ñ€Ð¾ÑÐ¸Ð»Ð° Ð½Ðµ-Ð»ÐµÐ³ÐµÐ½Ð´Ñƒ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾!');
  }
  // XP Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹
  const xpBase = f.rar==='legend'||f.rar==='coastal_legend' ? 80 : f.rar==='epic' ? 40 : f.rar==='rare' ? 20 : 10;
  const xpEarned = xpBase * getEventXPMult();
  addXP(xpEarned);
  showXPPop(xpEarned, gs.bobX, gs.bobY);
  gs.catchStreak = (gs.catchStreak||0) + 1;
  updateStreakUI();
  gs._caughtLegend = gs._caughtLegend || (f.rar==='legend');
  gs._coastCatch = gs._coastCatch || (gs.mapMode==='coast');
  if(gs.currentRod.id==='rubberduck') gs._duckCatches = (gs._duckCatches||0)+1;
  updateQuestProgress('fish');
  if(f.rar==='epic') updateQuestProgress('epic');
  if(f.rar==='legend'||f.rar==='coastal_legend') { updateQuestProgress('legend'); updateQuestProgress('epic'); }
  updateQuestProgress('streak', 0); // check streak
  if((gs.catchStreak||0)>=5) updateQuestProgress('no_miss_5',0);
  checkAchievements();
  saveGame();
  syncLeaderboard();
}

function calcPrice(f) {
  const base = Math.round(parseFloat(f.weight) * f.coins);
  const withMarble = f.marbleBonus ? base * 2 : base;
  // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ð¹ Ð¼Ð½Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (Ð´Ð»Ñ Ñ€Ñ‹Ð± Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ðµ) Ð¸Ð»Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  const mult = f._rodMult || (gs.currentRod && gs.currentRod.catchMult > 1 ? gs.currentRod.catchMult : 1);
  return Math.round(withMarble * mult);
}

// ðŸ™ Ð’Ð·Ñ€Ñ‹Ð² ÐºÑ€Ð°ÐºÐµÐ½Ð°
function spawnKrakenExplosion(x, y) {
  const game = document.getElementById('game');
  const tentacles = ['ðŸ™','ðŸ¦‘','ðŸ’œ','ðŸŒŠ','âš¡'];
  for(let i=0;i<15;i++) {
    setTimeout(()=>{
      const el = document.createElement('div');
      el.style.cssText = `position:absolute;font-size:${14+Math.random()*12}px;pointer-events:none;z-index:10000;left:${x-10}px;top:${y-10}px;`;
      el.textContent = tentacles[Math.floor(Math.random()*tentacles.length)];
      const angle = Math.random()*Math.PI*2;
      const dist = 40+Math.random()*120;
      el.style.setProperty('--px', Math.cos(angle)*dist+'px');
      el.style.setProperty('--py', Math.sin(angle)*dist+'px');
      el.style.setProperty('--pr', (Math.random()*720-360)+'deg');
      el.style.animation='petalFly 1.4s ease-out forwards';
      game.appendChild(el);
      setTimeout(()=>el.remove(), 1500);
    }, i*30);
  }
  // Purple flash
  const flash = document.createElement('div');
  flash.style.cssText='position:absolute;inset:0;background:rgba(80,0,160,.25);z-index:9000;pointer-events:none;border-radius:12px;animation:krakenTentacle .6s ease-out forwards;';
  game.appendChild(flash);
  setTimeout(()=>flash.remove(), 600);
}

// ðŸ’° Ð—Ð¾Ð»Ð¾Ñ‚Ñ‹Ðµ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ Ñ„Ð°Ñ€Ð°Ð¾Ð½Ð°
function spawnGoldCoins(x, y) {
  const game = document.getElementById('game');
  for(let i=0;i<12;i++) {
    setTimeout(()=>{
      const el = document.createElement('div');
      el.style.cssText = `position:absolute;font-size:${12+Math.random()*10}px;pointer-events:none;z-index:10000;left:${x-8}px;top:${y-8}px;`;
      el.textContent = ['ðŸª™','ðŸ’›','âœ¨','ð“¹'][Math.floor(Math.random()*4)];
      const angle = Math.random()*Math.PI*2;
      const dist = 30+Math.random()*100;
      el.style.setProperty('--px', Math.cos(angle)*dist+'px');
      el.style.setProperty('--py', Math.sin(angle)*dist+'px');
      el.style.setProperty('--pr', (Math.random()*540-270)+'deg');
      el.style.animation='petalFly 1.2s ease-out forwards';
      game.appendChild(el);
      setTimeout(()=>el.remove(), 1300);
    }, i*35);
  }
}

function spawnMarbleSplash() {
  const game = document.getElementById('game');
  const m = document.createElement('div');
  const sz = 8 + Math.random()*16;
  const hue = 240 + Math.random()*40;
  m.style.cssText = `position:absolute;width:${sz}px;height:${sz}px;border-radius:50%;
    background:radial-gradient(circle at 35% 30%,rgba(255,255,255,.9),hsl(${hue},50%,70%),hsl(${hue},40%,40%));
    box-shadow:0 0 ${sz*.4}px rgba(200,180,255,.6);
    left:${gs.bobX - sz/2 + (Math.random()-0.5)*50}px;
    top:${gs.bobY - sz/2 + (Math.random()-0.5)*30}px;
    pointer-events:none;z-index:30;
    animation:marbleSplashAnim 1s ease-out forwards;`;
  game.appendChild(m);
  setTimeout(()=>m.remove(), 1000);
}

function updateCatchPopupFish(f) {
  const g=document.querySelector('#fishG');
  if(g){
    g.children[0].setAttribute('stop-color', lighten(f.col,40));
    g.children[1].setAttribute('stop-color', f.col);
  }
}
function lighten(hex,amt){
  const n=parseInt(hex.replace('#',''),16);
  return `rgb(${Math.min(255,(n>>16)+amt)},${Math.min(255,((n>>8)&0xff)+amt)},${Math.min(255,(n&0xff)+amt)})`;
}

function showScorePop(txt, x, y) {
  const p=document.createElement('div'); p.className='score-pop';
  p.textContent=txt; p.style.left=x+'px'; p.style.top=(y-20)+'px';
  fishingScreen.appendChild(p);
  setTimeout(()=>p.remove(), 1800);
}
function showXPPop(xp, x, y) {
  const p=document.createElement('div'); p.className='xp-pop';
  p.textContent='+'+xp+' XP'; p.style.left=x+'px'; p.style.top=(y-40)+'px';
  fishingScreen.appendChild(p);
  setTimeout(()=>p.remove(), 1500);
}
function updateStreakUI() {
  const el = document.getElementById('streak-display');
  if(!el) return;
  const s = gs.catchStreak||0;
  if(s >= 3) {
    el.textContent = 'ðŸ”¥ Ð¡ÐµÑ€Ð¸Ñ: ' + s;
    el.classList.add('active');
  } else {
    el.classList.remove('active');
  }
}

// ============================================================
// KEEP / SELL (popup buttons)
// ============================================================
function resetCatchPopup() {
  document.getElementById('catch-fish-svg').style.display = '';
  document.getElementById('catch-pokemon-emoji').style.display = 'none';
  document.getElementById('catch-pokemon-emoji').textContent = '';
  document.getElementById('catch-sell-btn').style.display = '';
}

function keepFish() {
  document.getElementById('catch-popup').classList.remove('show');
  resetCatchPopup();
  const f=gs.currentCatch;
  if(!f) return;
  if(f.isPokemon) { afterCatch(); return; } // pokÃ©mon go to leaderboard only
  if(gs.inventory.length >= gs.maxInv) {
    showToast('ðŸŽ’ Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð¿Ð¾Ð»Ð¾Ð½! ÐŸÑ€Ð¾Ð´Ð°Ð¹ Ñ€Ñ‹Ð±Ñƒ.'); afterCatch(); return;
  }
  gs.inventory.push({...f, _rodMult: gs.currentRod.catchMult || 1});
  showToast(`ðŸŸ ${f.name} Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð² ÑÑƒÐ¼ÐºÑƒ!`);
  afterCatch(); saveGame();
}

function sellFish() {
  document.getElementById('catch-popup').classList.remove('show');
  resetCatchPopup();
  const f=gs.currentCatch;
  if(!f) return;
  const price=calcPrice(f);
  gs.coins+=price;
  updateCoins();
  coinBurst(180, 350);
  addXP(15);
  updateQuestProgress('sell');
  updateQuestProgress('coins', price);
  checkAchievements();
  showToast(`ðŸ’° ÐŸÑ€Ð¾Ð´Ð°Ð½Ð¾: ${f.name} Ð·Ð° ${price}ðŸª™ (+15 XP)`);
  afterCatch(); saveGame();
}

function afterCatch() {
  hint.style.display='block';
  hint.textContent='ÐÐ°Ð¶Ð¼Ð¸ Ð½Ð° Ð²Ð¾Ð´Ñƒ Ð´Ð»Ñ Ð·Ð°Ð±Ñ€Ð¾ÑÐ°';
}

function updateCoins() {
  document.getElementById('coins-display').textContent=gs.coins;
}
updateCoins();
document.getElementById('fish-count').textContent=gs.fishCount;
document.getElementById('score-val').textContent=gs.score;
document.getElementById('current-rod-name').textContent='Ð£Ð´Ð¾Ñ‡ÐºÐ°: '+gs.currentRod.name;

// ============================================================
// SELL ALL
// ============================================================
function sellAll() {
  if(!gs.inventory.length){ showToast('ðŸŽ’ Ð¡ÑƒÐ¼ÐºÐ° Ð¿ÑƒÑÑ‚Ð°!'); return; }
  const total=gs.inventory.reduce((s,f)=>s+calcPrice(f),0);
  gs.coins+=total; gs.inventory=[];
  updateCoins(); renderInventory();
  coinBurst(180, 300);
  showToast(`ðŸ’° ÐŸÑ€Ð¾Ð´Ð°Ð½Ð¾ Ð²ÑÑ‘ Ð·Ð° ${total}ðŸª™`); saveGame();
}

// ============================================================
// WATER CLICK â€” CAST or CATCH
// ============================================================
fishingScreen.addEventListener('click', e=>{
  if(gs.currentScreen!=='fishing') return;
  if(gs.phase==='bite'){ catchFish(); return; }
  if(gs.phase!=='idle') return;
  const rect=fishingScreen.getBoundingClientRect();
  const scaleWrapper=document.getElementById('game-scale-wrapper');
  const scaleStr=scaleWrapper.style.transform;
  const scale=scaleStr ? parseFloat(scaleStr.replace('scale(','')) : 1;
  const x=(e.clientX-rect.left)/scale;
  const y=(e.clientY-rect.top)/scale;
  const waterTop=fishingScreen.offsetHeight*0.39+54;
  const toolbarTop=fishingScreen.offsetHeight-140;
  if(y < waterTop) return;
  if(y > toolbarTop) return;
  castTo(x, y);
});
biteEl.addEventListener('click', catchFish);

// ============================================================
// TOOL SELECT
// ============================================================
function selectTool(t) {
  document.querySelectorAll('.tool-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('btn-'+t).classList.add('active');
}

// ============================================================
// ENERGY
// ============================================================
let eDir=1;
setInterval(()=>{
  gs.energy+=eDir*.055;
  if(gs.energy>=100){gs.energy=100;eDir=-1;}
  if(gs.energy<=12) {gs.energy=12; eDir=1;}
  document.getElementById('energyfill').style.width=gs.energy+'%';
}, 100);

// ============================================================
// AMBIENT RIPPLES
// ============================================================
function ambientRipple() {
  const wTop = 240;
  const x=30+Math.random()*(280);
  const y=wTop+Math.random()*(200);
  makeRipple(x,y,18);
  setTimeout(ambientRipple, 6000+Math.random()*5000);
}
setTimeout(ambientRipple, 4000);

// ============================================================
// RAIN LOOP
// ============================================================
function rainLoop() {
  drawRain();
  requestAnimationFrame(rainLoop);
}
rainLoop();

// ============================================================
// SCREEN SWITCH
// ============================================================
function switchScreen(name) {
  gs.currentScreen=name;
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.navtab').forEach(t=>t.classList.remove('active'));
  if(name === 'achievements') {
    gs.currentScreen = 'achievements';
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.navtab').forEach(t=>t.classList.remove('active'));
    document.getElementById('achievements-screen').classList.add('active');
    document.getElementById('nav-achieve').classList.add('active');
    renderAchievementsScreen();
    return;
  }
  if(name === 'leaderboard') {
    document.getElementById('leaderboard-screen').classList.add('active');
    document.getElementById('nav-lb').classList.add('active');
    renderLeaderboard();
    updatePlayerLocation('leaderboard');
    return;
  }
  const map={fishing:'fishing-screen',shop:'shop-screen',inventory:'inventory-screen',multi:'multi-screen',garden:'garden-screen',event:'event-screen',fisher:'fisher-screen'};
  const navMap={fishing:'nav-fish',shop:'nav-shop',inventory:'nav-inv',multi:'nav-multi',garden:'nav-garden',event:'nav-event',fisher:'nav-fisher'};
  const screenEl = document.getElementById(map[name]);
  const navEl = document.getElementById(navMap[name]);
  if(screenEl) screenEl.classList.add('active');
  if(navEl) navEl.classList.add('active');
  if(name==='shop')      renderShop();
  if(name==='inventory') renderInventory();
  if(name==='garden')    renderGarden();
  if(name==='multi')     renderMultiScreen();
  if(name==='event')     renderEasterEventScreen();
  if(name==='fisher')    renderFisherScreen();
  // Update location in Firebase if in a room
  updatePlayerLocation(name);
}

// ============================================================
// ðŸŽ£ FISHER SCREEN â€” Render function
// ============================================================
function renderFisherScreen() {
  const rod = gs.currentRod;

  // â”€â”€ Ð¦Ð²ÐµÑ‚Ð° ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â”€â”€
  const rc = ROD_COLORS[rod.id] || ROD_COLORS.wood;
  const rodColor = rc.color || '#80d040';
  const hasGlow  = rc.glow !== 'none';
  const rodAura  = hasGlow ? rodColor + '40' : 'rgba(40,120,20,.15)';

  // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ CSS-Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð°ÑƒÑ€Ñ‹
  const charZone = document.getElementById('fisher-character-zone');
  charZone.style.setProperty('--rod-aura', rodAura);
  charZone.style.setProperty('--rod-aura-color', rodColor + '50');
  document.getElementById('fisher-glow-2').style.background = rodAura;

  const rodIconBig = document.getElementById('fisher-rod-icon-big');
  rodIconBig.style.setProperty('--rod-aura', rodAura);
  rodIconBig.innerHTML = rodIconSVG(rod);

  document.getElementById('fisher-rod-name-big').textContent = rod.name;
  document.getElementById('fisher-rod-name-big').style.color = rodColor;
  document.getElementById('fisher-rod-name-big').style.textShadow = hasGlow ? `0 0 10px ${rodColor}` : 'none';

  document.getElementById('fisher-rod-stats-big').textContent = rod.stats || 'ÐšÐ»Ñ‘Ð²: Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹';

  // Ð ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  const rarEl = document.getElementById('fisher-rod-rarity-badge');
  let rarClass = 'rarity-common';
  let rarLabel = 'ðŸªµ ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ';
  if(rod.id === 'godly')   { rarClass = 'rarity-og';     rarLabel = 'âœ¨ Ð‘ÐžÐ“-Ð¢Ð˜Ð•Ð '; }
  else if(rod.detail === 'Ð‘ÐžÐ“-Ð¢Ð˜Ð•Ð ')   { rarClass = 'rarity-og';   rarLabel = 'âœ¨ Ð‘ÐžÐ“-Ð¢Ð˜Ð•Ð '; }
  else if(rod.special === 'flower' || rod.craftType === 'flower') { rarClass = 'rarity-flower'; rarLabel = 'ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ'; }
  else if(rod.special === 'shark')     { rarClass = 'rarity-og';   rarLabel = 'ðŸ¦ˆ ÐÐºÑƒÐ»ÑŒÑ'; }
  else if(rod.detail === 'Ð“Ð¸Ð¿ÐµÑ€-Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ') { rarClass = 'rarity-legend'; rarLabel = 'ðŸ’Ž Ð£Ð»ÑŒÑ‚Ñ€Ð°'; }
  else if(rod.price >= 100000)         { rarClass = 'rarity-legend'; rarLabel = 'ðŸ‘‘ Ð›ÐµÐ³ÐµÐ½Ð´Ð°'; }
  else if(rod.price >= 10000)          { rarClass = 'rarity-epic';   rarLabel = 'âš¡ Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ°Ñ'; }
  else if(rod.price >= 1000)           { rarClass = 'rarity-rare';   rarLabel = 'ðŸ”µ Ð ÐµÐ´ÐºÐ°Ñ'; }
  rarEl.className = rarClass;
  rarEl.textContent = rarLabel;

  // Ð—Ð½Ð°Ñ‡Ð¾Ðº ÑƒÑ€Ð¾Ð²Ð½Ñ Ð½Ð° Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶Ðµ
  const lvl = Math.floor((gs.xp || 0) / 100) + 1;
  const lvlEl = document.getElementById('fisher-lvl-txt-svg');
  if(lvlEl) lvlEl.textContent = 'Ð£Ñ€. ' + lvl;

  // â”€â”€ ÐŸÐ°ÑÑÐ¸Ð²ÐºÐ¸ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â”€â”€
  const passList = document.getElementById('fisher-passives-list');
  passList.innerHTML = '';
  const passives = [];

  if(rod.biteChance >= 10) passives.push({ icon: 'âš¡', txt: `ÐšÐ»Ñ‘Ð² x${rod.biteChance}`, color: '#60d0ff' });
  else if(rod.biteChance >= 5) passives.push({ icon: 'ðŸŽ¯', txt: `ÐšÐ»Ñ‘Ð² x${rod.biteChance}`, color: '#80e040' });
  else if(rod.biteChance > 1) passives.push({ icon: 'ðŸŽ¯', txt: `ÐšÐ»Ñ‘Ð² x${rod.biteChance}`, color: '#a0c060' });

  if(rod.catchMult >= 10) passives.push({ icon: 'ðŸ’Ž', txt: `Ð£Ð»Ð¾Ð² x${rod.catchMult}`, color: '#c060ff' });
  else if(rod.catchMult >= 5) passives.push({ icon: 'âœ¨', txt: `Ð£Ð»Ð¾Ð² x${rod.catchMult}`, color: '#d0a030' });
  else if(rod.catchMult > 1) passives.push({ icon: 'ðŸ“ˆ', txt: `Ð£Ð»Ð¾Ð² x${rod.catchMult}`, color: '#90c050' });

  if(rod.special === 'shark')   passives.push({ icon: 'ðŸ¦ˆ', txt: 'ÐœÐ¸Ð½Ð¸-Ð°ÐºÑƒÐ»Ñ‹ Ð½Ð° OG', color: '#40c0e0' });
  if(rod.special === 'duck')    passives.push({ icon: 'ðŸ¦†', txt: 'Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð­Ð¿Ð¸ÐºÐ¸+', color: '#e0c020' });
  if(rod.id === 'poseidon')     passives.push({ icon: 'ðŸ”±', txt: 'ÐÐ²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3Ñ', color: '#40a0ff' });
  if(rod.id === 'quantum')      passives.push({ icon: 'ðŸŒ€', txt: '2 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð·', color: '#ff40ff' });
  if(rod.craftType === 'flower')passives.push({ icon: 'ðŸŒ¸', txt: 'Ð‘Ð°Ñ„Ñ„ ÑÐ°Ð´Ð° Ð¿Ñ€Ð¸ ÑƒÐ»Ð¾Ð²Ðµ', color: '#ff80c0' });
  if(rod.craftType === 'easter')passives.push({ icon: 'ðŸ°', txt: '+10000ðŸª™ Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº', color: '#ff80c0' });
  if(rod.id === 'marble')       passives.push({ icon: 'ðŸª¨', txt: 'Ã—2 Ñ†ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸', color: '#c0b0e0' });
  if(rod.id === 'ghost')        passives.push({ icon: 'ðŸ‘»', txt: 'ÐšÐ»Ñ‘Ð² ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ x0.3-x3', color: '#80ffb0' });

  if(passives.length === 0) passives.push({ icon: 'ðŸŽ£', txt: 'Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ°', color: '#80a060' });

  passives.forEach(p => {
    const el = document.createElement('div');
    el.className = 'fisher-passive-row';
    el.style.setProperty('--passive-color', p.color);
    el.innerHTML = `<span class="fisher-passive-icon">${p.icon}</span><span>${p.txt}</span><span class="fisher-passive-val">${p.icon}</span>`;
    passList.appendChild(el);
  });

  // â”€â”€ ÐÐ°Ð¶Ð¸Ð²ÐºÐ° â”€â”€
  const baitSlot = document.getElementById('fisher-bait-slot');
  const activeBait = BAITS.find(b => b.qty > 0);
  if(activeBait) {
    baitSlot.querySelector('.fisher-item-slot-icon').textContent = activeBait.icon;
    baitSlot.querySelector('.fisher-item-slot-name').textContent = activeBait.name;
    baitSlot.querySelector('.fisher-item-slot-qty').textContent = activeBait.qty + ' ÑˆÑ‚ â€¢ ÐšÐ»Ñ‘Ð² +' + Math.round(activeBait.biteBonus*100)+'%';
    baitSlot.style.borderColor = 'rgba(80,200,40,.4)';
  } else {
    baitSlot.querySelector('.fisher-item-slot-icon').textContent = 'ðŸª±';
    baitSlot.querySelector('.fisher-item-slot-name').textContent = 'ÐÐµÑ‚ Ð½Ð°Ð¶Ð¸Ð²ÐºÐ¸';
    baitSlot.querySelector('.fisher-item-slot-qty').textContent = '0 ÑˆÑ‚';
    baitSlot.style.borderColor = '';
  }

  // â”€â”€ ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ° â”€â”€
  const lureSlot = document.getElementById('fisher-lure-slot');
  const activeLure = LURES.find(l => l.qty > 0);
  if(activeLure) {
    lureSlot.querySelector('.fisher-item-slot-icon').textContent = activeLure.icon;
    lureSlot.querySelector('.fisher-item-slot-name').textContent = activeLure.name;
    lureSlot.querySelector('.fisher-item-slot-qty').textContent = activeLure.qty + ' ÑˆÑ‚ â€¢ Ð ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ +' + Math.round(activeLure.rareBonus*100)+'%';
    lureSlot.style.borderColor = 'rgba(80,200,40,.4)';
  } else {
    lureSlot.querySelector('.fisher-item-slot-icon').textContent = 'ðŸª';
    lureSlot.querySelector('.fisher-item-slot-name').textContent = 'ÐÐµÑ‚ Ð¿Ñ€Ð¸Ð¼Ð°Ð½ÐºÐ¸';
    lureSlot.querySelector('.fisher-item-slot-qty').textContent = '0 ÑˆÑ‚';
    lureSlot.style.borderColor = '';
  }

  // â”€â”€ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ â”€â”€
  const upgradeGrid = document.getElementById('fisher-upgrades-grid');
  upgradeGrid.innerHTML = '';
  const upgradeIcons = { bigger_bag:'ðŸŽ’', fish_radar:'ðŸ“¡', auto_reel:'âš¡', lucky_charm:'ðŸ€', fast_bite:'ðŸŽ£' };
  UPGRADES.forEach((u, i) => {
    const chip = document.createElement('div');
    chip.className = 'fisher-upgrade-chip' + (u.owned ? '' : ' inactive');
    chip.style.setProperty('--chip-delay', (i*0.2)+'s');
    chip.innerHTML = `<span class="fisher-upgrade-chip-icon">${upgradeIcons[u.id]||'âœ¨'}</span>${u.name}`;
    upgradeGrid.appendChild(chip);
  });

  // â”€â”€ XP Ð¸ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ â”€â”€
  const xp = gs.xp || 0;
  const xpPerLevel = 100;
  const curLvl = Math.floor(xp / xpPerLevel) + 1;
  const xpInLevel = xp % xpPerLevel;
  const xpPct = (xpInLevel / xpPerLevel) * 100;

  document.getElementById('fisher-lvl-num').textContent = curLvl;
  document.getElementById('fisher-xp-cur').textContent = xpInLevel;
  document.getElementById('fisher-xp-nxt').textContent = xpPerLevel;
  document.getElementById('fisher-xp-fill').style.width = xpPct + '%';

  // Ð—Ð²Ñ‘Ð·Ð´Ð¾Ñ‡ÐºÐ¸ ÑƒÑ€Ð¾Ð²Ð½Ñ
  const lvlLabel = document.getElementById('fisher-level-label');
  const stars = Math.min(curLvl, 5);
  let starStr = 'â­ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ <span id="fisher-lvl-num">' + curLvl + '</span> ';
  for(let i=0;i<stars;i++) starStr += `<span class="fisher-lvl-star" style="--star-delay:${i*.15}s">â˜…</span>`;
  lvlLabel.innerHTML = starStr;

  // â”€â”€ Ð¡Ñ‚Ð°Ñ‚Ñ‹ â”€â”€
  document.getElementById('fs-fish-count').textContent = (gs.fishCount || 0).toLocaleString('ru');
  document.getElementById('fs-coins').textContent = (gs.coins || 0).toLocaleString('ru');
  document.getElementById('fs-score').textContent = (gs.score || 0).toLocaleString('ru');
  document.getElementById('fs-streak').textContent = gs.catchStreak || 0;
  document.getElementById('fs-energy').textContent = Math.round(gs.energy || 0) + '%';
  document.getElementById('fs-inv').textContent = (gs.inventory || []).length + '/' + (gs.maxInv || 20);

  // â”€â”€ Ð¤Ð¾Ð½Ð¾Ð²Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ (Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð·) â”€â”€
  const bgAnim = document.getElementById('fisher-bg-anim');
  if(!bgAnim._init) {
    bgAnim._init = true;
    for(let i=0;i<12;i++) {
      const p = document.createElement('div');
      p.className = 'fisher-bg-particle';
      const sz = 30 + Math.random()*80;
      const col = ['rgba(40,120,20,.08)','rgba(60,160,30,.06)','rgba(20,80,10,.1)','rgba(100,200,40,.05)'][i%4];
      p.style.cssText = `width:${sz}px;height:${sz}px;background:${col};left:${Math.random()*100}%;top:${Math.random()*100}%;--fd:${5+Math.random()*8}s;--fdelay:${Math.random()*5}s;--tx:${-20+Math.random()*40}px;--ty:${-20+Math.random()*30}px;--tx2:${-15+Math.random()*30}px;--ty2:${-10+Math.random()*25}px;`;
      bgAnim.appendChild(p);
    }
  }
}


let currentShopTab='rods';
function switchShopTab(tab, el) {
  currentShopTab=tab;
  document.querySelectorAll('.shop-tab').forEach(t=>t.classList.remove('active'));
  if(el) el.classList.add('active');
  renderShop();
}

function renderShop() {
  const body=document.getElementById('shop-body');
  body.innerHTML='';
  if(currentShopTab==='rods')          renderRods(body);
  else if(currentShopTab==='bait')     renderBaits(body);
  else if(currentShopTab==='lures')    renderLures(body);
  else if(currentShopTab==='upgrades') renderUpgrades(body);
  else if(currentShopTab==='pikabufs') renderPikabufs(body);
}

function makeShopItem(iconHtml, name, desc, stats, priceHtml, btnHtml, extraClass) {
  const el=document.createElement('div');
  el.className='shop-item'+(extraClass?' '+extraClass:'');
  el.innerHTML=`
    <div class="shop-item-icon">${iconHtml}</div>
    <div class="shop-item-info">
      <div class="shop-item-name">${name}</div>
      <div class="shop-item-desc">${desc}</div>
      <div class="shop-item-stats">${stats}</div>
      ${priceHtml?`<div class="shop-item-price">ðŸª™ ${priceHtml}</div>`:''}
    </div>
    ${btnHtml}
  `;
  return el;
}

function rodIconSVG(rod) {
  const RC = ROD_COLORS[rod.id] || ROD_COLORS.wood;
  const c = RC.color;
  const glowStyle = RC.glow !== 'none' ? `filter:drop-shadow(0 0 8px ${c});` : '';

  // Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸ÐºÐ¾Ð½ÐºÐ¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” Ð’Ð¡Ð• ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  const specials = {
    /* â”€â”€ Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ (Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¸Ð·Ð°Ð¹Ð½ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹) â”€â”€ */

    // Ð”ÐµÑ€ÐµÐ²ÐµÐ½ÑÐºÐ°Ñ: ÑÑ‚Ð°Ñ€Ð°Ñ Ñ‚Ñ€ÐµÑÐ½ÑƒÑ‚Ð°Ñ Ð´Ð¾ÑÐºÐ° Ñ Ð³Ð²Ð¾Ð·Ð´ÑÐ¼Ð¸ Ð¸ Ð²ÐµÑ€Ñ‘Ð²ÐºÐ¾Ð¹
    wood: `
      <!-- ÐŸÐ¾Ñ‚Ñ€Ñ‘Ð¿Ð°Ð½Ð½Ð°Ñ Ð´ÐµÑ€ÐµÐ²ÐµÐ½ÑÐºÐ°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° Ð¸Ð· Ð´Ð¾ÑÐºÐ¸ -->
      <rect x="22" y="6" width="8" height="40" rx="2" fill="url(#wdPlank)" stroke="#5a3010" stroke-width="1"/>
      <defs><linearGradient id="wdPlank" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#4a2808"/><stop offset="50%" stop-color="#8b5e2a"/><stop offset="100%" stop-color="#5a3010"/></linearGradient></defs>
      <!-- Ð¢Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ Ð² Ð´ÐµÑ€ÐµÐ²Ðµ -->
      <line x1="24" y1="10" x2="26" y2="25" stroke="#3a1808" stroke-width="0.8" opacity=".7"/>
      <line x1="27" y1="18" x2="29" y2="30" stroke="#3a1808" stroke-width="0.6" opacity=".5"/>
      <!-- Ð£Ð·Ð»Ð¾Ð²Ð°Ñ‚Ñ‹Ð¹ ÐºÑ€ÑŽÐº ÑÐ²ÐµÑ€Ñ…Ñƒ (Ð¿Ñ€Ð¸Ð¼Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹) -->
      <path d="M26,6 Q26,2 30,2 Q34,2 34,6 Q34,9 30,9" stroke="#5a3828" stroke-width="2" fill="none" stroke-linecap="round"/>
      <!-- Ð“Ð²Ð¾Ð·Ð´Ð¸ÐºÐ¸ Ð½Ð° Ñ€ÑƒÐºÐ¾ÑÑ‚ÐºÐµ -->
      <circle cx="24" cy="40" r="1.2" fill="#888" stroke="#444" stroke-width="0.5"/>
      <circle cx="28" cy="40" r="1.2" fill="#888" stroke="#444" stroke-width="0.5"/>
      <!-- Ð’ÐµÑ€Ñ‘Ð²ÐºÐ° Ð²Ð¼ÐµÑÑ‚Ð¾ Ð»ÐµÑÐºÐ¸ -->
      <path d="M26,6 Q36,12 44,24" stroke="#7a6030" stroke-width="1.5" stroke-dasharray="2,1" fill="none"/>
      <!-- ÐšÐ¾Ñ€ÑÐ²Ñ‹Ð¹ Ð¿Ð¾Ð¿Ð»Ð°Ð²Ð¾Ðº Ð¸Ð· Ð¿Ñ€Ð¾Ð±ÐºÐ¸ -->
      <ellipse cx="44" cy="26" rx="4" ry="6" fill="#c87030" stroke="#8a4820" stroke-width="1"/>
      <line x1="44" y1="20" x2="44" y2="16" stroke="#7a6030" stroke-width="1.5"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° Ð¾Ð±Ð¼Ð¾Ñ‚Ð°Ð½Ð° Ñ‚Ñ€ÑÐ¿ÐºÐ¾Ð¹ -->
      <rect x="21" y="36" width="10" height="10" rx="1" fill="rgba(80,40,10,.5)" stroke="#6a4020" stroke-width="1"/>
      <line x1="21" y1="38" x2="31" y2="38" stroke="#9a6030" stroke-width="0.8" opacity=".6"/>
      <line x1="21" y1="41" x2="31" y2="41" stroke="#9a6030" stroke-width="0.8" opacity=".6"/>
      <line x1="21" y1="44" x2="31" y2="44" stroke="#9a6030" stroke-width="0.8" opacity=".6"/>`,

    // Ð‘Ð°Ð¼Ð±ÑƒÐºÐ¾Ð²Ð°Ñ: Ñ‚Ð¾Ð½ÐºÐ¾Ðµ Ð±Ð°Ð¼Ð±ÑƒÐºÐ¾Ð²Ð¾Ðµ ÐºÐ¾Ð»ÐµÐ½Ð¾ Ñ Ð»Ð¸ÑÑ‚Ð¸ÐºÐ¾Ð¼
    bamboo: `
      <!-- Ð¢Ð¾Ð½ÐºÐ¾Ðµ Ð±Ð°Ð¼Ð±ÑƒÐºÐ¾Ð²Ð¾Ðµ ÐºÐ¾Ð»ÐµÐ½Ð¾ -->
      <line x1="36" y1="6" x2="20" y2="48" stroke="#4a7020" stroke-width="4" stroke-linecap="round"/>
      <line x1="36" y1="6" x2="20" y2="48" stroke="#8aaa40" stroke-width="2" stroke-linecap="round" opacity=".5"/>
      <!-- Ð£Ð·Ð»Ñ‹ Ð±Ð°Ð¼Ð±ÑƒÐºÐ° -->
      <line x1="35" y1="10" x2="31" y2="10" stroke="#2a5010" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="32" y1="17" x2="28" y2="17" stroke="#2a5010" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="30" y1="24" x2="26" y2="24" stroke="#2a5010" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="27" y1="31" x2="23" y2="31" stroke="#2a5010" stroke-width="2" stroke-linecap="round"/>
      <line x1="24" y1="39" x2="21" y2="39" stroke="#2a5010" stroke-width="2" stroke-linecap="round"/>
      <!-- Ð–Ð¸Ð²Ð¾Ð¹ Ð»Ð¸ÑÑ‚Ð¸Ðº ÑÐ±Ð¾ÐºÑƒ -->
      <path d="M34,13 Q42,8 44,15 Q38,16 34,13Z" fill="#5a9020" stroke="#3a7010" stroke-width="0.8"/>
      <line x1="34" y1="13" x2="42" y2="14" stroke="#2a6010" stroke-width="0.7" opacity=".7"/>
      <!-- Ð¢Ð¾Ð½ÐºÐ°Ñ Ð½Ð¸Ñ‚ÑÐ½Ð°Ñ Ð»ÐµÑÐºÐ° -->
      <line x1="36" y1="6" x2="46" y2="30" stroke="rgba(180,200,160,.6)" stroke-width="0.8"/>
      <!-- ÐšÑ€ÑƒÐ³Ð»Ñ‹Ð¹ Ð¿Ð¾Ð¿Ð»Ð°Ð²Ð¾Ðº Ð¸Ð· Ð´ÐµÑ€ÐµÐ²Ð° -->
      <circle cx="46" cy="32" r="5" fill="url(#bmbFl)" stroke="#5a3010" stroke-width="1"/>
      <defs><linearGradient id="bmbFl" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#e8c860"/><stop offset="50%" stop-color="#e8c860"/><stop offset="50.1%" stop-color="#c0e060"/><stop offset="100%" stop-color="#c0e060"/></linearGradient></defs>
      <!-- ÐšÑ€ÑŽÐº ÑÐ±Ð¾ÐºÑƒ Ð²Ð½Ð¸Ð·Ñƒ -->
      <path d="M20,46 Q16,46 16,50 Q16,54 20,54" stroke="#888" stroke-width="1.5" fill="none"/>`,

    // ÐšÐ°Ñ€Ð±Ð¾Ð½Ð¾Ð²Ð°Ñ: Ñ…Ð°Ð¹Ñ‚ÐµÐº ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ Ð²Ð¾Ð»Ð¾ÐºÐ½Ð°Ð¼Ð¸ Ð¸ Ñ†Ð¸Ñ„Ñ€Ð¾Ð²Ñ‹Ð¼ Ð´Ð¸ÑÐ¿Ð»ÐµÐµÐ¼
    carbon: `
      <!-- ÐšÐ°Ñ€Ð±Ð¾Ð½Ð¾Ð²Ð¾Ðµ Ñ‚ÐµÐ»Ð¾ â€” ÑˆÐµÑÑ‚Ð¸ÑƒÐ³Ð¾Ð»ÑŒÐ½Ð°Ñ Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ð° -->
      <rect x="23" y="8" width="6" height="38" rx="3" fill="#1e2a34" stroke="#405868" stroke-width="1"/>
      <!-- ÐšÐ°Ñ€Ð±Ð¾Ð½Ð¾Ð²Ñ‹Ðµ Ð²Ð¾Ð»Ð¾ÐºÐ½Ð° (Ð´Ð¸Ð°Ð³Ð¾Ð½Ð°Ð»ÑŒ) -->
      <line x1="23" y1="10" x2="29" y2="16" stroke="rgba(80,140,180,.4)" stroke-width="0.7"/>
      <line x1="23" y1="15" x2="29" y2="21" stroke="rgba(80,140,180,.4)" stroke-width="0.7"/>
      <line x1="23" y1="20" x2="29" y2="26" stroke="rgba(80,140,180,.4)" stroke-width="0.7"/>
      <line x1="23" y1="25" x2="29" y2="31" stroke="rgba(80,140,180,.4)" stroke-width="0.7"/>
      <line x1="23" y1="30" x2="29" y2="36" stroke="rgba(80,140,180,.4)" stroke-width="0.7"/>
      <line x1="29" y1="10" x2="23" y2="16" stroke="rgba(60,100,140,.3)" stroke-width="0.7"/>
      <line x1="29" y1="15" x2="23" y2="21" stroke="rgba(60,100,140,.3)" stroke-width="0.7"/>
      <line x1="29" y1="20" x2="23" y2="26" stroke="rgba(60,100,140,.3)" stroke-width="0.7"/>
      <!-- ÐœÐ¸Ð½Ð¸-Ð´Ð¸ÑÐ¿Ð»ÐµÐ¹ (Ð´Ð°Ñ‚Ñ‡Ð¸Ðº Ð¿Ð¾ÐºÐ»Ñ‘Ð²ÐºÐ¸) -->
      <rect x="18" y="20" width="10" height="7" rx="1.5" fill="#001828" stroke="#40a0c0" stroke-width="1"/>
      <rect x="19" y="21" width="8" height="5" rx="1" fill="#003050"/>
      <line x1="20" y1="23.5" x2="26" y2="23.5" stroke="#00c0ff" stroke-width="0.8" opacity=".7"/>
      <circle cx="24" cy="23.5" r="1" fill="#00ffff" opacity=".9"/>
      <!-- ÐÐ½Ñ‚ÐµÐ½Ð½Ð°/ÐºÐ¾Ð½Ñ‡Ð¸Ðº â€” ÑƒÐ³Ð»ÐµÐ¿Ð»Ð°ÑÑ‚Ð¸Ðº -->
      <line x1="26" y1="8" x2="26" y2="3" stroke="#607888" stroke-width="2" stroke-linecap="round"/>
      <circle cx="26" cy="3" r="1.5" fill="#80c8e0" stroke="#405868" stroke-width="0.8"/>
      <!-- Ð›ÐµÑÐºÐ° Ñ‚Ð¾Ð½ÐºÐ°Ñ -->
      <line x1="26" y1="3" x2="44" y2="28" stroke="rgba(150,200,240,.5)" stroke-width="0.7"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº-Ñ‚Ð¾Ñ€Ð¿ÐµÐ´Ð° -->
      <ellipse cx="44" cy="29" rx="3" ry="7" fill="#e03020" stroke="#801010" stroke-width="1"/>
      <line x1="44" y1="22" x2="44" y2="20" stroke="rgba(150,200,240,.5)" stroke-width="0.7"/>`,

    // Ð’Ð¾Ð»ÑˆÐµÐ±Ð½Ð°Ñ: Ð¶ÐµÐ·Ð» Ñ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ð¾Ð¼ Ð¸ Ð¼Ð°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ñ€ÑƒÐ½Ð°Ð¼Ð¸
    magic: `
      <!-- Ð¢ÐµÐ»Ð¾ Ð¶ÐµÐ·Ð»Ð° â€” Ñ€ÐµÐ·ÑŒÐ±Ð° Ñ Ñ€ÑƒÐ½Ð°Ð¼Ð¸ -->
      <rect x="23" y="10" width="6" height="36" rx="3" fill="url(#magWand)" stroke="#7030a0" stroke-width="1"/>
      <defs><linearGradient id="magWand" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3a1060"/><stop offset="50%" stop-color="#8040c0"/><stop offset="100%" stop-color="#3a1060"/></linearGradient></defs>
      <!-- Ð ÑƒÐ½Ñ‹ Ð½Ð° Ð¶ÐµÐ·Ð»Ðµ -->
      <text x="26" y="22" text-anchor="middle" font-size="5" fill="#c080ff" opacity=".8">áš </text>
      <text x="26" y="30" text-anchor="middle" font-size="5" fill="#e0a0ff" opacity=".7">áš±</text>
      <text x="26" y="38" text-anchor="middle" font-size="5" fill="#c080ff" opacity=".8">áš¾</text>
      <!-- Ð‘Ð¾Ð»ÑŒÑˆÐ¾Ð¹ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð» Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <polygon points="26,3 30,9 26,13 22,9" fill="rgba(200,100,255,.7)" stroke="#b060e0" stroke-width="1.5"/>
      <polygon points="26,3 30,9 26,7" fill="rgba(240,180,255,.8)"/>
      <circle cx="25" cy="6" r="1.5" fill="white" opacity=".9"/>
      <!-- ÐœÐ°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¸ÑÐºÑ€Ñ‹ Ð²Ð¾ÐºÑ€ÑƒÐ³ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ð° -->
      <circle cx="32" cy="5" r="1.5" fill="#ff80ff" opacity=".8"/>
      <circle cx="20" cy="7" r="1" fill="#e060ff" opacity=".7"/>
      <circle cx="34" cy="10" r="1" fill="#c040ff" opacity=".6"/>
      <!-- Ð¡Ð²ÐµÑ‚ÑÑ‰Ð°ÑÑÑ Ð°ÑƒÑ€Ð° Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð¶ÐµÐ·Ð»Ð° -->
      <ellipse cx="26" cy="26" rx="10" ry="18" fill="none" stroke="rgba(180,80,255,.25)" stroke-width="3"/>
      <!-- Ð›ÐµÑÐºÐ° Ð¸Ð· ÑÐ²ÐµÑ‚ÑÑ‰Ð¸Ñ…ÑÑ Ñ‡Ð°ÑÑ‚Ð¸Ñ† -->
      <line x1="26" y1="3" x2="44" y2="20" stroke="rgba(200,100,255,.6)" stroke-width="1" stroke-dasharray="2,2"/>
      <!-- ÐœÐ°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¿Ð»Ð°Ð²Ð¾Ðº (Ð·Ð²ÐµÐ·Ð´Ð°) -->
      <polygon points="44,20 45.5,24.5 50.5,24.5 46.5,27.5 48,32 44,29 40,32 41.5,27.5 37.5,24.5 42.5,24.5" fill="rgba(200,100,255,.8)" stroke="#9040c0" stroke-width="0.8"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° Ñ ÐºÐ¾Ð¶Ð°Ð½Ð¾Ð¹ Ð¾Ð±Ð¼Ð¾Ñ‚ÐºÐ¾Ð¹ -->
      <rect x="22" y="42" width="8" height="5" rx="2" fill="#2a0840" stroke="#7030a0" stroke-width="1"/>`,

    // Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ: Ð±Ð¾Ð³Ð°Ñ‚Ð°Ñ Ñ‚Ñ€Ð¾ÑÑ‚Ð¾Ñ‡ÐºÐ° Ñ Ð¼Ð¾Ð½ÐµÑ‚Ð°Ð¼Ð¸ Ð¸ Ð½Ð°ÑÐµÑ‡ÐºÐ¾Ð¹
    golden: `
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð´ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÑÑ‚ÐµÑ€Ð¶ÐµÐ½ÑŒ -->
      <rect x="23" y="8" width="6" height="38" rx="3" fill="url(#golRod)" stroke="#c09010" stroke-width="1.2"/>
      <defs>
        <linearGradient id="golRod" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#907010"/><stop offset="30%" stop-color="#ffe060"/><stop offset="70%" stop-color="#d4a020"/><stop offset="100%" stop-color="#907010"/></linearGradient>
      </defs>
      <!-- Ð“Ñ€Ð°Ð²Ð¸Ñ€Ð¾Ð²ÐºÐ° â€” Ñ€Ð¾Ð¼Ð±Ñ‹ -->
      <line x1="23" y1="14" x2="29" y2="14" stroke="#b08010" stroke-width="0.8" opacity=".7"/>
      <line x1="23" y1="20" x2="29" y2="20" stroke="#b08010" stroke-width="0.8" opacity=".7"/>
      <line x1="23" y1="26" x2="29" y2="26" stroke="#b08010" stroke-width="0.8" opacity=".7"/>
      <line x1="23" y1="32" x2="29" y2="32" stroke="#b08010" stroke-width="0.8" opacity=".7"/>
      <!-- ÐÐ°Ð²ÐµÑ€ÑˆÐ¸Ðµ â€” ÐºÐ¾Ñ€Ð¾Ð½Ð° -->
      <rect x="21" y="5" width="10" height="4" rx="1" fill="#d4a020" stroke="#c09010" stroke-width="0.8"/>
      <rect x="21" y="3" width="2" height="4" rx="0.5" fill="#d4a020" stroke="#c09010" stroke-width="0.7"/>
      <rect x="25" y="2" width="2" height="5" rx="0.5" fill="#ffe060" stroke="#c09010" stroke-width="0.7"/>
      <rect x="29" y="3" width="2" height="4" rx="0.5" fill="#d4a020" stroke="#c09010" stroke-width="0.7"/>
      <!-- Ð ÑƒÐ±Ð¸Ð½Ñ‹ Ð² ÐºÐ¾Ñ€Ð¾Ð½Ðµ -->
      <circle cx="22" cy="4" r="1" fill="#ff2020"/>
      <circle cx="26" cy="3" r="1.2" fill="#ff4040"/>
      <circle cx="30" cy="4" r="1" fill="#ff2020"/>
      <!-- ÐœÐ¾Ð½ÐµÑ‚ÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      <ellipse cx="20" cy="20" rx="3" ry="3" fill="#e8b830" stroke="#b08010" stroke-width="0.7" opacity=".8"/>
      <ellipse cx="32" cy="30" rx="3" ry="3" fill="#e8b830" stroke="#b08010" stroke-width="0.7" opacity=".7"/>
      <!-- Ð›ÐµÑÐºÐ° â€” Ð·Ð¾Ð»Ð¾Ñ‚Ð°Ñ Ð½Ð¸Ñ‚ÑŒ -->
      <line x1="26" y1="2" x2="44" y2="22" stroke="rgba(255,210,50,.7)" stroke-width="1.2"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº â€” ÐºÑƒÐ±Ð¾Ðº -->
      <rect x="41" y="23" width="6" height="8" rx="1" fill="#d4a020" stroke="#907010" stroke-width="1"/>
      <rect x="40" y="23" width="8" height="2" rx="1" fill="#ffe060" stroke="#b08010" stroke-width="0.5"/>
      <rect x="43" y="31" width="2" height="3" fill="#907010"/>
      <rect x="41" y="34" width="6" height="1.5" rx="0.5" fill="#d4a020" stroke="#907010" stroke-width="0.5"/>
      <!-- Ð˜ÑÐºÑ€Ñ‹ Ð·Ð¾Ð»Ð¾Ñ‚Ð° -->
      <circle cx="15" cy="15" r="1.5" fill="#ffe060" opacity=".7"/>
      <circle cx="38" cy="12" r="1" fill="#ffd040" opacity=".6"/>`,
    mech: `
      <line x1="38" y1="10" x2="14" y2="42" stroke="#90e0f8" stroke-width="6" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="rgba(255,255,255,.2)" stroke-width="2" stroke-linecap="round"/>
      <rect x="35" y="7" width="9" height="7" rx="2" fill="rgba(30,80,100,.9)" stroke="#90e0f8" stroke-width="1.5"/>
      <circle cx="39.5" cy="10.5" r="2.5" fill="#90e0f8" stroke="#406070" stroke-width="0.8"/>
      <circle cx="39.5" cy="10.5" r="1" fill="white"/>
      <rect x="28" y="19" width="6" height="3" rx="1" fill="#90e0f844" stroke="#90e0f8" stroke-width="0.8"/>
      <rect x="22" y="26" width="5" height="3" rx="1" fill="#90e0f844" stroke="#90e0f8" stroke-width="0.8"/>
      <rect x="17" y="33" width="5" height="3" rx="1" fill="#90e0f844" stroke="#90e0f8" stroke-width="0.8"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(15,50,65,.9)" stroke="#90e0f8" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#306070" stroke="#4090a0" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#90e0f8"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#90e0f8" stroke-width="1.5" opacity=".85"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#90e0f8" stroke-width="1.3" opacity=".75"/>`,
    cosmic: `
      <line x1="38" y1="10" x2="14" y2="42" stroke="#e060ff" stroke-width="5.5" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="rgba(255,150,255,.25)" stroke-width="2" stroke-linecap="round"/>
      <circle cx="38" cy="10" r="8" fill="rgba(60,0,120,.7)" stroke="#e060ff" stroke-width="1.5"/>
      <circle cx="38" cy="10" r="4.5" fill="#a020d0" opacity=".7"/>
      <circle cx="38" cy="10" r="2" fill="#e060ff"/>
      <circle cx="36" cy="8" r="1.5" fill="white" opacity=".7"/>
      <circle cx="10" cy="20" r="1" fill="white" opacity=".5"/>
      <circle cx="44" cy="28" r="1" fill="white" opacity=".4"/>
      <circle cx="6" cy="36" r="1.5" fill="white" opacity=".5"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(30,5,60,.9)" stroke="#e060ff" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#601090" stroke="#8020c0" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#e060ff"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#e060ff" stroke-width="1.5" opacity=".85"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#e060ff" stroke-width="1.3" opacity=".75"/>`,
    demonic: `
      <line x1="38" y1="10" x2="14" y2="42" stroke="#ff1020" stroke-width="6" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="rgba(255,80,80,.25)" stroke-width="2" stroke-linecap="round"/>
      <path d="M34,12 Q38,8 36,14" fill="#990010" stroke="#cc0010" stroke-width="1.2"/>
      <path d="M29,18 Q33,14 31,20" fill="#990010" stroke="#cc0010" stroke-width="1.2"/>
      <path d="M24,24 Q28,20 26,26" fill="#990010" stroke="#cc0010" stroke-width="1.2"/>
      <path d="M19,31 Q23,27 21,33" fill="#990010" stroke="#cc0010" stroke-width="1.2"/>
      <circle cx="38" cy="10" r="7" fill="rgba(80,0,10,.9)" stroke="#ff1020" stroke-width="1.5"/>
      <circle cx="35.5" cy="7.5" r="2" fill="#ff0000" opacity=".9"/>
      <circle cx="40.5" cy="7.5" r="2" fill="#ff0000" opacity=".9"/>
      <path d="M35,12 Q38,14 41,12" stroke="#ff4040" stroke-width="1" fill="none"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(50,0,10,.95)" stroke="#ff1020" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#600010" stroke="#880010" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#ff4050"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#ff2030" stroke-width="1.5" opacity=".85"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#ff2030" stroke-width="1.3" opacity=".75"/>`,
    godly: `
      <line x1="38" y1="10" x2="14" y2="42" stroke="#ffd700" stroke-width="5.5" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="rgba(255,255,180,.35)" stroke-width="2" stroke-linecap="round"/>
      <circle cx="38" cy="10" r="9" fill="rgba(200,160,0,.3)" stroke="#ffd700" stroke-width="2"/>
      <circle cx="38" cy="10" r="5" fill="#ffd70099" stroke="#c09010" stroke-width="1"/>
      <circle cx="36" cy="8" r="2.5" fill="rgba(255,255,220,.85)"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(60,45,0,.9)" stroke="#ffd700" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#907010" stroke="#b09010" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#fff8a0"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#ffd700" stroke-width="1.5" opacity=".9"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#ffd700" stroke-width="1.3" opacity=".8"/>
      <circle cx="36" cy="17" r="2" fill="none" stroke="#ffd700" stroke-width="1.2" opacity=".7"/>
      <line x1="38" y1="10" x2="46" y2="28" stroke="rgba(255,230,80,.5)" stroke-width="1" stroke-dasharray="2,3"/>`,
    flower: `
      <line x1="38" y1="10" x2="14" y2="42" stroke="#ffb0e0" stroke-width="5.5" stroke-linecap="round"/>
      <circle cx="38" cy="10" r="8" fill="rgba(255,100,180,.4)" stroke="#ffb0e0" stroke-width="1.5"/>
      <circle cx="38" cy="10" r="4" fill="rgba(255,200,100,.7)" stroke="#d0a000" stroke-width="1"/>
      <circle cx="38" cy="10" r="2" fill="#ffff80"/>
      <circle cx="34" cy="7" r="3" fill="rgba(255,120,180,.6)" stroke="#ffb0e0" stroke-width="0.8"/>
      <circle cx="42" cy="7" r="3" fill="rgba(255,120,180,.6)" stroke="#ffb0e0" stroke-width="0.8"/>
      <circle cx="34" cy="13" r="3" fill="rgba(255,120,180,.5)" stroke="#ffb0e0" stroke-width="0.8"/>
      <circle cx="42" cy="13" r="3" fill="rgba(255,120,180,.5)" stroke="#ffb0e0" stroke-width="0.8"/>
      <circle cx="24" cy="24" r="5" fill="rgba(255,100,180,.4)" stroke="#ffb0e0" stroke-width="1"/>
      <circle cx="24" cy="24" r="2.5" fill="#ffff80" stroke="#d0a000" stroke-width="0.5"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(80,20,50,.9)" stroke="#ffb0e0" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#c06090" stroke="#e090b0" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#ffb0e0"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#ffb0e0" stroke-width="1.5" opacity=".85"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#ffb0e0" stroke-width="1.3" opacity=".75"/>`,
    /* â”€â”€ Ð£Ð¶Ðµ Ð±Ñ‹Ð»Ð¸ â€” Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ñ‹ â”€â”€ */

    // Ð ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ ÑƒÑ‚ÐºÐ°: ÑƒÑ‚ÐºÐ° Ð½Ð° Ð¼Ð¸Ð½Ð¸-ÑÐ¿Ð¸Ð½Ð½Ð¸Ð½Ð³Ðµ Ñ Ð±Ñ€Ñ‹Ð·Ð³Ð°Ð¼Ð¸
    rubberduck: `
      <!-- ÐšÐ¾Ñ€Ð¿ÑƒÑ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” Ð²ÐµÑÑ‘Ð»Ð°Ñ Ð¶Ñ‘Ð»Ñ‚Ð°Ñ -->
      <line x1="38" y1="10" x2="18" y2="44" stroke="#f0b010" stroke-width="4.5" stroke-linecap="round"/>
      <!-- Ð‘Ð°Ð½Ñ‚Ð¸Ðº-ÑƒÐºÑ€Ð°ÑˆÐµÐ½Ð¸Ðµ Ð½Ð° Ñ€ÑƒÐºÐ¾ÑÑ‚ÐºÐµ -->
      <path d="M20,42 Q14,38 16,34 Q22,38 20,42Z" fill="#ff6060" stroke="#cc3030" stroke-width="0.8"/>
      <path d="M20,42 Q26,38 24,34 Q18,38 20,42Z" fill="#ff6060" stroke="#cc3030" stroke-width="0.8"/>
      <circle cx="20" cy="42" r="2" fill="#ffaaaa" stroke="#cc3030" stroke-width="0.5"/>
      <!-- Ð›ÐµÑÐºÐ° Ð¿ÑƒÐ½ÐºÑ‚Ð¸Ñ€Ð¾Ð¼ (Ð¸Ð³Ñ€Ð¸Ð²Ð°Ñ) -->
      <path d="M38,10 Q42,18 38,26 Q34,34 38,42" stroke="#f0d020" stroke-width="1.2" stroke-dasharray="2,2" fill="none"/>
      <!-- Ð£Ð¢ÐšÐ Ð¿Ð»Ð°Ð²Ð°ÐµÑ‚ Ð½Ð° ÐºÐ¾Ð½Ñ†Ðµ -->
      <!-- Ð¢ÐµÐ»Ð¾ ÑƒÑ‚ÐºÐ¸ -->
      <ellipse cx="40" cy="38" rx="9" ry="7" fill="#f0d820" stroke="#c0a010" stroke-width="1.5"/>
      <!-- Ð“Ð¾Ð»Ð¾Ð²Ð° -->
      <circle cx="44" cy="33" r="5.5" fill="#f0d820" stroke="#c0a010" stroke-width="1.5"/>
      <!-- Ð“Ð»Ð°Ð· -->
      <circle cx="46" cy="32" r="1.5" fill="#1a1008"/>
      <circle cx="46.5" cy="31.5" r="0.5" fill="white"/>
      <!-- ÐšÐ»ÑŽÐ² -->
      <path d="M47,34 Q51,32 50,36" stroke="#e05020" stroke-width="2.5" fill="#ff8030" stroke-linecap="round"/>
      <!-- ÐšÑ€Ñ‹Ð»Ñ‹ÑˆÐºÐ¾ -->
      <path d="M35,38 Q38,34 42,37" stroke="#c0a010" stroke-width="1.5" fill="rgba(240,200,10,.3)"/>
      <!-- Ð’Ð¾Ð»Ð½Ñ‹ Ð¿Ð¾Ð´ ÑƒÑ‚ÐºÐ¾Ð¹ -->
      <path d="M32,44 Q36,42 40,44 Q44,46 48,44" stroke="rgba(100,180,255,.6)" stroke-width="1.2" fill="none"/>`,

    // ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ: Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð» Ñ Ð³Ñ€Ð°Ð½ÑÐ¼Ð¸ Ð¸ Ñ€Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¼ Ð¾Ñ‚Ñ€Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼  
    crystal: `
      <!-- ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ð¾Ð»Ð¿ ÑÐ½Ð¸Ð·Ñƒ Ð²Ð²ÐµÑ€Ñ… -->
      <polygon points="26,6 33,16 30,46 22,46 19,16" fill="rgba(160,232,255,.3)" stroke="${c}" stroke-width="1.5"/>
      <!-- Ð“Ñ€Ð°Ð½Ð¸ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ð° -->
      <polygon points="26,6 33,16 26,18 19,16" fill="rgba(200,245,255,.6)" stroke="${c}" stroke-width="1"/>
      <line x1="26" y1="6" x2="26" y2="46" stroke="rgba(255,255,255,.5)" stroke-width="1.2"/>
      <line x1="26" y1="18" x2="33" y2="16" stroke="rgba(255,255,255,.3)" stroke-width="0.8"/>
      <line x1="26" y1="18" x2="19" y2="16" stroke="rgba(255,255,255,.3)" stroke-width="0.8"/>
      <!-- Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ðµ Ð¾Ñ‚Ð±Ð»ÐµÑÐºÐ¸ -->
      <line x1="8" y1="10" x2="14" y2="18" stroke="rgba(255,100,100,.6)" stroke-width="1.5"/>
      <line x1="8" y1="14" x2="14" y2="22" stroke="rgba(255,200,50,.5)" stroke-width="1.2"/>
      <line x1="8" y1="18" x2="14" y2="26" stroke="rgba(50,255,100,.5)" stroke-width="1"/>
      <line x1="8" y1="22" x2="14" y2="30" stroke="rgba(50,100,255,.5)" stroke-width="1.2"/>
      <!-- Ð¡Ð½ÐµÐ¶Ð¸Ð½ÐºÐ¸ Ð²Ð¾ÐºÑ€ÑƒÐ³ -->
      <circle cx="40" cy="15" r="2" fill="rgba(200,245,255,.7)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="42" cy="25" r="1.5" fill="rgba(200,245,255,.6)" stroke="${c}" stroke-width="0.7"/>
      <circle cx="10" cy="34" r="1.5" fill="rgba(200,245,255,.5)"/>
      <!-- Ð›ÐµÑÐºÐ° -->
      <line x1="26" y1="6" x2="44" y2="14" stroke="${c}" stroke-width="0.8" opacity=".7"/>
      <!-- ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¿Ð»Ð°Ð²Ð¾Ðº -->
      <polygon points="44,14 48,20 44,28 40,20" fill="rgba(160,232,255,.5)" stroke="${c}" stroke-width="1"/>
      <polygon points="44,14 48,20 44,18 40,20" fill="rgba(220,250,255,.8)"/>`,

    // Ð“Ñ€Ð¾Ð¼Ð¾Ð²Ð°Ñ: Ð·Ð¸Ð³Ð·Ð°Ð³-Ð¼Ð¾Ð»Ð½Ð¸Ñ Ñ Ð³Ñ€Ð¾Ð·Ð¾Ð²Ñ‹Ð¼Ð¸ Ñ‚ÑƒÑ‡Ð°Ð¼Ð¸ Ð¸ Ð´ÑƒÐ³Ð¾Ð¹ Ñ‚Ð¾ÐºÐ°
    thunder: `
      <!-- Ð“Ñ€Ð¾Ð·Ð¾Ð²Ð°Ñ Ñ‚ÑƒÑ‡Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <ellipse cx="14" cy="14" rx="10" ry="7" fill="rgba(60,60,90,.9)" stroke="${c}" stroke-width="1.2"/>
      <ellipse cx="22" cy="12" rx="7" ry="5" fill="rgba(70,70,100,.9)" stroke="${c}" stroke-width="1"/>
      <ellipse cx="10" cy="18" rx="7" ry="4" fill="rgba(60,60,90,.9)" stroke="${c}" stroke-width="0.8"/>
      <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¼Ð¾Ð»Ð½Ð¸Ñ â€” Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð·Ð¸Ð³Ð·Ð°Ð³ -->
      <polygon points="22,18 14,32 20,32 10,48 28,30 20,30" fill="#f8f040" stroke="#c0b010" stroke-width="1.5"/>
      <!-- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€Ð°Ð·Ñ€ÑÐ´Ñ‹ -->
      <path d="M26,20 L32,28 L28,28 L34,38" stroke="${c}" stroke-width="2" fill="none" stroke-linecap="round" opacity=".7"/>
      <path d="M8,22 L12,30" stroke="${c}" stroke-width="1.5" fill="none" opacity=".5"/>
      <!-- Ð­Ð»ÐµÐºÑ‚Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÑƒÐ³Ð¸ Ð²Ð¾ÐºÑ€ÑƒÐ³ -->
      <path d="M38,14 Q44,18 38,22" stroke="${c}" stroke-width="1.5" fill="none" stroke-linecap="round" opacity=".8"/>
      <path d="M40,24 Q46,28 40,32" stroke="${c}" stroke-width="1" fill="none" stroke-linecap="round" opacity=".6"/>
      <!-- Ð”Ð¾Ð¶Ð´ÑŒ Ð¸Ð· Ñ‚ÑƒÑ‡Ð¸ -->
      <line x1="8" y1="22" x2="6" y2="28" stroke="rgba(100,150,255,.7)" stroke-width="1"/>
      <line x1="12" y1="24" x2="10" y2="30" stroke="rgba(100,150,255,.6)" stroke-width="1"/>
      <!-- ÐšÑ€ÑƒÐ³Ð»Ð°Ñ Ð¼Ð¾Ð»Ð½Ð¸Ñ-Ð¿Ð¾Ð¿Ð»Ð°Ð²Ð¾Ðº -->
      <circle cx="10" cy="48" r="3" fill="#f8f040" stroke="#c0b010" stroke-width="1"/>
      <polygon points="10,44 11,47 13,47 11,49 12,51 10,49 8,51 9,49 7,47 9,47" fill="#ffe040" transform="scale(0.4) translate(15,70)"/>`,

    // Ð‘ÐµÐ·Ð´Ð½Ð°: Ñ‡Ñ‘Ñ€Ð½Ð°Ñ Ð´Ñ‹Ñ€Ð° Ñ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð¾Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð¸ Ð¸ÑÐºÐ°Ð¶ÐµÐ½Ð¸ÐµÐ¼
    void: `
      <!-- Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ â€” Ñ‡Ñ‘Ñ€Ð½Ð°Ñ Ð´Ñ‹Ñ€Ð° -->
      <circle cx="26" cy="26" r="20" fill="rgba(5,0,20,.95)" stroke="${c}" stroke-width="2.5"/>
      <!-- ÐÐºÐºÑ€ÐµÑ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð´Ð¸ÑÐº (ÐºÐ¾Ð»ÑŒÑ†Ð° Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð§Ð”) -->
      <ellipse cx="26" cy="26" rx="18" ry="6" fill="none" stroke="rgba(80,0,200,.6)" stroke-width="2" opacity=".9"/>
      <ellipse cx="26" cy="26" rx="22" ry="8" fill="none" stroke="rgba(60,0,160,.4)" stroke-width="1.5" opacity=".7"/>
      <!-- Ð›Ð¸Ð½Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ â€” Ð¸ÑÐºÐ°Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð° -->
      <path d="M6,20 Q14,22 6,28" stroke="rgba(120,0,255,.5)" stroke-width="1.5" fill="none"/>
      <path d="M46,20 Q38,22 46,28" stroke="rgba(120,0,255,.5)" stroke-width="1.5" fill="none"/>
      <!-- Ð¡Ð²ÐµÑ‚Ð»Ñ‹Ðµ Ð·Ð²Ñ‘Ð·Ð´Ñ‹ Ð·Ð°Ñ‚ÑÐ³Ð¸Ð²Ð°ÑŽÑ‚ÑÑ -->
      <circle cx="8" cy="12" r="1.5" fill="white" opacity=".5"/>
      <circle cx="44" cy="10" r="1" fill="white" opacity=".4"/>
      <circle cx="6" cy="38" r="1.5" fill="white" opacity=".3"/>
      <circle cx="46" cy="40" r="1" fill="white" opacity=".4"/>
      <!-- Ð Ð°ÑÑ‚ÑÐ¶ÐµÐ½Ð¸Ðµ Ð·Ð²Ñ‘Ð·Ð´ (ÑÐ¿Ð°Ð³ÐµÑ‚Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ) -->
      <line x1="12" y1="14" x2="18" y2="20" stroke="white" stroke-width="0.8" opacity=".4"/>
      <line x1="40" y1="14" x2="34" y2="20" stroke="white" stroke-width="0.8" opacity=".3"/>
      <!-- Ð¯Ð´Ñ€Ð¾ Ð§Ð” â€” Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð°Ñ Ñ‚ÑŒÐ¼Ð° -->
      <circle cx="26" cy="26" r="8" fill="#000000"/>
      <circle cx="26" cy="26" r="4" fill="${c}" opacity=".6"/>
      <!-- ÐšÑ€ÐµÑÑ‚ Ð¿Ñ€Ð¸Ñ†ÐµÐ»Ð° (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ "Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹") -->
      <line x1="26" y1="14" x2="26" y2="19" stroke="${c}" stroke-width="1" opacity=".6"/>
      <line x1="26" y1="33" x2="26" y2="38" stroke="${c}" stroke-width="1" opacity=".6"/>
      <line x1="14" y1="26" x2="19" y2="26" stroke="${c}" stroke-width="1" opacity=".6"/>
      <line x1="33" y1="26" x2="38" y2="26" stroke="${c}" stroke-width="1" opacity=".6"/>`,
    shark: `<ellipse cx="26" cy="28" rx="18" ry="9" fill="rgba(0,100,140,.7)" stroke="${c}" stroke-width="2"/>
      <polygon points="26,10 30,19 26,28 22,19" fill="#1a8aaa" stroke="${c}" stroke-width="1.5"/>
      <polygon points="12,30 6,40 18,34" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <polygon points="40,30 46,40 34,34" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <circle cx="16" cy="26" r="3" fill="#001020" stroke="${c}" stroke-width="1"/>
      <path d="M10,31 L13,34 L16,31 L19,34 L22,31" stroke="#fff" stroke-width="1.5" fill="none"/>
      <text x="26" y="48" text-anchor="middle" font-size="9" fill="${c}" font-family="sans-serif">ðŸ¦ˆ</text>`,
    // â•â•â• Ð¥ÐÐ Ð”ÐšÐžÐ  â•â•â•
    meteor: `
      <!-- Meteor rod â€” glowing orange rock + trail -->
      <ellipse cx="26" cy="26" rx="16" ry="16" fill="rgba(80,20,0,.8)" stroke="${c}" stroke-width="2"/>
      <!-- Crater texture -->
      <circle cx="20" cy="22" r="4" fill="rgba(0,0,0,.4)" stroke="rgba(255,80,0,.5)" stroke-width="1"/>
      <circle cx="31" cy="30" r="3" fill="rgba(0,0,0,.3)" stroke="rgba(255,100,0,.4)" stroke-width="1"/>
      <circle cx="24" cy="32" r="2.5" fill="rgba(0,0,0,.35)" stroke="rgba(255,80,0,.4)" stroke-width="1"/>
      <!-- Glowing lava cracks -->
      <path d="M18,18 L22,24 L18,28 L24,30" stroke="#ff6020" stroke-width="1.5" fill="none" opacity=".9"/>
      <path d="M28,16 L32,20 L29,26" stroke="#ff8040" stroke-width="1.5" fill="none" opacity=".9"/>
      <path d="M14,26 L20,28 L16,34" stroke="#ffa060" stroke-width="1.5" fill="none" opacity=".8"/>
      <!-- Fire particles -->
      <circle cx="10" cy="14" r="3" fill="#ff4000" opacity=".7"/>
      <circle cx="42" cy="12" r="2" fill="#ffaa00" opacity=".6"/>
      <circle cx="8" cy="38" r="2" fill="#ff6020" opacity=".5"/>
      <!-- Handle with metal rings -->
      <line x1="26" y1="42" x2="26" y2="50" stroke="#888" stroke-width="4" stroke-linecap="round"/>
      <line x1="22" y1="44" x2="30" y2="44" stroke="${c}" stroke-width="2"/>
      <line x1="22" y1="47" x2="30" y2="47" stroke="${c}" stroke-width="1.5"/>`,
    dragon: `
      <!-- Dragon bone rod â€” elaborate bone with scales -->
      <line x1="38" y1="8" x2="14" y2="44" stroke="#c04020" stroke-width="6" stroke-linecap="round"/>
      <line x1="38" y1="8" x2="14" y2="44" stroke="rgba(255,80,0,.3)" stroke-width="3" stroke-linecap="round"/>
      <!-- Dragon scales along rod -->
      <path d="M34,12 Q38,8 36,14" fill="#a03010" stroke="#cc2200" stroke-width="1"/>
      <path d="M30,17 Q34,13 32,19" fill="#a03010" stroke="#cc2200" stroke-width="1"/>
      <path d="M26,22 Q30,18 28,24" fill="#a03010" stroke="#cc2200" stroke-width="1"/>
      <path d="M22,27 Q26,23 24,29" fill="#a03010" stroke="#cc2200" stroke-width="1"/>
      <path d="M18,32 Q22,28 20,34" fill="#a03010" stroke="#cc2200" stroke-width="1"/>
      <!-- Dragon skull tip -->
      <circle cx="38" cy="8" r="6" fill="rgba(60,0,0,.8)" stroke="#cc2200" stroke-width="2"/>
      <circle cx="36" cy="6" r="2" fill="#ff0000" opacity=".8"/>
      <circle cx="40" cy="6" r="2" fill="#ff0000" opacity=".8"/>
      <path d="M35,10 L37,12 L39,10 L41,12" stroke="#ff8040" stroke-width="1" fill="none"/>
      <!-- Reel with dragon markings -->
      <circle cx="14" cy="40" r="7" fill="rgba(0,0,0,.6)" stroke="#cc2200" stroke-width="2"/>
      <circle cx="14" cy="40" r="4" fill="#601010" stroke="#aa2000" stroke-width="1"/>
      <circle cx="14" cy="40" r="1.5" fill="#ff4040"/>
      <!-- Fire breath effect -->
      <path d="M40,4 Q46,2 44,8 Q50,6 46,12" stroke="#ff8020" stroke-width="1.5" fill="none" opacity=".7"/>`,
    poseidon: `
      <!-- Trident of Poseidon â€” three-pronged golden trident -->
      <line x1="26" y1="44" x2="26" y2="18" stroke="#0060ff" stroke-width="5" stroke-linecap="round"/>
      <line x1="26" y1="44" x2="26" y2="18" stroke="rgba(100,180,255,.4)" stroke-width="2" stroke-linecap="round"/>
      <!-- Three prongs -->
      <line x1="26" y1="18" x2="26" y2="8" stroke="${c}" stroke-width="3" stroke-linecap="round"/>
      <line x1="20" y1="20" x2="18" y2="8" stroke="${c}" stroke-width="3" stroke-linecap="round"/>
      <line x1="32" y1="20" x2="34" y2="8" stroke="${c}" stroke-width="3" stroke-linecap="round"/>
      <!-- Prong tips -->
      <polygon points="26,6 24,10 28,10" fill="${c}" stroke="#0040c0" stroke-width="1"/>
      <polygon points="18,6 16,10 20,10" fill="${c}" stroke="#0040c0" stroke-width="1"/>
      <polygon points="34,6 32,10 36,10" fill="${c}" stroke="#0040c0" stroke-width="1"/>
      <!-- Cross piece -->
      <line x1="18" y1="20" x2="34" y2="20" stroke="${c}" stroke-width="2.5"/>
      <circle cx="18" cy="20" r="2.5" fill="${c}"/>
      <circle cx="34" cy="20" r="2.5" fill="${c}"/>
      <!-- Handle decorations -->
      <line x1="24" y1="28" x2="28" y2="28" stroke="${c}" stroke-width="2"/>
      <line x1="24" y1="33" x2="28" y2="33" stroke="${c}" stroke-width="2"/>
      <line x1="24" y1="38" x2="28" y2="38" stroke="${c}" stroke-width="2"/>
      <!-- Water droplets -->
      <circle cx="8" cy="16" r="2.5" fill="rgba(0,100,255,.6)" stroke="${c}" stroke-width="1"/>
      <circle cx="44" cy="22" r="2" fill="rgba(0,150,255,.5)" stroke="${c}" stroke-width="1"/>
      <circle cx="6" cy="30" r="1.5" fill="rgba(0,120,255,.4)"/>`,
    quantum: `
      <!-- Quantum rod â€” multiple overlapping versions -->
      <line x1="38" y1="10" x2="14" y2="42" stroke="${c}" stroke-width="4" stroke-linecap="round" opacity=".9"/>
      <line x1="40" y1="8" x2="16" y2="40" stroke="#ff00ff" stroke-width="3" stroke-linecap="round" opacity=".5"/>
      <line x1="36" y1="12" x2="12" y2="44" stroke="#00ffff" stroke-width="3" stroke-linecap="round" opacity=".4"/>
      <!-- Quantum rings (superposition) -->
      <circle cx="25" cy="26" r="8" fill="none" stroke="${c}" stroke-width="1.5" opacity=".9"/>
      <circle cx="27" cy="24" r="8" fill="none" stroke="#ff00ff" stroke-width="1" opacity=".5"/>
      <circle cx="23" cy="28" r="8" fill="none" stroke="#00ffff" stroke-width="1" opacity=".4"/>
      <!-- Probability cloud -->
      <circle cx="26" cy="26" r="4" fill="rgba(255,0,255,.3)" stroke="${c}" stroke-width="1"/>
      <circle cx="26" cy="26" r="2" fill="${c}" opacity=".8"/>
      <!-- Dimensional cracks -->
      <path d="M10,10 L16,18 L12,24" stroke="#ff00ff" stroke-width="1" fill="none" opacity=".6"/>
      <path d="M42,38 L36,30 L40,24" stroke="#00ffff" stroke-width="1" fill="none" opacity=".6"/>
      <!-- Reel (blurred/multiple) -->
      <circle cx="14" cy="40" r="6" fill="rgba(0,0,0,.5)" stroke="${c}" stroke-width="2" opacity=".9"/>
      <circle cx="15" cy="39" r="5" fill="rgba(0,0,0,.3)" stroke="#ff00ff" stroke-width="1" opacity=".5"/>`,
    celestial: `
      <!-- Celestial rod â€” glowing white with stars and halos -->
      <line x1="38" y1="10" x2="14" y2="42" stroke="#ffffff" stroke-width="5" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="${c}" stroke-width="2" stroke-linecap="round" opacity=".6"/>
      <!-- Holy rings / halos -->
      <ellipse cx="26" cy="24" rx="14" ry="5" fill="none" stroke="#ffffff" stroke-width="1.5" opacity=".6"/>
      <ellipse cx="26" cy="24" rx="18" ry="6" fill="none" stroke="${c}" stroke-width="1" opacity=".3"/>
      <!-- Stars along rod -->
      <polygon points="35,14 36,17 39,17 37,19 38,22 35,20 32,22 33,19 31,17 34,17" fill="#ffffff" opacity=".9" transform="scale(0.5) translate(35,4)"/>
      <polygon points="35,14 36,17 39,17 37,19 38,22 35,20 32,22 33,19 31,17 34,17" fill="#ffffa0" opacity=".8" transform="scale(0.4) translate(28,28)"/>
      <polygon points="35,14 36,17 39,17 37,19 38,22 35,20 32,22 33,19 31,17 34,17" fill="#a0c8ff" opacity=".7" transform="scale(0.35) translate(18,58)"/>
      <!-- Glowing tip -->
      <circle cx="38" cy="10" r="5" fill="rgba(255,255,255,.3)" stroke="#ffffff" stroke-width="2"/>
      <circle cx="38" cy="10" r="2.5" fill="#ffffff" opacity=".9"/>
      <!-- Light rays -->
      <line x1="38" y1="4" x2="38" y2="6" stroke="#ffffff" stroke-width="1.5" opacity=".7"/>
      <line x1="42" y1="7" x2="44" y2="7" stroke="#ffffff" stroke-width="1.5" opacity=".6"/>
      <line x1="41" y1="4" x2="43" y2="3" stroke="#ffffff" stroke-width="1" opacity=".5"/>
      <!-- Crystal reel -->
      <circle cx="14" cy="40" r="7" fill="rgba(200,240,255,.2)" stroke="#ffffff" stroke-width="2"/>
      <circle cx="14" cy="40" r="4" fill="rgba(255,255,255,.4)" stroke="#c0e8ff" stroke-width="1"/>`,
    apocalypse: `
      <!-- Apocalypse rod â€” reality is breaking -->
      <!-- Broken world background -->
      <circle cx="26" cy="26" r="22" fill="rgba(60,0,0,.8)" stroke="#ff0000" stroke-width="2"/>
      <!-- Cracks in reality -->
      <path d="M4,4 L15,16 L10,26 L20,22 L26,26 L34,18 L42,26 L48,14" stroke="#ff0000" stroke-width="2" fill="none"/>
      <path d="M8,42 L18,32 L22,38 L30,28 L36,34 L44,22 L50,30" stroke="#ff4000" stroke-width="1.5" fill="none" opacity=".8"/>
      <!-- The rod itself â€” barely visible -->
      <line x1="38" y1="8" x2="14" y2="44" stroke="#ff0000" stroke-width="6" stroke-linecap="round" opacity=".9"/>
      <line x1="38" y1="8" x2="14" y2="44" stroke="#ffffff" stroke-width="2" stroke-linecap="round" opacity=".4"/>
      <!-- Eye of chaos -->
      <ellipse cx="26" cy="24" rx="8" ry="5" fill="rgba(0,0,0,.9)" stroke="#ff0000" stroke-width="2"/>
      <ellipse cx="26" cy="24" rx="4" ry="3" fill="#ff0000"/>
      <ellipse cx="26" cy="24" rx="2" ry="2" fill="#ffffff" opacity=".8"/>
      <!-- Explosion rings -->
      <circle cx="26" cy="26" r="10" fill="none" stroke="#ff4000" stroke-width="1" opacity=".7"/>
      <circle cx="26" cy="26" r="15" fill="none" stroke="#ff8000" stroke-width="0.8" opacity=".5"/>
      <!-- Blood drips -->
      <path d="M20,40 L19,44 L20,48" stroke="#cc0000" stroke-width="2" fill="none"/>
      <path d="M28,42 L27,46" stroke="#cc0000" stroke-width="2" fill="none"/>
      <circle cx="19" cy="49" r="2" fill="#cc0000"/>`,
    marble: `
      <!-- Marble rod â€” white/grey veined marble handle with marble ball -->
      <!-- Rod body â€” white marble with veins -->
      <line x1="38" y1="10" x2="14" y2="42" stroke="#e8e0f0" stroke-width="5.5" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="14" y2="42" stroke="rgba(160,140,200,.4)" stroke-width="2" stroke-linecap="round"/>
      <!-- Marble veins on rod -->
      <path d="M34,14 Q32,18 36,22" stroke="rgba(160,140,200,.6)" stroke-width="1" fill="none"/>
      <path d="M28,20 Q24,24 28,30" stroke="rgba(200,180,240,.5)" stroke-width="0.8" fill="none"/>
      <path d="M22,28 Q26,32 20,38" stroke="rgba(140,120,180,.5)" stroke-width="0.8" fill="none"/>
      <!-- Marble sphere at tip â€” realistic marble -->
      <defs>
        <radialGradient id="marbleGrad" cx="35%" cy="30%">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="40%" stop-color="#d4c8e8"/>
          <stop offset="100%" stop-color="#9080c0"/>
        </radialGradient>
      </defs>
      <circle cx="38" cy="10" r="9" fill="url(#marbleGrad)" stroke="rgba(180,160,220,.8)" stroke-width="1.5"/>
      <!-- Marble veins on sphere -->
      <path d="M32,6 Q36,10 34,14" stroke="rgba(80,60,140,.4)" stroke-width="1" fill="none"/>
      <path d="M38,4 Q42,8 40,12" stroke="rgba(100,80,160,.3)" stroke-width="0.8" fill="none"/>
      <path d="M35,8 Q33,11 36,13" stroke="rgba(200,180,240,.5)" stroke-width="0.7" fill="none"/>
      <!-- Highlight on sphere -->
      <circle cx="35" cy="7" r="3" fill="rgba(255,255,255,.6)"/>
      <!-- Reel -->
      <circle cx="18" cy="36" r="6.5" fill="rgba(30,20,60,.7)" stroke="#c0b0e0" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#a090c0" stroke="#8070a0" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#e0d0ff"/>
      <!-- Rod rings -->
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="#d0c0f0" stroke-width="1.5" opacity=".8"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="#d0c0f0" stroke-width="1.3" opacity=".7"/>
      <!-- Marble thrown in water effect â€” mini marble below rod -->
      <circle cx="10" cy="46" r="4" fill="url(#marbleGrad)" stroke="rgba(180,160,220,.6)" stroke-width="1" opacity=".7"/>
      <path d="M8,48 Q10,50 12,48" stroke="rgba(160,200,255,.5)" stroke-width="1" fill="none"/>`,

    // ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ: Ð¿Ð¾Ð»ÑƒÐ¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ ectoplasm-ÑƒÐ´Ð¾Ñ‡ÐºÐ° Ñ Ð¼ÐµÑ€Ñ†Ð°ÑŽÑ‰Ð¸Ð¼ ÐºÐ¾Ð½Ñ‚ÑƒÑ€Ð¾Ð¼
    ghost: `
      <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ðµ Ñ‚ÐµÐ»Ð¾ â€” Ð¿Ð¾Ð»ÑƒÐ¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ðµ, ÑÐ»ÐµÐ³ÐºÐ° Ð¸ÑÐºÐ°Ð¶Ñ‘Ð½Ð½Ð¾Ðµ -->
      <line x1="38" y1="10" x2="18" y2="44" stroke="rgba(128,255,200,.15)" stroke-width="7" stroke-linecap="round"/>
      <line x1="38" y1="10" x2="18" y2="44" stroke="rgba(128,255,200,.6)" stroke-width="2" stroke-linecap="round" stroke-dasharray="4,2"/>
      <!-- "Ð¢ÐµÐ½ÑŒ" ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” ÑÐ¼ÐµÑ‰Ñ‘Ð½Ð½Ð°Ñ -->
      <line x1="40" y1="9" x2="20" y2="43" stroke="rgba(180,100,255,.2)" stroke-width="5" stroke-linecap="round"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” ÑÐ²ÐµÑ‚ÑÑ‰Ð¸ÐµÑÑ, Ð¿Ð°Ñ€ÑÑ‰Ð¸Ðµ -->
      <circle cx="32" cy="20" r="5" fill="none" stroke="rgba(128,255,200,.7)" stroke-width="1.5" stroke-dasharray="3,2"/>
      <circle cx="27" cy="28" r="4" fill="none" stroke="rgba(128,255,200,.6)" stroke-width="1.3" stroke-dasharray="3,2"/>
      <circle cx="23" cy="35" r="3" fill="none" stroke="rgba(128,255,200,.5)" stroke-width="1.2" stroke-dasharray="2,2"/>
      <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°Ðº Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ (Ð¼Ð¸Ð»Ñ‹Ð¹) -->
      <ellipse cx="38" cy="10" rx="9" ry="10" fill="rgba(200,255,230,.85)" stroke="rgba(128,255,200,.9)" stroke-width="1.5"/>
      <path d="M29,15 Q29,22 33,20 Q35,18 38,20 Q41,18 43,20 Q47,22 47,15" fill="rgba(200,255,230,.85)" stroke="rgba(128,255,200,.9)" stroke-width="1.5"/>
      <!-- Ð“Ð»Ð°Ð·ÐºÐ¸ Ð¿Ñ€Ð¸Ð·Ñ€Ð°ÐºÐ° -->
      <ellipse cx="35" cy="9" rx="2" ry="2.5" fill="rgba(20,20,40,.8)"/>
      <ellipse cx="41" cy="9" rx="2" ry="2.5" fill="rgba(20,20,40,.8)"/>
      <!-- Ð Ð¾Ñ‚Ð¸Ðº Ðž_Ðž (ÑƒÐ´Ð¸Ð²Ð»Ñ‘Ð½Ð½Ñ‹Ð¹) -->
      <circle cx="38" cy="13" r="1.5" fill="rgba(20,20,40,.7)"/>
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ -->
      <circle cx="18" cy="40" r="7" fill="rgba(128,255,200,.1)" stroke="rgba(128,255,200,.7)" stroke-width="1.8" stroke-dasharray="4,3"/>
      <circle cx="18" cy="40" r="4" fill="rgba(128,255,200,.2)" stroke="rgba(128,255,200,.5)" stroke-width="1"/>
      <circle cx="18" cy="40" r="1.5" fill="rgba(200,255,230,.8)"/>`,

    // â•â•â• ÐÐžÐ’ÐÐ¯: Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð° â•â•â•
    pharaoh: `
      <defs>
        <linearGradient id="phGold" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#c09010"/>
          <stop offset="40%" stop-color="#ffe060"/>
          <stop offset="100%" stop-color="#a07010"/>
        </linearGradient>
        <radialGradient id="phScarab" cx="50%" cy="40%">
          <stop offset="0%" stop-color="#40c060"/>
          <stop offset="100%" stop-color="#106030"/>
        </radialGradient>
        <filter id="phGlow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð¿Ð¾ÑÐ¾Ñ… Ñ„Ð°Ñ€Ð°Ð¾Ð½Ð° Ñ Ð¸ÐµÑ€Ð¾Ð³Ð»Ð¸Ñ„Ð°Ð¼Ð¸ -->
      <rect x="24" y="7" width="6" height="38" rx="2" fill="url(#phGold)" stroke="#a07010" stroke-width="1" filter="url(#phGlow)"/>
      <!-- Ð˜ÐµÑ€Ð¾Ð³Ð»Ð¸Ñ„Ñ‹ Ð½Ð° Ð¿Ð¾ÑÐ¾Ñ…Ðµ -->
      <text x="27" y="17" text-anchor="middle" font-size="4.5" fill="#8a5010" opacity=".8">ð“‚€</text>
      <text x="27" y="26" text-anchor="middle" font-size="4" fill="#8a5010" opacity=".7">ð“†£</text>
      <text x="27" y="35" text-anchor="middle" font-size="4" fill="#8a5010" opacity=".8">ð“¹</text>
      <!-- Ð¡ÐºÐ°Ñ€Ð°Ð±ÐµÐ¹ Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ â€” ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑÑ -->
      <g style="transform-origin:27px 7px;animation:pharaohScarabSpin 4s linear infinite;">
        <ellipse cx="27" cy="7" rx="7" ry="5" fill="url(#phScarab)" stroke="#20a040" stroke-width="1"/>
        <ellipse cx="27" cy="7" rx="4" ry="3" fill="#50e080" opacity=".6"/>
        <!-- ÐšÑ€Ñ‹Ð»Ñ‹ÑˆÐºÐ¸ ÑÐºÐ°Ñ€Ð°Ð±ÐµÑ -->
        <path d="M20,6 Q16,3 18,8 Q20,9 22,7" fill="#30b060" opacity=".8"/>
        <path d="M34,6 Q38,3 36,8 Q34,9 32,7" fill="#30b060" opacity=".8"/>
        <circle cx="27" cy="7" r="1.5" fill="#90ff80" opacity=".9"/>
      </g>
      <!-- ÐÐ½Ðº (ÐµÐ³Ð¸Ð¿ÐµÑ‚ÑÐºÐ¸Ð¹ ÐºÑ€ÐµÑÑ‚) Ð½Ð° Ñ€ÑƒÐºÐ¾ÑÑ‚ÐºÐµ -->
      <ellipse cx="27" cy="42" rx="4" ry="3" fill="none" stroke="#ffe060" stroke-width="1.5"/>
      <line x1="27" y1="45" x2="27" y2="50" stroke="#ffe060" stroke-width="1.5"/>
      <line x1="24" y1="47" x2="30" y2="47" stroke="#ffe060" stroke-width="1.5"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¸ÐµÑ€Ð¾Ð³Ð»Ð¸Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ -->
      <ellipse cx="33" cy="16" rx="5" ry="3" fill="none" stroke="#ffe060" stroke-width="1.5"/>
      <ellipse cx="35" cy="26" rx="4" ry="2.5" fill="none" stroke="#d4a030" stroke-width="1.3"/>
      <ellipse cx="36" cy="35" rx="3" ry="2" fill="none" stroke="#c09020" stroke-width="1.2"/>
      <!-- ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ñ‹Ðµ Ð¸ÐµÑ€Ð¾Ð³Ð»Ð¸Ñ„Ñ‹ Ð²Ð¾ÐºÑ€ÑƒÐ³ -->
      <text x="14" y="20" font-size="7" fill="rgba(255,200,0,.5)">ð“¹</text>
      <text x="40" y="30" font-size="6" fill="rgba(255,200,0,.4)">ð“‚€</text>
      <!-- Ð›ÐµÑÐºÐ° Ð¸Ð· Ð·Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð½Ð¸Ñ‚Ð¸ -->
      <line x1="27" y1="7" x2="48" y2="25" stroke="#d4a020" stroke-width="1" stroke-dasharray="2,1" opacity=".8"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº â€” ÑÐ°Ñ€ÐºÐ¾Ñ„Ð°Ð³ -->
      <rect x="44" y="24" width="8" height="12" rx="3" fill="#c09010" stroke="#806010" stroke-width="1"/>
      <ellipse cx="48" cy="24" rx="4" ry="2.5" fill="#d4a020" stroke="#806010" stroke-width="1"/>
      <line x1="46" y1="27" x2="50" y2="27" stroke="#806010" stroke-width="0.8"/>
      <line x1="46" y1="30" x2="50" y2="30" stroke="#806010" stroke-width="0.8"/>`,

    // â•â•â• ÐÐžÐ’ÐÐ¯: ÐÐµÐ¾Ð½-Ð¢ÑƒÑ€Ð±Ð¾ Ð£Ð´Ð¾Ñ‡ÐºÐ° â•â•â•
    neon: `
      <defs>
        <linearGradient id="neonBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#003020"/>
          <stop offset="50%" stop-color="#00604040"/>
          <stop offset="100%" stop-color="#003020"/>
        </linearGradient>
        <filter id="neonBlur"><feGaussianBlur stdDeviation="1.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¤ÑƒÑ‚ÑƒÑ€Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ¾Ñ€Ð¿ÑƒÑ -->
      <rect x="24" y="7" width="6" height="38" rx="2.5" fill="#0a1a14" stroke="#00ffcc" stroke-width="1" filter="url(#neonBlur)"/>
      <!-- ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ð¾ÑÑ‹ -->
      <line x1="24" y1="7" x2="24" y2="45" stroke="#00ffcc" stroke-width="1.5" opacity=".8"/>
      <line x1="30" y1="7" x2="30" y2="45" stroke="#00e0cc" stroke-width="1.5" opacity=".8"/>
      <!-- Ð¡ÐºÑ€Ð¾Ð»Ð»ÑÑ‰Ð¸ÐµÑÑ Ð´Ð°Ð½Ð½Ñ‹Ðµ Wi-Fi -->
      <rect x="25" y="8" width="4" height="36" rx="1" fill="rgba(0,0,0,.6)" clip-path="url(#neonClip)"/>
      <defs><clipPath id="neonClip"><rect x="25" y="8" width="4" height="36" rx="1"/></clipPath></defs>
      <text x="27" y="14" text-anchor="middle" font-size="3.5" fill="#00ffcc" opacity=".7" style="animation:neonDataScroll 1s linear infinite;">10</text>
      <text x="27" y="19" text-anchor="middle" font-size="3.5" fill="#00ccff" opacity=".6">01</text>
      <text x="27" y="24" text-anchor="middle" font-size="3.5" fill="#00ffaa" opacity=".7">11</text>
      <text x="27" y="29" text-anchor="middle" font-size="3.5" fill="#00ffcc" opacity=".6">00</text>
      <text x="27" y="34" text-anchor="middle" font-size="3.5" fill="#00ccff" opacity=".7">10</text>
      <text x="27" y="39" text-anchor="middle" font-size="3.5" fill="#00ffcc" opacity=".6">11</text>
      <!-- Wi-Fi Ð°Ð½Ñ‚ÐµÐ½Ð½Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <line x1="27" y1="7" x2="27" y2="2" stroke="#00ffcc" stroke-width="2" stroke-linecap="round"/>
      <!-- Wi-Fi ÐºÐ¾Ð»ÑŒÑ†Ð° -->
      <path d="M22,4 Q27,0 32,4" stroke="#00ffcc" stroke-width="1.5" fill="none" opacity=".9"/>
      <path d="M20,6 Q27,-1 34,6" stroke="#00ffcc" stroke-width="1" fill="none" opacity=".5"/>
      <!-- Ð¡ÐºÐ°Ð½Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¹ Ð»ÑƒÑ‡ -->
      <line x1="27" y1="2" x2="50" y2="20" stroke="#00ffcc" stroke-width="0.8" stroke-dasharray="3,2" opacity=".6"/>
      <!-- Ð§Ð¸Ð¿-Ð¸ÐºÐ¾Ð½ÐºÐ° Ð½Ð° ÐºÐ¾Ñ€Ð¿ÑƒÑÐµ -->
      <rect x="18" y="22" width="8" height="6" rx="1" fill="#001a14" stroke="#00ffcc" stroke-width="0.8"/>
      <circle cx="22" cy="25" r="1.5" fill="#00ffcc" opacity=".8"/>
      <line x1="18" y1="25" x2="16" y2="25" stroke="#00ffcc" stroke-width="0.6"/>
      <line x1="26" y1="25" x2="28" y2="25" stroke="#00ffcc" stroke-width="0.6"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð³Ð¾Ð»Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ -->
      <ellipse cx="34" cy="15" rx="5" ry="3" fill="none" stroke="#00ffcc" stroke-width="1.5" opacity=".9"/>
      <ellipse cx="36" cy="25" rx="4" ry="2.5" fill="none" stroke="#00e0ff" stroke-width="1.3" opacity=".8"/>
      <ellipse cx="37" cy="34" rx="3.5" ry="2" fill="none" stroke="#00ffaa" stroke-width="1.2" opacity=".7"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº-Ð´Ñ€Ð¾Ð½ -->
      <rect x="44" y="19" width="10" height="6" rx="3" fill="#001a14" stroke="#00ffcc" stroke-width="1"/>
      <circle cx="49" cy="22" r="2" fill="#00ffcc" opacity=".8"/>
      <line x1="44" y1="22" x2="42" y2="22" stroke="#00ffcc" stroke-width="1" stroke-linecap="round"/>
      <line x1="54" y1="22" x2="56" y2="22" stroke="#00ffcc" stroke-width="1" stroke-linecap="round"/>
      <line x1="47" y1="19" x2="47" y2="17" stroke="#00ffcc" stroke-width="0.8"/>
      <line x1="51" y1="19" x2="51" y2="17" stroke="#00ffcc" stroke-width="0.8"/>`,

    // â•â•â• ÐÐžÐ’ÐÐ¯: Ð©ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ ÐšÑ€Ð°ÐºÐµÐ½Ð° â•â•â•
    kraken: `
      <defs>
        <linearGradient id="krkBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#1a0840"/>
          <stop offset="50%" stop-color="#4010a0"/>
          <stop offset="100%" stop-color="#1a0840"/>
        </linearGradient>
        <radialGradient id="krkEye" cx="40%" cy="35%">
          <stop offset="0%" stop-color="#ff4040"/>
          <stop offset="100%" stop-color="#800000"/>
        </radialGradient>
        <filter id="krkGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ â€” ÑÐºÑ€ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ -->
      <path d="M26,7 Q22,15 26,23 Q30,31 26,39 Q24,43 26,46" stroke="url(#krkBody)" stroke-width="7" fill="none" stroke-linecap="round" filter="url(#krkGlow)"/>
      <path d="M26,7 Q22,15 26,23 Q30,31 26,39 Q24,43 26,46" stroke="#8030e0" stroke-width="3" fill="none" stroke-linecap="round" opacity=".6"/>
      <!-- ÐŸÑ€Ð¸ÑÐ¾ÑÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ð° -->
      ${[12,20,28,36,42].map((y,i)=>
        `<circle cx="${24+i%2*4}" cy="${y}" r="${2.5-i*.1}" fill="rgba(0,0,0,.7)" stroke="#9040d0" stroke-width="1" opacity="${.9-i*.05}"/>`+
        `<circle cx="${24+i%2*4}" cy="${y}" r="${1.2-i*.05}" fill="rgba(120,50,200,.5)"/>`
      ).join('')}
      <!-- ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ð° -->
      <path d="M26,20 Q18,14 16,18" stroke="#6020b0" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M26,30 Q34,24 36,28" stroke="#6020b0" stroke-width="2" fill="none" stroke-linecap="round"/>
      <!-- Ð–ÑƒÑ‚ÐºÐ¸Ð¹ Ð³Ð»Ð°Ð· ÐºÑ€Ð°ÐºÐµÐ½Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <ellipse cx="26" cy="6" rx="8" ry="7" fill="#0a0420" stroke="#6020c0" stroke-width="1.5" filter="url(#krkGlow)"/>
      <ellipse cx="26" cy="6" rx="5" ry="5" fill="url(#krkEye)"/>
      <ellipse cx="26" cy="6" rx="2.5" ry="3" fill="#1a0000"/>
      <circle cx="27.5" cy="4.5" r="1.2" fill="rgba(255,255,255,.7)"/>
      <!-- Ð¡Ð²ÐµÑ‚ÑÑ‰Ð¸Ð¹ÑÑ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ñ€Ð°Ñ‡Ð¾Ðº -->
      <ellipse cx="26" cy="6" rx="1" ry="2.5" fill="rgba(0,0,0,.9)"/>
      <!-- Ð§ÐµÑ€Ð½Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ»ÐµÐ´ (Ð»ÐµÑÐºÐ°) -->
      <path d="M26,6 Q38,10 48,22" stroke="rgba(80,0,160,.7)" stroke-width="1.5" fill="none" stroke-dasharray="3,2"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº â€” Ð³Ð¾Ð»Ð¾Ð²Ð° Ð¾ÑÑŒÐ¼Ð¸Ð½Ð¾Ð³Ð° -->
      <ellipse cx="48" cy="24" rx="6" ry="5" fill="#1a0840" stroke="#8030e0" stroke-width="1.5"/>
      <ellipse cx="48" cy="22" rx="3" ry="2" fill="rgba(100,40,180,.4)"/>
      <circle cx="46" cy="21" r="1" fill="#ff4040"/>
      <circle cx="50" cy="21" r="1" fill="#ff4040"/>
      <!-- ÐœÐ¸Ð½Ð¸ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ð° Ð¿Ð¾Ð¿Ð»Ð°Ð²ÐºÐ° -->
      <path d="M44,28 Q42,32 44,34" stroke="#6020b0" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M48,29 Q48,33 46,35" stroke="#6020b0" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M52,28 Q54,32 52,34" stroke="#6020b0" stroke-width="1.5" fill="none" stroke-linecap="round"/>`,

    // â•â•â• ÐÐžÐ’ÐÐ¯: Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð’Ñ€ÐµÐ¼ÐµÐ½Ð¸ â•â•â•
    time: `
      <defs>
        <linearGradient id="tmBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#8090b0"/>
          <stop offset="50%" stop-color="#e0f0ff"/>
          <stop offset="100%" stop-color="#8090b0"/>
        </linearGradient>
        <radialGradient id="tmOrb" cx="35%" cy="30%">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="50%" stop-color="#c0e0ff"/>
          <stop offset="100%" stop-color="#4080c0"/>
        </radialGradient>
        <filter id="tmGlow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ Ð¸Ð· Ð·Ð°Ð¼Ñ‘Ñ€Ð·ÑˆÐµÐ³Ð¾ Ñ…Ñ€ÑƒÑÑ‚Ð°Ð»Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ -->
      <rect x="24" y="7" width="6" height="38" rx="3" fill="url(#tmBody)" stroke="#c0e0ff" stroke-width="1" filter="url(#tmGlow)" opacity=".9"/>
      <!-- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹ÌÐµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ (Ð·Ð°ÑÑ‚Ñ‹Ð²ÑˆÐ¸Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹) -->
      <line x1="24" y1="12" x2="30" y2="18" stroke="rgba(255,255,255,.7)" stroke-width=".8"/>
      <line x1="30" y1="22" x2="24" y2="28" stroke="rgba(255,255,255,.6)" stroke-width=".8"/>
      <line x1="24" y1="32" x2="30" y2="38" stroke="rgba(255,255,255,.5)" stroke-width=".8"/>
      <!-- Ð¢ÑƒÐ¼Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÐ½Ð¸ Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾ -->
      <rect x="21" y="10" width="4" height="30" rx="2" fill="rgba(180,210,255,.08)"/>
      <rect x="29" y="10" width="4" height="30" rx="2" fill="rgba(180,210,255,.08)"/>
      <!-- Ð‘ÐžÐ›Ð¬Ð¨Ð˜Ð• Ð§ÐÐ¡Ð« Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <circle cx="27" cy="7" r="8" fill="rgba(5,15,30,.9)" stroke="#c0e0ff" stroke-width="1.5" filter="url(#tmGlow)"/>
      <circle cx="27" cy="7" r="6.5" fill="rgba(10,20,40,.8)" stroke="#8090b0" stroke-width=".8"/>
      <!-- Ð¦Ð¸Ñ„ÐµÑ€Ð±Ð»Ð°Ñ‚ -->
      ${[0,1,2,3,4,5,6,7,8,9,10,11].map(i=>{
        const a=i*30*Math.PI/180; const r1=5.5; const r2=6;
        return `<line x1="${27+Math.sin(a)*r1}" y1="${7-Math.cos(a)*r1}" x2="${27+Math.sin(a)*r2}" y2="${7-Math.cos(a)*r2}" stroke="rgba(180,220,255,.5)" stroke-width="${i%3===0?1.2:.6}"/>`;
      }).join('')}
      <!-- Ð¡Ñ‚Ñ€ÐµÐ»ÐºÐ¸ -->
      <line x1="27" y1="7" x2="27" y2="2.5" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="27" y1="7" x2="31" y2="8.5" stroke="#c0e0ff" stroke-width="1.2" stroke-linecap="round"/>
      <!-- Ð¡ÐµÐºÑƒÐ½Ð´Ð½Ð°Ñ (Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ) -->
      <line x1="27" y1="7" x2="23" y2="3.5" stroke="#ff8040" stroke-width=".8" stroke-linecap="round" style="animation:timeClockSpin 4s linear infinite;transform-origin:27px 7px;"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹ÌÐµ Ð²Ð¸Ñ…Ñ€Ð¸ -->
      <ellipse cx="34" cy="16" rx="5" ry="3" fill="none" stroke="#c0e0ff" stroke-width="1.5" opacity=".8"/>
      <ellipse cx="34" cy="16" rx="7" ry="5" fill="none" stroke="rgba(180,220,255,.3)" stroke-width="1" opacity=".5"/>
      <ellipse cx="36" cy="26" rx="4" ry="2.5" fill="none" stroke="#a0c0e0" stroke-width="1.3" opacity=".8"/>
      <ellipse cx="37" cy="35" rx="3" ry="2" fill="none" stroke="#8090b0" stroke-width="1.2" opacity=".7"/>
      <!-- Ð¢Ñ€Ð¸ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð»ÐµÑÐºÐ¸ (3 Ñ€Ñ‹Ð±Ñ‹!) -->
      <line x1="27" y1="7" x2="46" y2="22" stroke="rgba(200,220,255,.5)" stroke-width="1"/>
      <line x1="27" y1="7" x2="48" y2="24" stroke="rgba(180,200,255,.35)" stroke-width=".7" stroke-dasharray="2,2"/>
      <line x1="27" y1="7" x2="50" y2="26" stroke="rgba(160,180,255,.25)" stroke-width=".5" stroke-dasharray="2,3"/>
      <!-- ÐŸÐ¾Ð¿Ð»Ð°Ð²Ð¾Ðº â€” Ð·Ð°Ð¼Ñ‘Ñ€Ð·ÑˆÐ¸Ð¹ Ð¿ÑƒÐ·Ñ‹Ñ€ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ -->
      <circle cx="48" cy="24" r="5.5" fill="url(#tmOrb)" stroke="#c0e0ff" stroke-width="1.5" opacity=".9" filter="url(#tmGlow)"/>
      <circle cx="46" cy="22" r="2" fill="rgba(255,255,255,.5)"/>
      <text x="48" y="26.5" text-anchor="middle" font-size="5" fill="rgba(60,80,120,.8)">â³</text>`,

  };

  // ÐžÐ±Ñ‰Ð¸Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ Ñ ÐºÐ¾Ð»ÑŒÑ†Ð°Ð¼Ð¸ Ð¸ ÐºÐ°Ñ‚ÑƒÑˆÐºÐ¾Ð¹
  function defaultRod(extraDecor) {
    return `
      <line x1="40" y1="10" x2="12" y2="42" stroke="${c}" stroke-width="5.5" stroke-linecap="round"/>
      <line x1="40" y1="10" x2="12" y2="42" stroke="rgba(255,255,255,.18)" stroke-width="2" stroke-linecap="round"/>
      <circle cx="18" cy="36" r="6.5" fill="rgba(0,0,0,.5)" stroke="#aaa" stroke-width="2"/>
      <circle cx="18" cy="36" r="3.5" fill="#888" stroke="#555" stroke-width="1"/>
      <circle cx="18" cy="36" r="1.5" fill="#ccc"/>
      <circle cx="25" cy="29" r="3.5" fill="none" stroke="${c}" stroke-width="1.5" opacity=".8"/>
      <circle cx="31" cy="23" r="2.5" fill="none" stroke="${c}" stroke-width="1.3" opacity=".7"/>
      <circle cx="36" cy="17" r="2" fill="none" stroke="${c}" stroke-width="1.2" opacity=".6"/>
      <line x1="40" y1="10" x2="46" y2="30" stroke="rgba(220,210,180,.45)" stroke-width="1" stroke-dasharray="2,3"/>
      ${extraDecor}`;
  }

  const extraByRod = {}; // Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ â€” Ð²ÑÐµ Ð² specials Ñ‚ÐµÐ¿ÐµÑ€ÑŒ

  if(specials[rod.id]) {
    return `<svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg" style="${glowStyle}width:52px;height:52px">
      <circle cx="26" cy="26" r="24" fill="rgba(0,0,0,.4)" stroke="${c}" stroke-width="2"/>
      ${specials[rod.id]}
    </svg>`;
  }

  return `<svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg" style="${glowStyle}width:52px;height:52px">
    <circle cx="26" cy="26" r="24" fill="rgba(0,0,0,.4)" stroke="${c}" stroke-width="2"/>
    ${defaultRod(extraByRod[rod.id]||'')}
  </svg>`;
}

function renderRods(body) {
  RODS.forEach(rod=>{
    const owned=rod.owned||false;
    const equipped=rod.equipped||false;
    let btnHtml;
    if(equipped) {
      btnHtml=`<button class="shop-item-btn btn-equipped-shop">âœ“ ÐÐ°Ð´ÐµÑ‚Ð°</button>`;
    } else if(owned) {
      btnHtml=`<button class="shop-item-btn btn-equip-shop" onclick="equipRod('${rod.id}')">ÐÐ°Ð´ÐµÑ‚ÑŒ</button>`;
    } else {
      btnHtml=`<button class="shop-item-btn btn-buy-shop" onclick="buyRod('${rod.id}')">ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ</button>`;
    }
    const cls=equipped?'equipped':owned?'owned':'';
    const el=makeShopItem(
      rodIconSVG(rod), rod.name, rod.desc, rod.stats,
      owned?'':rod.price, btnHtml, cls
    );
    body.appendChild(el);
  });
}

function renderBaits(body) {
  BAITS.forEach(b=>{
    const cost=b.price*5;
    const canBuy=gs.coins>=cost;
    const el=makeShopItem(
      `<span style="font-size:36px;animation:toolBounce 1.8s ease-in-out infinite;">${b.icon}</span>`,
      `${b.name} (Ã—${b.qty})`,
      b.desc,
      `ÐšÐ»Ñ‘Ð²: +${Math.round(b.biteBonus*100)}%`,
      `${cost} Ð·Ð° Ã—5`,
      `<button class="shop-item-btn btn-buy-shop" onclick="buyBait('${b.id}')"${canBuy?'':' style="opacity:.5"'}>+5ÑˆÑ‚</button>`,
      ''
    );
    body.appendChild(el);
  });
}

function renderLures(body) {
  LURES.forEach(l=>{
    const cost=l.price*3;
    const canBuy=gs.coins>=cost;
    const el=makeShopItem(
      `<span style="font-size:36px;animation:toolSpin 5s linear infinite;">${l.icon}</span>`,
      `${l.name} (Ã—${l.qty})`,
      l.desc,
      `Ð ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ: +${Math.round(l.rareBonus*100)}%`,
      `${cost} Ð·Ð° Ã—3`,
      `<button class="shop-item-btn btn-buy-shop" onclick="buyLure('${l.id}')"${canBuy?'':' style="opacity:.5"'}>+3ÑˆÑ‚</button>`,
      ''
    );
    body.appendChild(el);
  });
}

function renderUpgrades(body) {
  UPGRADES.forEach(u=>{
    const owned=u.owned||false;
    const canBuy=!owned && gs.coins>=u.price;
    const btnHtml=owned
      ?`<button class="shop-item-btn btn-owned-shop">âœ“ ÐšÑƒÐ¿Ð»ÐµÐ½Ð¾</button>`
      :`<button class="shop-item-btn btn-buy-shop" onclick="buyUpgrade('${u.id}')"${canBuy?'':' style="opacity:.5"'}>ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ</button>`;
    const el=makeShopItem(
      `<span style="font-size:36px;animation:toolPulse 2s ease-in-out infinite;">âš¡</span>`,
      u.name, u.desc, u.effect,
      owned?'':u.price, btnHtml, owned?'owned':''
    );
    body.appendChild(el);
  });
}

// ============================================================
// BUY FUNCTIONS â€” FIXED: proper coin check and deduction
// ============================================================
function buyRod(id) {
  const rod=RODS.find(r=>r.id===id);
  if(!rod||rod.owned) return;
  if(gs.coins < rod.price) { showToast('âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¼Ð¾Ð½ÐµÑ‚! ÐÑƒÐ¶Ð½Ð¾: '+rod.price+'ðŸª™'); return; }
  gs.coins -= rod.price;
  rod.owned=true;
  updateCoins(); renderShop();
  showToast(`ðŸŽ£ ${rod.name} ÐºÑƒÐ¿Ð»ÐµÐ½Ð°!`);
  coinBurst(180,350); saveGame();
}

function equipRod(id) {
  const rod=RODS.find(r=>r.id===id);
  if(!rod||!rod.owned) return;
  RODS.forEach(r=>{r.equipped=false;});
  rod.equipped=true;
  gs.currentRod=rod;
  document.getElementById('current-rod-name').textContent='Ð£Ð´Ð¾Ñ‡ÐºÐ°: '+rod.name;
  renderShop();
  // ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ¸ Ð¼ÐµÑ…Ð°Ð½Ð¸Ðº Ð¿Ñ€Ð¸ ÑÐºÐ¸Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐµ
  const rodTips = {
    thunder:    'âš¡ Ð“Ñ€Ð¾Ð¼Ð¾Ð²Ð°Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°: Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð°Ñ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°!',
    mech:       'âš™ï¸ ÐœÐµÑ…-Ð¿Ñ€Ð¸Ñ†ÐµÐ»: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° + Ð­Ð¿Ð¸ÐºÐ¸/Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹/OG!',
    neon:       'ðŸ’» ÐÐµÐ¾Ð½: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° + Ð°Ð²Ñ‚Ð¾-ÑƒÐ»Ð¾Ð² ÐºÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð·Ð°Ð±Ñ€Ð¾ÑÐ¾Ð²!',
    marble:     'ðŸª¨ ÐœÑ€Ð°Ð¼Ð¾Ñ€: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG+Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹, Ã—2 Ñ†ÐµÐ½Ð°!',
    poseidon:   'ðŸ”± ÐŸÐ¾ÑÐµÐ¹Ð´Ð¾Ð½ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½: Ð°Ð²Ñ‚Ð¾-Ð·Ð°Ð±Ñ€Ð¾Ñ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑÐµÐº!',
    godly:      'ðŸ‘‘ Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð¾Ð³Ð¾Ð²: Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° + Ð²ÑÐµ Ñ€Ñ‹Ð±Ñ‹!',
    quantum:    'âš›ï¸ ÐšÐ²Ð°Ð½Ñ‚ÑƒÐ¼: ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð² = 2 Ñ€Ñ‹Ð±Ñ‹!',
    crystal:    'âœ¨ ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ: ÑˆÐ°Ð½Ñ Ñ€ÐµÐ´ÐºÐ¸Ñ…/ÑÐ¿Ð¸Ðº/Ð»ÐµÐ³ÐµÐ½Ð´ x2!',
    dragon:     'ðŸ‰ Ð”Ñ€Ð°ÐºÐ¾Ð½ÑŒÑ: Ð²ÐµÑ Ñ€Ñ‹Ð±Ñ‹ x3 = Ð¼ÐµÐ³Ð°-Ñ†ÐµÐ½Ð°!',
    meteor:     'â˜„ï¸ ÐœÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚Ð½Ð°Ñ: +100-500ðŸª™ Ð¾Ð³Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ!',
    time:       'â³ Ð’Ñ€ÐµÐ¼Ñ: 10 ÑÐµÐº Ð½Ð° Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÑƒ + 3 Ñ€Ñ‹Ð±Ñ‹ Ð·Ð° Ñ€Ð°Ð·!',
    apocalypse: 'ðŸ’€ ÐÐŸÐžÐšÐÐ›Ð˜ÐŸÐ¡Ð˜Ð¡: Ð²ÑÐµÐ³Ð´Ð° OG, Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾!',
    celestial:  'ðŸŒŒ ÐÐµÐ±ÐµÑÐ½Ð°Ñ: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG + Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹!',
    demonic:    'ðŸ˜ˆ Ð”ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ: +666ðŸª™ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²!',
    cosmic:     'ðŸŒ€ ÐšÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ: 70% ÑˆÐ°Ð½Ñ OG Ñ€Ñ‹Ð±Ñ‹!',
    void:       'ðŸ•³ï¸ Ð‘ÐµÐ·Ð´Ð½Ñ‹: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹!',
    rubberduck: 'ðŸ¦† Ð£Ñ‚ÐºÐ°: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð­Ð¿Ð¸ÐºÐ¸+ Ð¸ +1-100ðŸª™ Ð·Ð° ÑƒÐ»Ð¾Ð²!',
    pharaoh:    'ðŸº Ð¤Ð°Ñ€Ð°Ð¾Ð½: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG+Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹, Ã—2 Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ Ð·Ð° ÑƒÐ»Ð¾Ð²!',
    kraken:     'ðŸ™ ÐšÑ€Ð°ÐºÐµÐ½: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OG + Ð²Ð·Ñ€Ñ‹Ð² +5000ðŸª™!',
    blackhole:  'ðŸ•³ï¸ Ð§Ñ‘Ñ€Ð½Ð°Ñ Ð”Ñ‹Ñ€Ð°: ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑƒÐ»Ð¾Ð²Ð° +5 Ñ€Ñ‹Ð± Ð“Ð ÐÐ’Ð˜Ð¢ÐÐ¦Ð˜Ð¯!',
    rainbow:    'ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°: ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð² = ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ + Ð¼ÐµÐ½ÑÐµÑ‚ Ð²Ð¾Ð´Ñƒ!',
    magnet:     'ðŸ§² ÐœÐ°Ð³Ð½Ð¸Ñ‚: 30% ÑˆÐ°Ð½Ñ Ð²Ñ‹Ñ‚Ð°Ñ‰Ð¸Ñ‚ÑŒ Ð¡ÑƒÐ½Ð´ÑƒÐº!',
    laser:      'ðŸ”´ Ð›Ð°Ð·ÐµÑ€: Ð›ÐµÐ³ÐµÐ½Ð´Ð° â†’ 3 OG Ñ€Ñ‹Ð±Ñ‹ ÑÑ€Ð°Ð·Ñƒ!',
    bakintsa:   'ðŸ† Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð°ÐºÐ¸Ð½Ñ†Ð°: Ð›Ð˜ÐœÐ˜Ð¢! +2500ðŸª™ Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²!',
    hugiwugi:   'ðŸ’™ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸: Ð›Ð˜ÐœÐ˜Ð¢! Ð¢Ð¾Ð»ÑŒÐºÐ¾ OG + Ð¡ÐºÐ¸Ð½ ÐšÐ¸ÑÐ¸Ð¼Ð¸ÑÐ¸!',
  };
  showToast(rodTips[rod.id] || 'ðŸŽ£ ÐÐ°Ð´ÐµÑ‚Ð°: '+rod.name);
  saveGame();
  updateRodVisual();
}

function buyBait(id) {
  const b=BAITS.find(b=>b.id===id);
  if(!b) return;
  const cost=b.price*5;
  if(gs.coins < cost) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${cost}ðŸª™, Ñƒ Ñ‚ÐµÐ±Ñ ${gs.coins}ðŸª™`); return; }
  gs.coins-=cost; b.qty+=5;
  updateCoins(); renderShop();
  showToast(`${b.icon} ${b.name} Ã—5 ÐºÑƒÐ¿Ð»ÐµÐ½Ð¾!`); saveGame();
}

function buyLure(id) {
  const l=LURES.find(l=>l.id===id);
  if(!l) return;
  const cost=l.price*3;
  if(gs.coins < cost) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${cost}ðŸª™, Ñƒ Ñ‚ÐµÐ±Ñ ${gs.coins}ðŸª™`); return; }
  gs.coins-=cost; l.qty+=3;
  updateCoins(); renderShop();
  showToast(`${l.icon} ${l.name} Ã—3 ÐºÑƒÐ¿Ð»ÐµÐ½Ð¾!`); saveGame();
}

function buyUpgrade(id) {
  const u=UPGRADES.find(u=>u.id===id);
  if(!u||u.owned) return;
  if(gs.coins < u.price) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${u.price}ðŸª™, Ñƒ Ñ‚ÐµÐ±Ñ ${gs.coins}ðŸª™`); return; }
  gs.coins-=u.price; u.owned=true;
  if(id==='bigger_bag') gs.maxInv=30;
  updateCoins(); renderShop();
  showToast(`âš¡ ${u.name} ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¾!`); saveGame();
}

// ============================================================
// INVENTORY RENDER
// ============================================================
function renderInventory() {
  const body=document.getElementById('inv-body');
  body.innerHTML='';
  let total=0;
  for(let i=0;i<gs.maxInv;i++){
    const slot=document.createElement('div');
    if(i<gs.inventory.length){
      const f=gs.inventory[i];
      const price=calcPrice(f);
      total+=price;
      slot.className='inv-slot';
      slot.title=`ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ ${f.name}`;
      slot.innerHTML=`
        <svg class="inv-fish-svg" width="48" height="26" viewBox="0 0 48 26" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="20" cy="13" rx="17" ry="9" fill="${f.col}"/>
          <polygon points="37,13 48,7 48,19" fill="${f.col2}"/>
          <circle cx="8" cy="11" r="2.5" fill="#fff" stroke="#333" stroke-width=".5"/>
          <circle cx="7.5" cy="11" r="1.2" fill="#111"/>
        </svg>
        <div class="inv-fish-name">${f.name}</div>
        <div class="inv-fish-weight">${f.weight}ÐºÐ³</div>
        <div class="inv-coins-small">ðŸª™${price}</div>
      `;
      slot.onclick=()=>sellOne(i);
    } else {
      slot.className='inv-slot empty';
      slot.innerHTML='<div style="font-size:22px;opacity:.25;">ðŸª£</div>';
    }
    body.appendChild(slot);
  }
  document.getElementById('sell-all-amount').textContent=total;
  document.getElementById('inv-total').textContent=total;
}

function sellOne(idx) {
  const f=gs.inventory[idx];
  if(!f) return;
  const price=calcPrice(f);
  gs.coins+=price;
  gs.inventory.splice(idx,1);
  updateCoins(); renderInventory();
  coinBurst(180,300);
  showToast(`ðŸ’° ${f.name} Ð¿Ñ€Ð¾Ð´Ð°Ð½Ð° Ð·Ð° ${price}ðŸª™`); saveGame();
}

// ============================================================
// GARDEN SYSTEM
// ============================================================
const SEEDS = [
  {id:'rose',     name:'Ð Ð¾Ð·Ð°',       bag:'ðŸŒ¹', seed:'ðŸŒ±', flower:'ðŸŒ¹', color:'#e05060',
   desc:'ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ°Ñ ÐºÑ€Ð°ÑÐ°Ð²Ð¸Ñ†Ð°',    flowerDesc:'ÐÐ»Ð°Ñ Ñ€Ð¾Ð·Ð° Ñ Ð½ÐµÐ¶Ð½Ñ‹Ð¼ Ð°Ñ€Ð¾Ð¼Ð°Ñ‚Ð¾Ð¼. Ð”Ð¾Ð»Ð³Ð¾ Ñ€Ð°ÑÑ‚Ñ‘Ñ‚, Ð½Ð¾ Ð´Ð¾Ñ€Ð¾Ð³Ð¾ ÑÑ‚Ð¾Ð¸Ñ‚.',
   growTime:60000, price:25, sellPrice:40, owned:0},
  {id:'sunflower',name:'ÐŸÐ¾Ð´ÑÐ¾Ð»Ð½ÑƒÑ…',  bag:'ðŸŒ»', seed:'ðŸŒ¾', flower:'ðŸŒ»', color:'#f0c020',
   desc:'Ð¯Ñ€ÐºÐ¸Ð¹ Ð¸ Ð¶Ð¸Ð·Ð½ÐµÑ€Ð°Ð´Ð¾ÑÑ‚Ð½Ñ‹Ð¹',   flowerDesc:'Ð‘Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¶Ñ‘Ð»Ñ‚Ñ‹Ð¹ Ñ†Ð²ÐµÑ‚Ð¾Ðº, Ñ‚ÑÐ½ÐµÑ‚ÑÑ Ðº ÑÐ¾Ð»Ð½Ñ†Ñƒ. Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ Ñ€Ð°ÑÑ‚Ñ‘Ñ‚!',
   growTime:30000, price:15, sellPrice:22, owned:0},
  {id:'tulip',    name:'Ð¢ÑŽÐ»ÑŒÐ¿Ð°Ð½',    bag:'ðŸŒ·', seed:'ðŸŒ±', flower:'ðŸŒ·', color:'#e06090',
   desc:'Ð’ÐµÑÐµÐ½Ð½Ð¸Ð¹ Ð»ÑŽÐ±Ð¸Ð¼ÐµÑ†',          flowerDesc:'ÐÐµÐ¶Ð½Ñ‹Ð¹ Ñ‚ÑŽÐ»ÑŒÐ¿Ð°Ð½ Ñ€Ð°ÑÑ†Ð²ÐµÑ‚Ð°ÐµÑ‚ Ð·Ð° ÑÑ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ.',
   growTime:45000, price:20, sellPrice:32, owned:0},
  {id:'daisy',    name:'Ð Ð¾Ð¼Ð°ÑˆÐºÐ°',    bag:'ðŸŒ¼', seed:'ðŸ«˜', flower:'ðŸŒ¼', color:'#f0f0a0',
   desc:'ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð¸ ÐºÑ€Ð°ÑÐ¸Ð²Ð°Ñ',        flowerDesc:'Ð‘ÐµÐ»Ð°Ñ Ñ€Ð¾Ð¼Ð°ÑˆÐºÐ° â€” ÑÐ¸Ð¼Ð²Ð¾Ð» Ñ‡Ð¸ÑÑ‚Ð¾Ñ‚Ñ‹. Ð¡Ð°Ð¼Ð°Ñ Ð´ÐµÑˆÑ‘Ð²Ð°Ñ!',
   growTime:20000, price:8,  sellPrice:12, owned:0},
  {id:'orchid',   name:'ÐžÑ€Ñ…Ð¸Ð´ÐµÑ',    bag:'ðŸª·', seed:'ðŸŒ±', flower:'ðŸª·', color:'#c070e0',
   desc:'Ð ÐµÐ´ÐºÐ°Ñ ÑÐºÐ·Ð¾Ñ‚Ð¸ÐºÐ°',           flowerDesc:'ÐšÐ°Ð¿Ñ€Ð¸Ð·Ð½Ð°Ñ ÐºÑ€Ð°ÑÐ°Ð²Ð¸Ñ†Ð°. Ð”Ð¾Ð»Ð³Ð¾ Ñ€Ð°ÑÑ‚Ñ‘Ñ‚ Ð½Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ Ð´Ð¾Ñ€Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð´Ð°Ñ‘Ñ‚ÑÑ!',
   growTime:120000,price:60, sellPrice:120, owned:0},
  {id:'clover',   name:'ÐšÐ»ÐµÐ²ÐµÑ€',     bag:'ðŸ€', seed:'ðŸ«˜', flower:'ðŸ€', color:'#40c060',
   desc:'ÐÐ° ÑƒÐ´Ð°Ñ‡Ñƒ!',                 flowerDesc:'Ð§ÐµÑ‚Ñ‹Ñ€Ñ‘Ñ…Ð»Ð¸ÑÑ‚Ð½Ñ‹Ð¹ ÐºÐ»ÐµÐ²ÐµÑ€ Ð¿Ñ€Ð¸Ð½Ð¾ÑÐ¸Ñ‚ ÑƒÐ´Ð°Ñ‡Ñƒ Ð² Ñ€Ñ‹Ð±Ð°Ð»ÐºÐµ (+10% ÐºÐ»Ñ‘Ð²).',
   growTime:40000, price:30, sellPrice:30, owned:0, bonusEffect:'bite'},
  {id:'hybrid_plant', name:'Ð“Ð¸Ð±Ñ€Ð¸Ð´ Ð Ð°ÑÑ‚ÐµÐ½Ð¸Ñ', bag:'ðŸŒ¿', seed:'ðŸ§¬', flower:'ðŸŒº', color:'#ff40a0',
   desc:'âš—ï¸ ÐœÑƒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð²ÑˆÐµÐµ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ! Ð¦Ð²ÐµÑ‚Ñ‘Ñ‚ Ñ†Ð¸ÐºÐ»Ð°Ð¼Ð¸',
   flowerDesc:'Ð“Ð¸Ð±Ñ€Ð¸Ð´Ð½Ð¾Ðµ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ â€” Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¼ÑƒÑ‚Ð°Ñ†Ð¸Ð¸. Ð”Ð°Ñ‘Ñ‚ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ: Ð¼Ð¾Ð½ÐµÑ‚Ñ‹, Ñ€Ñ‹Ð±Ð°Ñ†ÐºÐ¸Ð¹ Ð±ÑƒÑÑ‚ÐµÑ€ Ð¸Ð»Ð¸ OG Ð¿Ñ€Ð¸Ð¼Ð°Ð½ÐºÑƒ!',
   growTime:90000, price:150, sellPrice:300, owned:0, bonusEffect:'og_lure', special:'hybrid'},
];

const GARDEN_PLOTS = 6; // 3 left + 3 right
let gardenPlots = []; // {seedId, plantedAt, state:'empty'|'seeded'|'growing'|'ready'}
let gardenFlowersSold = 0;

function initGardenPlots() {
  if(gardenPlots.length === 0) {
    for(let i=0;i<GARDEN_PLOTS;i++) gardenPlots.push({seedId:null,plantedAt:0,state:'empty'});
  }
}
initGardenPlots();

function gardenGrowInterval() {
  gardenPlots.forEach((p,i)=>{
    if(p.state==='seeded'||p.state==='growing') {
      const seed = SEEDS.find(s=>s.id===p.seedId);
      if(!seed) return;
      const elapsed = Date.now()-p.plantedAt;
      if(elapsed >= seed.growTime) { p.state='ready'; }
      else if(elapsed >= seed.growTime*0.3) { p.state='growing'; }
    }
  });
  if(gs.currentScreen==='garden') renderGardenPlots();
}
setInterval(gardenGrowInterval, 2000);

function renderGarden() {
  renderGardenPlots();
}

function renderGardenPlots() {
  const leftEl  = document.getElementById('garden-plots-left');
  const rightEl = document.getElementById('garden-plots-right');
  if(!leftEl || !rightEl) return;
  leftEl.innerHTML=''; rightEl.innerHTML='';
  gardenPlots.forEach((p,i)=>{
    const el=document.createElement('div');
    const seed=p.seedId?SEEDS.find(s=>s.id===p.seedId):null;
    let icon='ðŸŒ¿', label='', prog=0;
    if(p.state==='empty')   { icon='ðŸŸ«'; label='ÐŸÑƒÑÑ‚Ð¾'; }
    if(p.state==='seeded')  { icon=seed?seed.seed:'ðŸŒ±'; label='ÐŸÐ¾ÑÐµÑÐ½Ð¾'; prog=15; }
    if(p.state==='growing') { icon=seed?seed.seed:'ðŸŒ¿'; label='Ð Ð°ÑÑ‚Ñ‘Ñ‚'; prog=seed?Math.min(90,((Date.now()-p.plantedAt)/seed.growTime)*100):50; }
    if(p.state==='ready')   { icon=seed?seed.flower:'ðŸŒ¸'; label='Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!'; prog=100; }
    el.className=`gdn-plot ${p.state}`;
    el.innerHTML=`<div class="gdn-plot-icon">${icon}</div><div class="gdn-plot-label">${label}</div>${p.state!=='empty'?`<div class="gdn-progress"><div class="gdn-progress-fill" style="width:${prog}%"></div></div>`:''}`;
    el.onclick=()=>clickPlot(i);
    (i<3?leftEl:rightEl).appendChild(el);
  });
}

function clickPlot(idx) {
  const p=gardenPlots[idx];
  if(p.state==='ready') { harvestPlot(idx); return; }
  if(p.state!=='empty') { showToast('â³ Ð•Ñ‰Ñ‘ Ñ€Ð°ÑÑ‚Ñ‘Ñ‚...'); return; }
  // Show seed picker
  showSeedPicker(idx);
}

function showSeedPicker(plotIdx) {
  const ownedSeeds=SEEDS.filter(s=>s.owned>0);
  if(!ownedSeeds.length) { showToast('ðŸŒ± ÐšÑƒÐ¿Ð¸ ÑÐµÐ¼ÐµÐ½Ð° Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ!'); return; }
  // Simple picker via toast sequence
  ownedSeeds.forEach((s,i)=>{
    setTimeout(()=>{
      const el=document.createElement('div');
      el.style.cssText=`position:absolute;left:50%;transform:translateX(-50%);top:${130+i*46}px;z-index:300;background:rgba(20,60,10,.97);border:2px solid #4a7a18;border-radius:14px;padding:8px 18px;font-family:'Neucha',cursive;font-size:13px;color:#a0f060;cursor:pointer;white-space:nowrap;`;
      el.innerHTML=`${s.flower} ${s.name} (Ã—${s.owned}) â€” Ð¡Ð°Ð¶Ð°Ñ‚ÑŒ?`;
      el.onclick=()=>{ plantSeed(plotIdx,s.id); document.querySelectorAll('.seed-picker-item').forEach(x=>x.remove()); };
      el.className='seed-picker-item';
      document.getElementById('garden-screen').appendChild(el);
      setTimeout(()=>el.remove(), 5000);
    },0);
  });
}

function plantSeed(plotIdx, seedId) {
  const seed=SEEDS.find(s=>s.id===seedId);
  if(!seed||seed.owned<=0) return;
  seed.owned--;
  gardenPlots[plotIdx]={seedId,plantedAt:Date.now(),state:'seeded'};
  renderGardenPlots();
  showToast(`ðŸŒ± ${seed.name} Ð¿Ð¾ÑÐ°Ð¶ÐµÐ½Ð°!`);
  saveGame(); saveGarden();
  if(gs.fullMultiMode) syncGardenToFirebase();
}

function harvestAll() {
  let total=0;
  gardenPlots.forEach((p,i)=>{
    if(p.state==='ready') {
      const seed=SEEDS.find(s=>s.id===p.seedId);
      if(seed){ total+=seed.sellPrice; gardenFlowersSold++; gardenPlots[i]={seedId:null,plantedAt:0,state:'empty'}; }
    }
  });
  if(!total){ showToast('ðŸŒ± ÐÐµÑ‡ÐµÐ³Ð¾ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ!'); return; }
  gs.coins+=total; updateCoins(); renderGardenPlots();
  coinBurst(180,350);
  showToast(`ðŸŒ¸ Ð¡Ð¾Ð±Ñ€Ð°Ð½Ð¾ Ð½Ð° ${total}ðŸª™!`);
  saveGame(); saveGarden();
  if(gs.fullMultiMode) syncGardenToFirebase();
}

// ============================================================
// GARDEN ROAD / SHOP ANIMATIONS
// ============================================================
let gardenScene = 'garden'; // 'garden' | 'road' | 'seedshop'

function fadeScene(cb) {
  const fade=document.getElementById('scene-fade');
  fade.classList.add('fading');
  setTimeout(()=>{ cb(); fade.classList.remove('fading'); }, 650);
}

function showGardenScene(name) {
  gardenScene=name;
  document.getElementById('gscene-garden').style.display='none';
  document.getElementById('gscene-road').style.display='none';
  document.getElementById('gscene-seedshop').style.display='none';
  const kioskEl = document.getElementById('gscene-kiosk');
  if(kioskEl) kioskEl.style.display='none';
  if(name==='garden')    document.getElementById('gscene-garden').style.display='block';
  if(name==='road')      document.getElementById('gscene-road').style.display='block';
  if(name==='seedshop')  document.getElementById('gscene-seedshop').style.display='flex';
  if(name==='kiosk' && kioskEl) kioskEl.style.display='flex';
}

function walkToShop() {
  fadeScene(()=>{
    showGardenScene('road');
    document.getElementById('road-hint').textContent='Ð˜Ð´Ñ‘Ð¼ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½...';
    const walker=document.getElementById('walker');
    walker.className='walker to-shop';
    walker.style.bottom='200px';
    updatePlayerLocation('garden-road');
    setTimeout(()=>{
      document.getElementById('road-hint').textContent='ÐŸÑ€Ð¸ÑˆÐ»Ð¸! Ð—Ð°Ñ…Ð¾Ð´Ð¸Ð¼?';
      // Open door animation
      const door=document.getElementById('shop-door');
      door.classList.add('open');
      setTimeout(()=>{
        door.classList.remove('open');
        fadeScene(()=>{ showGardenScene('seedshop'); renderSeedShop(); updatePlayerLocation('garden-shop'); });
      }, 800);
    }, 2500);
  });
}

function enterShop() {
  const door=document.getElementById('shop-door');
  door.classList.add('open');
  setTimeout(()=>{
    door.classList.remove('open');
    fadeScene(()=>{ showGardenScene('seedshop'); renderSeedShop(); updatePlayerLocation('garden-shop'); });
  }, 700);
}

function leaveShop() {
  fadeScene(()=>{
    showGardenScene('road');
    document.getElementById('road-hint').textContent='Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ...';
    const walker=document.getElementById('walker');
    walker.style.bottom='580px'; walker.className='walker from-shop';
    updatePlayerLocation('garden-road');
    setTimeout(()=>{
      fadeScene(()=>{ showGardenScene('garden'); renderGardenPlots(); updatePlayerLocation('garden'); });
    }, 2100);
  });
}

function renderSeedShop() {
  const container=document.getElementById('seedshop-items');
  container.innerHTML='';
  SEEDS.forEach(seed=>{
    const canBuy=gs.coins>=seed.price;
    const el=document.createElement('div');
    el.className='seed-pack';
    el.innerHTML=`
      <div class="seed-pack-left">
        <div class="seed-pack-bag" style="background:rgba(60,30,10,.8);border-color:${seed.color}44;">${seed.bag}</div>
      </div>
      <div class="seed-pack-info">
        <div class="seed-pack-name">${seed.name}</div>
        <div class="seed-pack-desc">${seed.desc}</div>
        <div class="seed-pack-flower">
          <div class="seed-pack-flower-icon">${seed.flower}</div>
          <div class="seed-pack-flower-desc">${seed.flowerDesc}</div>
        </div>
        <div class="seed-pack-price">ðŸª™ ${seed.price} <span style="color:#6a5030;font-size:10px;">â†’ Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ Ð·Ð° ${seed.sellPrice}ðŸª™</span></div>
        <div style="display:flex;align-items:center;gap:8px;margin-top:6px;">
          <div class="seed-buy-btn" onclick="buySeed('${seed.id}')${canBuy?'':";showToast('âŒ ÐÐµÑ‚ Ð¼Ð¾Ð½ÐµÑ‚!')"}" style="${canBuy?'':'opacity:.4;'}">ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ã—1</div>
          <div style="font-family:'Neucha',cursive;font-size:11px;color:#6a5030;">Ð’ Ð·Ð°Ð¿Ð°ÑÐµ: ${seed.owned}</div>
        </div>
      </div>`;
    container.appendChild(el);
  });
}

function buySeed(id) {
  const seed=SEEDS.find(s=>s.id===id);
  if(!seed) return;
  if(gs.coins<seed.price){ showToast('âŒ ÐÐµÑ‚ Ð¼Ð¾Ð½ÐµÑ‚!'); return; }
  gs.coins-=seed.price; seed.owned++;
  updateCoins(); renderSeedShop();
  showToast(`${seed.bag} ÐšÑƒÐ¿Ð»ÐµÐ½Ð¾: ${seed.name}!`);
  saveGame(); saveGarden();
}

// ============================================================
// FIREBASE MULTIPLAYER â€” IMPROVED
// ============================================================
let firebaseApp=null, firebaseDB=null;
let currentRoomId=null;
let myPlayerId='player_'+Math.random().toString(36).substr(2,8);
let myPlayerName='Ð Ñ‹Ð±Ð°Ðº '+Math.floor(Math.random()*999);
let playersData={};
let heartbeatInterval=null;
let connectionStatus='offline';

gs.fullMultiMode=false;

const FIREBASE_CONFIG={
  apiKey:"AIzaSyAQKXcmFEKBKsZvLbqDCGudVTLBQVV9R7o",
  authDomain:"fishingonlinereborn.firebaseapp.com",
  databaseURL:"https://fishingonlinereborn-default-rtdb.firebaseio.com",
  projectId:"fishingonlinereborn",
  storageBucket:"fishingonlinereborn.firebasestorage.app",
  messagingSenderId:"104300782903",
  appId:"1:104300782903:web:8db9d1c0a930959994a6b2"
};

const fb={
  r:(path)=>window._fbRef(firebaseDB,path),
  set:(path,val)=>window._fbSet(fb.r(path),val),
  upd:(path,val)=>window._fbUpdate(fb.r(path),val),
  on:(path,cb)=>window._fbOnValue(fb.r(path),cb),
  get:(path)=>window._fbGet(fb.r(path)),
  rm:(path)=>window._fbRemove(fb.r(path)),
};

async function initFirebase() {
  if(firebaseApp) return true;
  setConnectionStatus('connecting');
  try {
    // Use compat SDK loaded via <script> tags â€” avoids dynamic import() CSP issues
    if(typeof firebase === 'undefined') throw new Error('Firebase compat SDK not loaded');
    // Reuse existing app if already initialized (e.g. hot reload)
    firebaseApp = firebase.apps.length ? firebase.app() : firebase.initializeApp(FIREBASE_CONFIG);
    firebaseDB  = firebase.database();
    // Map compat API to the same internal helpers the rest of the code uses
    window._fbRef        = (db, path) => db.ref(path);
    window._fbSet        = (ref, val) => ref.set(val);
    window._fbOnValue    = (ref, cb)  => { ref.on('value', cb); return cb; };
    window._fbGet        = (ref)      => ref.get();
    window._fbUpdate     = (ref, val) => ref.update(val);
    window._fbRemove     = (ref)      => ref.remove();
    window._fbOnDisconnect = (ref)    => ref.onDisconnect();
    setConnectionStatus('online');
    return true;
  } catch(e){
    console.warn('Firebase init failed', e);
    setConnectionStatus('offline');
    showToast('âš ï¸ ÐÐµÑ‚ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ');
    return false;
  }
}

function setConnectionStatus(status) {
  connectionStatus=status;
  const label=document.getElementById('session-label');
  if(!label) return;
  if(currentRoomId && status==='online') label.textContent=`ðŸŸ¢ ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð°: ${currentRoomId}`;
  else if(status==='connecting') label.textContent='ðŸŸ¡ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ...';
  else label.textContent='ðŸ”´ ÐÐµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ñ‘Ð½';
}

function generateRoomCode() {
  const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let s=''; for(let i=0;i<4;i++) s+=c[Math.floor(Math.random()*c.length)]; return s;
}

async function createRoom() {
  const ok=await initFirebase(); if(!ok) return;
  const code=generateRoomCode();
  document.getElementById('room-code-input').value=code;
  try {
    await fb.set(`rooms/${code}`,{
      created:Date.now(), host:myPlayerId, fullMulti:false,
      sharedCoins:gs.coins, sharedFishCount:gs.fishCount, sharedFlowers:gardenFlowersSold,
      sharedInventory:JSON.stringify(gs.inventory), sharedGarden:JSON.stringify(gardenPlots),
    });
    await _joinRoomSetup(code);
    showToast(`âœ… ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð°: ${code}`);
  } catch(e){ console.error(e); showToast('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ'); }
}

async function joinRoom() {
  const code=document.getElementById('room-code-input').value.trim().toUpperCase();
  if(code.length<2){ showToast('Ð’Ð²ÐµÐ´Ð¸ ÐºÐ¾Ð´ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹!'); return; }
  const ok=await initFirebase(); if(!ok) return;
  try {
    const snap=await fb.get(`rooms/${code}`);
    if(!snap.exists()){ showToast(`âŒ ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð° ${code} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°`); return; }
    await _joinRoomSetup(code);
    showToast(`âœ… Ð’Ð¾ÑˆÑ‘Ð» Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ ${code}`);
  } catch(e){ console.error(e); showToast('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ'); }
}

async function _joinRoomSetup(code) {
  currentRoomId=code;
  const presRef=fb.r(`rooms/${code}/players/${myPlayerId}`);
  await window._fbSet(presRef,{
    name:myPlayerName, location:gs.currentScreen, joinedAt:Date.now(),
    lastSeen:Date.now(), fishCaught:gs.fishCount, flowersSold:gardenFlowersSold, online:true
  });
  // Auto-remove when disconnected
  window._fbOnDisconnect(presRef).remove();
  // Heartbeat every 5s
  if(heartbeatInterval) clearInterval(heartbeatInterval);
  heartbeatInterval=setInterval(()=>{
    if(!currentRoomId) return;
    fb.upd(`rooms/${code}/players/${myPlayerId}`,{
      lastSeen:Date.now(), online:true,
      location:gs.currentScreen, fishCaught:gs.fishCount, flowersSold:gardenFlowersSold
    }).catch(()=>{});
  },5000);
  // Listen to room in real-time
  fb.on(`rooms/${code}`,(snap)=>{
    const data=snap.val(); if(!data) return;
    const now=Date.now();
    playersData={};
    if(data.players) Object.entries(data.players).forEach(([pid,p])=>{
      if(now-(p.lastSeen||0)<30000||pid===myPlayerId) playersData[pid]=p;
    });
    const remoteFullMulti=data.fullMulti||false;
    if(remoteFullMulti!==gs.fullMultiMode && data.lastToggler!==myPlayerId) {
      gs.fullMultiMode=remoteFullMulti;
      const tog=document.getElementById('full-multi-toggle');
      if(tog) tog.checked=gs.fullMultiMode;
      updateMultiRodVisibility();
    }
    if(gs.fullMultiMode && data.lastSyncer!==myPlayerId) {
      // Only accept remote coins if they're different and more recent
      if(data.sharedCoins!==undefined && data.sharedCoins!==gs.coins && data.lastSyncTime > (gs._lastLocalSync||0)){
        gs.coins=data.sharedCoins;updateCoins();
      }
      if(data.sharedFishCount!==undefined && data.sharedFishCount!==gs.fishCount){gs.fishCount=data.sharedFishCount;document.getElementById('fish-count').textContent=gs.fishCount;}
      if(data.sharedInventory){try{gs.inventory=JSON.parse(data.sharedInventory);}catch(e){}}
      if(data.sharedGarden){try{const pg=JSON.parse(data.sharedGarden);gardenPlots=pg;if(gs.currentScreen==='garden')renderGardenPlots();}catch(e){}}
    }
    if(gs.currentScreen==='multi') renderMultiScreen();
    updateNavPlayerDots();
  });
  setConnectionStatus('online');
  updateMultiRodVisibility();
  if(gs.currentScreen==='multi') renderMultiScreen();
}

async function leaveRoom() {
  if(!currentRoomId) return;
  try{ await fb.rm(`rooms/${currentRoomId}/players/${myPlayerId}`); }catch(e){}
  if(heartbeatInterval){clearInterval(heartbeatInterval);heartbeatInterval=null;}
  currentRoomId=null; playersData={}; gs.fullMultiMode=false;
  setConnectionStatus('offline'); updateMultiRodVisibility();
  showToast('ðŸ‘‹ Ð’Ñ‹ÑˆÐµÐ» Ð¸Ð· ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹');
  if(gs.currentScreen==='multi') renderMultiScreen();
}

function updateMultiRodVisibility() {
  const show=gs.fullMultiMode&&!!currentRoomId;
  document.getElementById('rod-wrapper2').style.display=show?'block':'none';
  document.getElementById('linecanvas2').style.display=show?'block':'none';
}

async function toggleFullMulti(enabled) {
  gs.fullMultiMode=enabled;
  document.getElementById('full-multi-note').style.display=enabled?'none':'block';
  document.getElementById('shared-stats-section').style.display=enabled?'block':'none';
  if(!currentRoomId){showToast('Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð²Ð¾Ð¹Ð´Ð¸ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ!');document.getElementById('full-multi-toggle').checked=false;gs.fullMultiMode=false;return;}
  if(!enabled){
    clearTimeout(partner2Timer);
    partnerPhase = 'idle';
    const lctx2el = document.getElementById('linecanvas2');
    if(lctx2el) lctx2el.getContext('2d').clearRect(0,0,360,700);
    await fairSplitAndDisable();
    return;
  }
  try{
    await fb.upd(`rooms/${currentRoomId}`,{
      fullMulti:true,lastToggler:myPlayerId,
      sharedCoins:gs.coins,sharedFishCount:gs.fishCount,sharedFlowers:gardenFlowersSold,
      sharedInventory:JSON.stringify(gs.inventory),sharedGarden:JSON.stringify(gardenPlots),
    });
    updateMultiRodVisibility();
    showToast('ðŸ‘¥ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐµÑ€ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½!');
    setTimeout(()=>{ simulatePartner2(); }, 2000);
  }catch(e){showToast('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸');}
}

async function fairSplitAndDisable() {
  const n=Math.max(1,Object.keys(playersData).length);
  const myShare=Math.floor(gs.coins/n);
  gs.coins=myShare; gs.inventory=gs.inventory.slice(0,Math.ceil(gs.inventory.length/n));
  updateCoins();
  if(currentRoomId) await fb.upd(`rooms/${currentRoomId}`,{fullMulti:false,lastToggler:myPlayerId}).catch(()=>{});
  updateMultiRodVisibility();
  showToast(`ðŸ’° Ð§ÐµÑÑ‚Ð½Ñ‹Ð¹ Ñ€Ð°Ð·Ð´ÐµÐ»: ${myShare}ðŸª™ Ñ‚ÐµÐ±Ðµ!`);
  saveGame(); saveGarden();  
}

function syncGardenToFirebase() {
  if(!firebaseDB||!currentRoomId||!gs.fullMultiMode) return;
  fb.upd(`rooms/${currentRoomId}`,{sharedGarden:JSON.stringify(gardenPlots),sharedFlowers:gardenFlowersSold,lastSyncer:myPlayerId}).catch(()=>{});
}

function syncFishingToFirebase() {
  if(!firebaseDB||!currentRoomId||!gs.fullMultiMode) return;
  gs._lastLocalSync = Date.now();
  fb.upd(`rooms/${currentRoomId}`,{
    sharedCoins:gs.coins,
    sharedFishCount:gs.fishCount,
    sharedInventory:JSON.stringify(gs.inventory),
    lastSyncer:myPlayerId,
    lastSyncTime: gs._lastLocalSync
  }).catch(()=>{});
  _lastSyncedCoins = gs.coins;
  _lastSyncedFish = gs.fishCount;
}

function updatePlayerLocation(loc) {
  if(!firebaseDB||!currentRoomId) return;
  fb.upd(`rooms/${currentRoomId}/players/${myPlayerId}`,{location:loc}).catch(()=>{});
}

function updateNavPlayerDots() {
  document.querySelectorAll('.nav-player-dot').forEach(d=>d.style.display='none');
  const map={fishing:'nav-fish-dot',shop:'nav-shop-dot',inventory:'nav-inv-dot',garden:'nav-garden-dot','garden-road':'nav-garden-dot','garden-shop':'nav-garden-dot',multi:'nav-multi-dot'};
  Object.entries(playersData).forEach(([pid,p])=>{
    if(pid===myPlayerId) return;
    const el=document.getElementById(map[p.location]||'');
    if(el) el.style.display='block';
  });
}

function renderMultiScreen() {
  const list=document.getElementById('players-list'); if(!list) return;
  list.innerHTML='';
  const locE={fishing:'ðŸŽ£',shop:'ðŸª',inventory:'ðŸŽ’',garden:'ðŸŒ¸','garden-road':'ðŸš¶','garden-shop':'ðŸŒ±',multi:'ðŸŒ'};
  const locN={fishing:'Ð Ñ‹Ð±Ð°Ð»ÐºÐ°',shop:'Ð›Ð°Ð²ÐºÐ°',inventory:'Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ',garden:'Ð¡Ð°Ð´','garden-road':'ÐÐ° Ð´Ð¾Ñ€Ð¾Ð¶ÐºÐµ','garden-shop':'ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ ÑÐµÐ¼ÑÐ½',multi:'ÐžÐ½Ð»Ð°Ð¹Ð½'};
  const players=Object.entries(playersData);
  if(!players.length){
    list.innerHTML='<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#3040a0;padding:8px 0;">Ð’Ð¾Ð¹Ð´Ð¸ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²</div>';
  } else {
    players.forEach(([pid,p])=>{
      const isMe=pid===myPlayerId;
      const online=Date.now()-(p.lastSeen||0)<15000;
      const loc=p.location||'fishing';
      const card=document.createElement('div'); card.className='multi-player-card';
      card.innerHTML=`
        <div class="player-avatar" style="${online?'box-shadow:0 0 10px rgba(80,200,100,.6);':''}">${isMe?'ðŸ˜Š':'ðŸŽ®'}</div>
        <div class="player-info">
          <div class="player-name">${p.name||'Ð Ñ‹Ð±Ð°Ðº'}${isMe?' <span style="font-size:10px;color:#4060a0;">(Ð’Ñ‹)</span>':''}</div>
          <div class="player-status">ðŸŸ${p.fishCaught||0} ðŸŒ¸${p.flowersSold||0} ${online?'<span style="color:#40c060;font-size:10px;">â— Ð¾Ð½Ð»Ð°Ð¹Ð½</span>':'<span style="color:#505060;font-size:10px;">â—‹ Ð½ÐµÑ‚</span>'}</div>
        </div>
        <div class="player-location-badge">${locE[loc]||'â“'} ${locN[loc]||loc}</div>`;
      list.appendChild(card);
    });
  }
  if(gs.fullMultiMode){
    const sc=document.getElementById('shared-coins');const sf=document.getElementById('shared-fish');const sfl=document.getElementById('shared-flowers');
    if(sc)sc.textContent=gs.coins; if(sf)sf.textContent=gs.fishCount; if(sfl)sfl.textContent=gardenFlowersSold;
    document.getElementById('shared-stats-section').style.display='block';
  }
}

// ============================================================
// POKEMON MAP MODE
// ============================================================
const POKEMON_DATA = [
  {name:'ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ',    emoji:'âš¡', pts:40,  coins:0, pikaCoins:20, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',    col:'#f0d040', col2:'#c0a010'},
  {name:'Ð‘ÑƒÐ»ÑŒÐ±Ð°Ð·Ð°Ð²Ñ€',emoji:'ðŸŒ¿', pts:50,  coins:0, pikaCoins:25, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',    col:'#40a040', col2:'#206020'},
  {name:'Ð§Ð°Ñ€Ð¼Ð°Ð½Ð´ÐµÑ€', emoji:'ðŸ”¥', pts:50,  coins:0, pikaCoins:25, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',    col:'#f06020', col2:'#a03010'},
  {name:'Ð¡ÐºÐ²Ð¸Ñ€Ñ‚Ð»',   emoji:'ðŸ’§', pts:50,  coins:0, pikaCoins:25, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',    col:'#4090f0', col2:'#2060c0'},
  {name:'ÐœÐ°Ð´Ð¶Ð¸ÐºÐ°Ñ€Ð¿', emoji:'ðŸŸ', pts:10,  coins:0, pikaCoins:5,  rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',    col:'#f04040', col2:'#a01010'},
  {name:'ÐŸÑÐ¸Ð´Ð°Ðº',    emoji:'ðŸ¦†', pts:60,  coins:0, pikaCoins:30, rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',     col:'#f0e040', col2:'#c0a010'},
  {name:'Ð“Ð°ÑÑ‚Ð»Ð¸',    emoji:'ðŸ‘»', pts:70,  coins:0, pikaCoins:35, rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',     col:'#8040c0', col2:'#4010a0'},
  {name:'Ð›Ð°Ð¿Ñ€Ð°Ñ',    emoji:'ðŸŒŠ', pts:100, coins:0, pikaCoins:50, rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',  col:'#4080c0', col2:'#2050a0'},
  {name:'Ð“ÐµÐ½Ð³Ð°Ñ€',    emoji:'ðŸ˜ˆ', pts:120, coins:0, pikaCoins:60, rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',  col:'#6030a0', col2:'#301060'},
  {name:'ÐœÑŒÑŽÑ‚Ñƒ',     emoji:'ðŸ”®', pts:200, coins:0, pikaCoins:100,rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹',col:'#c040c0', col2:'#801080'},
  {name:'ÐœÑŒÑŽ',         emoji:'ðŸ’—', pts:250, coins:0, pikaCoins:150,rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹',  col:'#f080c0', col2:'#c04090'},
  // === ÐÐžÐ’Ð«Ð• ÐŸÐžÐšÐ•ÐœÐžÐÐ« ===
  {name:'Ð˜Ð²Ð¸',          emoji:'ðŸ¦Š', pts:35,  coins:0, pikaCoins:18, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',      col:'#d09050', col2:'#906030'},
  {name:'ÐœÑÑƒÑ‚',         emoji:'ðŸ˜¸', pts:30,  coins:0, pikaCoins:15, rar:'common',  label:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',      col:'#f0f0e0', col2:'#c0c0b0'},
  {name:'ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ Ð¡Ñ‘Ñ€Ñ„',  emoji:'ðŸ„', pts:80,  coins:0, pikaCoins:45, rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',       col:'#f0d040', col2:'#c0a010'},
  {name:'Ð›Ð¾Ð¿Ñ‚Ð°Ð½',       emoji:'ðŸŒ€', pts:90,  coins:0, pikaCoins:50, rar:'rare',    label:'Ð ÐµÐ´ÐºÐ¸Ð¹',       col:'#6080f0', col2:'#4050c0'},
  {name:'ÐœÐ°Ð±Ð¾Ð¹',        emoji:'ðŸŒŠ', pts:110, coins:0, pikaCoins:65, rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',    col:'#40c0f0', col2:'#2080c0'},
  {name:'Ð”Ñ€Ð°Ð³Ð¾Ð½Ð¸Ñ‚',     emoji:'ðŸ²', pts:150, coins:0, pikaCoins:90, rar:'epic',    label:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',    col:'#40a040', col2:'#206020'},
  {name:'Ð›ÑƒÐ³Ð°',         emoji:'ðŸŒ™', pts:300, coins:0, pikaCoins:180,rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹',  col:'#8060c0', col2:'#503090'},
  {name:'Ð¥Ð¾Ñƒ-ÐžÑ…',       emoji:'ðŸ¦…', pts:350, coins:0, pikaCoins:200,rar:'legend',  label:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹',  col:'#f08020', col2:'#c05010'},
];

const PIKABUFS = [
  {id:'combo_x2',    name:'ÐŸÐ¸ÐºÐ°-ÐšÐ¾Ð¼Ð±Ð¾ Ã—2',      desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ 5 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð² Ð´Ð°ÑŽÑ‚ x2 Ð¿Ð¸ÐºÐ°ÐºÐ¾Ð¸Ð½Ñ‹',       price:30,  icon:'âš¡Ã—2', effect:'combo2'},
  {id:'combo_x3',    name:'ÐŸÐ¸ÐºÐ°-ÐšÐ¾Ð¼Ð±Ð¾ Ã—3',      desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ 3 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð° Ð´Ð°ÑŽÑ‚ x3 Ð¿Ð¸ÐºÐ°ÐºÐ¾Ð¸Ð½Ñ‹',        price:60,  icon:'âš¡Ã—3', effect:'combo3'},
  {id:'combo_x5',    name:'ÐŸÐ˜ÐšÐ-ÐšÐžÐœÐ‘Ðž Ã—5!',     desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½ Ð´Ð°Ñ‘Ñ‚ x5 Ð¿Ð¸ÐºÐ°ÐºÐ¾Ð¸Ð½Ñ‹!',          price:120, icon:'âš¡Ã—5', effect:'combo5'},
  {id:'rare_boost',  name:'Ð Ð°Ñ€Ð‘ÑƒÑÑ‚',             desc:'Ð ÐµÐ´ÐºÐ¸Ðµ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ñ‹ Ð¿Ð¾ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ð²Ð´Ð²Ð¾Ðµ Ñ‡Ð°Ñ‰Ðµ',         price:80,  icon:'ðŸŒŸ',   effect:'rare'},
  {id:'legend_call', name:'Ð—Ð¾Ð² Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹',         desc:'Ð¨Ð°Ð½Ñ Ð¿Ð¾Ð¹Ð¼Ð°Ñ‚ÑŒ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ð¾Ð³Ð¾ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð°',            price:150, icon:'ðŸ”®',   effect:'legend'},
  {id:'pika_storm',  name:'ÐŸÐ¸ÐºÐ°-Ð‘ÑƒÑ€Ñ',           desc:'10 ÑÐµÐºÑƒÐ½Ð´ â€” ÐºÐ»Ñ‘Ð² x5! Ð›Ð¾Ð²Ð¸ ÐºÐ°Ðº ÑÑƒÐ¼Ð°ÑÑˆÐµÐ´ÑˆÐ¸Ð¹!',   price:90,  icon:'â›ˆï¸âš¡', effect:'pika_storm'},
  {id:'shiny_hunt',  name:'ÐŸÐ¾Ð¸ÑÐº Ð‘Ð»ÐµÑÑ‚ÑÑ‰Ð¸Ñ…',     desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ 4 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð° Ð´Ð°ÑŽÑ‚ x2 Ð¾Ñ‡ÐºÐ¾Ð²',           price:70,  icon:'âœ¨',   effect:'shiny'},
  {id:'mega_evolve', name:'ÐœÐµÐ³Ð°-Ð­Ð²Ð¾Ð»ÑŽÑ†Ð¸Ñ',       desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑƒÐ»Ð¾Ð² Ð´Ð°Ñ‘Ñ‚ x4 PikaCoins + Ð¼Ð¾Ð½ÐµÑ‚Ñ‹!',   price:200, icon:'ðŸ’«',   effect:'mega'},
  {id:'poke_radar',  name:'ÐŸÐ¾ÐºÐµÐ Ð°Ð´Ð°Ñ€',           desc:'Ð’Ð¸Ð´Ð¸ÑˆÑŒ Ñ€ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð° Ð´Ð¾ ÐºÐ»Ñ‘Ð²Ð°',  price:50,  icon:'ðŸ“¡',   effect:'radar'},
  {id:'lucky_egg',   name:'Ð¡Ñ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ð¾Ðµ ÑÐ¹Ñ†Ð¾',     desc:'x2 XP Ð¾Ñ‚ Ð²ÑÐµÐ³Ð¾ Ð½Ð° 60 ÑÐµÐºÑƒÐ½Ð´',                  price:100, icon:'ðŸ¥š',   effect:'lucky_egg'},
];

gs.mapMode = 'normal'; // 'normal' | 'pokemon'
gs.pikaCoins = 0;
gs.pikaCatchCount = 0;
gs.activePikaBuf = null;
gs.pikaBufCount = 0;

function setMap(mode) {
  gs.mapMode = mode;
  ['normal','pokemon','coast','hardcore','hobo','bum','easter'].forEach(m=>{
    const btn = document.getElementById('map-btn-'+m);
    if(btn) btn.classList.toggle('active', mode===m);
  });
  const pokeBadge = document.getElementById('poke-mode-badge');
  const pikaBox   = document.getElementById('pika-coins-box');
  const coastBadge = document.getElementById('coast-mode-badge');
  const hcBadge   = document.getElementById('hardcore-mode-badge');
  const bumBadge  = document.getElementById('bum-mode-badge');
  const hcBar     = document.getElementById('hc-boss-bar');
  const easterBadge = document.getElementById('easter-mode-badge');

  // Reset all badges
  if(pokeBadge) pokeBadge.style.display='none';
  if(pikaBox)   pikaBox.style.display='none';
  if(coastBadge) coastBadge.style.display='none';
  if(hcBadge)  hcBadge.style.display='none';
  if(bumBadge) bumBadge.style.display='none';
  if(hcBar)    hcBar.style.display='none';
  if(easterBadge) easterBadge.style.display='none';
  // Stop piranha and boss loops if switching
  stopHcBossLoop();
  // Reset any in-progress coast fishing
  hideCoastTapBar();
  gs.coastTapCount = 0;
  gs.coastTapNeeded = 0;

  if(mode === 'pokemon') {
    if(pokeBadge) pokeBadge.style.display='block';
    if(pikaBox)   pikaBox.style.display='flex';
    document.documentElement.style.setProperty('--sky-top','#1a0828');
    document.documentElement.style.setProperty('--sky-bot','#0a0418');
    document.documentElement.style.setProperty('--water-top','#180830');
    document.documentElement.style.setProperty('--water-bot','#0a0418');
    showToast('âš¡ ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½ Ñ€ÐµÐ¶Ð¸Ð¼! Ð›Ð¾Ð²Ð¸ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð² Ð·Ð° ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ñ‹!');
  } else if(mode === 'coast') {
    if(coastBadge) coastBadge.style.display='block';
    document.documentElement.style.setProperty('--sky-top','#003060');
    document.documentElement.style.setProperty('--sky-bot','#001830');
    document.documentElement.style.setProperty('--water-top','#003878');
    document.documentElement.style.setProperty('--water-bot','#001840');
    showToast('ðŸ–ï¸ ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð¾Ðº! Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð›Ð•Ð“Ð•ÐÐ”Ð«! Ð–Ð¼Ð¸ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð· Ð´Ð»Ñ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ¸!');
  } else if(mode === 'hardcore') {
    if(hcBadge) hcBadge.style.display='block';
    document.documentElement.style.setProperty('--sky-top','#1a0000');
    document.documentElement.style.setProperty('--sky-bot','#0a0000');
    document.documentElement.style.setProperty('--water-top','#3a0000');
    document.documentElement.style.setProperty('--water-bot','#180000');
    startHcBossLoop();
    showToast('ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð! Ð‘Ð¾ÑÑÑ‹! ÐŸÐ¸Ñ€Ð°Ð½ÑŒÐ¸! ÐžÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾!');
  } else if(mode === 'hobo') {
    if(bumBadge) bumBadge.style.display='block';
    document.documentElement.style.setProperty('--sky-top','#0e0c08');
    document.documentElement.style.setProperty('--sky-bot','#181410');
    document.documentElement.style.setProperty('--water-top','#0e1208');
    document.documentElement.style.setProperty('--water-bot','#060804');
    showToast('ðŸ§Ÿ Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ñ! Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð³Ð½Ð¸Ð»Ð°Ñ Ñ€Ñ‹Ð±Ð°... ÐÐ°ÐºÐ¾Ð¿Ð¸ 1000ðŸª™ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ±ÐµÐ¶Ð°Ñ‚ÑŒ!');
    // Shop becomes rotten
    renderShop();
  } else if(mode === 'easter') {
    if(easterBadge) easterBadge.style.display='block';
    document.documentElement.style.setProperty('--sky-top','#280a1e');
    document.documentElement.style.setProperty('--sky-bot','#180614');
    document.documentElement.style.setProperty('--water-top','#3a0a2a');
    document.documentElement.style.setProperty('--water-bot','#200618');
    showToast('ðŸ° ÐšÐ°Ñ€Ñ‚Ð° ÐŸÐ°ÑÑ…Ð°! Ð›Ð¾Ð²Ð¸ ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð²! 50% ÑˆÐ°Ð½Ñ Ð±Ð°Ñ„Ñ„ Cha Cha!');
    spawnEasterConfetti();
  } else {
    applyWeather(gs.weather, true);
    showToast('ðŸŒŠ ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð° â€” Ð»Ð¾Ð²Ð¸Ð¼ Ñ€Ñ‹Ð±Ñƒ!');
  }
}

function getPokemonPool() {
  const hasBuf = gs.activePikaBuf;
  const pool = [];
  POKEMON_DATA.forEach(p => {
    let w = p.rar==='common'?60 : p.rar==='rare'?30 : p.rar==='epic'?8 : 2;
    if(hasBuf?.effect==='rare' && p.rar!=='common') w*=2;
    if(hasBuf?.effect==='legend' && p.rar==='legend') w*=3;
    for(let i=0;i<Math.round(w);i++) pool.push(p);
  });
  return pool;
}

function updatePikaCoins() {
  document.getElementById('pika-coins-display').textContent = gs.pikaCoins;
}


function catchPokemon(f) {
  gs.fishCount++;
  gs.pikaCatchCount++;
  gs.score += f.pts;
  document.getElementById('fish-count').textContent = gs.fishCount;
  document.getElementById('score-val').textContent = gs.score;
  
  let earned = f.pikaCoins;
  // Apply active buffs
  if(gs.activePikaBuf?.effect === 'combo2') { earned *= 2; gs.pikaBufCount--; }
  if(gs.activePikaBuf?.effect === 'combo3') { earned *= 3; gs.pikaBufCount--; }
  if(gs.activePikaBuf?.effect === 'combo5') { earned *= 5; gs.pikaBufCount--; }
  if(gs.activePikaBuf?.effect === 'shiny')  { gs.score += f.pts; gs.pikaBufCount--; }
  if(gs.activePikaBuf?.effect === 'mega')   { earned *= 4; gs.coins += 200; updateCoins(); gs.pikaBufCount--; }
  if(gs.pikaBufCount <= 0) gs.activePikaBuf = null;
  
  gs.pikaCoins += earned;
  updatePikaCoins();
  
  // ðŸ”´ POKEBALL BOOST â€” show pokeball catch overlay first!
  const boostRoll = Math.random();
  let boost = null;
  if(boostRoll < 0.25) boost = {id:'pb_coins',  icon:'ðŸ’°', name:'ÐœÐ¾Ð½ÐµÑ‚Ð½Ñ‹Ð¹ Ð‘ÑƒÑÑ‚',   desc:'+500 Ð¼Ð¾Ð½ÐµÑ‚ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾!',     effect:'coins',  val:500};
  else if(boostRoll < 0.45) boost = {id:'pb_bite',    icon:'ðŸŽ£', name:'Ð Ñ‹Ð±Ð¾Ð»Ð¾Ð²Ð½Ñ‹Ð¹ Ð‘ÑƒÑÑ‚', desc:'ÐšÐ»Ñ‘Ð² x3 Ð½Ð° 45 ÑÐµÐº!',       effect:'bite_x3',val:45000};
  else if(boostRoll < 0.60) boost = {id:'pb_xp',      icon:'â¬†ï¸', name:'XP Ð‘ÑƒÑÑ‚',        desc:'+200 XP Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾!',        effect:'xp',     val:200};
  else if(boostRoll < 0.72) boost = {id:'pb_legend',  icon:'â­', name:'Ð›ÐµÐ³ÐµÐ½Ð´Ð° Ð‘ÑƒÑÑ‚',   desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ñ€Ñ‹Ð±Ð° â€” Ð›Ð•Ð“Ð•ÐÐ”Ð!', effect:'next_legend',val:1};
  else if(boostRoll < 0.82) boost = {id:'pb_og',      icon:'ðŸ‘‘', name:'OG Ð‘ÑƒÑÑ‚',        desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ñ€Ñ‹Ð±Ð° â€” OG!',      effect:'next_og',val:1};
  else if(boostRoll < 0.90) boost = {id:'pb_shield',  icon:'ðŸ›¡ï¸', name:'ÐŸÐ¸Ñ€Ð°Ð½ÑŒÑ Ð©Ð¸Ñ‚',   desc:'Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ð¿Ð¸Ñ€Ð°Ð½ÑŒÑ = Ð¿Ñ€Ð¾Ð¿ÑƒÑÐº',effect:'pirana_shield',val:1};
  else boost = {id:'pb_jackpot', icon:'ðŸŽ°', name:'Ð”Ð–Ð•ÐšÐŸÐžÐ¢',       desc:'+2000 Ð¼Ð¾Ð½ÐµÑ‚ + x5 PikaCoins!',  effect:'jackpot',val:2000};

  showPokeballCatch(f, earned, boost);
  addXP(30 + f.pts/5);
  updateQuestProgress('pokemon');
  checkAchievements();
  saveGame();
  syncLeaderboard();
}



// ============================================================
// PIKABUFS SHOP
// ============================================================
function renderPikabufs(body) {
  if(gs.mapMode !== 'pokemon') {
    const note = document.createElement('div');
    note.style.cssText='font-family:\'Neucha\',cursive;font-size:13px;color:#5050a0;padding:16px;text-align:center;';
    note.textContent='âš¡ ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸ÑÑŒ Ð½Ð° ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½ ÐºÐ°Ñ€Ñ‚Ñƒ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÐŸÐ¸ÐºÐ°Ð‘Ð°Ñ„Ñ„Ñ‹!';
    body.appendChild(note);
    return;
  }
  const wrap = document.createElement('div'); wrap.className='pikabufs-section';
  wrap.innerHTML=`<div class="pikabufs-title">âš¡ ÐŸÐ¸ÐºÐ°Ð‘Ð°Ñ„Ñ„Ñ‹</div><div style="font-family:'Neucha',cursive;font-size:10px;color:#8070a0;margin-bottom:8px;text-align:center;">ÐŸÐ¾ÐºÑƒÐ¿Ð°ÑŽÑ‚ÑÑ Ð·Ð° ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ñ‹ âš¡ â€¢ Ð”Ð°ÑŽÑ‚ ÐšÐ¾Ð¼Ð±Ð¾!</div>`;
  
  const bal = document.createElement('div');
  bal.style.cssText='font-family:\'Neucha\',cursive;font-size:13px;color:#f0d040;text-align:center;margin-bottom:10px;';
  bal.textContent = `Ð£ Ñ‚ÐµÐ±Ñ: ${gs.pikaCoins}âš¡ ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ð¾Ð²`;
  wrap.appendChild(bal);
  
  PIKABUFS.forEach(pb => {
    const canBuy = gs.pikaCoins >= pb.price;
    const active = gs.activePikaBuf?.id === pb.id;
    const el = document.createElement('div');
    el.className='shop-item';
    if(active) el.style.borderColor='#f0d040';
    el.innerHTML=`
      <div class="shop-item-icon"><span style="font-size:36px;">${pb.icon}</span></div>
      <div class="shop-item-info">
        <div class="shop-item-name">${pb.name}</div>
        <div class="shop-item-desc">${pb.desc}</div>
        <div class="shop-item-price">âš¡ ${pb.price} ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ð¾Ð²</div>
      </div>
      <button class="shop-item-btn ${active?'btn-equipped-shop':canBuy?'btn-buy-shop':'btn-owned-shop'}"
        onclick="buyPikaBuf('${pb.id}')" ${active||!canBuy?'disabled':''}>
        ${active?'âœ“ ÐÐºÑ‚Ð¸Ð²ÐµÐ½':'ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ'}
      </button>`;
    wrap.appendChild(el);
  });
  body.appendChild(wrap);
}

function buyPikaBuf(id) {
  const pb = PIKABUFS.find(p=>p.id===id);
  if(!pb) return;
  if(gs.pikaCoins < pb.price) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${pb.price}âš¡, Ñƒ Ñ‚ÐµÐ±Ñ ${gs.pikaCoins}âš¡`); return; }
  gs.pikaCoins -= pb.price;
  updatePikaCoins();
  gs.activePikaBuf = pb;
  // Set duration/count depending on effect
  if(pb.effect === 'combo2') gs.pikaBufCount = 5;
  else if(pb.effect === 'combo3') gs.pikaBufCount = 3;
  else if(pb.effect === 'combo5') gs.pikaBufCount = 1;
  else if(pb.effect === 'shiny')  gs.pikaBufCount = 4;
  else if(pb.effect === 'mega')   gs.pikaBufCount = 1;
  else if(pb.effect === 'pika_storm') {
    gs.pikaBufCount = 999;
    const prevBite = gs.currentRod.biteChance;
    gs.currentRod._stormBiteBackup = prevBite;
    gs.currentRod.biteChance = prevBite * 5;
    setTimeout(()=>{
      if(gs.currentRod._stormBiteBackup) {
        gs.currentRod.biteChance = gs.currentRod._stormBiteBackup;
        delete gs.currentRod._stormBiteBackup;
      }
      gs.activePikaBuf = null; gs.pikaBufCount = 0;
      showToast('â›ˆï¸ ÐŸÐ¸ÐºÐ°-Ð‘ÑƒÑ€Ñ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð°ÑÑŒ!');
    }, 10000);
  } else if(pb.effect === 'lucky_egg') {
    gs.pikaBufCount = 999;
    gs._luckyEggActive = true;
    setTimeout(()=>{ gs._luckyEggActive = false; gs.activePikaBuf = null; gs.pikaBufCount = 0; showToast('ðŸ¥š Ð¡Ñ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ð¾Ðµ ÑÐ¹Ñ†Ð¾ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð¾ÑÑŒ!'); }, 60000);
  } else gs.pikaBufCount = 10;
  renderShop();
  showToast(`âš¡ ${pb.name} Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½!`);
}

// ============================================================
// FORTUNE WHEEL
// ============================================================
const FORTUNE_PRIZES = [
  {label:'50ðŸª™',    color:'#c04010', type:'coins', val:50},
  {label:'100ðŸª™',   color:'#206040', type:'coins', val:100},
  {label:'ðŸŸ Ð Ñ‹Ð±Ð°', color:'#2040a0', type:'fish',  val:1},
  {label:'20ðŸª™',    color:'#a02030', type:'coins', val:20},
  {label:'200ðŸª™',   color:'#806010', type:'coins', val:200},
  {label:'âš¡Ã—10',   color:'#8020a0', type:'pika',  val:10},
  {label:'30ðŸª™',    color:'#204060', type:'coins', val:30},
  {label:'ðŸŒ±Ð¡ÐµÐ¼Ñ',  color:'#1a5010', type:'seed',  val:1},
  {label:'500ðŸª™!',  color:'#a06010', type:'coins', val:500},
  {label:'ÐÐ¸Ñ‡ÐµÐ³Ð¾',  color:'#1a1a2a', type:'none',  val:0},
  {label:'80ðŸª™',    color:'#302050', type:'coins', val:80},
  {label:'âš¡Ã—25',   color:'#6010a0', type:'pika',  val:25},
];
const FORTUNE_COST = 50;
let fortuneSpinning = false;
let fortuneAngle = 0;

function openFortune() {
  document.getElementById('fortune-overlay').classList.add('show');
  drawFortuneWheel(fortuneAngle);
  document.getElementById('fortune-result').textContent = '';
}

function closeFortune() {
  if(fortuneSpinning) return;
  document.getElementById('fortune-overlay').classList.remove('show');
}

function drawFortuneWheel(rotation) {
  const canvas = document.getElementById('fortune-wheel-canvas');
  const ctx = canvas.getContext('2d');
  const cx = 130, cy = 130, r = 126;
  const n = FORTUNE_PRIZES.length;
  const arc = (Math.PI*2)/n;
  ctx.clearRect(0,0,260,260);
  // Outer ring
  ctx.beginPath(); ctx.arc(cx,cy,r+4,0,Math.PI*2);
  ctx.strokeStyle='#f0d040'; ctx.lineWidth=4; ctx.stroke();
  
  FORTUNE_PRIZES.forEach((p,i) => {
    const start = rotation + i*arc - Math.PI/2;
    const end   = start + arc;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,end);
    ctx.closePath();
    ctx.fillStyle = p.color;
    ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,.3)'; ctx.lineWidth=1; ctx.stroke();
    // Label
    const mid = start + arc/2;
    ctx.save();
    ctx.translate(cx + Math.cos(mid)*r*.65, cy + Math.sin(mid)*r*.65);
    ctx.rotate(mid + Math.PI/2);
    ctx.fillStyle='#fff';
    ctx.font='bold 11px Neucha,cursive';
    ctx.textAlign='center';
    ctx.fillText(p.label, 0, 0);
    ctx.restore();
  });
  // Center
  ctx.beginPath(); ctx.arc(cx,cy,18,0,Math.PI*2);
  ctx.fillStyle='#2a1608'; ctx.fill();
  ctx.strokeStyle='#f0d040'; ctx.lineWidth=2; ctx.stroke();
}

function spinFortune() {
  if(fortuneSpinning) return;
  if(gs.coins < FORTUNE_COST) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${FORTUNE_COST}ðŸª™ Ð´Ð»Ñ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ!`); return; }
  gs.coins -= FORTUNE_COST;
  updateCoins();
  fortuneSpinning = true;
  document.getElementById('fortune-spin-btn').style.opacity = '0.5';
  document.getElementById('fortune-result').textContent = 'ðŸŽ¡ ÐšÑ€ÑƒÑ‚Ð¸Ñ‚ÑÑ...';
  
  const prizeIdx = Math.floor(Math.random()*FORTUNE_PRIZES.length);
  const n = FORTUNE_PRIZES.length;
  const arc = (Math.PI*2)/n;
  // Target angle: spin 5-8 full rotations + land on prize
  const targetOffset = -(prizeIdx * arc + arc/2);
  const extraSpins = (5 + Math.floor(Math.random()*3)) * Math.PI * 2;
  const finalAngle = targetOffset + extraSpins;
  
  let startTime = null;
  const duration = 4000;
  
  function animate(ts) {
    if(!startTime) startTime = ts;
    const elapsed = ts - startTime;
    const t = Math.min(1, elapsed/duration);
    // Ease out cubic
    const ease = 1 - Math.pow(1-t, 3);
    const currentAngle = fortuneAngle + finalAngle * ease;
    drawFortuneWheel(currentAngle);
    if(t < 1) {
      requestAnimationFrame(animate);
    } else {
      fortuneAngle = (fortuneAngle + finalAngle) % (Math.PI*2);
      fortuneSpinning = false;
      document.getElementById('fortune-spin-btn').style.opacity = '1';
      const prize = FORTUNE_PRIZES[prizeIdx];
      applyFortunePrize(prize);
    }
  }
  requestAnimationFrame(animate);
}

function applyFortunePrize(prize) {
  let msg = '';
  if(prize.type === 'coins') { gs.coins += prize.val; updateCoins(); coinBurst(180,350); msg = `ðŸŽ‰ Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð» ${prize.val}ðŸª™!`; }
  else if(prize.type === 'pika') { gs.pikaCoins += prize.val; updatePikaCoins(); msg = `âš¡ Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð» ${prize.val} ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ð¾Ð²!`; }
  else if(prize.type === 'fish') { 
    const f = FISH_DATA[Math.floor(Math.random()*5)];
    gs.inventory.push({...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)});
    msg = `ðŸŸ Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð» Ñ€Ñ‹Ð±Ñƒ: ${f.name}!`;
  }
  else if(prize.type === 'seed') {
    SEEDS[Math.floor(Math.random()*SEEDS.length)].owned++;
    msg = 'ðŸŒ± Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð» ÑÐµÐ¼Ñ!';
  }
  else { msg = 'ðŸ˜… ÐÐ¸Ñ‡ÐµÐ³Ð¾... ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·!'; }
  
  document.getElementById('fortune-result').textContent = msg;
  showToast(msg);
  saveGame();
}

// ============================================================
// LEADERBOARD
// ============================================================
let lbTab = 'fish';

function switchLbTab(tab, el) {
  lbTab = tab;
  document.querySelectorAll('.lb-tab').forEach(t=>t.classList.remove('active'));
  if(el) el.classList.add('active');
  renderLeaderboard();
}

async function renderLeaderboard() {
  const list = document.getElementById('lb-list');
  list.innerHTML = '<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#4040a0;padding:16px;text-align:center;">â³ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...</div>';
  
  // Try Firebase
  const ok = await initFirebase();
  if(!ok) {
    list.innerHTML = '<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#4040a0;padding:16px;text-align:center;">âŒ ÐÑƒÐ¶Ð½Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ</div>';
    return;
  }
  
  // Push own data
  await fb.upd(`leaderboard/${myPlayerId}`, {
    name: myPlayerName,
    fishCount: gs.fishCount,
    pikaCount: gs.pikaCatchCount,
    coins: gs.coins
  }).catch(()=>{});
  
  const snap = await fb.get('leaderboard').catch(()=>null);
  if(!snap || !snap.exists()) { list.innerHTML='<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#4040a0;padding:16px;text-align:center;">ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…</div>'; return; }
  
  const data = snap.val();
  let entries = Object.entries(data).map(([id,d])=>({id,...d}));
  
  const field = lbTab==='fish'?'fishCount': lbTab==='pika'?'pikaCount':'coins';
  const icon  = lbTab==='fish'?'ðŸŸ': lbTab==='pika'?'âš¡':'ðŸª™';
  entries.sort((a,b)=>(b[field]||0)-(a[field]||0));
  entries = entries.slice(0,20);
  
  list.innerHTML = '';
  const medals = ['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'];
  entries.forEach((e,i)=>{
    const isMe = e.id === myPlayerId;
    const row = document.createElement('div');
    row.className = 'lb-row' + (isMe?' lb-me':'');
    row.innerHTML = `
      <div class="lb-rank">${medals[i]||('#'+(i+1))}</div>
      <div class="lb-name">${e.name||'Ð Ñ‹Ð±Ð°Ðº'}${isMe?' ðŸ‘ˆ':''}</div>
      <div class="lb-val">${icon} ${e[field]||0}</div>`;
    list.appendChild(row);
  });
}

async function syncLeaderboard() {
  if(!firebaseDB) return;
  fb.upd(`leaderboard/${myPlayerId}`, {
    name: myPlayerName,
    fishCount: gs.fishCount,
    pikaCount: gs.pikaCatchCount,
    coins: gs.coins
  }).catch(()=>{});
}

// ============================================================
// KIOSK (Player Marketplace)
// ============================================================
let kioskListings = {}; // Local cache of market


// ============================================================
// ðŸŽ Ð¡Ð¢ÐÐ Ð¢ÐžÐ’Ð«Ð™ ÐŸÐžÐ”ÐÐ ÐžÐš
// ============================================================
function checkAndShowGift() {
  if(localStorage.getItem('fishing_gift_claimed')) return;
  // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· 600Ð¼Ñ Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸
  setTimeout(()=>{
    // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð½ÑƒÑŽ Ð²ÐµÑ‰ÑŒ Ð¸Ð· Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ñ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°
    const soldItem = gs.inventory.length > 0
      ? gs.inventory[Math.floor(Math.random()*gs.inventory.length)]
      : {name:'ÐšÐ°Ñ€Ð°ÑÑŒ'};
    document.getElementById('gift-bot-item').innerHTML =
      'ðŸ¤– Ð‘Ð¾Ñ‚ ÐºÑƒÐ¿Ð¸Ð» <b>' + soldItem.name + '</b> Ð·Ð° <b>4000ðŸª™</b> â€” Ð·Ð°Ð±ÐµÑ€Ð¸ Ð² ÐºÐ¸Ð¾ÑÐºÐµ!';
    gs._giftBotItem = soldItem;
    document.getElementById('gift-overlay').style.display='flex';
  }, 600);
}

function claimGift() {
  localStorage.setItem('fishing_gift_claimed','1');
  document.getElementById('gift-overlay').style.display='none';

  // 1. Ð’Ñ‹Ð´Ð°Ñ‚ÑŒ ÑƒÐ´Ð¾Ñ‡ÐºÑƒ Ð ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ Ð£Ñ‚ÐºÐ°
  const duck = RODS.find(r=>r.id==='rubberduck');
  if(duck) { duck.owned=true; }

  // 2. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð° ÐœÐ°Ð±Ð¾Ð¹ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº Â«Ð¿Ð¾Ð¹Ð¼Ð°Ð½Ð½Ñ‹Ñ…Â» (Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ðµ ÐºÐ°Ðº Ñ‚Ñ€Ð¾Ñ„ÐµÐ¹)
  gs.caughtPokemon = gs.caughtPokemon || [];
  const maboi = POKEMON_DATA.find(p=>p.name==='ÐœÐ°Ð±Ð¾Ð¹');
  if(maboi) gs.caughtPokemon.push({...maboi, weight:'1.5'});

  // 3. ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ
  gs.coastUnlocked = true;
  const coastBtn = document.getElementById('map-btn-coast');
  if(coastBtn) coastBtn.style.display='';

  // 4. Ð‘Ð¾Ñ‚ ÐºÑƒÐ¿Ð¸Ð» Ð²ÐµÑ‰ÑŒ â€” Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ 4000 Ð¼Ð¾Ð½ÐµÑ‚ Ð² ÐºÐ¸Ð¾ÑÐº-Ð¿Ð»Ð°Ñ‚Ñ‘Ð¶
  initFirebase().then(ok=>{
    if(ok) {
      fb.get('kiosk_payments/' + myPlayerId + '/pending').then(snap=>{
        const cur = snap.exists() ? (snap.val()||0) : 0;
        fb.set('kiosk_payments/' + myPlayerId + '/pending', cur + 4000);
      }).catch(()=>{
        // ÐžÑ„Ð»Ð°Ð¹Ð½ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ ÑÑ€Ð°Ð·Ñƒ
        gs.coins += 4000; updateCoins();
        showToast('ðŸ¤– Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ð» 4000ðŸª™ Ð·Ð° Ð²Ð°ÑˆÑƒ Ñ€Ñ‹Ð±Ñƒ!');
      });
    } else {
      gs.coins += 4000; updateCoins();
      showToast('ðŸ¤– Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ð» 4000ðŸª™!');
    }
  });

  saveGame();
  showToast('ðŸŽ Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ð°Ðº Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½! Ð£Ð´Ð°Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ð°Ð»ÐºÐ¸!');
  // ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÑŽ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  setTimeout(updateRodVisual, 300);
}

// ============================================================
// ðŸ’¬ Ð“Ð›ÐžÐ‘ÐÐ›Ð¬ÐÐ«Ð™ Ð§ÐÐ¢
// ============================================================
let chatOpen = false;
let chatUnreadCount = 0;

function toggleChat() {
  chatOpen = !chatOpen;
  document.getElementById('chat-box').style.display = chatOpen ? 'block' : 'none';
  if(chatOpen) {
    chatUnreadCount = 0;
    const u = document.getElementById('chat-unread');
    u.style.display='none'; u.textContent='';
    setTimeout(()=>{
      const msgs = document.getElementById('chat-messages');
      msgs.scrollTop = msgs.scrollHeight;
      document.getElementById('chat-input').focus();
    }, 50);
  }
}

function sendChatMsg() {
  const inp = document.getElementById('chat-input');
  const text = inp.value.trim();
  if(!text) return;
  inp.value = '';
  initFirebase().then(ok=>{
    if(!ok){ showToast('âŒ ÐÐµÑ‚ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ñ‡Ð°Ñ‚Ð°'); return; }
    const msg = {
      name: myPlayerName,
      text: text,
      ts: Date.now()
    };
    fb.set('global_chat/' + Date.now() + '_' + myPlayerId.slice(-4), msg).catch(()=>{});
  });
}

function startChatListener() {
  initFirebase().then(ok=>{
    if(!ok) return;
    // Ð¡Ð»ÑƒÑˆÐ°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 50 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
    const ref = fb.r('global_chat');
    // Compat: .limitToLast
    firebaseDB.ref('global_chat').limitToLast(50).on('child_added', snap=>{
      const msg = snap.val();
      if(!msg) return;
      appendChatMsg(msg);
      if(!chatOpen) {
        chatUnreadCount++;
        const u = document.getElementById('chat-unread');
        u.textContent = chatUnreadCount > 9 ? '9+' : chatUnreadCount;
        u.style.display = 'flex';
      }
    });
  });
}

function appendChatMsg(msg) {
  const div = document.createElement('div');
  div.className = 'chat-msg';
  const t = new Date(msg.ts);
  const time = t.getHours().toString().padStart(2,'0')+':'+t.getMinutes().toString().padStart(2,'0');
  const isMe = msg.name === myPlayerName;
  div.innerHTML = '<span class="chat-time">' + time + '</span> '
    + '<span class="chat-name"' + (isMe?' style="color:#f0d060"':'') + '>' + escapeHtml(msg.name) + '</span>: '
    + escapeHtml(msg.text);
  const msgs = document.getElementById('chat-messages');
  msgs.appendChild(div);
  // ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ñ‚ÑŒ 100 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² DOM
  while(msgs.children.length > 100) msgs.removeChild(msgs.firstChild);
  if(chatOpen) msgs.scrollTop = msgs.scrollHeight;
}

function escapeHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// Enter Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸
document.addEventListener('DOMContentLoaded', ()=>{
  const inp = document.getElementById('chat-input');
  if(inp) inp.addEventListener('keydown', e=>{ if(e.key==='Enter') sendChatMsg(); });
});



// ============================================================
// ðŸ† Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ Ð£Ð ÐžÐ’ÐÐ•Ð™
// ============================================================
const LEVEL_THRESHOLDS = [0,100,250,500,900,1500,2500,4000,6000,9000,13000,18000,25000,35000,50000,70000,100000,140000,200000,999999];
const LEVEL_TITLES = ['ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº','Ð Ñ‹Ð±Ð°Ñ‡Ð¾Ðº','Ð£Ð´Ð¸Ð»ÑŒÑ‰Ð¸Ðº','Ð£Ð¼ÐµÐ»ÐµÑ†','ÐœÐ°ÑÑ‚ÐµÑ€','Ð—Ð½Ð°Ñ‚Ð¾Ðº','Ð Ñ‹Ð±Ð°Ñ€ÑŒ','Ð‘Ñ‹Ð²Ð°Ð»Ñ‹Ð¹','Ð’ÐµÑ‚ÐµÑ€Ð°Ð½','Ð›ÐµÐ³ÐµÐ½Ð´Ð°','ÐœÐ¾Ñ€ÑÐºÐ¾Ð¹ Ð’Ð¾Ð»Ðº','ÐšÐ°Ð¿Ð¸Ñ‚Ð°Ð½','ÐÐ´Ð¼Ð¸Ñ€Ð°Ð»','ÐÐµÐ¿Ñ‚ÑƒÐ½','Ð‘Ð¾Ð³ Ð Ñ‹Ð±Ð°Ð»ÐºÐ¸','Ð”Ñ€ÐµÐ²Ð½Ð¸Ð¹','ÐœÐ¸Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹','Ð’ÐµÑ‡Ð½Ñ‹Ð¹','Ð‘ÐµÑÑÐ¼ÐµÑ€Ñ‚Ð½Ñ‹Ð¹','ÐœÐÐšÐ¡Ð˜ÐœÐ£Ðœ'];

function getLevel(xp) {
  if(typeof LEVEL_THRESHOLDS === 'undefined') return 1;
  for(let i=LEVEL_THRESHOLDS.length-1;i>=0;i--) if(xp>=LEVEL_THRESHOLDS[i]) return i+1;
  return 1;
}
function getXpForNext(xp) {
  const lv = getLevel(xp);
  return lv < LEVEL_THRESHOLDS.length ? LEVEL_THRESHOLDS[lv] : LEVEL_THRESHOLDS[LEVEL_THRESHOLDS.length-1];
}
function addXP(amount) {
  const prevLv = getLevel(gs.xp||0);
  gs.xp = (gs.xp||0) + amount;
  const newLv = getLevel(gs.xp);
  updateLevelUI();
  if(newLv > prevLv) {
    onLevelUp(newLv);
  }
}
function updateLevelUI() {
  const lv = getLevel(gs.xp||0);
  const xp = gs.xp||0;
  const nextXp = getXpForNext(xp);
  const prevXp = LEVEL_THRESHOLDS[lv-1]||0;
  const pct = Math.min(100, Math.round((xp-prevXp)/(nextXp-prevXp)*100));
  const el = document.getElementById('level-display');
  if(el) el.textContent = 'Ð£Ñ€.' + lv;
  const bar = document.getElementById('xp-bar-fill');
  if(bar) bar.style.width = pct+'%';
  const title = document.getElementById('level-title');
  if(title) title.textContent = LEVEL_TITLES[lv-1]||'';
}
function onLevelUp(lv) {
  // Ð‘Ð¾Ð½ÑƒÑ Ð·Ð° Ð»ÐµÐ²ÐµÐ»-Ð°Ð¿
  const bonusCoins = lv * 50;
  gs.coins += bonusCoins;
  updateCoins();
  // ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ
  const el = document.getElementById('levelup-anim');
  if(el) {
    el.textContent = 'â¬†ï¸ Ð£Ð ÐžÐ’Ð•ÐÐ¬ ' + lv + '!';
    el.style.display = 'block';
    el.style.animation = 'none';
    void el.offsetWidth;
    el.style.animation = 'levelUpPop 2.5s ease forwards';
    setTimeout(()=>{ el.style.display='none'; }, 2500);
  }
  showToast('ðŸŽ‰ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ ' + lv + '! +' + bonusCoins + 'ðŸª™ Ð±Ð¾Ð½ÑƒÑ! Ð¢Ñ‹: ' + LEVEL_TITLES[lv-1]);
  saveGame();
}

// ============================================================
// ðŸ… Ð”ÐžÐ¡Ð¢Ð˜Ð–Ð•ÐÐ˜Ð¯
// ============================================================
const ACHIEVEMENTS = [
  {id:'first_fish',   name:'ÐŸÐµÑ€Ð²Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²',      icon:'ðŸŸ', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ñ€Ñ‹Ð±Ñƒ',              cond:g=>g.fishCount>=1},
  {id:'fish_10',      name:'Ð Ñ‹Ð±Ð°Ðº',            icon:'ðŸŽ£', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 10 Ñ€Ñ‹Ð±',                   cond:g=>g.fishCount>=10},
  {id:'fish_100',     name:'Ð—Ð°ÑÐ´Ð»Ñ‹Ð¹ Ñ€Ñ‹Ð±Ð°Ðº',    icon:'ðŸ†', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 100 Ñ€Ñ‹Ð±',                  cond:g=>g.fishCount>=100},
  {id:'fish_500',     name:'ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»',      icon:'ðŸŒŠ', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 500 Ñ€Ñ‹Ð±',                  cond:g=>g.fishCount>=500},
  {id:'coins_1000',   name:'ÐšÐ¾Ð¿Ð¸Ð»ÐºÐ°',           icon:'ðŸ’°', desc:'ÐÐ°ÐºÐ¾Ð¿Ð¸ 1000 Ð¼Ð¾Ð½ÐµÑ‚',               cond:g=>g.coins>=1000},
  {id:'coins_10000',  name:'Ð‘Ð¾Ð³Ð°Ñ‡',             icon:'ðŸ’Ž', desc:'ÐÐ°ÐºÐ¾Ð¿Ð¸ 10000 Ð¼Ð¾Ð½ÐµÑ‚',              cond:g=>g.coins>=10000},
  {id:'legend_catch', name:'ÐžÑ…Ð¾Ñ‚Ð½Ð¸Ðº Ð·Ð° Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ð¼Ð¸',icon:'â­',desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½ÑƒÑŽ Ñ€Ñ‹Ð±Ñƒ',        cond:g=>g.inventory.some(f=>f.rar==='legend')||g.fishCount>0&&(g._caughtLegend||false)},
  {id:'pokemon_10',   name:'ÐŸÐ¾ÐºÐµÐ¼Ð°ÑÑ‚ÐµÑ€',        icon:'âš¡', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 10 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð²',             cond:g=>g.pikaCatchCount>=10},
  {id:'pokemon_50',   name:'ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½-Ñ‡ÐµÐ¼Ð¿Ð¸Ð¾Ð½',   icon:'ðŸ”®', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 50 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð²',             cond:g=>g.pikaCatchCount>=50},
  {id:'level_5',      name:'ÐžÐ¿Ñ‹Ñ‚Ð½Ñ‹Ð¹',           icon:'ðŸ“ˆ', desc:'Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½Ð¸ 5 ÑƒÑ€Ð¾Ð²Ð½Ñ',               cond:g=>getLevel(g.xp||0)>=5},
  {id:'level_10',     name:'ÐœÐ°ÑÑ‚ÐµÑ€ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹',    icon:'ðŸŒŸ', desc:'Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½Ð¸ 10 ÑƒÑ€Ð¾Ð²Ð½Ñ',              cond:g=>getLevel(g.xp||0)>=10},
  {id:'sell_all',     name:'Ð¢Ð¾Ñ€Ð³Ð°Ñˆ',            icon:'ðŸ’±', desc:'ÐŸÑ€Ð¾Ð´Ð°Ð¹ Ð²ÑÑ‘ Ð¸Ð· Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ñ',         cond:g=>(g._soldAll||false)},
  {id:'coast_catch',  name:'ÐœÐ¾Ñ€ÑÐºÐ¾Ð¹ Ð¾Ñ…Ð¾Ñ‚Ð½Ð¸Ðº',   icon:'ðŸ–ï¸', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ Ñ€Ñ‹Ð±Ñƒ Ð½Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ',       cond:g=>(g._coastCatch||false)},
  {id:'duck_rod',     name:'Ð£Ñ‚Ð¸Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð½Ð°Ñ‚',     icon:'ðŸ¦†', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 20 Ñ€Ñ‹Ð± ÑƒÐ´Ð¾Ñ‡ÐºÐ¾Ð¹ Ð£Ñ‚ÐºÐ°',    cond:g=>(g._duckCatches||0)>=20},
  {id:'streak_5',     name:'Ð¡ÐµÑ€Ð¸Ñ',             icon:'ðŸ”¥', desc:'5 ÑƒÐ»Ð¾Ð²Ð¾Ð² Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð¼Ð°Ñ…Ð°',     cond:g=>(g.catchStreak||0)>=5},
  {id:'streak_10',    name:'ÐžÐ³Ð¾Ð½ÑŒ!',            icon:'ðŸ”¥ðŸ”¥',desc:'10 ÑƒÐ»Ð¾Ð²Ð¾Ð² Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð¼Ð°Ñ…Ð°',   cond:g=>(g.catchStreak||0)>=10},
];

gs.achievements = gs.achievements || {};
gs.catchStreak = gs.catchStreak || 0;

function checkAchievements() {
  ACHIEVEMENTS.forEach(a=>{
    if(gs.achievements[a.id]) return;
    if(a.cond(gs)) {
      gs.achievements[a.id] = Date.now();
      showAchievementToast(a);
      addXP(200);
      saveGame();
    }
  });
}

function showAchievementToast(a) {
  const el = document.createElement('div');
  el.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1a0a00,#3a1a00);border:2px solid #f0c040;border-radius:14px;padding:10px 18px;font-family:Neucha,cursive;font-size:13px;color:#f0d060;z-index:9999;text-align:center;box-shadow:0 4px 20px rgba(200,150,0,.5);animation:achieveIn .4s cubic-bezier(.34,1.56,.64,1) forwards;';
  el.innerHTML = '<div style="font-size:22px">' + a.icon + '</div><div style="font-weight:bold">' + a.name + '</div><div style="font-size:11px;color:#c0a040">' + a.desc + '</div><div style="font-size:11px;color:#80ff80;margin-top:2px">+200 XP</div>';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 3500);
}


// ============================================================
// ðŸ“‹ Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð• Ð—ÐÐ”ÐÐÐ˜Ð¯
// ============================================================
const QUEST_POOL = [
  {id:'catch_5',    name:'Ð£Ñ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ ÑƒÐ»Ð¾Ð²',      icon:'ðŸŒ…', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 5 Ñ€Ñ‹Ð±',           type:'fish',    target:5,    reward:{coins:200,  xp:100}},
  {id:'catch_15',   name:'Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ Ñ€Ñ‹Ð±Ð°Ð»ÐºÐ°',    icon:'ðŸŽ£', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 15 Ñ€Ñ‹Ð±',          type:'fish',    target:15,   reward:{coins:500,  xp:250}},
  {id:'catch_epic', name:'ÐžÑ…Ð¾Ñ‚Ð° Ð½Ð° ÑÐ¿Ð¸ÐºÐ¾Ð²',    icon:'ðŸ’œ', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 3 ÑÐ¿Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ€Ñ‹Ð±Ñ‹', type:'epic',    target:3,    reward:{coins:400,  xp:200}},
  {id:'catch_legend',name:'ÐžÑ…Ð¾Ñ‚Ð° Ð½Ð° Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹',  icon:'â­', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½ÑƒÑŽ Ñ€Ñ‹Ð±Ñƒ', type:'legend',  target:1,    reward:{coins:800,  xp:400}},
  {id:'earn_coins', name:'Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ',       icon:'ðŸ’°', desc:'Ð—Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð¹ 500 Ð¼Ð¾Ð½ÐµÑ‚',    type:'coins',   target:500,  reward:{coins:300,  xp:150}},
  {id:'pokemon_5',  name:'ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½-Ð¾Ñ…Ð¾Ñ‚Ð°',       icon:'âš¡', desc:'ÐŸÐ¾Ð¹Ð¼Ð°Ð¹ 5 Ð¿Ð¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð²',     type:'pokemon', target:5,    reward:{coins:0,    xp:200, pikaCoins:50}},
  {id:'no_miss_5',  name:'Ð¢Ð¾Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ°',     icon:'ðŸŽ¯', desc:'5 ÑƒÐ»Ð¾Ð²Ð¾Ð² Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð¼Ð°Ñ…Ð°',   type:'streak',  target:5,    reward:{coins:350,  xp:180}},
  {id:'sell_3',     name:'Ð Ñ‹Ð±Ð½Ñ‹Ð¹ Ñ€Ñ‹Ð½Ð¾Ðº',        icon:'ðŸ’±', desc:'ÐŸÑ€Ð¾Ð´Ð°Ð¹ 3 Ñ€Ñ‹Ð±Ñ‹',          type:'sell',    target:3,    reward:{coins:250,  xp:120}},
];

function getDailyQuests() {
  const today = new Date().toDateString();
  const saved = JSON.parse(localStorage.getItem('fishing_daily_quests')||'{}');
  if(saved.date === today && saved.quests) return saved.quests;
  // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ 3 Ð·Ð°Ð´Ð°Ð½Ð¸Ñ Ð½Ð° Ð´ÐµÐ½ÑŒ
  const shuffled = [...QUEST_POOL].sort(()=>Math.random()-.5);
  const quests = shuffled.slice(0,3).map(q=>({...q, progress:0, done:false}));
  localStorage.setItem('fishing_daily_quests', JSON.stringify({date:today, quests}));
  return quests;
}

function saveDailyQuests(quests) {
  const today = new Date().toDateString();
  localStorage.setItem('fishing_daily_quests', JSON.stringify({date:today, quests}));
}

function updateQuestProgress(type, amount=1) {
  const quests = getDailyQuests();
  let changed = false;
  quests.forEach(q=>{
    if(q.done) return;
    if(q.type !== type) return;
    q.progress = Math.min(q.target, (q.progress||0) + amount);
    if(q.progress >= q.target) {
      q.done = true;
      claimQuestReward(q);
      changed = true;
    }
    changed = true;
  });
  if(changed) {
    saveDailyQuests(quests);
    if(gs.currentScreen==='fishing') renderQuestPanel();
  }
}

function claimQuestReward(q) {
  if(q.reward.coins) { gs.coins += q.reward.coins; updateCoins(); }
  if(q.reward.xp)    { addXP(q.reward.xp); }
  if(q.reward.pikaCoins) { gs.pikaCoins += q.reward.pikaCoins; updatePikaCoins(); }
  showToast('âœ… Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: ' + q.name + '! +' + (q.reward.coins||'') + (q.reward.coins?'ðŸª™ ':'') + '+' + q.reward.xp + 'XP');
  saveGame();
}

function renderQuestPanel() {
  const panel = document.getElementById('quest-panel');
  if(!panel) return;
  const quests = getDailyQuests();
  panel.innerHTML = '<div style="font-family:UnifrakturMaguntia,cursive;font-size:14px;color:#f0c840;margin-bottom:6px;text-align:center;">ðŸ“‹ Ð—Ð°Ð´Ð°Ð½Ð¸Ñ Ð´Ð½Ñ</div>';
  quests.forEach(q=>{
    const pct = Math.min(100, Math.round((q.progress||0)/q.target*100));
    const done = q.done;
    const bc = done?'#40c040':'#3a3020';
    const tc = done?'#80ff80':'#d0b060';
    const fc = done?'#40c040':'#c08020';
    panel.innerHTML += '<div style="margin-bottom:5px;background:rgba(0,0,0,.3);border-radius:8px;padding:5px 7px;border:1px solid '+bc+'">'
      + '<div style="display:flex;justify-content:space-between;align-items:center;">'
      + '<span style="font-family:Neucha,cursive;font-size:11px;color:'+tc+'">'+q.icon+' '+q.name+'</span>'
      + '<span style="font-family:Neucha,cursive;font-size:10px;color:#a08040">'+(q.progress||0)+'/'+q.target+'</span>'
      + '</div>'
      + '<div style="height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin-top:3px">'
      + '<div style="height:100%;width:'+pct+'%;background:'+fc+';border-radius:2px;transition:.3s"></div>'
      + '</div></div>';
  });
}

let questPanelOpen = false;
function toggleQuestPanel() {
  questPanelOpen = !questPanelOpen;
  const panel = document.getElementById('quest-panel');
  if(panel) {
    panel.style.display = questPanelOpen ? 'block' : 'none';
    if(questPanelOpen) renderQuestPanel();
  }
}


function showAchievements() {
  const popup = document.getElementById('achieve-popup');
  if(popup.style.display !== 'none') { popup.style.display='none'; return; }
  const total = ACHIEVEMENTS.length;
  const earned = Object.keys(gs.achievements||{}).length;
  popup.innerHTML = '<div style="font-family:UnifrakturMaguntia,cursive;font-size:16px;color:#f0c840;text-align:center;margin-bottom:8px;">ðŸ… Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ ' + earned + '/' + total + '</div>';
  ACHIEVEMENTS.forEach(a=>{
    const done = !!(gs.achievements||{})[a.id];
    popup.innerHTML += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:5px;padding:5px 8px;background:rgba(0,0,0,.3);border-radius:8px;border:1px solid '+(done?'#c0a030':'#2a2a1a')+';opacity:'+(done?'1':'.5')+'">'
      + '<span style="font-size:20px">' + a.icon + '</span>'
      + '<div><div style="font-family:Neucha,cursive;font-size:12px;color:'+(done?'#f0d060':'#808060')+'">' + a.name + '</div>'
      + '<div style="font-family:Neucha,cursive;font-size:10px;color:#707050">' + a.desc + '</div></div>'
      + (done ? '<span style="margin-left:auto;color:#80ff80;font-size:14px">âœ“</span>' : '') + '</div>';
  });
  popup.style.display = 'block';
}

// Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ ÐºÐ»Ð¸ÐºÐµ Ð²Ð½Ðµ
document.addEventListener('click', e=>{
  const popup = document.getElementById('achieve-popup');
  const btn = document.getElementById('achieve-btn');
  if(popup && !popup.contains(e.target) && btn && !btn.contains(e.target)) {
    popup.style.display = 'none';
  }
  // Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ²ÐµÑÑ‚-Ð¿Ð°Ð½ÐµÐ»ÑŒ
  const qp = document.getElementById('quest-panel');
  const qb = document.getElementById('quest-btn');
  if(qp && qp.style.display !== 'none' && !qp.contains(e.target) && qb && !qb.contains(e.target)) {
    qp.style.display = 'none';
    questPanelOpen = false;
  }
});


// ============================================================
// ðŸŒŸ ÐžÐ¡ÐžÐ‘Ð«Ð• Ð Ð«Ð‘ÐÐ›ÐžÐ§ÐÐ«Ð• Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð¯
// ============================================================
const SPECIAL_EVENTS = [
  {id:'golden_hour',  name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ñ‡Ð°Ñ!',    icon:'ðŸŒ…', desc:'ÐœÐ¾Ð½ÐµÑ‚Ñ‹ x2 Ð½Ð° 60 ÑÐµÐº',      duration:60000, effect:'coins_x2'},
  {id:'fish_frenzy',  name:'Ð Ñ‹Ð±Ð½Ñ‹Ð¹ Ð±ÑƒÐ¼!',     icon:'ðŸ ', desc:'ÐšÐ»Ñ‘Ð² x3 Ð½Ð° 45 ÑÐµÐº',        duration:45000, effect:'bite_x3'},
  {id:'legend_moon',  name:'Ð›ÑƒÐ½Ð° Ð›ÐµÐ³ÐµÐ½Ð´!',    icon:'ðŸŒ•', desc:'Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹ 30 ÑÐµÐº',     duration:30000, effect:'legend_only'},
  {id:'xp_surge',     name:'XP Ð’ÑÐ¿Ñ‹ÑˆÐºÐ°!',     icon:'âš¡', desc:'XP x3 Ð½Ð° 60 ÑÐµÐº',          duration:60000, effect:'xp_x3'},
  {id:'coin_rain',    name:'Ð”Ð¾Ð¶Ð´ÑŒ Ð¼Ð¾Ð½ÐµÑ‚!',     icon:'ðŸ’°', desc:'+500 Ð¼Ð¾Ð½ÐµÑ‚ Ð±Ð¾Ð½ÑƒÑ!',         duration:0,     effect:'instant_coins'},
];

gs.activeEvent = null;
gs.eventEndTime = 0;

function triggerRandomEvent() {
  if(gs.activeEvent) return; // ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ ÑƒÐ¶Ðµ Ð¸Ð´Ñ‘Ñ‚
  const ev = SPECIAL_EVENTS[Math.floor(Math.random()*SPECIAL_EVENTS.length)];
  gs.activeEvent = ev.effect;
  gs.eventEndTime = Date.now() + ev.duration;

  if(ev.effect === 'instant_coins') {
    gs.coins += 500; updateCoins(); coinBurst(180,350);
    gs.activeEvent = null;
    showEventBanner(ev, 0);
    return;
  }
  showEventBanner(ev, ev.duration);
  setTimeout(()=>{
    gs.activeEvent = null;
    gs.eventEndTime = 0;
    hideEventBanner();
  }, ev.duration);
}

function showEventBanner(ev, dur) {
  let banner = document.getElementById('event-banner');
  if(!banner) {
    banner = document.createElement('div');
    banner.id = 'event-banner';
    banner.style.cssText = 'position:absolute;top:54px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,rgba(60,30,0,.95),rgba(100,60,0,.95));border:2px solid #f0c040;border-radius:12px;padding:6px 14px;font-family:Neucha,cursive;color:#f0d060;z-index:150;text-align:center;box-shadow:0 4px 16px rgba(200,140,0,.5);cursor:pointer;';
    banner.onclick = ()=> hideEventBanner();
    document.getElementById('fishing-screen').appendChild(banner);
  }
  const secs = Math.round(dur/1000);
  banner.innerHTML = '<div style="font-size:18px">' + ev.icon + '</div><div style="font-size:13px;font-weight:bold">' + ev.name + '</div><div style="font-size:10px;color:#c0a040">' + ev.desc + (dur>0?' ('+secs+'Ñ)':'') + '</div>';
  banner.style.display = 'block';
  if(dur > 0) setTimeout(()=>hideEventBanner(), dur);
}

function hideEventBanner() {
  const b = document.getElementById('event-banner');
  if(b) b.style.display='none';
}

// Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2-5 Ð¼Ð¸Ð½ÑƒÑ‚
function scheduleNextEvent() {
  const delay = 120000 + Math.random()*180000; // 2-5 Ð¼Ð¸Ð½
  setTimeout(()=>{
    triggerRandomEvent();
    scheduleNextEvent();
  }, delay);
}

// Ð£Ñ‡Ñ‘Ñ‚ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð² Ð³ÐµÐ¹Ð¼Ð¿Ð»ÐµÐµ
function getEventCoinMult()  { return gs.activeEvent==='coins_x2' ? 2 : 1; }
function getEventBiteMult()  { return gs.activeEvent==='bite_x3' ? 3 : 1; }
function getEventXPMult()    { return gs.activeEvent==='xp_x3' ? 3 : 1; }
function isLegendOnlyEvent() { return gs.activeEvent==='legend_only'; }



// Realtime listener â€” fires immediately when payment arrives, wherever seller is
let _kioskPayListener = false;
function startKioskPaymentListener() {
  if(_kioskPayListener) return;
  _kioskPayListener = true;
  fb.on(`kiosk_payments/${myPlayerId}/pending`, snap => {
    try {
      const amount = snap.exists() ? (snap.val() || 0) : 0;
      if(amount <= 0) return;
      gs.coins += amount;
      updateCoins();
      fb.set(`kiosk_payments/${myPlayerId}/pending`, 0).catch(()=>{});
      saveGame();
      showToast('ðŸ’° ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð° Ð² ÐºÐ¸Ð¾ÑÐºÐµ: +' + amount + 'ðŸª™!');
    } catch(e) {}
  });
}

async function enterKiosk() {
  const ok = await initFirebase();
  showGardenScene('kiosk');
  updatePlayerLocation('kiosk');
  renderKiosk();
  if(ok) {
    listenKioskMarket();
    startKioskPaymentListener();
  }
}

function leaveKiosk() {
  fadeScene(()=>{
    showGardenScene('road');
    document.getElementById('road-hint').textContent = 'Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ...';
    const walker = document.getElementById('walker');
    walker.style.bottom='580px'; walker.className='walker from-shop';
    updatePlayerLocation('garden-road');
    setTimeout(()=>{
      fadeScene(()=>{ showGardenScene('garden'); renderGardenPlots(); updatePlayerLocation('garden'); });
    }, 2100);
  });
}

function renderKiosk() {
  renderKioskSell();
  renderKioskMarket();
}

function renderKioskSell() {
  const sec = document.getElementById('kiosk-sell-section');
  sec.innerHTML = '';
  
  // Fish from inventory
  if(gs.inventory.length === 0 && SEEDS.every(s=>s.owned===0) && gs.pikaCatchCount === 0) {
    sec.innerHTML = '<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#6a5030;padding:8px;">ÐÐµÑ‚ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸</div>';
    return;
  }
  
  // List inventory fish
  const uniqueFish = {};
  gs.inventory.forEach((f,i)=>{
    if(!uniqueFish[f.name]) uniqueFish[f.name] = {f, count:0, idx:[]};
    uniqueFish[f.name].count++;
    uniqueFish[f.name].idx.push(i);
  });
  
  Object.values(uniqueFish).forEach(({f,count,idx})=>{
    const defaultPrice = calcPrice(f);
    const div = document.createElement('div');
    div.className='kiosk-my-listing';
    div.innerHTML=`
      <div class="kiosk-listing-icon">ðŸŸ</div>
      <div class="kiosk-listing-info">
        <div class="kiosk-listing-name">${f.name} Ã—${count}</div>
        <div class="kiosk-listing-price">ÐÐ²Ñ‚Ð¾-Ñ†ÐµÐ½Ð°: ${defaultPrice}ðŸª™</div>
      </div>
      <input class="kiosk-price-input" id="price-${f.name}" type="number" value="${defaultPrice}" min="1" max="99999"/>
      <button class="kiosk-listing-btn btn-list" onclick="listKioskItem('fish','${f.name}',${idx[0]})">ðŸ“¦ Ð’Ñ‹ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ</button>`;
    sec.appendChild(div);
  });
  
  // Seeds
  SEEDS.filter(s=>s.owned>0).forEach(s=>{
    const div = document.createElement('div');
    div.className='kiosk-my-listing';
    div.innerHTML=`
      <div class="kiosk-listing-icon">${s.bag}</div>
      <div class="kiosk-listing-info">
        <div class="kiosk-listing-name">${s.name} (ÑÐµÐ¼Ñ) Ã—${s.owned}</div>
        <div class="kiosk-listing-price">Ð Ñ‹Ð½Ð¾Ñ‡Ð½Ð°Ñ Ñ†ÐµÐ½Ð°: ${s.price}ðŸª™</div>
      </div>
      <input class="kiosk-price-input" id="price-seed-${s.id}" type="number" value="${s.price}" min="1" max="99999"/>
      <button class="kiosk-listing-btn btn-list" onclick="listKioskItem('seed','${s.id}',0)">ðŸ“¦ Ð’Ñ‹ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ</button>`;
    sec.appendChild(div);
  });
}

async function listKioskItem(type, id, invIdx) {
  const ok = await initFirebase();
  if(!ok) { showToast('âŒ ÐÐµÑ‚ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð°'); return; }
  
  let price, name, icon;
  if(type==='fish') {
    const priceInput = document.getElementById('price-'+id);
    price = parseInt(priceInput?.value)||10;
    const f = gs.inventory[invIdx]; if(!f) return;
    name = f.name; icon = 'ðŸŸ';
    gs.inventory.splice(invIdx, 1);
    saveGame();
  } else if(type==='seed') {
    const priceInput = document.getElementById('price-seed-'+id);
    price = parseInt(priceInput?.value)||10;
    const s = SEEDS.find(x=>x.id===id); if(!s||s.owned<=0) return;
    name = s.name+' (ÑÐµÐ¼Ñ)'; icon = s.bag;
    s.owned--;
    saveGame();
  }
  
  await fb.set(`kiosk/${myPlayerId}_${Date.now()}`, {
    sellerId: myPlayerId, sellerName: myPlayerName,
    type, id, price, name, icon, listedAt: Date.now()
  });
  showToast(`ðŸ“¦ ${name} Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½ Ð·Ð° ${price}ðŸª™!`);
  renderKiosk();
}

function listenKioskMarket() {
  fb.on('kiosk', snap=>{
    kioskListings = snap.val() || {};
    renderKioskMarket();
  });
}

function renderKioskMarket() {
  const list = document.getElementById('kiosk-market-list');
  if(!list) return;
  list.innerHTML = '';
  const entries = Object.entries(kioskListings);
  if(!entries.length) {
    list.innerHTML='<div style="font-family:\'Neucha\',cursive;font-size:12px;color:#6a5030;padding:8px;">Ð Ñ‹Ð½Ð¾Ðº Ð¿ÑƒÑÑ‚. Ð¡Ñ‚Ð°Ð½ÑŒ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð¾Ð¼!</div>';
    return;
  }
  entries.sort((a,b)=>a[1].listedAt-b[1].listedAt).forEach(([key,item])=>{
    const isOwn = item.sellerId === myPlayerId;
    const canBuy = gs.coins >= item.price;
    const div = document.createElement('div');
    div.className='kiosk-my-listing';
    div.innerHTML=`
      <div class="kiosk-listing-icon">${item.icon}</div>
      <div class="kiosk-listing-info">
        <div class="kiosk-listing-name">${item.name}</div>
        <div class="kiosk-listing-price">${isOwn?'Ð¢Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°Ñ‘ÑˆÑŒ':'ÐžÑ‚: '+item.sellerName} â€¢ ${item.price}ðŸª™</div>
      </div>
      ${isOwn
        ? `<button class="kiosk-listing-btn btn-cancel-listing" onclick="cancelKioskListing('${key}')">ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ</button>`
        : `<button class="kiosk-listing-btn btn-buy-listing" onclick="buyKioskListing('${key}')" ${canBuy?'':'style="opacity:.4"'}>${canBuy?'ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ':'ÐœÐ°Ð»Ð¾ ðŸª™'}</button>`
      }`;
    list.appendChild(div);
  });
}

async function buyKioskListing(key) {
  const item = kioskListings[key];
  if(!item) return;
  if(gs.coins < item.price) { showToast('âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¼Ð¾Ð½ÐµÑ‚!'); return; }
  const ok = await initFirebase();
  if(!ok) return;
  // Check still exists
  const snap = await fb.get(`kiosk/${key}`);
  if(!snap.exists()) { showToast('âŒ Ð¢Ð¾Ð²Ð°Ñ€ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¾Ð´Ð°Ð½!'); return; }
  gs.coins -= item.price;
  updateCoins();
  // Add to inventory if fish
  if(item.type === 'fish') {
    const f = FISH_DATA.find(x=>x.name===item.id||x.name===item.name);
    if(f) gs.inventory.push({...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)});
  } else if(item.type==='seed') {
    const s = SEEDS.find(x=>x.id===item.id);
    if(s) s.owned++;
  }
  await fb.rm(`kiosk/${key}`);
  // Give coins to seller via Firebase â€” listener on seller's side will pick this up instantly
  try {
    const payRef = fb.r(`kiosk_payments/${item.sellerId}/pending`);
    const paySnap = await window._fbGet(payRef);
    const cur = paySnap.exists() ? (paySnap.val() || 0) : 0;
    await window._fbSet(payRef, cur + item.price);
  } catch(e) { console.warn('Payment write failed', e); }
  showToast(`âœ… ÐšÑƒÐ¿Ð»ÐµÐ½Ð¾: ${item.name} Ð·Ð° ${item.price}ðŸª™!`);
  saveGame(); renderKiosk();
}

async function cancelKioskListing(key) {
  const item = kioskListings[key]; if(!item) return;
  const ok = await initFirebase(); if(!ok) return;
  await fb.rm(`kiosk/${key}`);
  // Return item
  if(item.type==='fish') {
    const f = FISH_DATA.find(x=>x.name===item.id||x.name===item.name);
    if(f) gs.inventory.push({...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)});
  } else if(item.type==='seed') {
    const s = SEEDS.find(x=>x.id===item.id);
    if(s) s.owned++;
  }
  showToast('ðŸ”™ Ð¢Ð¾Ð²Ð°Ñ€ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ñ‘Ð½!');
  saveGame(); renderKiosk();
}

// ============================================================
// ROD VISUAL â€” Change rod appearance on fishing screen
// ============================================================
const ROD_COLORS = {
  wood:       {color:'#8b5e2a', glow:'none'},
  bamboo:     {color:'#6a9030', glow:'0 0 8px rgba(100,160,40,.5)'},
  carbon:     {color:'#405868', glow:'0 0 8px rgba(60,100,120,.6)'},
  magic:      {color:'#9040c0', glow:'0 0 16px rgba(160,50,255,.8)'},
  golden:     {color:'#d4a020', glow:'0 0 20px rgba(255,200,30,.9)'},
  rubberduck: {color:'#f0d020', glow:'0 0 14px rgba(255,220,0,.7)'},
  crystal:    {color:'#a0e8ff', glow:'0 0 22px rgba(100,220,255,.9)'},
  thunder:    {color:'#f0f040', glow:'0 0 28px rgba(255,255,50,1.0)'},
  void:       {color:'#3010a0', glow:'0 0 30px rgba(80,0,200,.9)'},
  shark:      {color:'#40c8e0', glow:'0 0 35px rgba(0,200,230,1.0)'},
  meteor:     {color:'#ff6020', glow:'0 0 35px rgba(255,80,0,1.0)'},
  dragon:     {color:'#cc2200', glow:'0 0 40px rgba(220,30,0,1.0)'},
  poseidon:   {color:'#0060ff', glow:'0 0 45px rgba(0,100,255,1.0)'},
  quantum:    {color:'#ff00ff', glow:'0 0 50px rgba(255,0,255,1.0)'},
  celestial:  {color:'#ffffff', glow:'0 0 60px rgba(255,255,255,1.0)'},
  apocalypse: {color:'#ff0000', glow:'0 0 80px rgba(255,0,0,1.0)'},
  marble:     {color:'#c0b0e0', glow:'0 0 40px rgba(200,180,255,.9)'},
  ghost:      {color:'#80ffcc', glow:'0 0 30px rgba(80,255,180,.8)'},
  pharaoh:    {color:'#e8c020', glow:'0 0 50px rgba(255,200,0,1.0)'},
  neon:       {color:'#00ffcc', glow:'0 0 55px rgba(0,255,200,1.0)'},
  kraken:     {color:'#6020c0', glow:'0 0 60px rgba(120,0,220,1.0)'},
  time:       {color:'#c0e0ff', glow:'0 0 70px rgba(180,220,255,1.0)'},
};

// Ð Ð¸ÑÑƒÐµÐ¼ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ ÑƒÐ´Ð¾Ñ‡ÐºÑƒ Ð² Ð¸Ð³Ñ€Ðµ â€” ÐºÑ€Ð°ÑÐ¸Ð²Ð¾, ÐºÐ°Ðº Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ, Ð½Ð¾ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾
// SVG viewBox: ÑˆÐ¸Ñ€Ð¸Ð½Ð°=20, Ð²Ñ‹ÑÐ¾Ñ‚Ð°=400 (Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð½Ð° Ð²ÑÑŽ Ð²Ñ‹ÑÐ¾Ñ‚Ñƒ wrapper)
function makeIngameRodSVG(rod) {
  const RC = ROD_COLORS[rod.id] || ROD_COLORS.wood;
  const c = RC.color;
  const glow = RC.glow !== 'none' ? `filter:drop-shadow(0 0 8px ${c});` : '';

  // Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒ): Ñ‚ÐµÐ»Ð¾, ÐºÐ¾Ð»ÑŒÑ†Ð°, ÐºÐ°Ñ‚ÑƒÑˆÐºÐ°
  // x=10 â€” Ñ†ÐµÐ½Ñ‚Ñ€, y=0 Ð²ÐµÑ€Ñ… (ÐºÐ¾Ð½Ñ‡Ð¸Ðº), y=380 Ð½Ð¸Ð· (Ñ€ÑƒÑ‡ÐºÐ°)
  // ÐšÐ¾Ð»ÑŒÑ†Ð° Ð½Ð° y=60,120,180,240,300
  function rings(color, opacity=1) {
    return [60,120,180,240,300].map((y,i)=>{
      const w = 9 - i*1.2; // ÐºÐ¾Ð»ÑŒÑ†Ð° ÑÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ðº Ð²ÐµÑ€Ñ…Ñƒ
      return `<ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${color}" stroke-width="2" opacity="${opacity-(i*0.05)}"/>`;
    }).join('');
  }
  function reel(color, fill='rgba(0,0,0,.6)') {
    return `
      <ellipse cx="10" cy="345" rx="12" ry="8" fill="${fill}" stroke="${color}" stroke-width="2"/>
      <ellipse cx="10" cy="345" rx="7" ry="4.5" fill="${color}88" stroke="${color}" stroke-width="1"/>
      <ellipse cx="10" cy="345" rx="3" ry="2" fill="${color}"/>
      <line x1="10" y1="337" x2="10" y2="353" stroke="${color}44" stroke-width="1"/>
      <line x1="-2" y1="345" x2="22" y2="345" stroke="${color}44" stroke-width="1"/>`;
  }
  function handle(color) {
    return `<rect x="6" y="360" width="8" height="35" rx="4" fill="${color}aa" stroke="${color}" stroke-width="1.5"/>`;
  }

  // Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  const specials = {

    // Ð”Ð•Ð Ð•Ð’Ð•ÐÐ¡ÐšÐÐ¯ â€” ÑƒÐ·Ð»Ð¾Ð²Ð°Ñ‚Ð°Ñ Ð¿Ð°Ð»ÐºÐ°, Ð²Ð¸Ð´Ð½Ñ‹ ÑÑƒÑ‡ÐºÐ¸ Ð¸ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹, Ð²ÐµÑ€Ñ‘Ð²ÐºÐ° Ð²Ð¼ÐµÑÑ‚Ð¾ Ð»ÐµÑÐºÐ¸
    wood: `
      <defs><linearGradient id="wdGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3a1a05"/><stop offset="45%" stop-color="#8b5e2a"/><stop offset="100%" stop-color="#4a2808"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="2" fill="url(#wdGrad)" stroke="#5a3010" stroke-width="1"/>
      <!-- Ð¢Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ Ð¿Ð¾ Ð´ÐµÑ€ÐµÐ²Ñƒ -->
      <line x1="9" y1="20" x2="10" y2="80" stroke="#3a1808" stroke-width="1" opacity=".7"/>
      <line x1="11" y1="60" x2="10" y2="140" stroke="#4a2010" stroke-width="0.8" opacity=".5"/>
      <line x1="9" y1="160" x2="10.5" y2="220" stroke="#3a1808" stroke-width="0.7" opacity=".6"/>
      <!-- Ð¡ÑƒÑ‡ÐºÐ¸ (ÑƒÐ·Ð»Ñ‹ Ð´ÐµÑ€ÐµÐ²Ð°) -->
      <ellipse cx="9" cy="50" rx="3" ry="2" fill="#3a1808" stroke="#2a1005" stroke-width="0.5" opacity=".8"/>
      <ellipse cx="11" cy="150" rx="2.5" ry="1.8" fill="#3a1808" stroke="#2a1005" stroke-width="0.5" opacity=".7"/>
      <ellipse cx="9" cy="260" rx="3" ry="2" fill="#3a1808" stroke="#2a1005" stroke-width="0.5" opacity=".6"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ð¸Ð· Ð³Ñ€ÑƒÐ±Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²Ð¾Ð»Ð¾ÐºÐ¸ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#6a5020" stroke-width="3" opacity=".9"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#c8a060" stroke-width="1" opacity=".5"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð´ÐµÑ€ÐµÐ²ÑÐ½Ð½Ñ‹Ð¹ Ð±Ð°Ñ€Ð°Ð±Ð°Ð½ -->
      <ellipse cx="10" cy="345" rx="14" ry="9" fill="rgba(40,20,5,.9)" stroke="#7a4a18" stroke-width="2.5"/>
      <ellipse cx="10" cy="345" rx="8" ry="5" fill="#5a3010" stroke="#8b5e2a" stroke-width="1.5"/>
      <ellipse cx="10" cy="345" rx="3" ry="2" fill="#8b5e2a"/>
      <line x1="10" y1="336" x2="10" y2="354" stroke="#8b5e2a44" stroke-width="1"/>
      <line x1="-4" y1="345" x2="24" y2="345" stroke="#8b5e2a44" stroke-width="1"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ð¾Ð±Ð¼Ð¾Ñ‚Ð°Ð½Ð° Ð³Ñ€ÑƒÐ±Ð¾Ð¹ Ñ‚ÐºÐ°Ð½ÑŒÑŽ -->
      <rect x="5" y="358" width="10" height="37" rx="3" fill="#4a2808" stroke="#6a3808" stroke-width="1.5"/>
      <line x1="5" y1="362" x2="15" y2="362" stroke="#7a5020" stroke-width="1" opacity=".6"/>
      <line x1="5" y1="367" x2="15" y2="367" stroke="#7a5020" stroke-width="1" opacity=".6"/>
      <line x1="5" y1="372" x2="15" y2="372" stroke="#7a5020" stroke-width="1" opacity=".6"/>
      <line x1="5" y1="377" x2="15" y2="377" stroke="#7a5020" stroke-width="1" opacity=".5"/>
      <line x1="5" y1="382" x2="15" y2="382" stroke="#7a5020" stroke-width="1" opacity=".5"/>`,

    // Ð‘ÐÐœÐ‘Ð£ÐšÐžÐ’ÐÐ¯ â€” ÑÐ²Ð½Ñ‹Ðµ ÑƒÐ·Ð»Ñ‹ Ð±Ð°Ð¼Ð±ÑƒÐºÐ°, Ð¶Ð¸Ð²Ñ‹Ðµ Ð»Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ñ‚Ð¾Ñ€Ñ‡Ð°Ñ‚ Ð² ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹
    bamboo: `
      <defs><linearGradient id="bmGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3a6010"/><stop offset="50%" stop-color="#7ab030"/><stop offset="100%" stop-color="#3a6010"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#bmGrad)" stroke="#4a7020" stroke-width="0.8"/>
      <!-- ÐŸÑ€Ð¾Ð´Ð¾Ð»ÑŒÐ½Ñ‹Ðµ Ð²Ð¾Ð»Ð¾ÐºÐ½Ð° Ð±Ð°Ð¼Ð±ÑƒÐºÐ° -->
      <line x1="8.5" y1="0" x2="8.5" y2="360" stroke="#2a5010" stroke-width="0.6" opacity=".4"/>
      <line x1="11.5" y1="0" x2="11.5" y2="360" stroke="#2a5010" stroke-width="0.6" opacity=".3"/>
      <!-- Ð£Ð·Ð»Ñ‹ Ð±Ð°Ð¼Ð±ÑƒÐºÐ° â€” Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼Ñ‹Ñ‡ÐºÐ¸ -->
      ${[45,90,135,180,225,270,315].map(y=>`
        <rect x="5" y="${y-2}" width="10" height="4" rx="1" fill="#2a5010" stroke="#1a3808" stroke-width="0.5"/>
        <rect x="5.5" y="${y-1}" width="9" height="2" rx="0.5" fill="#4a8020" stroke="none" opacity=".5"/>
      `).join('')}
      <!-- Ð›Ð¸ÑÑ‚ÑŒÑ Ñ‚Ð¾Ñ€Ñ‡Ð°Ñ‚ Ð² ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ -->
      <path d="M13,30 Q22,22 24,32 Q18,33 13,30Z" fill="#5a9020" stroke="#3a7010" stroke-width="0.8"/>
      <line x1="13" y1="30" x2="21" y2="30" stroke="#2a6010" stroke-width="0.6"/>
      <path d="M5,80 Q-4,72 -6,82 Q0,83 5,80Z" fill="#6aaa20" stroke="#3a8010" stroke-width="0.8"/>
      <line x1="5" y1="80" x2="-3" y2="80" stroke="#2a6010" stroke-width="0.6"/>
      <path d="M13,160 Q20,150 22,160 Q17,162 13,160Z" fill="#5a9020" stroke="#3a7010" stroke-width="0.8"/>
      <path d="M5,240 Q-3,230 -5,240 Q0,243 5,240Z" fill="#6aaa20" stroke="#3a8010" stroke-width="0.8"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ð±Ð°Ð¼Ð±ÑƒÐºÐ¾Ð²Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#4a7020" stroke-width="2.5" opacity=".9"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="#8ac040" stroke-width="1" opacity=".6"/>
      `;}).join('')}
      ${reel('#6a9030','rgba(20,40,5,.8)')}${handle('#4a7020')}`,

    // ÐšÐÐ Ð‘ÐžÐÐžÐ’ÐÐ¯ â€” ÑÐµÑ‚Ñ‡Ð°Ñ‚Ð°Ñ Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ð° Ð²Ð¾Ð»Ð¾ÐºÐ¾Ð½, Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ LED-Ð´Ð¸ÑÐ¿Ð»ÐµÐ¹ Ð½Ð° Ñ€ÑƒÐºÐ¾ÑÑ‚ÐºÐµ
    carbon: `
      <defs>
        <linearGradient id="cbGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#10181e"/><stop offset="50%" stop-color="#405868"/><stop offset="100%" stop-color="#10181e"/></linearGradient>
        <pattern id="cfPat" x="0" y="0" width="4" height="4" patternUnits="userSpaceOnUse"><line x1="0" y1="4" x2="4" y2="0" stroke="rgba(80,140,180,.35)" stroke-width="0.8"/><line x1="-1" y1="1" x2="1" y2="-1" stroke="rgba(80,140,180,.35)" stroke-width="0.8"/><line x1="3" y1="5" x2="5" y2="3" stroke="rgba(80,140,180,.35)" stroke-width="0.8"/></pattern>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#cbGrad)"/>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#cfPat)" stroke="#304858" stroke-width="0.8"/>
      <!-- LED-Ð¿Ð¾Ð»Ð¾ÑÐºÐ° Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      <line x1="13.5" y1="0" x2="13.5" y2="340" stroke="rgba(0,180,255,.3)" stroke-width="1"/>
      <!-- ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð° (Ð·Ð°Ð¶Ð¸Ð¼Ñ‹) -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w+1}" ry="3.5" fill="rgba(30,50,70,.9)" stroke="#506878" stroke-width="1.5"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#80c0e0" stroke-width="1.5" opacity=".9"/>
        <ellipse cx="10" cy="${y}" rx="${w-3}" ry="1.3" fill="none" stroke="rgba(0,200,255,.4)" stroke-width="0.8"/>
      `;}).join('')}
      <!-- Ð”Ð¸ÑÐ¿Ð»ÐµÐ¹-Ð´Ð°Ñ‚Ñ‡Ð¸Ðº -->
      <rect x="3" y="290" width="14" height="9" rx="2" fill="#001828" stroke="#40a0c0" stroke-width="1.2"/>
      <rect x="4" y="291" width="12" height="7" rx="1" fill="#003050"/>
      <line x1="5" y1="294.5" x2="15" y2="294.5" stroke="rgba(0,180,255,.5)" stroke-width="0.7"/>
      <circle cx="12" cy="294.5" r="1.2" fill="#00ffff" opacity=".9"/>
      <line x1="5" y1="297" x2="9" y2="297" stroke="rgba(0,255,100,.4)" stroke-width="0.6"/>
      ${reel('#405868','rgba(5,15,25,.9)')}${handle('#304858')}`,

    // Ð’ÐžÐ›Ð¨Ð•Ð‘ÐÐÐ¯ â€” Ñ€ÑƒÐ½Ñ‹ ÑÐ²ÐµÑ‚ÑÑ‚ÑÑ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð°, Ð¿Ð»Ð°Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð·Ð²Ñ‘Ð·Ð´Ð¾Ñ‡ÐºÐ¸, ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð» Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ
    magic: `
      <defs>
        <linearGradient id="mgGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#2a0860"/><stop offset="50%" stop-color="#8030c0"/><stop offset="100%" stop-color="#2a0860"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#mgGrad)" stroke="#7030b0" stroke-width="0.8"/>
      <!-- Ð¡Ð²ÐµÑ‚ÑÑ‰Ð°ÑÑÑ Ð°ÑƒÑ€Ð° Ð²Ð¾ÐºÑ€ÑƒÐ³ Ñ‚ÐµÐ»Ð° -->
      <rect x="6" y="0" width="8" height="360" rx="3.5" fill="none" stroke="rgba(180,80,255,.2)" stroke-width="3"/>
      <!-- Ð ÑƒÐ½Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ -->
      <text x="10" y="35" text-anchor="middle" font-size="7" fill="rgba(200,120,255,.9)" font-family="serif">áš </text>
      <text x="10" y="90" text-anchor="middle" font-size="7" fill="rgba(220,150,255,.8)" font-family="serif">áš±</text>
      <text x="10" y="145" text-anchor="middle" font-size="7" fill="rgba(200,120,255,.9)" font-family="serif">áš¾</text>
      <text x="10" y="200" text-anchor="middle" font-size="7" fill="rgba(220,150,255,.8)" font-family="serif">á›</text>
      <text x="10" y="255" text-anchor="middle" font-size="7" fill="rgba(200,120,255,.9)" font-family="serif">áš·</text>
      <text x="10" y="310" text-anchor="middle" font-size="7" fill="rgba(220,150,255,.8)" font-family="serif">á›</text>
      <!-- ÐŸÐ»Ð°Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð¼Ð°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ -->
      <circle cx="3" cy="70" r="2" fill="rgba(200,100,255,.7)"/><circle cx="17" cy="110" r="1.5" fill="rgba(255,150,255,.6)"/>
      <circle cx="2" cy="190" r="1.5" fill="rgba(180,80,255,.7)"/><circle cx="18" cy="230" r="2" fill="rgba(220,130,255,.6)"/>
      <circle cx="3" cy="290" r="1.5" fill="rgba(200,100,255,.5)"/>
      <!-- Ð‘Ð¾Ð»ÑŒÑˆÐ¾Ð¹ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð» Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <polygon points="10,-2 14,8 10,16 6,8" fill="rgba(200,100,255,.75)" stroke="rgba(220,130,255,.9)" stroke-width="1.5"/>
      <polygon points="10,-2 14,8 10,6" fill="rgba(240,190,255,.85)"/>
      <circle cx="9" cy="2" r="1.8" fill="rgba(255,255,255,.8)"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ñ Ð¼Ð°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸ÐµÐ¼ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#c080ff" stroke-width="2" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w+2}" ry="4" fill="none" stroke="rgba(180,60,255,.25)" stroke-width="2"/>
      `;}).join('')}
      ${reel('#9040c0','rgba(30,5,70,.9)')}${handle('#5020a0')}`,

    // Ð—ÐžÐ›ÐžÐ¢ÐÐ¯ â€” Ð³Ñ€Ð°Ð²Ð¸Ñ€Ð¾Ð²ÐºÐ° Ñ€Ð¾Ð¼Ð±Ð°Ð¼Ð¸, Ð¼Ð¾Ð½ÐµÑ‚ÐºÐ¸ Ð²Ð¸ÑÑÑ‚ Ð½Ð° ÐºÐ¾Ð»ÑŒÑ†Ð°Ñ…, Ð·Ð¾Ð»Ð¾Ñ‚Ð°Ñ ÐºÐ¾Ñ€Ð¾Ð½Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ
    golden: `
      <defs>
        <linearGradient id="gdGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#806010"/><stop offset="30%" stop-color="#f0c030"/><stop offset="70%" stop-color="#d4a020"/><stop offset="100%" stop-color="#806010"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#gdGrad)" stroke="#c09010" stroke-width="1"/>
      <!-- Ð“Ñ€Ð°Ð²Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð½Ð° Ñ‚ÐµÐ»Ðµ â€” Ñ€Ð¾Ð¼Ð±Ñ‹ -->
      ${[30,60,90,120,150,180,210,240,270,300,330].map(y=>`
        <line x1="7" y1="${y}" x2="13" y2="${y+8}" stroke="#a07010" stroke-width="0.6" opacity=".5"/>
        <line x1="13" y1="${y}" x2="7" y2="${y+8}" stroke="#a07010" stroke-width="0.6" opacity=".5"/>
      `).join('')}
      <!-- ÐœÐ¾Ð½ÐµÑ‚ÐºÐ¸ Ð½Ð° ÐºÐ¾Ð»ÑŒÑ†Ð°Ñ… -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#d4a020" stroke-width="2.5" opacity=".9"/>
        <circle cx="${10+w+3}" cy="${y}" r="3.5" fill="#e8b830" stroke="#a07010" stroke-width="0.8" opacity=".85"/>
      `;}).join('')}
      <!-- ÐšÐ¾Ñ€Ð¾Ð½Ð° Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <rect x="5" y="-3" width="10" height="5" rx="1" fill="#d4a020" stroke="#c09010" stroke-width="0.8"/>
      <rect x="5" y="-7" width="2.5" height="5" rx="0.5" fill="#d4a020" stroke="#b08010" stroke-width="0.6"/>
      <rect x="8.75" y="-9" width="2.5" height="7" rx="0.5" fill="#ffe060" stroke="#b08010" stroke-width="0.6"/>
      <rect x="12.5" y="-7" width="2.5" height="5" rx="0.5" fill="#d4a020" stroke="#b08010" stroke-width="0.6"/>
      <circle cx="6.25" cy="-7" r="1" fill="#ff2020"/>
      <circle cx="10" cy="-9" r="1.2" fill="#ff4040"/>
      <circle cx="13.75" cy="-7" r="1" fill="#ff2020"/>
      <!-- Ð˜ÑÐºÑ€Ñ‹ Ð·Ð¾Ð»Ð¾Ñ‚Ð° Ñ€ÑÐ´Ð¾Ð¼ -->
      <circle cx="1" cy="50" r="2" fill="#ffe060" opacity=".6"/>
      <circle cx="19" cy="130" r="1.5" fill="#ffd040" opacity=".5"/>
      <circle cx="1" cy="210" r="1.5" fill="#ffe060" opacity=".5"/>
      ${reel('#d4a020','rgba(50,35,0,.9)')}${handle('#b08010')}`,

    // Ð Ð•Ð—Ð˜ÐÐžÐ’ÐÐ¯ Ð£Ð¢ÐšÐ â€” ÑƒÑ‚ÐºÐ° Ñ ÑˆÐµÐµÐ¹ ÑÐ¸Ð´Ð¸Ñ‚ Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸, ÑÑ€ÐºÐ¾-Ð¶Ñ‘Ð»Ñ‚Ð°Ñ
    rubberduck: `
      <rect x="7" y="0" width="6" height="360" rx="3" fill="#e8c820" stroke="#c0a010" stroke-width="1"/>
      <!-- Ð–Ñ‘Ð»Ñ‚Ñ‹Ðµ Ð¿Ð¾Ð»Ð¾ÑÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ -->
      <line x1="7" y1="0" x2="7" y2="360" stroke="#c0a010" stroke-width="1.2"/>
      <line x1="13" y1="0" x2="13" y2="360" stroke="#c0a010" stroke-width="1.2"/>
      <!-- Ð£Ð¢ÐšÐ Ð¡Ð˜Ð”Ð˜Ð¢ ÐÐÐ’Ð•Ð Ð¥Ð£ â€” Ñ‚ÐµÐ»Ð¾ -->
      <ellipse cx="10" cy="30" rx="11" ry="9" fill="#f0d820" stroke="#c0a010" stroke-width="1.5"/>
      <!-- Ð“Ð¾Ð»Ð¾Ð²Ð° -->
      <circle cx="10" cy="17" r="7" fill="#f0d820" stroke="#c0a010" stroke-width="1.5"/>
      <!-- Ð“Ð»Ð°Ð· -->
      <circle cx="12.5" cy="15.5" r="1.8" fill="#1a1008"/>
      <circle cx="13" cy="15" r="0.7" fill="white"/>
      <!-- ÐšÐ»ÑŽÐ² -->
      <path d="M14,17.5 Q18,15 17,19.5" stroke="#e05020" stroke-width="2" fill="#ff8030" stroke-linecap="round"/>
      <!-- ÐšÑ€Ñ‹Ð»Ñ‹ÑˆÐºÐ¾ -->
      <path d="M2,28 Q6,23 11,27" stroke="#c0a010" stroke-width="1.5" fill="rgba(240,200,10,.4)"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° (Ð¶Ñ‘Ð»Ñ‚Ñ‹Ðµ Ñ Ð¾Ñ€Ð°Ð½Ð¶ÐµÐ²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¾Ð¹) -->
      ${[75,135,195,255,315].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#d4a010" stroke-width="2.5" opacity=".9"/>
        <circle cx="${10-w-2}" cy="${y}" r="2.5" fill="#ff8020" stroke="#cc5010" stroke-width="0.7" opacity=".8"/>
      `;}).join('')}
      ${reel('#c0a010','rgba(60,50,0,.9)')}${handle('#b09000')}`,

    // ÐšÐ Ð˜Ð¡Ð¢ÐÐ›Ð¬ÐÐÐ¯ â€” Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ðµ Ñ‚ÐµÐ»Ð¾ Ñ Ð³Ñ€Ð°Ð½ÑÐ¼Ð¸ Ð¸ Ñ€Ð°Ð·Ð½Ð¾Ñ†Ð²ÐµÑ‚Ð½Ñ‹Ð¼Ð¸ Ð¾Ñ‚Ð±Ð»ÐµÑÐºÐ°Ð¼Ð¸ Ð²Ð½ÑƒÑ‚Ñ€Ð¸
    crystal: `
      <defs>
        <linearGradient id="crGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#60b0d888"/><stop offset="50%" stop-color="#b0ecff"/><stop offset="100%" stop-color="#60b0d888"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#crGrad)" stroke="${c}" stroke-width="1"/>
      <!-- Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ðµ Ð³Ñ€Ð°Ð½Ð¸ (Ð¼Ð½Ð¾Ð³Ð¾Ð³Ñ€Ð°Ð½Ð½Ð¸Ðº) -->
      <line x1="10" y1="0" x2="10" y2="360" stroke="rgba(255,255,255,.5)" stroke-width="0.8"/>
      <line x1="7" y1="0" x2="13" y2="60" stroke="rgba(255,255,255,.2)" stroke-width="0.6"/>
      <line x1="13" y1="60" x2="7" y2="120" stroke="rgba(255,255,255,.2)" stroke-width="0.6"/>
      <line x1="7" y1="120" x2="13" y2="180" stroke="rgba(255,255,255,.2)" stroke-width="0.6"/>
      <line x1="13" y1="180" x2="7" y2="240" stroke="rgba(255,255,255,.2)" stroke-width="0.6"/>
      <line x1="7" y1="240" x2="13" y2="300" stroke="rgba(255,255,255,.2)" stroke-width="0.6"/>
      <!-- Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ðµ Ð¾Ñ‚Ð±Ð»ÐµÑÐºÐ¸ ÑÐ±Ð¾ÐºÑƒ -->
      <line x1="3" y1="30" x2="6" y2="50" stroke="rgba(255,80,80,.7)" stroke-width="1.5"/>
      <line x1="3" y1="55" x2="6" y2="75" stroke="rgba(255,200,50,.6)" stroke-width="1.2"/>
      <line x1="3" y1="80" x2="6" y2="100" stroke="rgba(50,255,100,.6)" stroke-width="1.2"/>
      <line x1="3" y1="105" x2="6" y2="125" stroke="rgba(50,150,255,.6)" stroke-width="1.2"/>
      <line x1="3" y1="130" x2="6" y2="150" stroke="rgba(180,50,255,.6)" stroke-width="1.2"/>
      <!-- ÐšÑ€Ð¸ÑÑ‚Ð°Ð»Ð» ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <polygon points="10,-5 14.5,8 10,18 5.5,8" fill="rgba(180,240,255,.6)" stroke="${c}" stroke-width="1.5"/>
      <polygon points="10,-5 14.5,8 10,6" fill="rgba(220,250,255,.85)"/>
      <circle cx="9" cy="1" r="2" fill="rgba(255,255,255,.8)"/>
      <!-- Ð¡Ð½ÐµÐ¶Ð¸Ð½ÐºÐ¸-ÐºÐ¾Ð»ÑŒÑ†Ð° -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
        <circle cx="${10+w+2}" cy="${y}" r="1.5" fill="rgba(200,245,255,.7)" stroke="${c}" stroke-width="0.5"/>
        <circle cx="${10-w-2}" cy="${y}" r="1.5" fill="rgba(200,245,255,.7)" stroke="${c}" stroke-width="0.5"/>
      `;}).join('')}
      ${reel(c,'rgba(20,60,80,.85)')}${handle('#80c8e0')}`,

    // Ð“Ð ÐžÐœÐžÐ’ÐÐ¯ â€” Ð·Ð¸Ð³Ð·Ð°Ð³-Ð¼Ð¾Ð»Ð½Ð¸Ñ Ð²Ð´Ð¾Ð»ÑŒ Ð²ÑÐµÐ³Ð¾ Ñ‚ÐµÐ»Ð°, Ð¾Ð±Ð»Ð°ÐºÐ° Ð½Ð° ÐºÐ¾Ð»ÑŒÑ†Ð°Ñ…
    thunder: `
      <defs>
        <linearGradient id="thGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#606010"/><stop offset="50%" stop-color="#e8e030"/><stop offset="100%" stop-color="#606010"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#thGrad)" stroke="#c0b010" stroke-width="1"/>
      <!-- Ð‘ÐžÐ›Ð¬Ð¨ÐÐ¯ ÐœÐžÐ›ÐÐ˜Ð¯ Ð²Ð´Ð¾Ð»ÑŒ Ð²ÑÐµÐ¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ -->
      <polyline points="13,0 7,40 13,80 7,120 13,160 7,200 13,240 7,280 13,320 7,360" fill="none" stroke="#fffff0" stroke-width="2.5" opacity=".9"/>
      <polyline points="13,0 7,40 13,80 7,120 13,160 7,200 13,240 7,280 13,320 7,360" fill="none" stroke="#f8f040" stroke-width="1.2"/>
      <!-- Ð­Ð»ÐµÐºÑ‚Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÑƒÐ³Ð¸ (Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ) -->
      <line x1="-2" y1="30" x2="5" y2="30" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".8"/>
      <line x1="15" y1="70" x2="22" y2="70" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".7"/>
      <line x1="-2" y1="110" x2="5" y2="110" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".8"/>
      <line x1="15" y1="160" x2="22" y2="160" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".7"/>
      <line x1="-2" y1="200" x2="5" y2="200" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".6"/>
      <line x1="15" y1="250" x2="22" y2="250" stroke="${c}" stroke-width="1.5" stroke-dasharray="2,1.5" opacity=".6"/>
      <!-- Ð“Ñ€Ð¾Ð·Ð¾Ð²Ð°Ñ Ñ‚ÑƒÑ‡Ð° Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ -->
      <ellipse cx="10" cy="-8" rx="10" ry="6" fill="rgba(60,60,90,.95)" stroke="#8080a0" stroke-width="1"/>
      <ellipse cx="5" cy="-5" rx="6" ry="4" fill="rgba(60,60,90,.95)"/>
      <ellipse cx="15" cy="-5" rx="5" ry="3.5" fill="rgba(70,70,100,.9)"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¼Ð¾Ð»Ð½Ð¸ÐµÐ¾Ñ‚Ð²Ð¾Ð´Ñ‹ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(50,50,10,.8)" stroke="${c}" stroke-width="2.5" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="rgba(255,255,150,.5)" stroke-width="1"/>
      `;}).join('')}
      ${reel('#d0b010','rgba(40,40,0,.9)')}${handle('#b0a000')}`,

    // Ð‘Ð•Ð—Ð”ÐÐ â€” Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð¾ Ñ‡Ñ‘Ñ€Ð½Ð¾Ðµ Ñ‚ÐµÐ»Ð¾, Ð·Ð²Ñ‘Ð·Ð´Ñ‹ Ð·Ð°Ñ‚ÑÐ³Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð²Ð½ÑƒÑ‚Ñ€ÑŒ, ÐºÐ¾Ð»ÑŒÑ†Ð° Ð² Ð²Ð¸Ð´Ðµ Ð¾Ñ€Ð±Ð¸Ñ‚
    void: `
      <defs>
        <linearGradient id="vdGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#080020"/><stop offset="50%" stop-color="#200080"/><stop offset="100%" stop-color="#080020"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#vdGrad)" stroke="${c}" stroke-width="1"/>
      <!-- ÐŸÑ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ -->
      <line x1="7" y1="20" x2="13" y2="60" stroke="rgba(100,0,200,.5)" stroke-width="0.8"/>
      <line x1="13" y1="80" x2="7" y2="130" stroke="rgba(80,0,180,.4)" stroke-width="0.8"/>
      <line x1="7" y1="150" x2="13" y2="200" stroke="rgba(100,0,200,.5)" stroke-width="0.8"/>
      <line x1="13" y1="220" x2="7" y2="270" stroke="rgba(80,0,180,.4)" stroke-width="0.8"/>
      <!-- Ð—Ð²Ñ‘Ð·Ð´Ñ‹ Ð·Ð°Ñ‚ÑÐ³Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð² Ð§Ð” -->
      <circle cx="2" cy="40" r="1.2" fill="white" opacity=".5"/>
      <circle cx="18" cy="80" r="1" fill="white" opacity=".4"/>
      <circle cx="1" cy="150" r="1.5" fill="white" opacity=".5"/>
      <circle cx="19" cy="200" r="1" fill="white" opacity=".3"/>
      <circle cx="2" cy="270" r="1.2" fill="white" opacity=".4"/>
      <circle cx="18" cy="320" r="1" fill="white" opacity=".3"/>
      <!-- ÐœÐ¸Ð½Ð¸-Ñ‡Ñ‘Ñ€Ð½Ð°Ñ Ð´Ñ‹Ñ€Ð° Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ -->
      <circle cx="10" cy="5" r="9" fill="rgba(5,0,20,.98)" stroke="${c}" stroke-width="1.5"/>
      <circle cx="10" cy="5" r="5" fill="rgba(40,0,120,.6)" stroke="${c}" stroke-width="1"/>
      <circle cx="10" cy="5" r="2.5" fill="${c}" opacity=".8"/>
      <line x1="10" y1="-4" x2="10" y2="14" stroke="${c}" stroke-width="0.8" opacity=".5"/>
      <line x1="1" y1="5" x2="19" y2="5" stroke="${c}" stroke-width="0.8" opacity=".5"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¾Ñ€Ð±Ð¸Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w+3}" ry="4" fill="none" stroke="rgba(60,0,160,.4)" stroke-width="2"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.06}"/>
      `;}).join('')}
      ${reel(c,'rgba(5,0,30,.95)')}${handle('#150060')}`,

    shark: `
      <defs><linearGradient id="shGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#006070"/><stop offset="50%" stop-color="#40c8e0"/><stop offset="100%" stop-color="#006070"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#shGrad)" stroke="${c}" stroke-width="1"/>
      <!-- ÐŸÐ»Ð°Ð²Ð½Ð¸Ðº Ð°ÐºÑƒÐ»Ñ‹ ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <polygon points="10,-12 14,0 6,0" fill="#1a8aaa" stroke="${c}" stroke-width="1.5"/>
      <!-- Ð§ÐµÑˆÑƒÑ Ð°ÐºÑƒÐ»Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      ${[20,45,70,95,120,145,170,195,220,245,270,295,320].map(y=>`
        <path d="M7,${y} Q10,${y-7} 13,${y}" stroke="#1a8aaa" stroke-width="1" fill="rgba(26,138,170,.2)"/>
      `).join('')}
      <!-- Ð‘Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ð¿Ð»Ð°Ð²Ð½Ð¸ÐºÐ¸ -->
      <polygon points="3,80 -5,95 3,100" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <polygon points="17,80 25,95 17,100" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <polygon points="3,200 -5,215 3,220" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <polygon points="17,200 25,215 17,220" fill="#1a8aaa" stroke="${c}" stroke-width="1"/>
      <!-- Ð“Ð»Ð°Ð· Ð°ÐºÑƒÐ»Ñ‹ -->
      <circle cx="7" cy="50" r="3" fill="#001020" stroke="${c}" stroke-width="1"/>
      <circle cx="7.5" cy="49.5" r="1" fill="rgba(255,255,255,.4)"/>
      <!-- Ð—ÑƒÐ±Ð°ÑÑ‚Ð°Ñ Ð¿Ð°ÑÑ‚ÑŒ ÑÐ½Ð¸Ð·Ñƒ Ð°ÐºÑƒÐ»Ñ‹ -->
      <path d="M5,340 L7,345 L9,340 L11,345 L13,340 L15,345" stroke="white" stroke-width="1.5" fill="none" opacity=".8"/>
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(0,40,60,.7)" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
      `;}).join('')}
      ${reel(c,'rgba(0,30,50,.95)')}${handle('#006080')}`,

    flower: `
      <defs><linearGradient id="flGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#901060"/><stop offset="50%" stop-color="#ffb0e0"/><stop offset="100%" stop-color="#901060"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#flGrad)" stroke="${c}" stroke-width="1"/>
      <!-- Ð¦Ð’Ð•Ð¢Ð« Ð²Ð´Ð¾Ð»ÑŒ Ð²ÑÐµÐ¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (ÑÑ‚Ð¾ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ!) -->
      <!-- Ð¦Ð²ÐµÑ‚Ð¾Ðº 1 -->
      <circle cx="10" cy="25" r="7" fill="rgba(255,100,180,.5)" stroke="${c}" stroke-width="1"/>
      <circle cx="10" cy="19" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="16" cy="22" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="16" cy="28" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="10" cy="31" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="4" cy="28" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="4" cy="22" r="4" fill="rgba(255,100,180,.55)" stroke="${c}" stroke-width="0.8"/>
      <circle cx="10" cy="25" r="4" fill="#ffff80" stroke="#d0a000" stroke-width="1"/>
      <!-- Ð¦Ð²ÐµÑ‚Ð¾Ðº 2 -->
      <circle cx="10" cy="105" r="6" fill="rgba(255,130,200,.45)" stroke="rgba(255,150,220,.8)" stroke-width="0.8"/>
      <circle cx="10" cy="100" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="15.2" cy="102.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="15.2" cy="107.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="110" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="4.8" cy="107.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="4.8" cy="102.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="105" r="3" fill="#ffe060" stroke="#c09000" stroke-width="0.8"/>
      <!-- Ð¦Ð²ÐµÑ‚Ð¾Ðº 3 -->
      <circle cx="10" cy="195" r="7" fill="rgba(255,80,160,.4)" stroke="rgba(255,140,210,.8)" stroke-width="0.8"/>
      <circle cx="10" cy="189" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="16" cy="192" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="16" cy="198" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="201" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="4" cy="198" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="4" cy="192" r="4" fill="rgba(255,90,170,.5)" stroke="rgba(255,140,210,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="195" r="4" fill="#fff080" stroke="#c0a000" stroke-width="0.8"/>
      <!-- Ð¦Ð²ÐµÑ‚Ð¾Ðº 4 -->
      <circle cx="10" cy="285" r="6" fill="rgba(255,110,185,.4)" stroke="rgba(255,150,220,.7)" stroke-width="0.8"/>
      <circle cx="10" cy="280" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="15.2" cy="282.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="15.2" cy="287.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="290" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="4.8" cy="287.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="4.8" cy="282.5" r="3.5" fill="rgba(255,120,190,.5)" stroke="rgba(255,150,220,.7)" stroke-width="0.7"/>
      <circle cx="10" cy="285" r="3" fill="#ffe060" stroke="#c09000" stroke-width="0.8"/>
      <!-- Ð›Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¼ÐµÐ¶Ð´Ñƒ Ñ†Ð²ÐµÑ‚Ð°Ð¼Ð¸ -->
      <path d="M13,60 Q20,52 22,60 Q17,62 13,60Z" fill="#5a9020" stroke="#3a7010" stroke-width="0.7"/>
      <path d="M7,150 Q0,142 -2,150 Q3,153 7,150Z" fill="#6aaa20" stroke="#3a8010" stroke-width="0.7"/>
      <path d="M13,240 Q20,232 22,240 Q17,242 13,240Z" fill="#5a9020" stroke="#3a7010" stroke-width="0.7"/>
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
      `;}).join('')}
      ${reel(c,'rgba(80,15,50,.9)')}${handle('#c06090')}`,

    // ÐœÐ•Ð¢Ð•ÐžÐ Ð˜Ð¢ÐÐÐ¯ â€” Ñ€Ð°ÑÐºÐ°Ð»Ñ‘Ð½Ð½Ñ‹Ð¹ ÐºÐ°Ð¼ÐµÐ½ÑŒ Ñ ÐºÑ€Ð°Ñ‚ÐµÑ€Ð°Ð¼Ð¸ Ð¸ Ð¾Ð³Ð½ÐµÐ½Ð½Ñ‹Ð¼ ÑÐ»ÐµÐ´Ð¾Ð¼ ÑÐ²ÐµÑ€Ñ…Ñƒ
    meteor: `
      <defs><linearGradient id="mtGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#4a1005"/><stop offset="50%" stop-color="#c04018"/><stop offset="100%" stop-color="#4a1005"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#mtGrad)" stroke="#aa3010" stroke-width="1"/>
      <!-- Ð Ð°ÑÐºÐ°Ð»Ñ‘Ð½Ð½Ñ‹Ðµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹-Ð»Ð°Ð²Ð° Ð²Ð´Ð¾Ð»ÑŒ -->
      <path d="M8,0 Q10,40 8,80 Q10,120 8,160 Q10,200 8,240 Q10,280 8,320 Q10,350 8,360" fill="none" stroke="rgba(255,80,0,.5)" stroke-width="1.5"/>
      <path d="M12,0 Q10,50 12,100 Q10,150 12,200 Q10,250 12,300 Q10,340 12,360" fill="none" stroke="rgba(255,120,0,.4)" stroke-width="1"/>
      <!-- ÐšÑ€Ð°Ñ‚ÐµÑ€Ñ‹-Ð´Ñ‹Ñ€ÐºÐ¸ Ð½Ð° Ñ‚ÐµÐ»Ðµ -->
      <circle cx="9" cy="50" r="4" fill="rgba(0,0,0,.6)" stroke="rgba(255,80,0,.5)" stroke-width="0.8"/>
      <circle cx="9" cy="50" r="2" fill="rgba(255,60,0,.3)"/>
      <circle cx="11" cy="130" r="3" fill="rgba(0,0,0,.5)" stroke="rgba(255,100,0,.4)" stroke-width="0.7"/>
      <circle cx="9" cy="210" r="4" fill="rgba(0,0,0,.6)" stroke="rgba(255,80,0,.5)" stroke-width="0.8"/>
      <circle cx="11" cy="290" r="3" fill="rgba(0,0,0,.5)" stroke="rgba(255,100,0,.4)" stroke-width="0.7"/>
      <!-- ÐœÐµÑ‚ÐµÐ¾Ñ€Ð¸Ñ‚ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ â€” Ñ€Ð°ÑÐºÐ°Ð»Ñ‘Ð½Ð½Ñ‹Ð¹ Ð±ÑƒÐ»Ñ‹Ð¶Ð½Ð¸Ðº -->
      <ellipse cx="10" cy="8" rx="12" ry="12" fill="rgba(60,15,0,.92)" stroke="${c}" stroke-width="1.5"/>
      <circle cx="6" cy="5" r="4" fill="rgba(0,0,0,.5)" stroke="rgba(255,80,0,.5)" stroke-width="1"/>
      <circle cx="13" cy="10" r="3" fill="rgba(0,0,0,.4)" stroke="rgba(255,100,0,.4)" stroke-width="0.8"/>
      <path d="M4,4 L8,8 L4,12 L9,13" stroke="#ff6020" stroke-width="1.5" fill="none"/>
      <path d="M11,3 L14,7 L12,12" stroke="#ff8040" stroke-width="1.5" fill="none"/>
      <!-- ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ñ…Ð²Ð¾ÑÑ‚ -->
      <circle cx="-2" cy="-5" r="3" fill="#ff4000" opacity=".7"/>
      <circle cx="22" cy="-6" r="2" fill="#ffaa00" opacity=".6"/>
      <circle cx="-1" cy="3" r="1.5" fill="#ff6020" opacity=".5"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¼ÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ Ð¾Ð³Ð½Ñ‘Ð¼ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(50,15,0,.8)" stroke="${c}" stroke-width="2.5" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.3" fill="none" stroke="rgba(255,120,0,.4)" stroke-width="1"/>
      `;}).join('')}
      ${reel(c,'rgba(50,12,0,.95)')}${handle('#8a3010')}`,

    // Ð”Ð ÐÐšÐžÐÐ¬Ð¯ â€” Ñ‡ÐµÑˆÑƒÑ Ð´Ñ€Ð°ÐºÐ¾Ð½Ð° Ð²Ð´Ð¾Ð»ÑŒ Ð²ÑÐµÐ¹ Ð´Ð»Ð¸Ð½Ñ‹, Ñ…Ñ€ÐµÐ±ÐµÑ‚, Ñ‡ÐµÑ€ÐµÐ¿ Ñ Ð¾Ð³Ð½Ñ‘Ð¼ Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ
    dragon: `
      <defs><linearGradient id="drGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#400808"/><stop offset="50%" stop-color="#aa1800"/><stop offset="100%" stop-color="#400808"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#drGrad)" stroke="#881800" stroke-width="1"/>
      <!-- Ð§ÐµÑˆÑƒÑ Ð´Ñ€Ð°ÐºÐ¾Ð½Ð° Ñ Ð¾Ð±ÐµÐ¸Ñ… ÑÑ‚Ð¾Ñ€Ð¾Ð½ (Ð¼Ð½Ð¾Ð³Ð¾!) -->
      ${[15,30,45,60,75,90,105,120,135,150,165,180,195,210,225,240,255,270,285,300,315,330,345].map((y,i)=>`
        <path d="M${i%2===0?6:14},${y} Q${i%2===0?0:20},${y-6} ${i%2===0?2:18},${y+5}" fill="#801010" stroke="#aa1800" stroke-width="0.8"/>
      `).join('')}
      <!-- Ð¥Ñ€ÐµÐ±ÐµÑ‚-Ð³Ñ€ÐµÐ±ÐµÐ½ÑŒ Ð¿Ð¾ Ñ†ÐµÐ½Ñ‚Ñ€Ñƒ -->
      ${[20,40,60,80,100,120,140,160,180,200,220,240,260,280,300,320,340].map((y,i)=>`
        <polygon points="10,${y-7} 12,${y} 10,${y+1} 8,${y}" fill="#601010" stroke="#cc2000" stroke-width="0.6"/>
      `).join('')}
      <!-- Ð§ÐµÑ€ÐµÐ¿ Ð´Ñ€Ð°ÐºÐ¾Ð½Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <circle cx="10" cy="9" r="10" fill="rgba(50,0,0,.95)" stroke="#cc2200" stroke-width="2"/>
      <!-- Ð“Ð»Ð°Ð·Ð° Ñ‡ÐµÑ€ÐµÐ¿Ð° -->
      <ellipse cx="6.5" cy="7" rx="2.5" ry="3" fill="#ff0000" opacity=".9"/>
      <ellipse cx="13.5" cy="7" rx="2.5" ry="3" fill="#ff0000" opacity=".9"/>
      <ellipse cx="6.5" cy="7" rx="1.2" ry="1.5" fill="#111"/>
      <ellipse cx="13.5" cy="7" rx="1.2" ry="1.5" fill="#111"/>
      <!-- Ð—ÑƒÐ±Ñ‹ -->
      <path d="M5,14 L7,17 L9,14 L11,17 L13,14 L15,17" stroke="#cc4020" stroke-width="1" fill="none"/>
      <!-- ÐžÐ³Ð½ÐµÐ½Ð½Ð¾Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ Ð¸Ð· Ð¿Ð°ÑÑ‚Ð¸ -->
      <path d="M6,14 Q10,20 14,14" fill="rgba(255,80,0,.5)" stroke="rgba(255,120,0,.4)" stroke-width="0.5"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” ÐºÐ¾ÑÑ‚ÑÐ½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(40,0,0,.8)" stroke="#cc2200" stroke-width="2.5" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.3" fill="none" stroke="rgba(255,80,0,.4)" stroke-width="0.8"/>
      `;}).join('')}
      ${reel('#cc2200','rgba(35,0,0,.98)')}${handle('#700800')}`,

    // Ð¢Ð Ð•Ð—Ð£Ð‘Ð•Ð¦ ÐŸÐžÐ¡Ð•Ð™Ð”ÐžÐÐ â€” Ñ‚Ñ€ÐµÐ·ÑƒÐ±ÐµÑ† Ð²Ð¸Ð´ÐµÐ½ Ð² Ð²ÐµÑ€Ñ…Ð½ÐµÐ¹ Ñ‡Ð°ÑÑ‚Ð¸, Ð²Ð¾Ð»Ð½Ñ‹ Ð¸ Ð¿ÑƒÐ·Ñ‹Ñ€Ð¸ Ð²Ð´Ð¾Ð»ÑŒ
    poseidon: `
      <defs><linearGradient id="pdGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#001a60"/><stop offset="50%" stop-color="#0055e0"/><stop offset="100%" stop-color="#001a60"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#pdGrad)" stroke="#0048cc" stroke-width="1"/>
      <!-- Ð’Ð¾Ð»Ð½Ð¸ÑÑ‚Ð°Ñ Ñ‚ÐµÐºÑÑ‚ÑƒÑ€Ð° Ð²Ð¾Ð´Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ -->
      <path d="M7,30 Q9,26 11,30 Q13,34 7,38 Q9,34 11,38" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="1"/>
      <path d="M7,80 Q9,76 11,80 Q13,84 7,88 Q9,84 11,88" fill="none" stroke="rgba(80,160,255,.35)" stroke-width="1"/>
      <path d="M7,130 Q9,126 11,130 Q13,134 7,138 Q9,134 11,138" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="1"/>
      <path d="M7,180 Q9,176 11,180 Q13,184 7,188 Q9,184 11,188" fill="none" stroke="rgba(80,160,255,.35)" stroke-width="1"/>
      <path d="M7,230 Q9,226 11,230 Q13,234 7,238 Q9,234 11,238" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="1"/>
      <path d="M7,280 Q9,276 11,280 Q13,284 7,288 Q9,284 11,288" fill="none" stroke="rgba(80,160,255,.35)" stroke-width="1"/>
      <path d="M7,330 Q9,326 11,330 Q13,334 7,338 Q9,334 11,338" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="1"/>
      <!-- ÐŸÑƒÐ·Ñ‹Ñ€Ð¸ Ð²Ð¾Ð·Ð´ÑƒÑ…Ð° -->
      <circle cx="4" cy="60" r="2" fill="none" stroke="rgba(150,210,255,.6)" stroke-width="1"/>
      <circle cx="16" cy="110" r="1.5" fill="none" stroke="rgba(130,200,255,.5)" stroke-width="0.8"/>
      <circle cx="3" cy="180" r="2.5" fill="none" stroke="rgba(150,210,255,.6)" stroke-width="1"/>
      <circle cx="17" cy="250" r="1.5" fill="none" stroke="rgba(130,200,255,.5)" stroke-width="0.8"/>
      <circle cx="4" cy="320" r="2" fill="none" stroke="rgba(150,210,255,.6)" stroke-width="1"/>
      <!-- Ð¢Ð Ð•Ð—Ð£Ð‘Ð•Ð¦ Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ (Ñ‚Ñ€Ð¸ Ð·ÑƒÐ±Ñ†Ð°) -->
      <line x1="10" y1="0" x2="10" y2="25" stroke="${c}" stroke-width="4" stroke-linecap="round"/>
      <line x1="10" y1="0" x2="10" y2="25" stroke="rgba(150,200,255,.4)" stroke-width="2"/>
      <!-- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·ÑƒÐ±ÐµÑ† -->
      <line x1="10" y1="-12" x2="10" y2="8" stroke="${c}" stroke-width="3.5" stroke-linecap="round"/>
      <polygon points="10,-16 8,-8 12,-8" fill="${c}" stroke="#0030a0" stroke-width="1"/>
      <!-- Ð‘Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ð·ÑƒÐ±Ñ†Ñ‹ -->
      <line x1="4" y1="-8" x2="4" y2="8" stroke="${c}" stroke-width="3" stroke-linecap="round"/>
      <polygon points="4,-12 2,-5 6,-5" fill="${c}" stroke="#0030a0" stroke-width="1"/>
      <line x1="16" y1="-8" x2="16" y2="8" stroke="${c}" stroke-width="3" stroke-linecap="round"/>
      <polygon points="16,-12 14,-5 18,-5" fill="${c}" stroke="#0030a0" stroke-width="1"/>
      <!-- ÐŸÐµÑ€ÐµÐºÐ»Ð°Ð´Ð¸Ð½Ð° -->
      <line x1="4" y1="8" x2="16" y2="8" stroke="${c}" stroke-width="2.5"/>
      <circle cx="4" cy="8" r="2.5" fill="${c}"/><circle cx="16" cy="8" r="2.5" fill="${c}"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ñ Ð²Ð¾Ð»Ð½Ð°Ð¼Ð¸ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(0,20,70,.8)" stroke="${c}" stroke-width="2.5" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.2" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="0.8"/>
      `;}).join('')}
      ${reel(c,'rgba(0,15,65,.95)')}${handle('#003090')}`,

    // ÐšÐ’ÐÐÐ¢ÐžÐ’ÐÐ¯ â€” Ñ‚Ñ€Ð¾Ð¹Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° (Ñ‚Ñ€Ð¸ Ð¿Ñ€Ð¸Ð·Ñ€Ð°ÐºÐ° Ð½Ð°Ð»Ð¾Ð¶ÐµÐ½Ñ‹), Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð½Ñ‹Ðµ Ð¾Ð±Ð»Ð°ÐºÐ°
    quantum: `
      <defs><linearGradient id="qtGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#500050"/><stop offset="50%" stop-color="#dd00dd"/><stop offset="100%" stop-color="#500050"/></linearGradient></defs>
      <!-- Ð¢Ñ€Ð¸ Ð½Ð°Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ñ… ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ) -->
      <rect x="8.5" y="0" width="4" height="360" rx="2" fill="#00ffff33" stroke="#00ffff" stroke-width="0.8" opacity=".6"/>
      <rect x="6.5" y="0" width="4" height="360" rx="2" fill="#ff00ff33" stroke="#ff00ff" stroke-width="0.8" opacity=".5"/>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#qtGrad)" stroke="${c}" stroke-width="1"/>
      <!-- ÐšÐ²Ð°Ð½Ñ‚Ð¾Ð²Ñ‹Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð° (ÑÐ´Ð²Ð¸Ð½ÑƒÑ‚Ñ‹Ðµ) -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="9" cy="${y-1}" rx="${w}" ry="2.5" fill="none" stroke="#ff00ff" stroke-width="1.5" opacity=".6"/>
        <ellipse cx="11" cy="${y+1}" rx="${w}" ry="2.5" fill="none" stroke="#00ffff" stroke-width="1.2" opacity=".5"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(80,0,80,.5)" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
      `;}).join('')}
      <!-- Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð½Ñ‹Ðµ Ð¾Ð±Ð»Ð°ÐºÐ° Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <circle cx="10" cy="10" r="9" fill="none" stroke="${c}" stroke-width="1.5"/>
      <circle cx="11" cy="9" r="9" fill="none" stroke="#ff00ff" stroke-width="1" opacity=".5"/>
      <circle cx="9" cy="11" r="9" fill="none" stroke="#00ffff" stroke-width="1" opacity=".4"/>
      <circle cx="10" cy="10" r="5" fill="rgba(200,0,200,.35)" stroke="${c}" stroke-width="1"/>
      <circle cx="10" cy="10" r="2.5" fill="${c}" opacity=".9"/>
      <!-- Ð Ð°Ð·Ð¼Ñ‹Ñ‚Ñ‹Ðµ ÐºÐ¾Ð¿Ð¸Ð¸ ÑˆÐ°Ñ€Ð° -->
      <circle cx="13" cy="8" r="3" fill="rgba(255,0,255,.2)"/>
      <circle cx="7" cy="12" r="3" fill="rgba(0,255,255,.15)"/>
      <!-- Ð Ð°Ð·Ñ€Ñ‹Ð²Ñ‹ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ -->
      <path d="M-3,80 L5,95 L1,108" stroke="#ff00ff" stroke-width="1.2" fill="none" opacity=".6"/>
      <path d="M23,180 L15,195 L19,208" stroke="#00ffff" stroke-width="1" fill="none" opacity=".5"/>
      <path d="M-2,270 L6,285 L2,298" stroke="#ff00ff" stroke-width="1.2" fill="none" opacity=".6"/>
      ${reel(c,'rgba(50,0,60,.95)')}${handle('#800080')}`,

    // ÐÐ•Ð‘Ð•Ð¡ÐÐÐ¯ â€” Ð¾ÑÐ»ÐµÐ¿Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð±ÐµÐ»Ð°Ñ, Ð°Ð½Ð³ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð¿ÐµÑ€ÑŒÑ Ð²Ð´Ð¾Ð»ÑŒ, Ð½Ð¸Ð¼Ð± Ð¸ ÐºÑ€Ñ‹Ð»ÑŒÑ ÑÐ²ÐµÑ€Ñ…Ñƒ
    celestial: `
      <defs><linearGradient id="clGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#8090c0"/><stop offset="50%" stop-color="#ffffff"/><stop offset="100%" stop-color="#8090c0"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#clGrad)" stroke="rgba(200,220,255,.8)" stroke-width="1"/>
      <!-- ÐŸÐµÑ€ÑŒÑ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      ${[20,60,100,140,180,220,260,300,340].map((y,i)=>`
        <path d="M${i%2===0?6:14},${y} Q${i%2===0?-2:22},${y-4} ${i%2===0?0:20},${y+8} Q${i%2===0?4:16},${y+4} ${i%2===0?6:14},${y}Z" fill="rgba(240,245,255,.7)" stroke="rgba(180,200,255,.5)" stroke-width="0.7"/>
        <line x1="${i%2===0?6:14}" y1="${y}" x2="${i%2===0?1:19}" y2="${y+4}" stroke="rgba(200,220,255,.4)" stroke-width="0.5"/>
      `).join('')}
      <!-- ÐÐ¸Ð¼Ð± + ÐºÑ€Ñ‹Ð»ÑŒÑ ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <ellipse cx="10" cy="-5" rx="12" ry="4" fill="none" stroke="#ffd700" stroke-width="2.5" opacity=".9"/>
      <ellipse cx="10" cy="-5" rx="15" ry="5" fill="none" stroke="rgba(255,220,100,.4)" stroke-width="1.5"/>
      <!-- ÐšÑ€Ñ‹Ð»ÑŒÑ -->
      <path d="M4,5 Q-8,2 -10,12 Q-5,10 4,15Z" fill="rgba(240,245,255,.7)" stroke="rgba(200,220,255,.6)" stroke-width="0.8"/>
      <path d="M16,5 Q28,2 30,12 Q25,10 16,15Z" fill="rgba(240,245,255,.7)" stroke="rgba(200,220,255,.6)" stroke-width="0.8"/>
      <!-- Ð›ÑƒÑ‡Ð¸ ÑÐ²ÐµÑ‚Ð° -->
      <line x1="10" y1="-14" x2="10" y2="-10" stroke="#ffd700" stroke-width="2" opacity=".8"/>
      ${[0,40,80,120,160,200,240,280,320].map(a=>`
        <line x1="${10+12*Math.cos(a*Math.PI/180)}" y1="${-5+5*Math.sin(a*Math.PI/180)}" x2="${10+18*Math.cos(a*Math.PI/180)}" y2="${-5+7.5*Math.sin(a*Math.PI/180)}" stroke="rgba(255,240,180,.4)" stroke-width="0.8"/>
      `).join('')}
      <!-- Ð—Ð²Ñ‘Ð·Ð´Ð¾Ñ‡ÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ -->
      <circle cx="3" cy="50" r="1.5" fill="#ffffd0" opacity=".8"/>
      <circle cx="17" cy="100" r="1.2" fill="#ffffd0" opacity=".7"/>
      <circle cx="3" cy="180" r="1.5" fill="#ffffd0" opacity=".8"/>
      <circle cx="17" cy="250" r="1.2" fill="#ffffd0" opacity=".7"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” ÑÐ¸ÑÑŽÑ‰Ð¸Ðµ Ð±ÐµÐ»Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w+3}" ry="4.5" fill="none" stroke="rgba(255,255,255,.2)" stroke-width="2"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(200,220,255,.2)" stroke="white" stroke-width="2.5" opacity="${0.95-i*0.05}"/>
      `;}).join('')}
      ${reel('white','rgba(160,190,255,.25)')}${handle('#b0c8ff')}`,

    // ÐÐŸÐžÐšÐÐ›Ð˜ÐŸÐ¡Ð˜Ð¡ â€” Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ñ€Ð°Ð·Ð¾Ñ€Ð²Ð°Ð½Ð°, ÐºÑ€Ð¾Ð²Ð°Ð²Ñ‹Ðµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹, Ð³Ð»Ð°Ð· Ñ…Ð°Ð¾ÑÐ° Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ
    apocalypse: `
      <!-- Ð¤Ð¾Ð½ Ñ€Ð°Ð·Ð¾Ñ€Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð° -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="#cc000099" stroke="#ff0000" stroke-width="1.5"/>
      <rect x="5" y="0" width="10" height="360" rx="4" fill="none" stroke="rgba(255,255,255,.15)" stroke-width="1.5"/>
      <!-- Ð¢Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ (Ð¼Ð½Ð¾Ð³Ð¾, Ñ…Ð°Ð¾Ñ‚Ð¸Ñ‡Ð½Ð¾) -->
      <path d="M0,0 L7,20 L3,35 L10,28 L15,45 L8,55" stroke="#ff0000" stroke-width="2" fill="none"/>
      <path d="M20,10 L12,30 L18,40 L10,52 L16,65" stroke="#ff3000" stroke-width="1.5" fill="none" opacity=".8"/>
      <path d="M1,80 L8,95 L4,110 L12,105 L6,125" stroke="#ff0000" stroke-width="2" fill="none"/>
      <path d="M19,90 L13,108 L17,122 L9,118 L15,138" stroke="#ff2000" stroke-width="1.5" fill="none" opacity=".8"/>
      <path d="M0,160 L8,178 L3,192 L11,186 L5,206" stroke="#ff0000" stroke-width="2" fill="none"/>
      <path d="M20,170 L12,190 L18,204 L8,198 L15,218" stroke="#ff3000" stroke-width="1.5" fill="none" opacity=".8"/>
      <path d="M1,240 L9,258 L4,272 L12,268 L6,288" stroke="#ff0000" stroke-width="2" fill="none"/>
      <path d="M19,250 L11,270 L17,285 L8,280 L14,300" stroke="#ff2000" stroke-width="1.5" fill="none" opacity=".8"/>
      <path d="M2,320 L10,338 L5,350 L13,345 L7,360" stroke="#ff0000" stroke-width="2" fill="none"/>
      <!-- Ð“Ð»Ð°Ð· Ñ…Ð°Ð¾ÑÐ° Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ (Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹) -->
      <ellipse cx="10" cy="180" rx="9" ry="5.5" fill="rgba(0,0,0,.95)" stroke="#ff0000" stroke-width="2"/>
      <ellipse cx="10" cy="180" rx="5" ry="3.5" fill="#ff0000"/>
      <ellipse cx="10" cy="180" rx="2.5" ry="2" fill="#ffffff" opacity=".9"/>
      <ellipse cx="10" cy="180" rx="1" ry="0.8" fill="#000000"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ð²Ð·Ñ€Ñ‹Ð²Ð° Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð³Ð»Ð°Ð·Ð° -->
      <ellipse cx="10" cy="180" rx="13" ry="8" fill="none" stroke="#ff4000" stroke-width="1" opacity=".6"/>
      <ellipse cx="10" cy="180" rx="18" ry="12" fill="none" stroke="#ff6000" stroke-width="0.7" opacity=".4"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ñ€Ð°Ð·Ð¾Ñ€Ð²Ð°Ð½Ð½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(60,0,0,.8)" stroke="#ff0000" stroke-width="2.5" opacity="${0.9-i*0.05}" stroke-dasharray="${y===180?'1,0':'5,3'}"/>
      `;}).join('')}
      ${reel('#ff0000','rgba(35,0,0,.98)')}${handle('#700000')}`,

    // ÐœÐ•Ð¥ â€” Ð¼ÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐºÐ¾Ñ€Ð¿ÑƒÑ Ñ ÑˆÐµÑÑ‚ÐµÑ€Ñ‘Ð½ÐºÐ°Ð¼Ð¸, Ð¿Ð¾Ñ€ÑˆÐ½ÑÐ¼Ð¸, ÑÐºÑ€Ð°Ð½Ð¾Ð¼ Ð˜Ð˜
    mech: `
      <defs><linearGradient id="mcGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#102838"/><stop offset="50%" stop-color="#60b0d0"/><stop offset="100%" stop-color="#102838"/></linearGradient></defs>
      <!-- ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐºÐ¾Ñ€Ð¿ÑƒÑ Ñ Ñ€Ð¸Ñ„Ð»ÐµÐ½Ð¸ÐµÐ¼ -->
      <rect x="7" y="0" width="6" height="360" rx="2" fill="url(#mcGrad)" stroke="#407090" stroke-width="1"/>
      <rect x="6.5" y="0" width="1" height="360" fill="rgba(0,0,0,.3)"/>
      <rect x="12.5" y="0" width="1" height="360" fill="rgba(255,255,255,.1)"/>
      <!-- Ð¨ÐµÑÑ‚ÐµÑ€Ñ‘Ð½ÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      ${[30,100,170,240,310].map((y,i)=>`
        <circle cx="${i%2===0?3:17}" cy="${y}" r="7" fill="rgba(20,60,80,.9)" stroke="${c}" stroke-width="1.2"/>
        <circle cx="${i%2===0?3:17}" cy="${y}" r="4" fill="rgba(30,90,110,.8)" stroke="${c}88" stroke-width="0.8"/>
        <circle cx="${i%2===0?3:17}" cy="${y}" r="1.5" fill="${c}"/>
        <line x1="${i%2===0?3:17}" y1="${y-7}" x2="${i%2===0?3:17}" y2="${y-5}" stroke="${c}" stroke-width="1.5"/>
        <line x1="${i%2===0?3:17}" y1="${y+5}" x2="${i%2===0?3:17}" y2="${y+7}" stroke="${c}" stroke-width="1.5"/>
        <line x1="${i%2===0?-4:10}" y1="${y}" x2="${i%2===0?-2:12}" y2="${y}" stroke="${c}" stroke-width="1.5"/>
        <line x1="${i%2===0?4:18}" y1="${y}" x2="${i%2===0?6:20}" y2="${y}" stroke="${c}" stroke-width="1.5"/>
      `).join('')}
      <!-- Ð˜Ð˜-ÑÐºÑ€Ð°Ð½ Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ -->
      <rect x="3" y="0" width="14" height="22" rx="2" fill="rgba(5,20,35,.95)" stroke="${c}" stroke-width="1.5"/>
      <rect x="4" y="1" width="12" height="20" rx="1.5" fill="rgba(0,30,50,.9)"/>
      <line x1="5" y1="7" x2="15" y2="7" stroke="${c}" stroke-width="0.8" opacity=".7"/>
      <line x1="5" y1="11" x2="13" y2="11" stroke="${c}" stroke-width="0.8" opacity=".6"/>
      <line x1="5" y1="15" x2="11" y2="15" stroke="${c}" stroke-width="0.8" opacity=".5"/>
      <circle cx="13" cy="11" r="1.5" fill="${c}" opacity=".9"/>
      <circle cx="12" cy="15" r="1" fill="rgba(0,255,150,.7)"/>
      <!-- ÐŸÐ¾Ñ€ÑˆÐ½Ð¸ Ð½Ð° ÐºÐ¾Ð»ÑŒÑ†Ð°Ñ… -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <rect x="${10-w-2}" y="${y-3}" width="4" height="6" rx="1" fill="rgba(20,60,80,.8)" stroke="${c}" stroke-width="1"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(15,50,70,.8)" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="rgba(0,220,255,.4)" stroke-width="0.8"/>
      `;}).join('')}
      ${reel(c,'rgba(10,35,50,.95)')}${handle('#254555')}`,

    // ÐšÐžÐ¡ÐœÐ˜Ð§Ð•Ð¡ÐšÐÐ¯ â€” Ð³Ð°Ð»Ð°ÐºÑ‚Ð¸ÐºÐ° Ð²Ð½ÑƒÑ‚Ñ€Ð¸, Ð·Ð²Ñ‘Ð·Ð´Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ, Ð¿Ð»Ð°Ð½ÐµÑ‚Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ
    cosmic: `
      <defs>
        <linearGradient id="csGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#180830"/><stop offset="50%" stop-color="#6020c0"/><stop offset="100%" stop-color="#180830"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#csGrad)" stroke="${c}" stroke-width="1"/>
      <!-- Ð—Ð²Ñ‘Ð·Ð´Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° (Ð¸Ð·Ð¾Ð³Ð½ÑƒÑ‚Ñ‹Ð¹) -->
      <path d="M10,0 Q5,60 10,120 Q15,180 10,240 Q5,300 10,360" fill="none" stroke="rgba(255,255,255,.15)" stroke-width="3"/>
      <!-- Ð—Ð²Ñ‘Ð·Ð´Ñ‹ Ñ€Ð°Ð·Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° -->
      <circle cx="5" cy="20" r="1.2" fill="white" opacity=".8"/>
      <circle cx="15" cy="45" r="0.8" fill="white" opacity=".6"/>
      <circle cx="4" cy="75" r="1.5" fill="white" opacity=".7"/>
      <circle cx="16" cy="100" r="1" fill="white" opacity=".6"/>
      <circle cx="5" cy="135" r="1.2" fill="white" opacity=".7"/>
      <circle cx="15" cy="165" r="0.8" fill="white" opacity=".5"/>
      <circle cx="4" cy="200" r="1.5" fill="white" opacity=".8"/>
      <circle cx="16" cy="230" r="1" fill="white" opacity=".6"/>
      <circle cx="5" cy="265" r="1.2" fill="white" opacity=".7"/>
      <circle cx="15" cy="295" r="1.5" fill="white" opacity=".5"/>
      <circle cx="4" cy="330" r="1" fill="white" opacity=".6"/>
      <!-- ÐŸÐ»Ð°Ð½ÐµÑ‚Ð° Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <circle cx="10" cy="6" r="10" fill="rgba(60,0,120,.85)" stroke="${c}" stroke-width="1.5"/>
      <ellipse cx="10" cy="6" rx="14" ry="4" fill="none" stroke="${c}" stroke-width="1.2" opacity=".8"/>
      <ellipse cx="10" cy="6" rx="18" ry="5" fill="none" stroke="rgba(180,80,255,.3)" stroke-width="1.5"/>
      <circle cx="7" cy="4" r="3" fill="rgba(120,40,200,.6)"/>
      <circle cx="12" cy="8" r="2" fill="rgba(100,30,180,.5)"/>
      <circle cx="9" cy="2" r="2.5" fill="rgba(200,150,255,.4)"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¾Ñ€Ð±Ð¸Ñ‚Ñ‹ Ð¿Ð»Ð°Ð½ÐµÑ‚ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w+4}" ry="5" fill="none" stroke="rgba(150,50,255,.2)" stroke-width="1.5"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${c}" stroke-width="2" opacity="${0.9-i*0.05}"/>
        <circle cx="${10+w+2}" cy="${y}" r="2" fill="rgba(150,80,255,.6)" stroke="${c}" stroke-width="0.5"/>
      `;}).join('')}
      ${reel(c,'rgba(25,5,55,.95)')}${handle('#4a1090')}`,

    // Ð”Ð•ÐœÐžÐÐ˜Ð§Ð•Ð¡ÐšÐÐ¯ â€” Ñ‚Ñ‘Ð¼Ð½Ð¾-ÐºÑ€Ð°ÑÐ½Ð°Ñ, ÐºÑ€Ð¾Ð²Ð°Ð²Ñ‹Ðµ ÐºÐ°Ð¿Ð»Ð¸ ÑÑ‚ÐµÐºÐ°ÑŽÑ‚, Ñ€Ð¾Ð³Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ, Ð°Ð´ÑÐºÐ¾Ðµ Ð¿Ð»Ð°Ð¼Ñ
    demonic: `
      <defs><linearGradient id="dmGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#300008"/><stop offset="50%" stop-color="#cc0018"/><stop offset="100%" stop-color="#300008"/></linearGradient></defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#dmGrad)" stroke="#880010" stroke-width="1"/>
      <!-- ÐšÑ€Ð¾Ð²Ð°Ð²Ñ‹Ðµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ -->
      <line x1="9" y1="0" x2="7" y2="80" stroke="rgba(180,0,20,.6)" stroke-width="1.2"/>
      <line x1="11" y1="50" x2="13" y2="140" stroke="rgba(160,0,15,.5)" stroke-width="1"/>
      <line x1="8" y1="130" x2="7" y2="220" stroke="rgba(180,0,20,.6)" stroke-width="1.2"/>
      <line x1="12" y1="200" x2="13" y2="290" stroke="rgba(160,0,15,.5)" stroke-width="1"/>
      <!-- Ð¨Ð¸Ð¿Ñ‹-Ñ‡ÐµÑˆÑƒÐ¹ÐºÐ¸ Ñ Ð¾Ð±ÐµÐ¸Ñ… ÑÑ‚Ð¾Ñ€Ð¾Ð½ -->
      ${[20,50,80,110,140,170,200,230,260,290,320].map((y,i)=>`
        <path d="M${i%2===0?6:14},${y} Q${i%2===0?0:20},${y-5} ${i%2===0?2:18},${y+7}" fill="#880010" stroke="#cc0010" stroke-width="0.8"/>
      `).join('')}
      <!-- Ð Ð¾Ð³Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <path d="M7,0 Q3,-12 5,-18 Q8,-10 10,0Z" fill="#660010" stroke="#aa0010" stroke-width="1"/>
      <path d="M13,0 Q17,-12 15,-18 Q12,-10 10,0Z" fill="#660010" stroke="#aa0010" stroke-width="1"/>
      <!-- ÐÐ´ÑÐºÐ¾Ðµ Ð¿Ð»Ð°Ð¼Ñ Ñƒ Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ€Ð¾Ð³Ð¾Ð² -->
      <path d="M6,2 Q8,-3 10,2 Q12,-3 14,2" fill="rgba(255,60,0,.6)" stroke="rgba(255,100,0,.4)" stroke-width="0.5"/>
      <!-- Ð“Ð»Ð°Ð·Ð° Ð´ÐµÐ¼Ð¾Ð½Ð° Ð½Ð° Ñ‚ÐµÐ»Ðµ -->
      <ellipse cx="8" cy="100" rx="2" ry="2.5" fill="#ff0000" opacity=".8"/>
      <ellipse cx="8" cy="100" rx="1" ry="1.5" fill="#111"/>
      <ellipse cx="8" cy="220" rx="2" ry="2.5" fill="#ff0000" opacity=".7"/>
      <ellipse cx="8" cy="220" rx="1" ry="1.5" fill="#111"/>
      <!-- ÐšÐ°Ð¿Ð»Ð¸ ÐºÑ€Ð¾Ð²Ð¸ -->
      <path d="M13,60 Q14,65 13,70 Q12,65 13,60Z" fill="#cc0010"/>
      <path d="M7,150 Q6,155 7,162 Q8,155 7,150Z" fill="#aa0010"/>
      <path d="M13,240 Q14,247 13,254 Q12,247 13,240Z" fill="#cc0010"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ñ ÑˆÐ¸Ð¿Ð°Ð¼Ð¸ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(50,0,10,.8)" stroke="#cc0018" stroke-width="2.5" opacity="${0.9-i*0.05}"/>
        <polygon points="${10+w+1},${y} ${10+w+4},${y-2} ${10+w+4},${y+2}" fill="#880010"/>
        <polygon points="${10-w-1},${y} ${10-w-4},${y-2} ${10-w-4},${y+2}" fill="#880010"/>
      `;}).join('')}
      ${reel('#cc0018','rgba(40,0,8,.98)')}${handle('#500010')}`,

    // Ð£Ð”ÐžÐ§ÐšÐ Ð‘ÐžÐ“ÐžÐ’ â€” Ñ€Ð°Ð´ÑƒÐ¶Ð½Ð¾Ðµ ÑÐ²ÐµÑ‡ÐµÐ½Ð¸Ðµ, Ð½Ð¸Ð¼Ð±, Ð»ÑƒÑ‡Ð¸ ÑÐ²ÐµÑ‚Ð°, Ð·Ð¾Ð»Ð¾Ñ‚Ð¾ Ð½Ð° Ð·Ð¾Ð»Ð¾Ñ‚Ðµ
    godly: `
      <defs>
        <linearGradient id="gyGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#706010"/><stop offset="25%" stop-color="#fff8a0"/><stop offset="50%" stop-color="#ffd700"/><stop offset="75%" stop-color="#fff8a0"/><stop offset="100%" stop-color="#706010"/></linearGradient>
        <linearGradient id="rainbowY" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#ff0000" stop-opacity=".4"/>
          <stop offset="16%" stop-color="#ff8800" stop-opacity=".4"/>
          <stop offset="33%" stop-color="#ffff00" stop-opacity=".4"/>
          <stop offset="50%" stop-color="#00ff00" stop-opacity=".4"/>
          <stop offset="66%" stop-color="#0088ff" stop-opacity=".4"/>
          <stop offset="83%" stop-color="#8800ff" stop-opacity=".4"/>
          <stop offset="100%" stop-color="#ff00ff" stop-opacity=".4"/>
        </linearGradient>
      </defs>
      <!-- Ð Ð°Ð´ÑƒÐ¶Ð½Ð°Ñ Ð°ÑƒÑ€Ð° -->
      <rect x="4" y="0" width="12" height="360" rx="5" fill="url(#rainbowY)" opacity=".5"/>
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ðµ Ñ‚ÐµÐ»Ð¾ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#gyGrad)" stroke="#d4a020" stroke-width="1.2"/>
      <!-- Ð›ÑƒÑ‡Ð¸ ÑÐ²ÐµÑ‚Ð° Ð²Ð´Ð¾Ð»ÑŒ -->
      <line x1="10" y1="0" x2="10" y2="360" stroke="rgba(255,255,200,.3)" stroke-width="1.5"/>
      <!-- ÐŸÐ°Ñ€ÑÑ‰Ð¸Ðµ Ð·Ð²Ñ‘Ð·Ð´Ñ‹-Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ -->
      ${[25,70,115,160,205,250,295,340].map((y,i)=>`
        <polygon points="10,${y-5} 11,${y-2} 14,${y-2} 11.5,${y} 12.5,${y+3} 10,${y+1} 7.5,${y+3} 8.5,${y} 6,${y-2} 9,${y-2}" fill="#ffd700" stroke="#c09010" stroke-width="0.4" opacity="${.6+.3*(i%2)}"/>
      `).join('')}
      <!-- ÐÐ¸Ð¼Ð± Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <ellipse cx="10" cy="-2" rx="13" ry="4" fill="none" stroke="#ffd700" stroke-width="2.5" opacity=".9"/>
      <ellipse cx="10" cy="-2" rx="16" ry="5" fill="none" stroke="rgba(255,220,50,.4)" stroke-width="2"/>
      <ellipse cx="10" cy="-2" rx="9" ry="3" fill="none" stroke="rgba(255,240,100,.6)" stroke-width="1.2"/>
      <!-- Ð›ÑƒÑ‡Ð¸ Ð¾Ñ‚ Ð½Ð¸Ð¼Ð±Ð° -->
      ${[0,45,90,135,180,225,270,315].map(a=>`
        <line x1="${10+12*Math.cos(a*Math.PI/180)}" y1="${-2+5*Math.sin(a*Math.PI/180)}" x2="${10+18*Math.cos(a*Math.PI/180)}" y2="${-2+7.5*Math.sin(a*Math.PI/180)}" stroke="rgba(255,230,80,.5)" stroke-width="1"/>
      `).join('')}
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ Ð·Ð¾Ð»Ð¾Ñ‚Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w+2}" ry="4" fill="none" stroke="rgba(255,220,50,.3)" stroke-width="2"/>
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="rgba(60,45,0,.6)" stroke="#ffd700" stroke-width="2.5" opacity="${0.95-i*0.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-3}" ry="1.3" fill="none" stroke="rgba(255,255,200,.5)" stroke-width="0.8"/>
      `;}).join('')}
      ${reel('#ffd700','rgba(55,40,0,.95)')}${handle('#c09010')}`,

    marble: `
      <defs>
        <radialGradient id="igMbGrad" cx="35%" cy="30%"><stop offset="0%" stop-color="#ffffff"/><stop offset="40%" stop-color="#d4c8e8"/><stop offset="100%" stop-color="#9080c0"/></radialGradient>
        <linearGradient id="igMbBody" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f0e8ff"/><stop offset="50%" stop-color="#c0b0e0"/><stop offset="100%" stop-color="#f0e8ff"/></linearGradient>
      </defs>
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#igMbBody)" stroke="rgba(160,140,200,.5)" stroke-width="0.5"/>
      <path d="M8,20 Q11,50 8,90" stroke="rgba(160,140,200,.6)" stroke-width="0.9" fill="none"/>
      <path d="M12,60 Q9,110 12,160" stroke="rgba(200,180,240,.5)" stroke-width="0.8" fill="none"/>
      <path d="M8,140 Q12,200 8,260" stroke="rgba(140,120,180,.5)" stroke-width="0.8" fill="none"/>
      <path d="M12,240 Q8,300 12,340" stroke="rgba(180,160,220,.4)" stroke-width="0.7" fill="none"/>
      ${rings('#d0c0f0')}
      ${reel('#c0b0e0','rgba(30,20,60,.8)')}
      ${handle('#a090c0')}
      <circle cx="10" cy="8" r="8" fill="url(#igMbGrad)" stroke="rgba(180,160,220,.9)" stroke-width="1.5"/>
      <path d="M5,4 Q9,8 7,12" stroke="rgba(80,60,140,.4)" stroke-width="0.9" fill="none"/>
      <path d="M10,2 Q14,6 12,10" stroke="rgba(100,80,160,.3)" stroke-width="0.8" fill="none"/>
      <circle cx="7.5" cy="5" r="2.5" fill="rgba(255,255,255,.65)"/>
      <circle cx="10" cy="380" r="5" fill="url(#igMbGrad)" stroke="rgba(180,160,220,.5)" stroke-width="1" opacity=".8"/>`,

    ghost: `
      <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” Ð¿Ð¾Ð»ÑƒÐ¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ, Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð¸ÑÑ‚Ð°Ñ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="rgba(128,255,200,.1)" stroke="rgba(128,255,200,.5)" stroke-width="0.8" stroke-dasharray="8,4"/>
      <rect x="6.5" y="0" width="7" height="360" rx="3" fill="none" stroke="rgba(180,100,255,.2)" stroke-width="1.5"/>
      <!-- ÐœÐ¸Ð½Ð¸-Ð¿Ñ€Ð¸Ð·Ñ€Ð°Ðº Ð½Ð°Ð²ÐµÑ€Ñ…Ñƒ -->
      <ellipse cx="10" cy="12" rx="7" ry="8" fill="rgba(200,255,230,.8)" stroke="rgba(128,255,200,.9)" stroke-width="1.2"/>
      <path d="M3,17 Q3,22 6,20 Q8,18 10,20 Q12,18 14,20 Q17,22 17,17" fill="rgba(200,255,230,.8)" stroke="rgba(128,255,200,.9)" stroke-width="1.2"/>
      <ellipse cx="7.5" cy="11" rx="1.8" ry="2" fill="rgba(10,20,30,.8)"/>
      <ellipse cx="12.5" cy="11" rx="1.8" ry="2" fill="rgba(10,20,30,.8)"/>
      <circle cx="10" cy="14" r="1.2" fill="rgba(10,20,30,.7)"/>
      <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð° -->
      ${rings('rgba(128,255,200,.6)', 0.7)}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ°-Ð¿Ñ€Ð¸Ð·Ñ€Ð°Ðº -->
      <ellipse cx="10" cy="345" rx="12" ry="8" fill="rgba(128,255,200,.08)" stroke="rgba(128,255,200,.5)" stroke-width="1.5" stroke-dasharray="5,4"/>
      <ellipse cx="10" cy="345" rx="7" ry="4.5" fill="rgba(128,255,200,.15)" stroke="rgba(128,255,200,.4)" stroke-width="1"/>
      <ellipse cx="10" cy="345" rx="3" ry="2" fill="rgba(200,255,230,.7)"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° -->
      <rect x="6" y="360" width="8" height="35" rx="4" fill="rgba(128,255,200,.2)" stroke="rgba(128,255,200,.5)" stroke-width="1" stroke-dasharray="4,3"/>`,

    // â•â•â• Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð° â€” Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒ â•â•â•
    pharaoh: `
      <defs>
        <linearGradient id="phvGold" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#906010"/>
          <stop offset="35%" stop-color="#ffe060"/>
          <stop offset="65%" stop-color="#e8c020"/>
          <stop offset="100%" stop-color="#906010"/>
        </linearGradient>
        <radialGradient id="phvScarab" cx="50%" cy="35%">
          <stop offset="0%" stop-color="#60e080"/>
          <stop offset="100%" stop-color="#206040"/>
        </radialGradient>
      </defs>
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð¿Ð¾ÑÐ¾Ñ… Ñ Ð½Ð°ÑÐµÑ‡ÐºÐ¾Ð¹ Ñ€Ð¾Ð¼Ð±Ð°Ð¼Ð¸ -->
      <rect x="7" y="0" width="6" height="360" rx="2.5" fill="url(#phvGold)" stroke="#c09010" stroke-width="1"/>
      <!-- Ð˜ÐµÑ€Ð¾Ð³Ð»Ð¸Ñ„Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ -->
      <text x="10" y="50"  text-anchor="middle" font-size="6" fill="#8a5010" opacity=".7">ð“¹</text>
      <text x="10" y="110" text-anchor="middle" font-size="6" fill="#8a5010" opacity=".7">ð“‚€</text>
      <text x="10" y="170" text-anchor="middle" font-size="6" fill="#8a5010" opacity=".6">ð“†£</text>
      <text x="10" y="230" text-anchor="middle" font-size="6" fill="#8a5010" opacity=".6">ð“¹</text>
      <text x="10" y="290" text-anchor="middle" font-size="6" fill="#8a5010" opacity=".5">ð“‚€</text>
      <!-- Ð¡ÐºÐ°Ñ€Ð°Ð±ÐµÐ¹ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <g style="transform-origin:10px -5px;animation:pharaohScarabSpin 4s linear infinite;">
        <ellipse cx="10" cy="-5" rx="9" ry="6" fill="url(#phvScarab)" stroke="#20a040" stroke-width="1.5"/>
        <ellipse cx="10" cy="-5" rx="5" ry="3.5" fill="#50e080" opacity=".5"/>
        <!-- ÐšÑ€Ñ‹Ð»Ñ‹ÑˆÐºÐ¸ -->
        <path d="M1,-4 Q-5,-9 -3,-3 Q0,0 3,-2" fill="#30b060" opacity=".8"/>
        <path d="M19,-4 Q25,-9 23,-3 Q20,0 17,-2" fill="#30b060" opacity=".8"/>
        <circle cx="10" cy="-5" r="2" fill="#a0ff90" opacity=".9"/>
      </g>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” ÐµÐ³Ð¸Ð¿ÐµÑ‚ÑÐºÐ¸Ðµ Ð±Ñ€Ð°ÑÐ»ÐµÑ‚Ñ‹ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#ffe060" stroke-width="2.5" opacity="${.9-i*.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="#a07010" stroke-width="1" opacity=".5"/>
        <!-- ÐœÐ¾Ð½ÐµÑ‚ÐºÐ°-Ð¼ÐµÐ´Ð°Ð»ÑŒÐ¾Ð½ -->
        <circle cx="${10+w+4}" cy="${y}" r="4" fill="#e8c020" stroke="#a07010" stroke-width="1" opacity=".85"/>
        <text x="${10+w+4}" y="${y+1.5}" text-anchor="middle" font-size="4" fill="#8a5010">ð“¹</text>
      `;}).join('')}
      <!-- ÐÐ½Ðº Ð½Ð° Ñ€ÑƒÑ‡ÐºÐµ -->
      <ellipse cx="10" cy="356" rx="5" ry="4" fill="none" stroke="#ffe060" stroke-width="2"/>
      <line x1="10" y1="360" x2="10" y2="375" stroke="#ffe060" stroke-width="2"/>
      <line x1="5" y1="365" x2="15" y2="365" stroke="#ffe060" stroke-width="2"/>
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ°-ÑÐ°Ñ€ÐºÐ¾Ñ„Ð°Ð³ -->
      <ellipse cx="10" cy="340" rx="12" ry="8" fill="rgba(30,20,5,.9)" stroke="#ffe060" stroke-width="2"/>
      <ellipse cx="10" cy="340" rx="7" ry="4.5" fill="#8a6010" stroke="#c09010" stroke-width="1.5"/>
      <text x="10" y="342" text-anchor="middle" font-size="5" fill="#ffe060">ð“¹</text>`,

    // â•â•â• ÐÐµÐ¾Ð½-Ð¢ÑƒÑ€Ð±Ð¾ Ð£Ð´Ð¾Ñ‡ÐºÐ° â€” Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒ â•â•â•
    neon: `
      <defs>
        <linearGradient id="neonVBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#001a14"/>
          <stop offset="50%" stop-color="#004030"/>
          <stop offset="100%" stop-color="#001a14"/>
        </linearGradient>
      </defs>
      <!-- ÐšÐ¾Ñ€Ð¿ÑƒÑ -->
      <rect x="7" y="0" width="6" height="360" rx="2.5" fill="url(#neonVBody)" stroke="#00ffcc" stroke-width="1"/>
      <!-- ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ðµ Ð±Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ð¾ÑÑ‹ -->
      <line x1="7"  y1="0" x2="7"  y2="360" stroke="#00ffcc" stroke-width="1.5" opacity=".8"/>
      <line x1="13" y1="0" x2="13" y2="360" stroke="#00ccff" stroke-width="1.5" opacity=".8"/>
      <!-- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ LED-Ð¿Ð¾Ð»Ð¾ÑÐ° Ñ Ð±ÐµÐ³ÑƒÑ‰Ð¸Ð¼ Ð¾Ð³Ð½Ñ‘Ð¼ -->
      <line x1="10" y1="0" x2="10" y2="360" stroke="rgba(0,255,180,.2)" stroke-width="2"/>
      <!-- Ð‘Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð²Ð´Ð¾Ð»ÑŒ -->
      ${[30,60,90,120,150,180,210,240,270,300,330].map((y,i)=>
        `<text x="10" y="${y+4}" text-anchor="middle" font-size="5" fill="rgba(0,255,200,.5)">${['10','01','11','00'][i%4]}</text>`
      ).join('')}
      <!-- Wi-Fi Ð°Ð½Ñ‚ÐµÐ½Ð½Ð° ÑÐ²ÐµÑ€Ñ…Ñƒ -->
      <line x1="10" y1="0" x2="10" y2="-12" stroke="#00ffcc" stroke-width="2" stroke-linecap="round"/>
      <path d="M2,-10 Q10,-15 18,-10" stroke="#00ffcc" stroke-width="1.5" fill="none" opacity=".9"/>
      <path d="M-2,-7 Q10,-14 22,-7" stroke="#00ffcc" stroke-width="1" fill="none" opacity=".5"/>
      <circle cx="10" cy="-12" r="2.5" fill="#00ffcc" opacity=".9"/>
      <!-- Ð§Ð¸Ð¿-Ð¿Ð°Ð½ÐµÐ»Ð¸ Ð¿Ð¾ Ð±Ð¾ÐºÐ°Ð¼ -->
      ${[80,160,250,320].map((y,i)=>`
        <rect x="-6" y="${y}" width="7" height="10" rx="1.5" fill="rgba(0,30,20,.9)" stroke="#00ffcc" stroke-width=".8"/>
        <circle cx="-2.5" cy="${y+5}" r="1.5" fill="#00ffcc" opacity=".8"/>
        <line x1="-6" y1="${y+5}" x2="7" y2="${y+5}" stroke="rgba(0,255,200,.3)" stroke-width=".5"/>
      `).join('')}
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð³Ð¾Ð»Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#00ffcc" stroke-width="2" opacity="${.9-i*.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w+3}" ry="4.5" fill="none" stroke="rgba(0,255,200,.2)" stroke-width="1.5"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ°-Ñ€ÐµÐ°ÐºÑ‚Ð¾Ñ€ -->
      <ellipse cx="10" cy="340" rx="14" ry="9" fill="rgba(0,20,15,.95)" stroke="#00ffcc" stroke-width="2"/>
      <ellipse cx="10" cy="340" rx="8" ry="5" fill="rgba(0,80,60,.6)" stroke="#00ccff" stroke-width="1.5"/>
      <ellipse cx="10" cy="340" rx="4" ry="2.5" fill="#00ffcc" opacity=".9"/>
      <circle cx="10" cy="340" r="1.5" fill="#fff" opacity=".9"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° ÐºÐ°Ñ€Ð±Ð¾Ð½ -->
      <rect x="6" y="360" width="8" height="35" rx="4" fill="#001a14" stroke="#00ffcc" stroke-width="1.5"/>
      <line x1="7" y1="360" x2="7" y2="395" stroke="#00ffcc" stroke-width=".8" opacity=".6"/>
      <line x1="13" y1="360" x2="13" y2="395" stroke="#00ccff" stroke-width=".8" opacity=".6"/>`,

    // â•â•â• Ð©ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ ÐšÑ€Ð°ÐºÐµÐ½Ð° â€” Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒ â•â•â•
    kraken: `
      <defs>
        <linearGradient id="krkVBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#0a0220"/>
          <stop offset="40%" stop-color="#3010a0"/>
          <stop offset="100%" stop-color="#0a0220"/>
        </linearGradient>
        <radialGradient id="krkEyeV" cx="40%" cy="35%">
          <stop offset="0%" stop-color="#ff4030"/>
          <stop offset="100%" stop-color="#600000"/>
        </radialGradient>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ â€” ÑÐºÑ€ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ (Ð²Ð¾Ð»Ð½Ð¸ÑÑ‚Ð¾Ðµ) -->
      <path d="M10,0 Q14,40 8,80 Q12,120 8,160 Q12,200 8,240 Q12,280 8,320 Q10,350 10,360" stroke="url(#krkVBody)" stroke-width="8" fill="none" stroke-linecap="round"/>
      <path d="M10,0 Q14,40 8,80 Q12,120 8,160 Q12,200 8,240 Q12,280 8,320 Q10,350 10,360" stroke="#5020c0" stroke-width="3" fill="none" stroke-linecap="round" opacity=".5"/>
      <!-- ÐŸÑ€Ð¸ÑÐ¾ÑÐºÐ¸ Ð²Ð´Ð¾Ð»ÑŒ -->
      ${[20,50,80,110,140,170,200,230,260,290,320].map((y,i)=>{
        const x = i%2===0 ? 14 : 6;
        const r = 4-i*.15;
        return `
          <circle cx="${x}" cy="${y}" r="${r}" fill="rgba(0,0,0,.8)" stroke="#7030d0" stroke-width="${1.2-i*.02}" opacity="${.9-i*.03}"/>
          <circle cx="${x}" cy="${y}" r="${r*.5}" fill="rgba(100,40,180,.6)"/>
        `;
      }).join('')}
      <!-- Ð‘Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ð° (3 ÑˆÑ‚ÑƒÐºÐ¸, Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ñ‹ Ð² Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¼ÐµÑÑ‚Ð°Ñ…) -->
      <path d="M10,80 Q-10,70 -15,85 Q-8,90 10,80" stroke="#5020a0" stroke-width="3" fill="#2010600.4" stroke-linecap="round"/>
      <path d="M10,180 Q25,170 30,185 Q25,190 10,180" stroke="#5020a0" stroke-width="3" fill="none" stroke-linecap="round"/>
      <path d="M10,270 Q-12,260 -16,275 Q-9,282 10,270" stroke="#4010a0" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <!-- Ð–ÑƒÑ‚ÐºÐ¸Ð¹ Ð³Ð»Ð°Ð· Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <ellipse cx="10" cy="-8" rx="10" ry="9" fill="#060115" stroke="#7030c0" stroke-width="1.5"/>
      <ellipse cx="10" cy="-8" rx="7" ry="6" fill="url(#krkEyeV)"/>
      <ellipse cx="10" cy="-8" rx="3" ry="4" fill="#0a0000"/>
      <circle cx="12" cy="-10" r="1.5" fill="rgba(255,255,255,.7)"/>
      <!-- Ð’ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ñ€Ð°Ñ‡Ð¾Ðº ÐºÑ€Ð°ÐºÐµÐ½Ð° -->
      <ellipse cx="10" cy="-8" rx="1.2" ry="3.5" fill="rgba(0,0,0,.9)"/>
      <!-- ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ tentacle-Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ð° Ð¸Ð· Ð³Ð»Ð°Ð·Ð° -->
      <path d="M10,-1 Q7,5 4,8" stroke="#4010a0" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M10,-1 Q13,5 16,8" stroke="#4010a0" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ñ‡ÐµÑ€Ð½Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð²Ð¸Ñ…Ñ€Ð¸ -->
      ${[80,150,220,290].map((y,i)=>{const w=9-i*1.5; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#7030d0" stroke-width="2" opacity="${.8-i*.05}"/>
        <ellipse cx="10" cy="${y}" rx="${w+4}" ry="5" fill="none" stroke="rgba(100,30,200,.2)" stroke-width="2"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð¿Ð°ÑÑ‚ÑŒ ÐºÑ€Ð°ÐºÐµÐ½Ð° -->
      <ellipse cx="10" cy="342" rx="13" ry="8" fill="rgba(5,2,15,.95)" stroke="#6020c0" stroke-width="2"/>
      <path d="M0,342 Q5,338 10,342 Q15,338 20,342 Q15,346 10,342 Q5,346 0,342" fill="#3010a0" stroke="#7030d0" stroke-width="1"/>
      <circle cx="10" cy="342" r="2" fill="#ff4030"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” ÑÐºÐ¾Ð»ÑŒÐ·ÐºÐ¾Ðµ Ñ‰ÑƒÐ¿Ð°Ð»ÑŒÑ†Ðµ -->
      <path d="M7,360 Q5,372 8,380 Q11,388 8,395" stroke="#3010a0" stroke-width="7" fill="none" stroke-linecap="round"/>
      <path d="M13,360 Q15,372 12,380 Q9,388 12,395" stroke="#4020b0" stroke-width="4" fill="none" stroke-linecap="round"/>`,

    // â•â•â• Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð’Ñ€ÐµÐ¼ÐµÐ½Ð¸ â€” Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒ â•â•â•
    time: `
      <defs>
        <linearGradient id="tmVBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#6070a0"/>
          <stop offset="50%" stop-color="#d0e8ff"/>
          <stop offset="100%" stop-color="#6070a0"/>
        </linearGradient>
        <radialGradient id="tmVOrb" cx="35%" cy="30%">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="60%" stop-color="#90c0f0"/>
          <stop offset="100%" stop-color="#2060a0"/>
        </radialGradient>
      </defs>
      <!-- Ð¥Ñ€ÑƒÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ñ‚ÐµÐ»Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#tmVBody)" stroke="#c0d8ff" stroke-width="1" opacity=".95"/>
      <!-- Ð—Ð°ÑÑ‚Ñ‹Ð²ÑˆÐ¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹ÌÐµ Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹ -->
      <line x1="7"  y1="0"   x2="13" y2="60"  stroke="rgba(255,255,255,.4)" stroke-width=".8"/>
      <line x1="13" y1="60"  x2="7"  y2="120" stroke="rgba(255,255,255,.35)" stroke-width=".8"/>
      <line x1="7"  y1="120" x2="13" y2="180" stroke="rgba(255,255,255,.3)" stroke-width=".8"/>
      <line x1="13" y1="180" x2="7"  y2="240" stroke="rgba(255,255,255,.25)" stroke-width=".8"/>
      <line x1="7"  y1="240" x2="13" y2="300" stroke="rgba(255,255,255,.2)" stroke-width=".8"/>
      <!-- Ð¢ÐµÐ½Ð¸ Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      <rect x="4" y="0" width="3" height="360" rx="1.5" fill="rgba(150,180,255,.07)"/>
      <rect x="13" y="0" width="3" height="360" rx="1.5" fill="rgba(150,180,255,.07)"/>
      <!-- Ð§ÐÐ¡Ð« Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ â€” Ð±Ð¾Ð»ÑŒÑˆÐ¸Ðµ -->
      <circle cx="10" cy="-10" r="12" fill="rgba(5,10,25,.92)" stroke="#c0d8ff" stroke-width="2"/>
      <circle cx="10" cy="-10" r="10" fill="rgba(10,15,35,.8)" stroke="#8090b0" stroke-width="1"/>
      <!-- Ð¦Ð¸Ñ„ÐµÑ€Ð±Ð»Ð°Ñ‚ Ñ‡Ð°ÑÐ¾Ð² -->
      ${Array.from({length:12},(_,i)=>{
        const a=i*30*Math.PI/180; const r1=8; const r2=9.5;
        return `<line x1="${10+Math.sin(a)*r1}" y1="${-10-Math.cos(a)*r1}" x2="${10+Math.sin(a)*r2}" y2="${-10-Math.cos(a)*r2}" stroke="rgba(180,210,255,.6)" stroke-width="${i%3===0?1.5:.7}"/>`;
      }).join('')}
      <!-- ÐœÐ¸Ð½ÑƒÑ‚Ð½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° -->
      <line x1="10" y1="-10" x2="10" y2="-19" stroke="#ffffff" stroke-width="2" stroke-linecap="round"/>
      <!-- Ð§Ð°ÑÐ¾Ð²Ð°Ñ ÑÑ‚Ñ€ÐµÐ»ÐºÐ° -->
      <line x1="10" y1="-10" x2="16" y2="-7" stroke="#c0d8ff" stroke-width="1.5" stroke-linecap="round"/>
      <!-- Ð¡ÐµÐºÑƒÐ½Ð´Ð½Ð°Ñ (ÑÐ¿Ð¸Ð½Ð½Ð¸Ð½Ð³) -->
      <line x1="10" y1="-10" x2="4" y2="-14" stroke="#ff8040" stroke-width="1" stroke-linecap="round" style="transform-origin:10px -10px;animation:timeClockSpin 4s linear infinite;"/>
      <circle cx="10" cy="-10" r="1.5" fill="#c0d8ff"/>
      <!-- ÐÐ°Ð´Ð¿Ð¸ÑÑŒ XII, III, VI, IX -->
      <text x="10" y="-20" text-anchor="middle" font-size="3.5" fill="rgba(180,210,255,.6)">XII</text>
      <text x="19" y="-9" text-anchor="middle" font-size="3.5" fill="rgba(180,210,255,.5)">III</text>
      <text x="10" y="-0.5" text-anchor="middle" font-size="3.5" fill="rgba(180,210,255,.5)">VI</text>
      <text x="1" y="-9" text-anchor="middle" font-size="3.5" fill="rgba(180,210,255,.5)">IX</text>
      <!-- Ð¢Ñ€Ð¸ Ð»ÐµÑÐºÐ¸ (3 Ñ€Ñ‹Ð±Ñ‹ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾!) -->
      <!-- ÐŸÑ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ð¾-Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹ÌÐµ Ð²Ð¸Ñ…Ñ€Ð¸-ÐºÐ¾Ð»ÑŒÑ†Ð° -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#c0d8ff" stroke-width="2" opacity="${.9-i*.06}"/>
        <ellipse cx="10" cy="${y}" rx="${w+5}" ry="5.5" fill="none" stroke="rgba(180,210,255,.15)" stroke-width="1.5"/>
        <!-- ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ð·Ð²Ñ‘Ð·Ð´Ð¾Ñ‡ÐºÐ¸ Ð½Ð° ÐºÐ¾Ð»ÑŒÑ†Ð°Ñ… -->
        <circle cx="${10+w+2}" cy="${y}" r="1.5" fill="rgba(200,220,255,.6)"/>
        <circle cx="${10-w-2}" cy="${y}" r="1.5" fill="rgba(200,220,255,.6)"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(5,10,25,.95)" stroke="#c0d8ff" stroke-width="2"/>
      <ellipse cx="10" cy="342" rx="9" ry="5.5" fill="rgba(30,50,90,.7)" stroke="#a0c0e0" stroke-width="1.5"/>
      <!-- Ð¡Ð¿Ð¸Ñ€Ð°Ð»ÑŒ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ°Ñ‚ÑƒÑˆÐºÐ¸ -->
      <path d="M4,342 Q7,339 10,342 Q13,345 16,342" stroke="rgba(180,210,255,.7)" stroke-width="1" fill="none"/>
      <circle cx="10" cy="342" r="2.5" fill="url(#tmVOrb)"/>
      <circle cx="10" cy="342" r="1" fill="#ffffff" opacity=".9"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»-Ð¿Ñ€Ð¸Ð·Ð¼Ð° -->
      <rect x="6" y="360" width="8" height="35" rx="3" fill="rgba(80,100,150,.6)" stroke="#c0d8ff" stroke-width="1.5"/>
      <line x1="10" y1="360" x2="10" y2="395" stroke="rgba(200,220,255,.4)" stroke-width="1"/>`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŒŒ Ð§ÐÐ ÐÐÐ¯ Ð”Ð«Ð Ð â€” Ñ‚ÐµÐ»Ð¾ Ð¸Ð· Ð°Ð½Ñ‚Ð¸Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð¸, Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ° Ð³Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ð¸ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    blackhole: `
      <defs>
        <radialGradient id="bhBody" cx="50%" cy="50%">
          <stop offset="0%" stop-color="#2a0060"/>
          <stop offset="60%" stop-color="#0a0020"/>
          <stop offset="100%" stop-color="#000008"/>
        </radialGradient>
        <radialGradient id="bhCore" cx="50%" cy="50%">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="30%" stop-color="#c060ff"/>
          <stop offset="70%" stop-color="#4000a0"/>
          <stop offset="100%" stop-color="transparent"/>
        </radialGradient>
        <filter id="bhGlow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” Ð°Ð½Ñ‚Ð¸Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ñ, Ð¼ÐµÑ€Ñ†Ð°ÑŽÑ‰Ð°Ñ Ñ„Ð¸Ð¾Ð»ÐµÑ‚Ð¾Ð²Ñ‹Ð¼ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#bhBody)" stroke="#6000c0" stroke-width="1.5"/>
      <!-- Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ð²Ð¾Ð»Ð½Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      ${[40,80,120,160,200,240,280,320].map((y,i)=>`
        <ellipse cx="10" cy="${y}" rx="${14-i*.2}" ry="1.5" fill="none" stroke="rgba(140,0,255,${0.4-i*0.03})" stroke-width="1" style="animation:blackholeRipple ${1.5+i*0.2}s ease-in-out infinite alternate;"/>
      `).join('')}
      <!-- Ð§ÐÐ ÐÐÐ¯ Ð”Ð«Ð Ð Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ â€” Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ -->
      <circle cx="10" cy="-18" r="18" fill="rgba(0,0,5,.98)" stroke="rgba(120,0,220,.6)" stroke-width="1.5"/>
      <!-- ÐÐºÐºÑ€ÐµÑ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð´Ð¸ÑÐº Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð´Ñ‹Ñ€Ñ‹ -->
      <ellipse cx="10" cy="-18" rx="20" ry="6" fill="none" stroke="#8000ff" stroke-width="3" opacity=".7" style="animation:bhDiscSpin 2s linear infinite;"/>
      <ellipse cx="10" cy="-18" rx="16" ry="4" fill="none" stroke="#c060ff" stroke-width="2" opacity=".5" style="animation:bhDiscSpin 1.5s linear infinite reverse;"/>
      <!-- Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ â€” Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð¾ Ñ‡Ñ‘Ñ€Ð½Ñ‹Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ -->
      <circle cx="10" cy="-18" r="9" fill="#000000"/>
      <!-- Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ðµ Ð»Ð¸Ð½Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ â€” Ð±Ð»Ð¸ÐºÐ¸ -->
      <circle cx="10" cy="-18" r="11" fill="none" stroke="rgba(200,100,255,.4)" stroke-width="2" style="animation:bhPulse 1s ease-in-out infinite;"/>
      <!-- Ð—Ð°ÑÐ°ÑÑ‹Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ -->
      <circle cx="2" cy="-25" r="1.5" fill="#ff80ff" opacity=".8" style="animation:bhParticle1 2s linear infinite;"/>
      <circle cx="18" cy="-12" r="1" fill="#80ffff" opacity=".7" style="animation:bhParticle2 2.5s linear infinite;"/>
      <circle cx="5" cy="-10" r="1.2" fill="#c0a0ff" opacity=".6" style="animation:bhParticle3 3s linear infinite;"/>
      <!-- Ð ÐµÐ»ÑÑ‚Ð¸Ð²Ð¸ÑÑ‚ÑÐºÐ¸Ðµ Ð´Ð¶ÐµÑ‚Ñ‹ ÑÐ²ÐµÑ€Ñ…Ñƒ Ð¸ ÑÐ½Ð¸Ð·Ñƒ -->
      <line x1="10" y1="-36" x2="10" y2="-50" stroke="#c060ff" stroke-width="2" opacity=".6" style="animation:bhJet 1s ease-in-out infinite alternate;"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… â€” ÑÐ¸Ð½Ð³ÑƒÐ»ÑÑ€Ð½Ð¾ÑÑ‚ÑŒ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#8000ff" stroke-width="2" opacity="${.9-i*.06}"/>
        <circle cx="${10+w}" cy="${y}" r="2" fill="#c060ff" opacity=".5" style="animation:bhOrbit ${1+i*0.3}s linear infinite;"/>
        <circle cx="${10-w}" cy="${y}" r="1.5" fill="#ff00ff" opacity=".4" style="animation:bhOrbit ${1.5+i*0.3}s linear infinite reverse;"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” ÑÐ¸Ð½Ð³ÑƒÐ»ÑÑ€Ð½Ð¾ÑÑ‚ÑŒ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(0,0,5,.98)" stroke="#6000c0" stroke-width="2.5"/>
      <ellipse cx="10" cy="342" rx="8" ry="5" fill="rgba(20,0,40,.8)" stroke="#8000ff" stroke-width="1.5"/>
      <circle cx="10" cy="342" r="3" fill="url(#bhCore)" style="animation:bhPulse 1.5s ease-in-out infinite;"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ð¼Ñ€Ð°Ðº Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð° -->
      <rect x="6" y="360" width="8" height="35" rx="3" fill="rgba(5,0,15,.95)" stroke="#5000a0" stroke-width="2"/>
      <line x1="10" y1="360" x2="10" y2="395" stroke="rgba(120,0,220,.3)" stroke-width="1"/>`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŒˆ Ð ÐÐ”Ð£Ð–ÐÐÐ¯ â€” Ñ‚ÐµÐ»Ð¾ Ð¿ÐµÑ€ÐµÐ»Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð²ÑÐµÐ¼Ð¸ Ñ†Ð²ÐµÑ‚Ð°Ð¼Ð¸, Ñ€Ñ‹Ð±ÐºÐ¸ Ð½Ð° Ñ€ÑƒÑ‡ÐºÐµ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    rainbow: `
      <defs>
        <linearGradient id="rbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%"   stop-color="#ff0000"/>
          <stop offset="16%"  stop-color="#ff8000"/>
          <stop offset="33%"  stop-color="#ffff00"/>
          <stop offset="50%"  stop-color="#00ff00"/>
          <stop offset="66%"  stop-color="#0080ff"/>
          <stop offset="83%"  stop-color="#8000ff"/>
          <stop offset="100%" stop-color="#ff00ff"/>
        </linearGradient>
        <linearGradient id="rbGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%"   stop-color="#ff00ff"/>
          <stop offset="25%"  stop-color="#0080ff"/>
          <stop offset="50%"  stop-color="#00ff80"/>
          <stop offset="75%"  stop-color="#ffff00"/>
          <stop offset="100%" stop-color="#ff4000"/>
        </linearGradient>
        <filter id="rbGlow"><feGaussianBlur stdDeviation="2"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ â€” Ð¶Ð¸Ð²Ð°Ñ Ñ€Ð°Ð´ÑƒÐ³Ð°, Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ»Ð¸Ð²Ð°ÐµÑ‚ÑÑ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#rbGrad)" stroke="rgba(255,255,255,.4)" stroke-width="1" style="animation:rainbowShift 3s linear infinite;"/>
      <!-- Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹ ÑÐ»Ð¾Ð¹ â€” ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÑÑ‚Ð½Ð°Ñ Ñ€Ð°Ð´ÑƒÐ³Ð° Ð¿Ð¾Ð²ÐµÑ€Ñ… -->
      <rect x="8.5" y="0" width="3" height="360" rx="1.5" fill="url(#rbGrad2)" opacity=".5" style="animation:rainbowShift2 2s linear infinite reverse;"/>
      <!-- Ð‘Ð»ÐµÑÑ‚ÑÑ‰Ð¸Ðµ Ð¿ÑÑ‚Ð½Ð° â€” Ñ€Ñ‹Ð±ÑŒÑ Ñ‡ÐµÑˆÑƒÑ -->
      ${[30,70,110,150,190,230,270,310].map((y,i)=>`
        <ellipse cx="${i%2===0?8:12}" cy="${y}" rx="3" ry="2" fill="rgba(255,255,255,.6)" opacity=".7" style="animation:scaleGlint ${0.8+i*0.15}s ease-in-out infinite alternate;"/>
      `).join('')}
      <!-- Ð Ð°Ð´ÑƒÐ³Ð°-Ð°Ñ€ÐºÐ° Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ â€” ÑÐ¿Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ -->
      <path d="M-8,-5 Q10,-35 28,-5" fill="none" stroke="#ff0000" stroke-width="4" opacity=".9"/>
      <path d="M-5,-5 Q10,-30 25,-5" fill="none" stroke="#ff8800" stroke-width="3" opacity=".85"/>
      <path d="M-2,-5 Q10,-25 22,-5" fill="none" stroke="#ffff00" stroke-width="2.5" opacity=".8"/>
      <path d="M1,-5 Q10,-20 19,-5" fill="none" stroke="#00ff00" stroke-width="2" opacity=".75"/>
      <path d="M3,-5 Q10,-16 17,-5" fill="none" stroke="#0088ff" stroke-width="2" opacity=".7"/>
      <path d="M5,-5 Q10,-12 15,-5" fill="none" stroke="#8800ff" stroke-width="1.5" opacity=".65"/>
      <!-- Ð“Ð¾Ñ€ÑˆÐ¾Ðº Ñ Ð·Ð¾Ð»Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾Ð´ Ñ€Ð°Ð´ÑƒÐ³Ð¾Ð¹ -->
      <ellipse cx="10" cy="-2" rx="5" ry="3" fill="#ffd700" stroke="#b8860b" stroke-width="1" opacity=".9"/>
      <rect x="7" y="-5" width="6" height="4" rx="1" fill="#c0a000" stroke="#ffd700" stroke-width="1" opacity=".9"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” ÐºÐ°Ð¶Ð´Ð¾Ðµ ÑÐ²Ð¾ÐµÐ³Ð¾ Ñ†Ð²ÐµÑ‚Ð° Ñ€Ð°Ð´ÑƒÐ³Ð¸ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; const cols=['#ff4444','#ff8844','#ffff44','#44ff88','#4488ff','#aa44ff']; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${cols[i]}" stroke-width="2.5" opacity=".9"/>
        <ellipse cx="10" cy="${y}" rx="${w+3}" ry="4" fill="none" stroke="${cols[i]}" stroke-width="1" opacity=".3"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” ÑˆÐ°Ñ€ Ð¸Ð· Ñ€Ð°Ð´ÑƒÐ³Ð¸ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(0,0,0,.8)" stroke="rgba(255,255,255,.3)" stroke-width="1.5"/>
      <ellipse cx="10" cy="342" rx="8" ry="5" fill="url(#rbGrad)" opacity=".8"/>
      <ellipse cx="10" cy="342" rx="3" ry="2" fill="#ffffff" opacity=".9"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ñ€Ñ‹Ð±ÐºÐ¸ Ð¿Ð»Ð°Ð²Ð°ÑŽÑ‚ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ð¹ Ñ€ÑƒÑ‡ÐºÐ¸ -->
      <rect x="5" y="358" width="10" height="37" rx="4" fill="rgba(0,150,255,.2)" stroke="rgba(100,200,255,.6)" stroke-width="1.5"/>
      <!-- Ð Ñ‹Ð±ÐºÐ¸-ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ -->
      <text x="10" y="372" text-anchor="middle" font-size="7" style="animation:fishSwim1 2s ease-in-out infinite alternate;">ðŸŸ</text>
      <text x="10" y="385" text-anchor="middle" font-size="5" style="animation:fishSwim2 1.5s ease-in-out infinite alternate;">ðŸ </text>`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ§² ÐœÐÐ“ÐÐ˜Ð¢ â€” Ð² Ñ„Ð¾Ñ€Ð¼Ðµ Ð¿Ð¾Ð´ÐºÐ¾Ð²Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð½Ð¾Ð³Ð¾ Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ð°, Ð¼ÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    magnet: `
      <defs>
        <linearGradient id="mgBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#1a3a6a"/>
          <stop offset="40%" stop-color="#2060c0"/>
          <stop offset="60%" stop-color="#1040a0"/>
          <stop offset="100%" stop-color="#0a2050"/>
        </linearGradient>
        <linearGradient id="mgRed" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#800000"/>
          <stop offset="50%" stop-color="#dd2020"/>
          <stop offset="100%" stop-color="#800000"/>
        </linearGradient>
        <filter id="mgGlow"><feGaussianBlur stdDeviation="2.5"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ â€” ÑÐ¸Ð½ÑÑ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‚Ñ€ÑƒÐ±ÐºÐ° Ñ ÐºÑ€Ð°ÑÐ½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð»Ð¾ÑÐ°Ð¼Ð¸ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#mgBody)" stroke="#4080e0" stroke-width="1.5"/>
      <!-- ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ Ð¸ ÑÐ¸Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ð¾ÑÑ‹ â€” Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŽÑÐ° Ñ‡ÐµÑ€ÐµÐ´ÑƒÑŽÑ‚ÑÑ -->
      ${[0,40,80,120,160,200,240,280,320].map((y,i)=>`
        <rect x="7" y="${y}" width="6" height="20" rx="0" fill="${i%2===0?'url(#mgRed)':'rgba(30,80,200,.8)'}" opacity=".6"/>
      `).join('')}
      <!-- ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð±Ð»ÐµÑÐº -->
      <rect x="8.5" y="0" width="1.5" height="360" rx="0.5" fill="rgba(255,255,255,.25)"/>
      <!-- ÐŸÐžÐ”ÐšÐžÐ’ÐžÐžÐ‘Ð ÐÐ—ÐÐ«Ð™ ÐœÐÐ“ÐÐ˜Ð¢ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ â€” Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ -->
      <!-- ÐžÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÐºÐ¾Ð²Ñ‹ -->
      <path d="M-2,0 L-2,-20 Q-2,-32 10,-32 Q22,-32 22,-20 L22,0" fill="none" stroke="#4080e0" stroke-width="5" stroke-linecap="round"/>
      <!-- ÐšÑ€Ð°ÑÐ½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŽÑÐ° Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ð° (ÐºÐ¾Ð½Ñ†Ñ‹ Ð¿Ð¾Ð´ÐºÐ¾Ð²Ñ‹) -->
      <rect x="-6" y="-6" width="8" height="10" rx="2" fill="url(#mgRed)" stroke="#ff4040" stroke-width="1"/>
      <rect x="18" y="-6" width="8" height="10" rx="2" fill="url(#mgRed)" stroke="#ff4040" stroke-width="1"/>
      <!-- N Ð¸ S Ð¼ÐµÑ‚ÐºÐ¸ -->
      <text x="-2" y="1" text-anchor="middle" font-size="6" font-weight="bold" fill="white" font-family="monospace">N</text>
      <text x="22" y="1" text-anchor="middle" font-size="6" font-weight="bold" fill="white" font-family="monospace">S</text>
      <!-- ÐœÐ°Ð³Ð½Ð¸Ñ‚Ð½Ñ‹Ðµ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ð¾Ð»Ñ â€” Ð´ÑƒÐ³Ð¸ -->
      <path d="M-2,-12 Q10,-45 22,-12" fill="none" stroke="rgba(100,180,255,.5)" stroke-width="1.5" stroke-dasharray="3,2"/>
      <path d="M-2,-8 Q10,-38 22,-8" fill="none" stroke="rgba(100,180,255,.4)" stroke-width="1" stroke-dasharray="3,2"/>
      <!-- ÐŸÑ€Ð¸Ñ‚ÑÐ½ÑƒÑ‚Ñ‹Ðµ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ð¾Ð¼ -->
      <circle cx="-10" cy="-28" r="4" fill="#ffd700" stroke="#b8860b" stroke-width="1" style="animation:coinMagnet1 2s ease-in-out infinite;"/>
      <circle cx="30" cy="-24" r="3" fill="#ffd700" stroke="#b8860b" stroke-width="1" style="animation:coinMagnet2 2.5s ease-in-out infinite;"/>
      <circle cx="-8" cy="-15" r="2.5" fill="#ffd700" stroke="#b8860b" stroke-width="1" style="animation:coinMagnet3 1.8s ease-in-out infinite;"/>
      <!-- Ð¢ÐµÐºÑÑ‚ Ð¼Ð¾Ð½ÐµÑ‚ -->
      <text x="-10" y="-26" text-anchor="middle" font-size="5" fill="#b8860b">$</text>
      <text x="30" y="-22" text-anchor="middle" font-size="4" fill="#b8860b">$</text>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð¼ÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ…Ñ€Ð¾Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#60a0ff" stroke-width="2.5" opacity="${.9-i*.06}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="rgba(255,255,255,.3)" stroke-width="1"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð¼Ð°Ð³Ð½Ð¸Ñ‚ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(5,15,40,.98)" stroke="#4080e0" stroke-width="2"/>
      <ellipse cx="10" cy="342" rx="9" ry="5.5" fill="rgba(20,50,100,.8)" stroke="#60a0ff" stroke-width="1.5"/>
      <!-- ÐžÐ±Ð¼Ð¾Ñ‚ÐºÐ¸ ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð¼Ð°Ð³Ð½Ð¸Ñ‚Ð° -->
      ${[-3,-1,1,3].map(dy=>`
        <line x1="-4" y1="${342+dy}" x2="24" y2="${342+dy}" stroke="rgba(200,160,50,.6)" stroke-width="0.8"/>
      `).join('')}
      <circle cx="10" cy="342" r="3" fill="#40c0ff" style="animation:bhPulse 1s ease-in-out infinite;"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ñ€ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ -->
      <rect x="5" y="358" width="10" height="37" rx="3" fill="#1a2a4a" stroke="#4060a0" stroke-width="1.5"/>
      <!-- ÐŸÐ¾Ð»Ð¾ÑÐºÐ¸ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ -->
      ${[363,368,373,378,383,388].map(y=>`<line x1="5" y1="${y}" x2="15" y2="${y}" stroke="rgba(100,160,255,.4)" stroke-width="0.8"/>`).join('')}`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ’¥ Ð›ÐÐ—Ð•Ð ÐÐÐ¯ â€” ÑÐ²ÐµÑ‚ÑÑ‰Ð¸Ð¹ÑÑ ÑÐ½ÐµÑ€Ð³ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð»ÑƒÑ‡, sci-fi ÑÑ‚Ð¸Ð»ÑŒ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    laser: `
      <defs>
        <linearGradient id="lsBody" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#200010"/>
          <stop offset="30%" stop-color="#600020"/>
          <stop offset="50%" stop-color="#ff0040"/>
          <stop offset="70%" stop-color="#600020"/>
          <stop offset="100%" stop-color="#200010"/>
        </linearGradient>
        <linearGradient id="lsCore" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="transparent"/>
          <stop offset="30%" stop-color="#ff8080"/>
          <stop offset="50%" stop-color="#ffffff"/>
          <stop offset="70%" stop-color="#ff8080"/>
          <stop offset="100%" stop-color="transparent"/>
        </linearGradient>
        <filter id="lsGlow"><feGaussianBlur stdDeviation="4"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¿ÑƒÑ â€” Ñ‚Ñ‘Ð¼Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð» Ñ ÐºÑ€Ð°ÑÐ½Ð¾Ð¹ Ð¿Ð¾Ð´ÑÐ²ÐµÑ‚ÐºÐ¾Ð¹ -->
      <rect x="6" y="0" width="8" height="360" rx="4" fill="url(#lsBody)" stroke="#800020" stroke-width="1.5"/>
      <!-- Ð’Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ Ð»Ð°Ð·ÐµÑ€Ð½Ñ‹Ð¹ ÐºÐ°Ð½Ð°Ð» â€” ÑÐ²ÐµÑ‚Ð¸Ñ‚ÑÑ Ð¸Ð·Ð½ÑƒÑ‚Ñ€Ð¸ -->
      <rect x="8.5" y="0" width="3" height="360" rx="1.5" fill="url(#lsCore)" opacity=".8" style="animation:laserPulse 0.5s ease-in-out infinite alternate;"/>
      <!-- ÐžÑ…Ð»Ð°Ð¶Ð´Ð°ÑŽÑ‰Ð¸Ðµ Ñ€ÐµÐ±Ñ€Ð° Ð¿Ð¾ Ð±Ð¾ÐºÐ°Ð¼ -->
      ${[20,50,80,110,140,170,200,230,260,290,320,350].map((y,i)=>`
        <rect x="4" y="${y}" width="2" height="12" rx="1" fill="#400010" stroke="#800020" stroke-width="0.5" opacity=".7"/>
        <rect x="14" y="${y}" width="2" height="12" rx="1" fill="#400010" stroke="#800020" stroke-width="0.5" opacity=".7"/>
      `).join('')}
      <!-- Ð›ÐÐ—Ð•Ð ÐÐÐ¯ ÐŸÐ£Ð¨ÐšÐ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <!-- ÐšÐ¾Ñ€Ð¿ÑƒÑ Ð¿ÑƒÑˆÐºÐ¸ -->
      <rect x="2" y="-25" width="16" height="18" rx="4" fill="#1a0008" stroke="#800020" stroke-width="1.5"/>
      <rect x="4" y="-23" width="12" height="14" rx="3" fill="#2a0010" stroke="#600018" stroke-width="1"/>
      <!-- Ð›Ð¸Ð½Ð·Ð° Ð¿ÑƒÑˆÐºÐ¸ â€” Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ -->
      <circle cx="10" cy="-16" r="6" fill="rgba(0,0,0,.95)" stroke="#ff0040" stroke-width="2"/>
      <circle cx="10" cy="-16" r="4" fill="rgba(50,0,20,.8)" stroke="#ff4060" stroke-width="1"/>
      <circle cx="10" cy="-16" r="2.5" fill="#ff0040" style="animation:laserCharge 0.3s ease-in-out infinite alternate;"/>
      <circle cx="10" cy="-16" r="1" fill="#ffffff"/>
      <!-- ÐœÐ¸Ð½Ð¸-Ð»Ð¸Ð½Ð·Ñ‹ Ð¿Ð¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð°Ð¼ -->
      <circle cx="3" cy="-16" r="2.5" fill="rgba(0,0,0,.9)" stroke="#cc0030" stroke-width="1"/>
      <circle cx="3" cy="-16" r="1.5" fill="#cc0030" opacity=".6"/>
      <circle cx="17" cy="-16" r="2.5" fill="rgba(0,0,0,.9)" stroke="#cc0030" stroke-width="1"/>
      <circle cx="17" cy="-16" r="1.5" fill="#cc0030" opacity=".6"/>
      <!-- Ð›Ð°Ð·ÐµÑ€Ð½Ñ‹Ð¹ Ð»ÑƒÑ‡ Ð²Ñ‹Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð²Ð²ÐµÑ€Ñ… -->
      <line x1="10" y1="-31" x2="10" y2="-55" stroke="#ff0040" stroke-width="3" opacity=".9" style="animation:laserBeamFlicker 0.2s steps(2) infinite;"/>
      <line x1="10" y1="-31" x2="10" y2="-55" stroke="#ffffff" stroke-width="1" opacity=".7" style="animation:laserBeamFlicker 0.2s steps(2) infinite reverse;"/>
      <!-- Ð­Ð½ÐµÑ€Ð³ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð° Ð½Ð° ÑƒÐ´Ð¾Ñ‡ÐºÐµ â€” Ð³ÐµÐºÑÐ°Ð³Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#ff0040" stroke-width="2.5" opacity="${.9-i*.06}" style="animation:laserRing ${0.5+i*0.1}s ease-in-out infinite alternate;"/>
        <ellipse cx="10" cy="${y}" rx="${w-3}" ry="1.2" fill="none" stroke="rgba(255,200,200,.4)" stroke-width="1"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” ÑÐ½ÐµÑ€Ð³Ð¾Ð±Ð»Ð¾Ðº -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(10,0,5,.98)" stroke="#ff0040" stroke-width="2.5"/>
      <ellipse cx="10" cy="342" rx="8" ry="5" fill="rgba(60,0,20,.8)" stroke="#ff4060" stroke-width="1.5"/>
      <!-- Ð­Ð½ÐµÑ€Ð³ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑÑ‡ÐµÐ¹ÐºÐ¸ ÐºÐ°Ñ‚ÑƒÑˆÐºÐ¸ -->
      ${[-2,0,2].map(dx=>`<line x1="${10+dx}" y1="337" x2="${10+dx}" y2="347" stroke="#ff0040" stroke-width="0.8" opacity=".6"/>`).join('')}
      <circle cx="10" cy="342" r="3" fill="#ff0040" style="animation:laserCharge .4s ease-in-out infinite alternate;"/>
      <circle cx="10" cy="342" r="1.2" fill="#ffffff" opacity=".9"/>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” ergonomic grip -->
      <rect x="5" y="358" width="10" height="37" rx="3" fill="rgba(15,0,8,.95)" stroke="#600020" stroke-width="2"/>
      <!-- Ð Ð¸Ñ„Ð»Ñ‘Ð½Ð°Ñ Ð½Ð°ÐºÐ»Ð°Ð´ÐºÐ° -->
      ${[362,367,372,377,382,387].map(y=>`
        <rect x="5" y="${y}" width="10" height="2" rx="1" fill="#300010" stroke="#800020" stroke-width="0.5" opacity=".7"/>
      `).join('')}
      <!-- Ð›Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿ LASER Ð½Ð° Ñ€ÑƒÑ‡ÐºÐµ -->
      <text x="10" y="380" text-anchor="middle" font-size="4" font-family="monospace" fill="#ff0040" opacity=".8">LASER</text>`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸŽ„ Ð¥ÐÐ“Ð˜ Ð’ÐÐ“Ð˜ â€” Ð½Ð¾Ð²Ð¾Ð³Ð¾Ð´Ð½ÑÑ, ÑÐ¸Ð½Ðµ-Ð·ÐµÐ»Ñ‘Ð½Ð°Ñ Ð² Ð¿Ð¾Ð»Ð¾ÑÐºÑƒ, Ð¸Ð³Ñ€ÑƒÑˆÐºÐ¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    hugiwugi: `
      <defs>
        <linearGradient id="hwBody" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%"   stop-color="#0030e0"/>
          <stop offset="12%"  stop-color="#00cc44"/>
          <stop offset="25%"  stop-color="#0030e0"/>
          <stop offset="37%"  stop-color="#00cc44"/>
          <stop offset="50%"  stop-color="#0030e0"/>
          <stop offset="62%"  stop-color="#00cc44"/>
          <stop offset="75%"  stop-color="#0030e0"/>
          <stop offset="87%"  stop-color="#00cc44"/>
          <stop offset="100%" stop-color="#0030e0"/>
        </linearGradient>
        <linearGradient id="hwFur" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#c0d8ff"/>
          <stop offset="50%" stop-color="#e8f0ff"/>
          <stop offset="100%" stop-color="#c0d8ff"/>
        </linearGradient>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ â€” ÑÐ¸Ð½Ð¸Ðµ Ð¸ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ð¾ÑÑ‹ ÐºÐ°Ðº Ñƒ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸ -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#hwBody)" stroke="#2050ff" stroke-width="1.5"/>
      <!-- ÐœÐµÑ…Ð¾Ð²Ñ‹Ðµ Ð²ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ð¾Ð»Ð¾ÑÐ°Ð¼Ð¸ -->
      ${[30,90,150,210,270,330].map(y=>`
        <rect x="6" y="${y}" width="8" height="8" rx="2" fill="url(#hwFur)" opacity=".7"/>
      `).join('')}
      <!-- Ð‘Ð»ÐµÑÑ‚ÑÑ‰Ð¸Ðµ Ð¸Ð³Ñ€ÑƒÑˆÐºÐ¸ Ð½Ð° Ñ‚ÐµÐ»Ðµ -->
      <circle cx="10" cy="50" r="4" fill="#ff4444" stroke="#cc0000" stroke-width="1"/>
      <circle cx="10" cy="50" r="2" fill="#ff8888" opacity=".5"/>
      <line x1="10" y1="46" x2="10" y2="44" stroke="#888" stroke-width="1"/>
      <circle cx="10" cy="130" r="4" fill="#ffd700" stroke="#b8860b" stroke-width="1"/>
      <circle cx="10" cy="130" r="2" fill="#fff0a0" opacity=".5"/>
      <line x1="10" y1="126" x2="10" y2="124" stroke="#888" stroke-width="1"/>
      <circle cx="10" cy="210" r="4" fill="#44ff44" stroke="#00cc00" stroke-width="1"/>
      <circle cx="10" cy="210" r="2" fill="#aaffaa" opacity=".5"/>
      <line x1="10" y1="206" x2="10" y2="204" stroke="#888" stroke-width="1"/>
      <circle cx="10" cy="290" r="4" fill="#cc44ff" stroke="#8800cc" stroke-width="1"/>
      <circle cx="10" cy="290" r="2" fill="#ee99ff" opacity=".5"/>
      <line x1="10" y1="286" x2="10" y2="284" stroke="#888" stroke-width="1"/>
      <!-- Ð“ÐžÐ›ÐžÐ’Ð Ð¥ÐÐ“Ð˜ Ð’ÐÐ“Ð˜ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <!-- Ð›Ð¸Ñ†Ð¾ -->
      <circle cx="10" cy="-18" r="16" fill="#0044ff" stroke="#0022cc" stroke-width="2"/>
      <!-- Ð‘ÐµÐ»ÐºÐ¸ Ð³Ð»Ð°Ð· -->
      <circle cx="5" cy="-21" r="5" fill="white" stroke="#0022cc" stroke-width="1"/>
      <circle cx="15" cy="-21" r="5" fill="white" stroke="#0022cc" stroke-width="1"/>
      <!-- Ð—Ñ€Ð°Ñ‡ÐºÐ¸ -->
      <circle cx="5" cy="-21" r="3" fill="#1a1a1a"/>
      <circle cx="15" cy="-21" r="3" fill="#1a1a1a"/>
      <!-- Ð‘Ð»Ð¸Ðº Ð² Ð³Ð»Ð°Ð·Ð°Ñ… -->
      <circle cx="6" cy="-22.5" r="1.2" fill="white"/>
      <circle cx="16" cy="-22.5" r="1.2" fill="white"/>
      <!-- Ð Ð¾Ñ‚ â€” ÑˆÐ¸Ñ€Ð¾ÐºÐ°Ñ ÑƒÐ»Ñ‹Ð±ÐºÐ° -->
      <path d="M3,-12 Q10,-7 17,-12" fill="none" stroke="#ff3399" stroke-width="2.5" stroke-linecap="round"/>
      <!-- Ð—ÑƒÐ±Ñ‹ -->
      <rect x="5.5" y="-12" width="3" height="3" rx="0.5" fill="white"/>
      <rect x="9" y="-12" width="3" height="3" rx="0.5" fill="white"/>
      <rect x="12.5" y="-12" width="3" height="3" rx="0.5" fill="white"/>
      <!-- ÐœÐµÑ… Ð¿Ð¾ Ð±Ð¾ÐºÐ°Ð¼ Ð»Ð¸Ñ†Ð° -->
      <ellipse cx="-6" cy="-18" rx="5" ry="8" fill="#0066ff" stroke="#0033aa" stroke-width="1" opacity=".8"/>
      <ellipse cx="26" cy="-18" rx="5" ry="8" fill="#0066ff" stroke="#0033aa" stroke-width="1" opacity=".8"/>
      <!-- ÐÐ¾Ð²Ð¾Ð³Ð¾Ð´Ð½Ð¸Ð¹ ÐºÐ¾Ð»Ð¿Ð°Ðº -->
      <path d="M0,-33 L10,-60 L20,-33Z" fill="#ff2020" stroke="#cc0000" stroke-width="1"/>
      <rect x="0" y="-35" width="20" height="4" rx="2" fill="white"/>
      <circle cx="10" cy="-61" r="3" fill="white"/>
      <!-- Ð¡Ð½ÐµÐ¶Ð¸Ð½ÐºÐ¸ Ð²Ð¾ÐºÑ€ÑƒÐ³ -->
      <text x="-12" y="-35" font-size="8" opacity=".7" style="animation:snowFlake1 3s ease-in-out infinite;">â„ï¸</text>
      <text x="22" y="-28" font-size="6" opacity=".6" style="animation:snowFlake2 4s ease-in-out infinite;">â„ï¸</text>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð½Ð¾Ð²Ð¾Ð³Ð¾Ð´Ð½Ð¸Ðµ ÑˆÐ°Ñ€Ð¸ÐºÐ¸ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; const cols=['#ff4444','#ffd700','#44ff44','#cc44ff','#ff8844']; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="${cols[i]}" stroke-width="2.5" opacity=".9"/>
        <circle cx="${10+w+2}" cy="${y}" r="2.5" fill="${cols[i]}" stroke="${cols[i]}88" stroke-width="1"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð³Ð¾Ð»ÑƒÐ±Ð°Ñ Ñ Ð¼ÐµÑ…Ð¾Ð¼ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="#0033cc" stroke="#4488ff" stroke-width="2"/>
      <ellipse cx="10" cy="342" rx="9" ry="5.5" fill="rgba(180,200,255,.3)" stroke="#88aaff" stroke-width="1.5"/>
      <circle cx="10" cy="342" r="3" fill="white" opacity=".8"/>
      <text x="10" y="345" text-anchor="middle" font-size="5">â­</text>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ð¼ÐµÑ…Ð¾Ð²Ð°Ñ Ñ€ÑƒÐºÐ¾ÑÑ‚ÑŒ -->
      <rect x="5" y="358" width="10" height="37" rx="4" fill="url(#hwFur)" stroke="#aaccff" stroke-width="1.5"/>
      ${[362,367,372,377,382,387].map(y=>`<line x1="5" y1="${y}" x2="15" y2="${y}" stroke="rgba(150,180,255,.3)" stroke-width="0.8"/>`).join('')}`,

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ðŸ‡¦ðŸ‡¿ Ð£Ð”ÐžÐ§ÐšÐ Ð‘ÐÐšÐ˜ÐÐ¦Ð â€” Ð°Ð·ÐµÑ€Ð±Ð°Ð¹Ð´Ð¶Ð°Ð½ÑÐºÐ¸Ðµ Ñ†Ð²ÐµÑ‚Ð°, Ð¾Ñ€Ñ‘Ð», Ð½ÐµÑ„Ñ‚ÑŒ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    bakintsa: `
      <defs>
        <linearGradient id="bkBody" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%"   stop-color="#0092bc"/>
          <stop offset="33%"  stop-color="#0092bc"/>
          <stop offset="33%"  stop-color="#ff0000"/>
          <stop offset="66%"  stop-color="#ff0000"/>
          <stop offset="66%"  stop-color="#009900"/>
          <stop offset="100%" stop-color="#009900"/>
        </linearGradient>
        <radialGradient id="bkGold" cx="50%" cy="50%">
          <stop offset="0%" stop-color="#fff0a0"/>
          <stop offset="60%" stop-color="#ffd700"/>
          <stop offset="100%" stop-color="#b8860b"/>
        </radialGradient>
        <filter id="bkGlow"><feGaussianBlur stdDeviation="3"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <!-- Ð¢ÐµÐ»Ð¾ â€” Ñ„Ð»Ð°Ð³ ÐÐ·ÐµÑ€Ð±Ð°Ð¹Ð´Ð¶Ð°Ð½Ð° (ÑÐ¸Ð½Ð¸Ð¹-ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹-Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹) -->
      <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#bkBody)" stroke="rgba(255,215,0,.6)" stroke-width="1.5"/>
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ñ‹Ðµ ÑƒÐ·Ð¾Ñ€Ñ‹-Ð¾Ñ€Ð½Ð°Ð¼ÐµÐ½Ñ‚Ñ‹ Ð²Ð´Ð¾Ð»ÑŒ -->
      ${[45,90,135,180,225,270,315].map(y=>`
        <ellipse cx="10" cy="${y}" rx="5" ry="1.2" fill="rgba(255,215,0,.4)" stroke="rgba(255,215,0,.2)" stroke-width="0.5"/>
      `).join('')}
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð±Ð¾Ñ€Ð´ÑŽÑ€ Ð¿Ð¾ ÐºÑ€Ð°ÑÐ¼ -->
      <line x1="7" y1="0" x2="7" y2="360" stroke="rgba(255,215,0,.5)" stroke-width="1"/>
      <line x1="13" y1="0" x2="13" y2="360" stroke="rgba(255,215,0,.5)" stroke-width="1"/>
      <!-- Ð“Ð•Ð Ð‘ Ð‘ÐÐšÐ£ / Ð—Ð’Ð•Ð—Ð”Ð Ð˜ ÐŸÐžÐ›Ð£ÐœÐ•Ð¡Ð¯Ð¦ Ð½Ð° Ð²ÐµÑ€ÑˆÐ¸Ð½Ðµ -->
      <!-- Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ Ð·Ð²ÐµÐ·Ð´Ð° -->
      <circle cx="10" cy="-25" r="18" fill="rgba(0,0,0,.1)" stroke="rgba(255,215,0,.3)" stroke-width="1"/>
      <!-- ÐŸÐ¾Ð»ÑƒÐ¼ÐµÑÑÑ† -->
      <path d="M2,-30 Q10,-42 18,-30 Q12,-24 10,-22 Q8,-24 2,-30Z" fill="#ffd700" stroke="#b8860b" stroke-width="1"/>
      <!-- ÐŸÐµÑ€ÐµÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ñ‡Ð°ÑÑ‚ÑŒ Ð¿Ð¾Ð»ÑƒÐ¼ÐµÑÑÑ†Ð° Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ð¿ -->
      <circle cx="12" cy="-30" r="8" fill="rgba(0,0,0,0)" stroke="none"/>
      <path d="M6,-35 Q10,-42 14,-35 Q10,-28 6,-35Z" fill="#222" opacity=".9"/>
      <!-- 8-ÐºÐ¾Ð½ÐµÑ‡Ð½Ð°Ñ Ð·Ð²ÐµÐ·Ð´Ð° Ñ€ÑÐ´Ð¾Ð¼ -->
      ${Array.from({length:8},(_,i)=>{
        const a=i*45*Math.PI/180;
        const x1=10+Math.cos(a)*5, y1=-25+Math.sin(a)*5;
        const x2=10+Math.cos(a+22.5*Math.PI/180)*9, y2=-25+Math.sin(a+22.5*Math.PI/180)*9;
        return `<polygon points="${x1},${y1-2} ${x2},${y2} ${x1},${y1+2}" fill="#ffd700"/>`;
      }).join('')}
      <!-- ÐŸÐ»Ð°Ð¼Ñ Ð’ÐµÑ‡Ð½Ð¾Ð³Ð¾ ÐžÐ³Ð½Ñ Ð‘Ð°ÐºÑƒ -->
      <path d="M8,-45 Q10,-58 10,-65 Q12,-55 14,-48 Q11,-50 10,-44Z" fill="#ff6600" style="animation:bkuFlame 1s ease-in-out infinite alternate;"/>
      <path d="M9,-47 Q10,-55 11,-47 Q10,-43 9,-47Z" fill="#ffdd00" opacity=".8"/>
      <!-- ÐÐµÑ„Ñ‚ÑÐ½Ñ‹Ðµ ÐºÐ°Ð¿Ð»Ð¸ Ð²Ð´Ð¾Ð»ÑŒ Ñ‚ÐµÐ»Ð° -->
      <ellipse cx="10" cy="80" rx="2" ry="3.5" fill="#1a1a1a" opacity=".6"/>
      <ellipse cx="10" cy="160" rx="2" ry="3.5" fill="#1a1a1a" opacity=".5"/>
      <ellipse cx="10" cy="240" rx="2" ry="3.5" fill="#1a1a1a" opacity=".6"/>
      <!-- ÐšÐ¾Ð»ÑŒÑ†Ð° â€” Ð·Ð¾Ð»Ð¾Ñ‚Ñ‹Ðµ Ð°Ð¶ÑƒÑ€Ð½Ñ‹Ðµ -->
      ${[60,120,180,240,300].map((y,i)=>{const w=9-i*1.2; return `
        <ellipse cx="10" cy="${y}" rx="${w}" ry="2.5" fill="none" stroke="#ffd700" stroke-width="2.5" opacity="${.9-i*.06}"/>
        <ellipse cx="10" cy="${y}" rx="${w-2}" ry="1.5" fill="none" stroke="rgba(255,255,255,.3)" stroke-width="1"/>
        <circle cx="${10+w+1}" cy="${y}" r="2" fill="url(#bkGold)"/>
        <circle cx="${10-w-1}" cy="${y}" r="2" fill="url(#bkGold)"/>
      `;}).join('')}
      <!-- ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° â€” Ð·Ð¾Ð»Ð¾Ñ‚Ð°Ñ Ñ Ñ„Ð»Ð°Ð³Ð¾Ð¼ -->
      <ellipse cx="10" cy="342" rx="14" ry="9" fill="rgba(0,0,0,.9)" stroke="#ffd700" stroke-width="2.5"/>
      <ellipse cx="10" cy="342" rx="8" ry="5" fill="url(#bkGold)"/>
      <ellipse cx="10" cy="342" rx="3" ry="2" fill="#b8860b"/>
      <text x="10" y="345" text-anchor="middle" font-size="5">ðŸŒ™</text>
      <!-- Ð ÑƒÑ‡ÐºÐ° â€” Ñ€Ð¾ÑÐºÐ¾ÑˆÐ½Ð°Ñ Ð·Ð¾Ð»Ð¾Ñ‚Ð°Ñ -->
      <rect x="5" y="358" width="10" height="37" rx="3" fill="rgba(0,0,0,.9)" stroke="#ffd700" stroke-width="2"/>
      <!-- Ð Ð¾Ð¼Ð±Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ñ€Ð½Ð°Ð¼ÐµÐ½Ñ‚ Ñ€ÑƒÑ‡ÐºÐ¸ -->
      ${[362,367,372,377,382,387,392].map(y=>`
        <line x1="5" y1="${y}" x2="15" y2="${y}" stroke="rgba(255,215,0,.5)" stroke-width="0.8"/>
      `).join('')}
      <text x="10" y="380" text-anchor="middle" font-size="4" font-family="serif" fill="#ffd700" opacity=".9">ðŸ‡¦ðŸ‡¿</text>`,
  };

  // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ, Ð¸Ð½Ð°Ñ‡Ðµ Ð´ÐµÑ„Ð¾Ð»Ñ‚Ð½Ñ‹Ð¹
  const body = specials[rod.id] || `
    <rect x="7" y="0" width="6" height="360" rx="3" fill="url(#dfGrad)" stroke="${c}" stroke-width="0.5"/>
    <defs><linearGradient id="dfGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c}80"/><stop offset="50%" stop-color="${c}"/><stop offset="100%" stop-color="${c}80"/></linearGradient></defs>
    ${rings(c)}${reel(c)}${handle(c)}`;

  const anim = rod.id === 'apocalypse' ? 'animation:apocalypseShake .3s steps(3) infinite;' :
               rod.id === 'quantum'    ? 'animation:quantumFlicker .8s steps(2) infinite;' :
               rod.id === 'thunder'    ? 'animation:thunderZap 3s steps(1) infinite;' :
               rod.id === 'pharaoh'   ? 'animation:pharaohGlow 2s ease-in-out infinite alternate;' :
               rod.id === 'neon'      ? 'animation:neonScan 1.5s ease-in-out infinite;' :
               rod.id === 'kraken'    ? 'animation:krakenTentacle 2.5s ease-in-out infinite;' :
               rod.id === 'time'      ? 'animation:timeFreeze 5s ease-in-out infinite;' :
               rod.id === 'blackhole' ? 'animation:bhPulse 1s ease-in-out infinite;' :
               rod.id === 'rainbow'   ? 'animation:rainbowShift 3s linear infinite;' :
               rod.id === 'laser'     ? 'animation:laserPulse 0.5s ease-in-out infinite alternate;' :
               rod.id === 'hugiwugi'  ? 'animation:neonScan 2s ease-in-out infinite;' :
               rod.id === 'bakintsa'  ? 'animation:pharaohGlow 1.5s ease-in-out infinite alternate;' : '';

  return `<svg id="rod-svg-ingame" viewBox="-15 -15 50 420"
    xmlns="http://www.w3.org/2000/svg"
    style="position:absolute;top:0;right:-10px;width:50px;height:100%;overflow:visible;pointer-events:none;${glow}${anim}">
    ${body}
  </svg>`;
}

function updateRodVisual() {
  const rod = gs.currentRod;
  const rc = ROD_COLORS[rod.id] || ROD_COLORS.wood;
  const rodWrapper = document.getElementById('rod-wrapper');
  const rodBody = document.getElementById('rod-body');
  const rodReel = document.getElementById('rod-reel');

  // --- Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ SVG ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ ---
  const oldSvg = document.getElementById('rod-svg-ingame');
  if(oldSvg) oldSvg.remove();

  // ÐŸÑ€ÑÑ‡ÐµÐ¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ rod-body/reel Ð¸ ÑÑ‚Ð°Ð²Ð¸Ð¼ Ð½Ð°Ñˆ ÐºÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ SVG
  rodBody.style.visibility = 'hidden';
  rodBody.style.opacity = '0';
  if(rodReel) { rodReel.style.visibility = 'hidden'; rodReel.style.opacity = '0'; }

  // Ð’ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ SVG â€” Ð¾Ð½ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð²ÐµÑÑŒ rod-wrapper
  rodWrapper.insertAdjacentHTML('beforeend', makeIngameRodSVG(rod));
  rodWrapper.style.filter = rc.glow !== 'none' ? `drop-shadow(0 0 8px ${rc.color})` : '';
  rodWrapper.style.overflow = 'visible';

  document.getElementById('current-rod-name').textContent = 'ðŸŽ£ '+rod.name;
  document.getElementById('current-rod-name').style.color = rc.color;
  document.getElementById('current-rod-name').style.textShadow = rc.glow !== 'none' ? `0 0 8px ${rc.color}` : '';
  const statsEl = document.getElementById('current-rod-stats');
  if(statsEl) { statsEl.textContent = rod.stats || ''; statsEl.style.color = rc.glow !== 'none' ? rc.color+'cc' : '#a0c8e0'; }
}



// ============================================================
// MULTIPLAYER ROD 2 â€” Show partner's rod with animation
// ============================================================
// Second bobber for partner
let bob2X = 180, bob2Y = 380;
let partnerPhase = 'idle'; // 'idle' | 'waiting' | 'bite'
let partner2Timer = null;

function simulatePartner2() {
  if(!gs.fullMultiMode || !currentRoomId) return;
  // Find another player in the room
  const others = Object.entries(playersData).filter(([pid])=>pid!==myPlayerId);
  if(!others.length) return;
  
  const lctx2 = document.getElementById('linecanvas2').getContext('2d');
  if(partnerPhase === 'idle') {
    // Partner casts
    bob2X = 60 + Math.random()*140;
    bob2Y = 320 + Math.random()*120;
    partnerPhase = 'waiting';
    // Draw line from left rod
    lctx2.clearRect(0,0,360,700);
    lctx2.beginPath();
    lctx2.moveTo(30, 90);
    lctx2.quadraticCurveTo(bob2X-20, 60, bob2X, bob2Y);
    lctx2.strokeStyle='rgba(180,170,140,.65)'; lctx2.lineWidth=1.2;
    lctx2.setLineDash([4,3]); lctx2.stroke(); lctx2.setLineDash([]);
    
    // Random bite after 3-8 seconds
    clearTimeout(partner2Timer);
    partner2Timer = setTimeout(()=>{
      if(!gs.fullMultiMode) return;
      partnerPhase = 'bite';
      // Flash the rod2
      document.getElementById('rod-body2').style.filter = 'brightness(2)';
      setTimeout(()=>{
        document.getElementById('rod-body2').style.filter='';
        partnerPhase = 'idle';
        lctx2.clearRect(0,0,360,700);
        setTimeout(simulatePartner2, 1000 + Math.random()*2000);
      }, 1200);
    }, 3000 + Math.random()*5000);
  }
}



// Periodic sync every 8s
setInterval(()=>{ if(gs.fullMultiMode&&currentRoomId) syncFishingToFirebase(); },8000);

let _lastSyncedCoins = -1;
let _lastSyncedFish = -1;

function syncFishingToFirebase() {
  if(!firebaseDB||!currentRoomId||!gs.fullMultiMode) return;
  fb.upd(`rooms/${currentRoomId}`,{
    sharedCoins:gs.coins,
    sharedFishCount:gs.fishCount,
    sharedInventory:JSON.stringify(gs.inventory),
    lastSyncer:myPlayerId,
    lastSyncTime:Date.now()
  }).catch(()=>{});
  _lastSyncedCoins = gs.coins;
  _lastSyncedFish = gs.fishCount;
}


// ============================================================
// GARDEN SCENE EXTENSION for kiosk - override first definition
// ============================================================
// This replaces the earlier showGardenScene to add kiosk support

// Override walkToShop to show choice
function walkToShop() {
  fadeScene(()=>{
    showGardenScene('road');
    document.getElementById('road-hint').textContent='Ð˜Ð´Ñ‘Ð¼...';
    document.getElementById('road-choice').style.display='none';
    const walker=document.getElementById('walker');
    walker.className='walker to-shop';
    walker.style.bottom='200px';
    updatePlayerLocation('garden-road');
    setTimeout(()=>{
      document.getElementById('road-hint').textContent='ÐŸÑ€Ð¸ÑˆÐ»Ð¸! ÐšÑƒÐ´Ð° Ð¸Ð´Ñ‘Ð¼?';
      document.getElementById('road-choice').style.display='flex';
    }, 2500);
  });
}

function enterShopFromRoad() {
  // Click on door = go to plant shop
  if(document.getElementById('road-choice').style.display==='flex') {
    enterShop();
  }
}

// (switchScreen, renderShop, saveGame wrappers merged into originals above)

// Load extra on startup
(function loadExtra() {
  try {
    const raw = localStorage.getItem('fishing_reborn_extra');
    if(!raw) return;
    const d = JSON.parse(raw);
    gs.pikaCoins = d.pikaCoins || 0;
    gs.pikaCatchCount = d.pikaCatchCount || 0;
    if(d.mapMode) { gs.mapMode = d.mapMode; }
    gs.coastUnlocked = d.coastUnlocked || false;
    gs.caughtPokemon = d.caughtPokemon || [];
    gs.xp = d.xp || 0;
    gs.achievements = d.achievements || {};
    gs.catchStreak = d.catchStreak || 0;
    gs._caughtLegend = d._caughtLegend || false;
    gs._coastCatch = d._coastCatch || false;
    gs._duckCatches = d._duckCatches || 0;
    gs._soldAll = d._soldAll || false;
  } catch(e){}
})();

// ============================================================
// INIT â€” apply rod visual on load
// ============================================================
setTimeout(()=>{
  updateRodVisual();
  updatePikaCoins();
  updateLevelUI();
  updateStreakUI();
  if(gs.mapMode === 'pokemon') setMap('pokemon');
  if(gs.mapMode === 'coast') setMap('coast');
  if(gs.mapMode === 'easter') setMap('easter');
  // ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÐµ: ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð°
  if(!gs.coastUnlocked) {
    const cb = document.getElementById('map-btn-coast');
    if(cb) cb.style.display='none';
  }
  // Check for pending kiosk payments on startup (sold while offline)
  initFirebase().then(ok=>{ if(ok) { startKioskPaymentListener(); startChatListener(); } });
  scheduleNextEvent();
  // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ
  checkAndShowGift();
}, 100);

// Leaderboard auto-refresh when on lb screen
setInterval(()=>{
  if(gs.currentScreen==='leaderboard') renderLeaderboard();
}, 30000);






// ============================================================
// DEBUG â€” uncomment to reset save
// ============================================================
// localStorage.removeItem(SAVE_KEY);
function saveGarden() {
  // Ð¿Ñ€Ð¸Ð¼ÐµÑ€ â€” ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÑÐ°Ð´ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
  localStorage.setItem('garden', JSON.stringify(gardenPlots));
}

// ============================================================
// ðŸ‘‘ OG Ð Ð«Ð‘Ð« â€” ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð¾Ð²Ð¾Ð¹ Ñ€ÐµÐ´ÐºÐ¾ÑÑ‚Ð¸
// ============================================================
// Patch getRarityLabel/color for OG
const _origGetRarityStyle = window.getRarityStyle;
function getOgStyle(rar) {
  if(rar==='og') return {label:'ðŸ‘‘ OG', cls:'rarity-og', col:'#ff80ff'};
  return null;
}

// Patch catch popup for OG
const _origShowCatchPopup = window.showCatchPopup;

// OG fish spawn: very rare, shark rod gives them always
// Patch pickFish to handle OG and shark rod
const _origPickFish = window.pickFish;

// Shark rod special: always OG or legend
function sharkRodPickFish() {
  const ogFish = FISH_DATA.filter(f=>f.og);
  const f = ogFish[Math.floor(Math.random()*ogFish.length)];
  const w = (f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2);
  return {...f, weight:w};
}

// ============================================================
// ðŸ¦ˆ BOSS FIGHT â€” Ð“Ð˜Ð‘Ð Ð˜Ð” ÐÐšÐ£Ð›Ð
// ============================================================
const BOSS_KEY = 'fishing_boss_defeated_v1';
const UPDATE_KEY = 'fishing_update_v2_seen';

let bossState = {
  active: false,
  hp: 1000,
  maxHp: 1000,
  phase: 1, // 1 = normal, 2 = enraged (<50%), 3 = final (<20%)
  hits: 0,
  combo: 0,
  comboTimer: null,
  cutsceneStep: 0,
};

function checkBossFirstVisit() {
  if(localStorage.getItem(UPDATE_KEY)) return;
  localStorage.setItem(UPDATE_KEY, '1');
  // Show boss intro after a short delay
  setTimeout(startBossIntro, 1200);
}

function startBossIntro() {
  bossState.active = true;
  bossState.hp = bossState.maxHp;
  bossState.phase = 1;
  bossState.hits = 0;
  bossState.combo = 0;

  const overlay = document.getElementById('boss-overlay');
  overlay.classList.add('active');
  document.getElementById('boss-cutscene').innerHTML = '';
  document.getElementById('boss-hp-wrap').style.display = 'none';
  document.getElementById('boss-attack-zone').style.display = 'none';
  document.getElementById('boss-victory').classList.remove('show');

  // Run cutscene sequence
  const steps = [
    {delay:0,    text:'âš¡ ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð• v2.0 âš¡', sub:'Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð´Ð²Ð¸Ð¶ÐµÑ‚ÑÑ Ð² Ð³Ð»ÑƒÐ±Ð¸Ð½Ð°Ñ…...'},
    {delay:2200, text:'ðŸŒŠ Ð’Ð¾Ð´Ñ‹ Ð¿Ð¾Ñ‚ÐµÐ¼Ð½ÐµÐ»Ð¸...', sub:'ÐžÐ³Ñ€Ð¾Ð¼Ð½Ð°Ñ Ñ‚ÐµÐ½ÑŒ Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°ÐµÑ‚ÑÑ ÑÐ¾ Ð´Ð½Ð°!'},
    {delay:4400, text:'ðŸ’¥ Ð“Ð˜Ð‘Ð Ð˜Ð” ÐÐšÐ£Ð›Ð!', sub:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹ Ð¼ÑƒÑ‚Ð°Ð½Ñ‚ Ð¸Ð· Ð³Ð»ÑƒÐ±Ð¸Ð½! Ð£Ð±Ð¸Ñ‚ÑŒ ÐµÑ‘ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶ÐµÐ»Ð¾...', big:true},
    {delay:6600, text:'âš”ï¸ Ðš Ð‘ÐžÐ®!', sub:'ÐÐ°Ð¶Ð¸Ð¼Ð°Ð¹ Ð£Ð”ÐÐ  ÐºÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ! Ð—Ð° Ð¿Ð¾Ð±ÐµÐ´Ñƒ Ð¶Ð´ÑƒÑ‚ Ð½Ð¸ÑˆÑ‚ÑÐºÐ¸!'},
  ];

  steps.forEach((s,i)=>{
    setTimeout(()=>{
      const cs = document.getElementById('boss-cutscene');
      cs.innerHTML = '';

      // Show shark SVG on step 2+
      if(i>=2){
        cs.innerHTML += `<div id="boss-shark-wrap">
          <svg id="boss-shark-svg" width="200" height="140" viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="sharkG" cx="40%" cy="40%">
                <stop offset="0%" stop-color="#60c8e8"/>
                <stop offset="60%" stop-color="#208aaa"/>
                <stop offset="100%" stop-color="#104060"/>
              </radialGradient>
              <filter id="sharkGlow">
                <feGaussianBlur stdDeviation="4" result="blur"/>
                <feComposite in="SourceGraphic" in2="blur" operator="over"/>
              </filter>
            </defs>
            <!-- Body -->
            <ellipse cx="100" cy="70" rx="80" ry="35" fill="url(#sharkG)" stroke="#0a3050" stroke-width="2" filter="url(#sharkGlow)"/>
            <!-- Belly -->
            <ellipse cx="100" cy="82" rx="55" ry="16" fill="#c0e8f8" opacity=".6"/>
            <!-- Tail -->
            <polygon points="180,70 200,40 200,100" fill="#208aaa" stroke="#0a3050" stroke-width="1.5"/>
            <!-- Dorsal fin -->
            <polygon points="90,35 110,10 115,35" fill="#1a6888" stroke="#0a3050" stroke-width="1.5"/>
            <!-- Pectoral fins -->
            <polygon points="75,75 55,95 80,85" fill="#1a6888" stroke="#0a3050" stroke-width="1"/>
            <!-- Eye -->
            <circle cx="35" cy="65" r="8" fill="#001020" stroke="#40a0c0" stroke-width="2"/>
            <circle cx="33" cy="63" r="3" fill="#40e8ff" opacity=".8"/>
            <!-- Teeth -->
            <path d="M22,72 L28,78 L34,72 L40,78 L46,72" stroke="#fff" stroke-width="2" fill="none"/>
            <!-- Scars / hybrid mutations -->
            <path d="M60,55 L80,60 L60,65" stroke="#ff4040" stroke-width="2" fill="none" opacity=".7"/>
            <circle cx="120" cy="60" r="5" fill="#ff2020" opacity=".6"/>
            <path d="M140,50 Q160,45 155,65" stroke="#ff4040" stroke-width="2.5" fill="none" opacity=".8"/>
            <!-- Glow lines -->
            <path d="M30,70 Q100,60 175,70" stroke="rgba(0,200,255,.3)" stroke-width="1.5" fill="none"/>
          </svg>
        </div>`;
      }

      const div1 = document.createElement('div');
      div1.className = 'boss-cs-text';
      if(s.big) div1.style.fontSize='28px';
      div1.textContent = s.text;
      cs.appendChild(div1);

      const div2 = document.createElement('div');
      div2.className = 'boss-cs-sub';
      div2.textContent = s.sub;
      cs.appendChild(div2);

      // Screen shake on big step
      if(s.big) {
        shakeScreen();
        setTimeout(shakeScreen, 300);
        setTimeout(shakeScreen, 600);
      }

    }, s.delay);
  });

  // Start actual fight after cutscenes
  setTimeout(startBossFight, 8500);
}

function shakeScreen() {
  const g = document.getElementById('game');
  g.style.animation = 'none';
  void g.offsetWidth;
  g.style.animation = 'bossShake 0.4s ease';
  setTimeout(()=>{ g.style.animation=''; }, 400);
}

// Add shake keyframe dynamically
(function(){
  const style = document.createElement('style');
  style.textContent = `@keyframes bossShake{0%{transform:translate(0,0)}15%{transform:translate(-6px,4px)}30%{transform:translate(6px,-4px)}45%{transform:translate(-4px,2px)}60%{transform:translate(4px,-2px)}75%{transform:translate(-2px,1px)}100%{transform:translate(0,0)}}`;
  document.head.appendChild(style);
})();

function startBossFight() {
  document.getElementById('boss-cutscene').innerHTML = `
    <div id="boss-shark-wrap" style="margin-bottom:20px">
      <svg id="boss-shark-svg" width="160" height="110" viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <radialGradient id="sharkG2" cx="40%" cy="40%">
            <stop offset="0%" stop-color="#60c8e8"/>
            <stop offset="60%" stop-color="#208aaa"/>
            <stop offset="100%" stop-color="#104060"/>
          </radialGradient>
        </defs>
        <ellipse cx="100" cy="70" rx="80" ry="35" fill="url(#sharkG2)" stroke="#0a3050" stroke-width="2"/>
        <ellipse cx="100" cy="82" rx="55" ry="16" fill="#c0e8f8" opacity=".6"/>
        <polygon points="180,70 200,40 200,100" fill="#208aaa" stroke="#0a3050" stroke-width="1.5"/>
        <polygon points="90,35 110,10 115,35" fill="#1a6888" stroke="#0a3050" stroke-width="1.5"/>
        <polygon points="75,75 55,95 80,85" fill="#1a6888" stroke="#0a3050" stroke-width="1"/>
        <circle cx="35" cy="65" r="8" fill="#001020" stroke="#40a0c0" stroke-width="2"/>
        <circle cx="33" cy="63" r="3" fill="#40e8ff" opacity=".8"/>
        <path d="M22,72 L28,78 L34,72 L40,78 L46,72" stroke="#fff" stroke-width="2" fill="none"/>
        <path d="M60,55 L80,60 L60,65" stroke="#ff4040" stroke-width="2" fill="none" opacity=".7"/>
        <circle cx="120" cy="60" r="5" fill="#ff2020" opacity=".6"/>
        <path d="M140,50 Q160,45 155,65" stroke="#ff4040" stroke-width="2.5" fill="none" opacity=".8"/>
      </svg>
    </div>`;

  document.getElementById('boss-hp-wrap').style.display = 'block';
  document.getElementById('boss-attack-zone').style.display = 'block';
  updateBossHpBar();
}

function updateBossHpBar() {
  const pct = Math.max(0, bossState.hp / bossState.maxHp * 100);
  document.getElementById('boss-hp-fill').style.width = pct + '%';
  document.getElementById('boss-hp-text').textContent = Math.max(0,bossState.hp) + '/' + bossState.maxHp + ' HP';

  // Color change by phase
  const fill = document.getElementById('boss-hp-fill');
  if(pct < 20) fill.style.background = 'linear-gradient(to right,#ff0000,#ff0050)';
  else if(pct < 50) fill.style.background = 'linear-gradient(to right,#ff4000,#ff8000)';
  else fill.style.background = 'linear-gradient(to right,#ff0000,#ff6000,#ffcc00)';
}

let _lastBossAttack = 0;
function bossAttack() {
  if(!bossState.active) return;

  const now = Date.now();
  const timeSinceLastHit = now - _lastBossAttack;
  _lastBossAttack = now;

  // Combo system
  if(timeSinceLastHit < 800) {
    bossState.combo++;
  } else {
    bossState.combo = 1;
  }

  clearTimeout(bossState.comboTimer);
  bossState.comboTimer = setTimeout(()=>{ bossState.combo=0; }, 1200);

  // Damage calculation
  let dmg = 30 + Math.random()*20;
  if(bossState.combo >= 5) dmg *= 2.5;
  else if(bossState.combo >= 3) dmg *= 1.5;
  dmg = Math.floor(dmg);

  bossState.hp -= dmg;
  bossState.hits++;
  updateBossHpBar();

  // Combo text
  const comboTxt = document.getElementById('boss-combo-txt');
  if(bossState.combo >= 3) {
    comboTxt.textContent = 'ðŸ”¥ x' + bossState.combo + ' ÐšÐžÐœÐ‘Ðž! Ã—' + (bossState.combo>=5?'2.5':'1.5') + ' ÑƒÑ€Ð¾Ð½!';
    comboTxt.style.color = bossState.combo >= 5 ? '#ff4040' : '#ffd060';
  } else {
    comboTxt.textContent = '-' + dmg + ' HP';
    comboTxt.style.color = '#c0f8ff';
  }

  // Spawn mini shark particles
  spawnMiniSharks(3);

  // Phase transitions
  const pct = bossState.hp / bossState.maxHp;
  if(pct <= 0.5 && bossState.phase === 1) {
    bossState.phase = 2;
    showBossPhaseMsg('ðŸ˜¡ Ð‘Ð•Ð¨Ð•ÐÐ¡Ð¢Ð’Ðž! ÐÐºÑƒÐ»Ð° Ñ€Ð°Ð·Ð¾Ð·Ð»Ð¸Ð»Ð°ÑÑŒ!', '#ff8040');
    shakeScreen(); shakeScreen();
    // Make shark look angry
    document.getElementById('boss-shark-svg').style.filter = 'drop-shadow(0 0 20px #ff4000) hue-rotate(30deg)';
  }

  if(pct <= 0.2 && bossState.phase === 2) {
    bossState.phase = 3;
    showBossPhaseMsg('ðŸ’€ ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð™ Ð Ð«Ð’ÐžÐš!', '#ff0040');
    shakeScreen(); setTimeout(shakeScreen,200); setTimeout(shakeScreen,400);
    document.getElementById('boss-shark-svg').style.filter = 'drop-shadow(0 0 30px #ff0000) hue-rotate(60deg) brightness(1.5)';
  }

  // Death
  if(bossState.hp <= 0) {
    bossState.hp = 0;
    bossState.active = false;
    updateBossHpBar();
    setTimeout(showBossVictory, 600);
  }
}

function spawnMiniSharks(count) {
  const overlay = document.getElementById('boss-overlay');
  for(let i=0;i<count;i++){
    const ms = document.createElement('div');
    ms.className = 'mini-shark';
    ms.textContent = 'ðŸ¦ˆ';
    const sx = -60 + Math.random()*120;
    const sy = -60 + Math.random()*40;
    const sx2 = -80 + Math.random()*160;
    const sy2 = -120 + Math.random()*60;
    ms.style.cssText = `left:${120+Math.random()*100}px;top:${200+Math.random()*80}px;--msx:${sx}px;--msy:${sy}px;--msx2:${sx2}px;--msy2:${sy2}px;`;
    overlay.appendChild(ms);
    setTimeout(()=>{ if(ms.parentNode) ms.parentNode.removeChild(ms); }, 1600);
  }
}

function showBossPhaseMsg(text, color) {
  const el = document.getElementById('boss-phase-msg');
  el.textContent = text;
  el.style.color = color;
  el.style.textShadow = `0 0 20px ${color}`;
  el.style.display = 'block';
  el.style.animation = 'none';
  void el.offsetWidth;
  el.style.animation = 'csTextIn 0.5s ease forwards';
  setTimeout(()=>{ el.style.display='none'; }, 2500);
}

function showBossVictory() {
  shakeScreen(); setTimeout(shakeScreen,150); setTimeout(shakeScreen,300);

  // Rewards
  const sharkSkinCount = 1 + Math.floor(bossState.hits / 20);
  const bonusCoins = 5000 + bossState.hits * 50;

  // Give shark skin (stored in gs)
  gs.sharkSkins = (gs.sharkSkins || 0) + sharkSkinCount;
  gs.coins += bonusCoins;
  updateCoins();

  // Give some OG fish
  const ogFishPool = FISH_DATA.filter(f=>f.og);
  const ogGifts = 2;
  const giftedOg = [];
  for(let i=0;i<ogGifts;i++){
    const f = ogFishPool[Math.floor(Math.random()*ogFishPool.length)];
    const w = (f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2);
    if(gs.inventory.length < gs.maxInv) gs.inventory.push({...f, weight:w});
    giftedOg.push(f.name);
  }

  // Mark boss as defeated
  localStorage.setItem(BOSS_KEY, '1');

  // Victory screen
  const rewards = document.getElementById('boss-reward-list');
  rewards.innerHTML = `
    <div class="boss-reward-item">ðŸ¦ˆ ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹ Ã— ${sharkSkinCount}</div>
    <div class="boss-reward-item">ðŸ’° +${bonusCoins.toLocaleString()} Ð¼Ð¾Ð½ÐµÑ‚</div>
    <div class="boss-reward-item">ðŸ‘‘ OG Ð Ñ‹Ð±Ñ‹: ${giftedOg.join(', ')}</div>
    <div class="boss-reward-item" style="font-size:12px;color:#80c8ff;margin-top:8px">ðŸ”¨ Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐºÑ€Ð°Ñ„Ñ‚Ð¸Ñ‚ÑŒ ÐÐºÑƒÐ»ÑŒÑŽ Ð£Ð´Ð¾Ñ‡ÐºÑƒ!</div>`;

  document.getElementById('boss-hp-wrap').style.display = 'none';
  document.getElementById('boss-attack-zone').style.display = 'none';
  document.getElementById('boss-cutscene').innerHTML = '';
  document.getElementById('boss-victory').classList.add('show');

  // Add achievement
  gs.achievements = gs.achievements || {};
  gs.achievements['boss_killed'] = Date.now();
  addXP(1000);
  saveGame();

  // Big coin burst
  for(let i=0;i<5;i++) setTimeout(()=>coinBurst(120+Math.random()*120, 200+Math.random()*100), i*200);
}

function closeBossFight() {
  document.getElementById('boss-overlay').classList.remove('active');
  bossState.active = false;
  showToast('ðŸ¦ˆ Ð“Ð¸Ð±Ñ€Ð¸Ð´ ÐÐºÑƒÐ»Ð° Ð¿Ð¾Ð²ÐµÑ€Ð¶ÐµÐ½Ð°! ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð¸ Ð»Ð°Ð²ÐºÑƒ!');
  // Refresh shop to show craft button
  if(gs.currentScreen === 'shop') renderShop();
}

// ============================================================
// ðŸ”¨ ÐšÐ ÐÐ¤Ð¢ ÐÐšÐ£Ð›Ð¬Ð•Ð™ Ð£Ð”ÐžÐ§ÐšÐ˜
// ============================================================
function craftSharkRod() {
  if((gs.sharkSkins||0) < 1) {
    showToast('âŒ ÐÑƒÐ¶Ð½Ð° ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹ (ÑƒÐ±ÐµÐ¹ Ð“Ð¸Ð±Ñ€Ð¸Ð´ ÐÐºÑƒÐ»Ñƒ)!');
    return;
  }
  if(gs.coins < 10000) {
    showToast('âŒ ÐÑƒÐ¶Ð½Ð¾ 10000 Ð¼Ð¾Ð½ÐµÑ‚!');
    return;
  }
  const sharkRod = RODS.find(r=>r.id==='shark');
  if(!sharkRod) return;
  if(sharkRod.owned) {
    showToast('âœ… ÐÐºÑƒÐ»ÑŒÑ Ð£Ð´Ð¾Ñ‡ÐºÐ° ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ!');
    return;
  }
  gs.sharkSkins--;
  gs.coins -= 10000;
  updateCoins();
  sharkRod.owned = true;
  showToast('ðŸ¦ˆ ÐÐºÑƒÐ»ÑŒÑ Ð£Ð´Ð¾Ñ‡ÐºÐ° ÑÐºÑ€Ð°Ñ„Ñ‚Ð»ÐµÐ½Ð°! ÐÐ°Ð´ÐµÐ²Ð°Ð¹ Ð² Ð»Ð°Ð²ÐºÐµ!');
  saveGame();
  renderShop();
}

// Patch renderRods to show shark rod craft option
const _origRenderRods = window.renderRods;
function renderRods(body) {
  RODS.forEach(rod=>{
    const owned=rod.owned||false;
    const equipped=rod.equipped||false;
    let btnHtml;

    if(rod.craftable && !owned) {
      const canCraft = (gs.sharkSkins||0) >= 1 && gs.coins >= 10000;
      const bossKilled = !!localStorage.getItem(BOSS_KEY);
      if(!bossKilled) {
        btnHtml = `<button class="shop-item-btn btn-owned-shop" style="font-size:10px">ðŸ”’ Ð£Ð±ÐµÐ¹ ÐÐºÑƒÐ»Ñƒ</button>`;
      } else {
        btnHtml = `<button class="craft-rod-btn" onclick="craftSharkRod()" style="font-size:12px;padding:5px 10px"${canCraft?'':' disabled'}>ðŸ”¨ ÐšÑ€Ð°Ñ„Ñ‚ (ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹ + 10ÐºðŸª™)</button>`;
      }
    } else if(equipped) {
      btnHtml=`<button class="shop-item-btn btn-equipped-shop">âœ“ ÐÐ°Ð´ÐµÑ‚Ð°</button>`;
    } else if(owned) {
      btnHtml=`<button class="shop-item-btn btn-equip-shop" onclick="equipRod('${rod.id}')">ÐÐ°Ð´ÐµÑ‚ÑŒ</button>`;
    } else {
      btnHtml=`<button class="shop-item-btn btn-buy-shop" onclick="buyRod('${rod.id}')">ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ</button>`;
    }

    const cls=equipped?'equipped':owned?'owned':'';
    const statsExtra = rod.id==='shark' ? (rod.stats + (gs.sharkSkins?' â€¢ ðŸ¦ˆ ÐšÐ¾Ð¶Ð¸: '+(gs.sharkSkins||0):'')) : rod.stats;
    const el=makeShopItem(
      rodIconSVG(rod), rod.name, rod.desc, statsExtra,
      (owned||rod.craftable)?'':rod.price, btnHtml, cls
    );
    body.appendChild(el);
  });
}

// ============================================================
// ðŸ¦ˆ SHARK ROD SPECIAL ABILITY â€” Mini sharks hunt OG
// ============================================================
// Override pickFish for shark rod
function pickFishPatched() {
  const rod = gs.currentRod;
  if(rod.id === 'shark') {
    // Always pick OG or coastal legend
    const ogFish = FISH_DATA.filter(f=>f.og||f.rar==='coastal_legend');
    const f = ogFish[Math.floor(Math.random()*ogFish.length)];
    // Spawn mini sharks as visual
    setTimeout(()=>{ for(let i=0;i<4;i++) spawnMiniSharkOnScreen(); }, 200);
    return f;
  }
  return null; // Fall through to original
}

function spawnMiniSharkOnScreen() {
  const fs = document.getElementById('fishing-screen');
  if(!fs) return;
  const ms = document.createElement('div');
  ms.style.cssText = `position:absolute;font-size:18px;z-index:50;pointer-events:none;animation:swimAcross 2s linear forwards;top:${280+Math.random()*80}px;`;
  ms.textContent = 'ðŸ¦ˆ';
  fs.appendChild(ms);
  setTimeout(()=>{ if(ms.parentNode) ms.parentNode.removeChild(ms); }, 2100);
}

// ============================================================
function harvestPlot(idx) {
  const p = gardenPlots[idx];
  if(!p || p.state !== 'ready') return;
  const seed = SEEDS.find(s=>s.id===p.seedId);
  if(!seed) return;

  // â•â•â• Ð“Ð¸Ð±Ñ€Ð¸Ð´ â€” Ð¾ÑÐ¾Ð±Ð°Ñ Ð½Ð°Ð³Ñ€Ð°Ð´Ð° â•â•â•
  if(seed.special === 'hybrid') {
    const roll = Math.random();
    let bonus = '';
    if(roll < 0.33) {
      gs.coins += 2000; updateCoins(); bonus = 'ðŸ’° +2000 Ð¼Ð¾Ð½ÐµÑ‚!';
    } else if(roll < 0.66) {
      gs._ogLureActive = Date.now() + 60000; bonus = 'ðŸŽ£ OG ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ° Ð½Ð° 60 ÑÐµÐº!';
    } else {
      gs.sharkSkins = (gs.sharkSkins||0) + 1; bonus = 'ðŸ¦ˆ +1 ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹!';
    }
    gardenFlowersSold++;
    p.state='empty'; p.seedId=null; p.plantedAt=0;
    updateCoins(); renderGardenPlots(); coinBurst(180,350);
    showToast('ðŸŒº Ð“Ð¸Ð±Ñ€Ð¸Ð´ Ð´Ð°Ð»: ' + bonus);
    saveGame(); saveGarden();
    return;
  }

  // â•â•â• ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ ÑƒÑ€Ð¾Ð¶Ð°Ð¹ â•â•â•
  const price = seed.sellPrice;
  gs.coins += price;
  gardenFlowersSold++;
  p.state='empty'; p.seedId=null; p.plantedAt=0;
  updateCoins(); renderGardenPlots(); coinBurst(180,350);
  showToast(`${seed.flower} ${seed.name} Ð¿Ñ€Ð¾Ð´Ð°Ð½Ð° Ð·Ð° ${price}ðŸª™!`);
  if(seed.bonusEffect==='bite') showToast('ðŸ€ Ð‘Ð¾Ð½ÑƒÑ ÐºÐ»Ñ‘Ð²Ð° +10% Ð½Ð° 60Ñ!');
  saveGame(); saveGarden();
  if(gs.fullMultiMode) syncGardenToFirebase();
}

// ============================================================
// OG FISH â€” patch catch rarity display
// ============================================================
// Patch the rarity badge in showCatchPopup
const _origGetRarBadge = window.getRarBadge;
function getRarBadge(rar) {
  if(rar==='og') return '<div class="catch-rarity rarity-og" style="display:inline-block;padding:3px 12px;border-radius:8px;margin-top:4px;font-family:Neucha,cursive;font-size:13px">ðŸ‘‘ OG â€” Ð›ÐµÐ³ÐµÐ½Ð´Ð° Ð›ÐµÐ³ÐµÐ½Ð´!</div>';
  if(_origGetRarBadge) return _origGetRarBadge(rar);
  const map = {common:'rarity-common',rare:'rarity-rare',epic:'rarity-epic',legend:'rarity-legend',coastal_legend:'rarity-legend og'};
  const labels = {common:'ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹',rare:'Ð ÐµÐ´ÐºÐ¸Ð¹',epic:'Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹',legend:'Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ð¹!',coastal_legend:'ðŸŒŠ Ð›ÐµÐ³ÐµÐ½Ð´Ð° ÐŸÐ¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑ',og:'ðŸ‘‘ OG!'};
  return '<div class="catch-rarity '+(map[rar]||'rarity-common')+'">'+(labels[rar]||rar)+'</div>';
}

// ============================================================
// OG LURE â€” modify pickFish to give OG fish occasionally
// ============================================================
// Intercept at the catchFish level via gs._ogLureActive
const _origShowFishResult = window.showFishResult;

// Patch: OG fish rarity in random fish pick when OG lure is active
// We add a post-process step in the existing pickFish that upgrades legend to OG
function upgradeToOgIfActive(fish) {
  if(!fish) return fish;
  if(gs._ogLureActive && Date.now() < gs._ogLureActive) {
    const ogFish = FISH_DATA.filter(f=>f.og);
    if(ogFish.length && Math.random() < 0.35) {
      const f = ogFish[Math.floor(Math.random()*ogFish.length)];
      return {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    }
  }
  return fish;
}

// ============================================================
// saveGame and extra loading handled by main saveGame/loadGame functions

// ============================================================
// TRIGGER BOSS ON STARTUP (first visit to this update)
// ============================================================
setTimeout(()=>{
  // Check if boss should appear (first time seeing this update)
  checkBossFirstVisit();
}, 1500);

// ============================================================
// ðŸ”´ HARDCORE MAP DATA
// ============================================================
const HARDCORE_FISH = [
  {name:'ÐœÑƒÑ‚Ð°Ð½Ñ‚ ÐšÐ°Ñ€Ð°ÑÑŒ',   w:[3,15],  pts:200, coins:150, rar:'epic',   label:'ðŸ’€ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#c04040', col2:'#801010'},
  {name:'ÐŸÐ¸Ñ€Ð°Ð½Ð¸Ð¹ Ð¡Ð¾Ð¼',     w:[8,35],  pts:400, coins:300, rar:'legend', label:'ðŸ’€ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#802020', col2:'#401010'},
  {name:'ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ð¹ ÐšÑ€Ð°Ð±',   w:[5,20],  pts:350, coins:250, rar:'legend', label:'ðŸ’€ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#ff4020', col2:'#c02010'},
  {name:'ÐšÑ€Ð¾Ð²Ð°Ð²Ñ‹Ð¹ Ð›ÐµÑ‰',    w:[2,12],  pts:280, coins:200, rar:'epic',   label:'ðŸ’€ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#c00000', col2:'#800000'},
  {name:'ÐÐ´ÑÐºÐ¸Ð¹ Ð¡Ð°Ð·Ð°Ð½',    w:[10,50], pts:600, coins:500, rar:'og',     label:'ðŸ’€ OG Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#ff2020', col2:'#aa0000', og:true},
  {name:'Ð”ÑŒÑÐ²Ð¾Ð»ÑŒÑÐºÐ¸Ð¹ ÐšÐ°Ñ€Ð¿',w:[6,25],  pts:450, coins:350, rar:'og',     label:'ðŸ’€ OG Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€', col:'#ff0040', col2:'#880020', og:true},
];

const HOBO_FISH = [
  {name:'Ð“Ð½Ð¸Ð»Ð°Ñ Ð Ñ‹Ð±Ð°',    w:[.1,.5],  pts:2,  coins:3,  rar:'common', label:'ðŸ§Ÿ Ð“Ð½Ð¸Ð»Ð°Ñ',   col:'#608040', col2:'#304020', rotten:true},
  {name:'Ð Ð¶Ð°Ð²Ð°Ñ Ð Ñ‹Ð±ÐºÐ°',   w:[.05,.3], pts:1,  coins:2,  rar:'common', label:'ðŸ§Ÿ Ð“Ð½Ð¸Ð»Ð°Ñ',   col:'#806030', col2:'#503010', rotten:true},
  {name:'Ð”Ð¾Ñ…Ð»Ñ‹Ð¹ ÐšÐ°Ñ€Ð°ÑÑŒ',  w:[.2,.8],  pts:3,  coins:4,  rar:'common', label:'ðŸ§Ÿ Ð“Ð½Ð¸Ð»Ð°Ñ',   col:'#707050', col2:'#404030', rotten:true},
  {name:'Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ð¹ ÐžÐºÑƒÐ½ÑŒ', w:[.3,1.2], pts:5,  coins:6,  rar:'rare',   label:'ðŸ§Ÿ Ð ÐµÐ´ÐºÐ°Ñ Ð“Ð½Ð¸Ð»ÑŒ',col:'#506040', col2:'#304020', rotten:true},
  {name:'Ð£Ð´Ð°Ñ‡Ð° Ð‘Ð¾Ð¼Ð¶Ð°',    w:[.1,.4],  pts:15, coins:50, rar:'rare',   label:'ðŸ€ Ð ÐµÐ´ÐºÐ°Ñ ÑƒÐ´Ð°Ñ‡Ð°!',col:'#40c060', col2:'#206040'},
];

// ============================================================
// ðŸ° EASTER EVENT DATA
// ============================================================
const EASTER_RABBITS = [
  {name:'Ð‘ÐµÐ»Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',     emoji:'ðŸ°', pts:200, coins:300,  rar:'common', label:'ðŸ° ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹'},
  {name:'Ð¡ÐµÑ€Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',     emoji:'ðŸ°', pts:250, coins:350,  rar:'common', label:'ðŸ° ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹'},
  {name:'Ð Ñ‹Ð¶Ð¸Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',     emoji:'ðŸ‡', pts:400, coins:400,  rar:'rare',   label:'ðŸŒŸ Ð ÐµÐ´ÐºÐ¸Ð¹'},
  {name:'ÐŸÐ°ÑÑ…Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',emoji:'ðŸ¥š', pts:500, coins:500,  rar:'rare',   label:'ðŸŒŸ Ð ÐµÐ´ÐºÐ¸Ð¹'},
  {name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',  emoji:'ðŸŒˆ', pts:700, coins:700,  rar:'epic',   label:'ðŸ’œ Ð­Ð¿Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹'},
  {name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº',   emoji:'âœ¨', pts:1000,coins:1000, rar:'legend', label:'ðŸ‘‘ Ð›Ð•Ð“Ð•ÐÐ”Ð'},
];

// ============================================================
// ðŸ’€ HARDCORE MAP â€” BOSS LOOP
// ============================================================
const HC_BOSSES_V1 = [
  {name:'Ð“Ð¸Ð³Ð°Ð½Ñ‚ÑÐºÐ°Ñ ÐŸÐ¸Ñ€Ð°Ð½ÑŒÑ', emoji:'ðŸ¦·', hp:300,  reward:{coins:2000,  xp:300},  special:'piranha_boss'},
  {name:'Ð Ñ‹Ð±Ð°-ÐœÐ¾Ð½ÑÑ‚Ñ€',        emoji:'ðŸ‘¹', hp:500,  reward:{coins:3500,  xp:500},  special:'monster'},
  {name:'ÐšÑ€Ð°ÐºÐµÐ½',             emoji:'ðŸ™', hp:800,  reward:{coins:6000,  xp:800},  special:'kraken'},
  {name:'Ð¥Ð¾Ð·ÑÐ¸Ð½ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€Ð°',    emoji:'ðŸ‘‘', hp:1500, reward:{coins:15000, xp:2000}, special:'hc_master'},
];

let hcBossStateV1 = {
  active: false,
  current: null,
  hp: 0,
  maxHp: 0,
  bossIdx: 0,
  loopTimer: null,
  attackTimer: null,
};

function startHcBossLoop() {
  stopHcBossLoop();
  hcBossStateV1.bossIdx = 0;
  scheduleNextHcBoss();
}

function stopHcBossLoop() {
  clearTimeout(hcBossStateV1.loopTimer);
  clearInterval(hcBossStateV1.attackTimer);
  hcBossStateV1.active = false;
  const bar = document.getElementById('hc-boss-bar');
  if(bar) bar.style.display='none';
}

function scheduleNextHcBoss() {
  if(gs.mapMode !== 'hardcore') return;
  const delay = 15000 + Math.random()*15000; // 15-30 ÑÐµÐº
  hcBossStateV1.loopTimer = setTimeout(spawnHcBoss, delay);
}

function spawnHcBoss() {
  if(gs.mapMode !== 'hardcore') return;
  const boss = HC_BOSSES_V1[hcBossStateV1.bossIdx % HC_BOSSES_V1.length];
  hcBossStateV1.active = true;
  hcBossStateV1.current = boss;
  hcBossStateV1.hp = boss.hp;
  hcBossStateV1.maxHp = boss.hp;

  const bar = document.getElementById('hc-boss-bar');
  const nameEl = document.getElementById('hc-boss-name');
  const fillEl = document.getElementById('hc-boss-hp-fill');
  if(bar) bar.style.display='block';
  if(nameEl) nameEl.textContent = boss.emoji + ' ' + boss.name + ' Ð¿Ð¾ÑÐ²Ð¸Ð»ÑÑ!';
  if(fillEl) fillEl.style.width = '100%';

  shakeScreen();
  showToast(`ðŸ’€ ${boss.emoji} ${boss.name} ÐŸÐžÐ¯Ð’Ð˜Ð›Ð¡Ð¯! Ð›Ð¾Ð²Ð¸ Ñ€Ñ‹Ð±Ñƒ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÐ³Ð¾ ÑƒÐ±Ð¸Ñ‚ÑŒ!`);
  if(navigator.vibrate) navigator.vibrate([200,100,200,100,200]);

  // Auto-deal damage when fish is caught (in catchFish we'll check this)
  // Also boss attacks every 20 sec if not killed
  hcBossStateV1.attackTimer = setInterval(()=>{
    if(!hcBossStateV1.active || gs.mapMode!=='hardcore') { clearInterval(hcBossStateV1.attackTimer); return; }
    // Boss attacks â€” take coins
    const steal = 500 + Math.floor(Math.random()*500);
    gs.coins = Math.max(0, gs.coins - steal);
    updateCoins();
    shakeScreen();
    showToast(`ðŸ’€ ${boss.emoji} Ð°Ñ‚Ð°ÐºÑƒÐµÑ‚! -${steal}ðŸª™!`);
    if(navigator.vibrate) navigator.vibrate([300,100,300]);
    // Check bankruptcy
    if(gs.coins <= 0) triggerHcBankruptcy();
  }, 20000);
}

function damageHcBoss(dmg) {
  if(!hcBossStateV1.active) return;
  hcBossStateV1.hp -= dmg;
  const pct = Math.max(0, hcBossStateV1.hp / hcBossStateV1.maxHp * 100);
  const fillEl = document.getElementById('hc-boss-hp-fill');
  if(fillEl) fillEl.style.width = pct + '%';

  if(hcBossStateV1.hp <= 0) {
    killHcBoss();
  }
}

function killHcBoss() {
  clearInterval(hcBossStateV1.attackTimer);
  const boss = hcBossStateV1.current;
  hcBossStateV1.active = false;

  gs.coins += boss.reward.coins;
  updateCoins();
  addXP(boss.reward.xp);

  const bar = document.getElementById('hc-boss-bar');
  if(bar) bar.style.display='none';

  shakeScreen(); setTimeout(shakeScreen, 200);
  for(let i=0;i<5;i++) setTimeout(()=>coinBurst(100+Math.random()*160, 200+Math.random()*100), i*150);
  showToast(`ðŸ† ${boss.emoji} ${boss.name} Ð£Ð‘Ð˜Ð¢! +${boss.reward.coins}ðŸª™ +${boss.reward.xp}XP!`);

  hcBossStateV1.bossIdx++;
  scheduleNextHcBoss();
}

function triggerHcBankruptcy() {
  if(gs.mapMode !== 'hardcore') return;
  // Ð¥Ð¾Ð·ÑÐ¸Ð½ Ð¿Ñ€Ð¾Ð³Ð¾Ð½ÑÐµÑ‚ Ð½Ð° Ð±Ð¾Ð¼Ð¶Ð°Ñ‚Ð½ÑŽ
  stopHcBossLoop();
  document.getElementById('boss-overlay').classList.add('active');
  const cs = document.getElementById('boss-cutscene');
  cs.innerHTML = `
    <div class="boss-cs-text" style="color:#ff4040">ðŸ‘‘ Ð¥ÐžÐ—Ð¯Ð˜Ð Ð¥ÐÐ Ð”ÐšÐžÐ Ð</div>
    <div style="font-size:64px;animation:sharkFloat 1s ease-in-out infinite alternate">ðŸ‘‘</div>
    <div class="boss-cs-sub">Ð¢Ð« ÐŸÐžÐ¢Ð ÐÐ¢Ð˜Ð› Ð’Ð¡Ð• Ð”Ð•ÐÐ¬Ð“Ð˜! Ð£Ð‘Ð˜Ð ÐÐ™Ð¡Ð¯ Ð¡ Ð¥ÐÐ Ð”ÐšÐžÐ Ð!</div>`;
  document.getElementById('boss-hp-wrap').style.display='none';
  document.getElementById('boss-attack-zone').style.display='none';
  shakeScreen(); setTimeout(shakeScreen,300); setTimeout(shakeScreen,600);

  setTimeout(()=>{
    document.getElementById('boss-overlay').classList.remove('active');
    setMap('hobo');
    // Show hobo map button, hide hardcore
    const hbtn = document.getElementById('map-btn-hobo');
    if(hbtn) hbtn.style.display='';
    saveGame();
    showToast('ðŸšï¸ Ð¢ÐµÐ±Ñ Ð²Ñ‹Ð³Ð½Ð°Ð»Ð¸ Ð½Ð° Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½ÑŽ... Ð½Ð°ÐºÐ¾Ð¿Ð¸ 1000ðŸª™ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ±ÐµÐ¶Ð°Ñ‚ÑŒ!');
  }, 4000);
}

// ============================================================
// ðŸšï¸ HOBO MAP â€” Escape mechanism
// ============================================================
function checkHoboEscape() {
  if(gs.mapMode !== 'hobo') return;
  if(gs.coins >= 1000) {
    showToast('ðŸŽ‰ Ð¢Ñ‹ Ð½Ð°ÐºÐ¾Ð¿Ð¸Ð» 1000ðŸª™! ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ!');
    // Show escape button
    const bumBadge = document.getElementById('bum-mode-badge');
    if(bumBadge) {
      bumBadge.innerHTML = 'ðŸ§Ÿ Ð‘ÐžÐœÐ–ÐÐ¢ÐÐ¯ â€” <button onclick="hoboEscape()" style="font-family:Neucha,cursive;font-size:11px;background:#406020;border:1px solid #80c040;color:#c0ff60;padding:2px 8px;border-radius:6px;cursor:pointer;">Ð¡Ð‘Ð•Ð–ÐÐ¢Ð¬ (1000ðŸª™)</button>';
    }
  }
}

function hoboEscape() {
  if(gs.coins < 1000) { showToast('ÐÑƒÐ¶Ð½Ð¾ 1000ðŸª™!'); return; }
  gs.coins -= 1000;
  updateCoins();
  setMap('normal');
  showToast('ðŸŽ‰ Ð¢Ñ‹ Ð²Ñ‹Ñ€Ð²Ð°Ð»ÑÑ Ð¸Ð· Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ð¸! Ð£Ð´Ð°Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ð°Ð»ÐºÐ¸!');
  saveGame();
}

// ============================================================
// ðŸ¦· ÐŸÐ˜Ð ÐÐÐ¬Ð¯ â€” Piranha attack system
// ============================================================
// ============================================================
// ðŸ”´ POKEBALL BOOST SYSTEM â€” Revorked
// ============================================================
gs.pokeballInventory = gs.pokeballInventory || [];

function showPokeballCatch(pokemon, earned, boost) {
  const overlay = document.getElementById('pokeball-catch-overlay');
  if(!overlay) {
    // Fallback to old popup
    showOldPokemonPopup(pokemon, earned);
    return;
  }
  overlay.style.display = 'flex';

  // Animate pokeball spin
  const ballEl = document.getElementById('pokeball-anim');
  if(ballEl) {
    ballEl.style.animation = 'pokeballSpin 0.6s linear infinite';
    // After spin, show opening
    setTimeout(()=>{
      if(ballEl) ballEl.textContent = boost ? 'âœ¨' : 'âš½';
      if(ballEl) ballEl.style.animation = 'pokeballFloat 1s ease-in-out infinite alternate';
    }, 1200);
  }

  // Show pokemon name
  const nameEl = document.querySelector('#pokeball-catch-overlay [id="pokeball-poke-name"]') ||
                 document.getElementById('pokeball-poke-name');
  if(nameEl) nameEl.textContent = pokemon.emoji + ' ' + pokemon.name + ' Ð¿Ð¾Ð¹Ð¼Ð°Ð»! +' + earned + 'âš¡';

  // Show boost
  const boostEl = document.getElementById('pokeball-boost-txt');
  if(boostEl && boost) {
    boostEl.innerHTML = `
      <div style="font-size:22px">${boost.icon}</div>
      <div style="color:#ffd060;font-weight:bold">${boost.name}</div>
      <div style="color:#80e8ff;font-size:12px">${boost.desc}</div>`;
  }

  // Apply boost after delay
  setTimeout(()=>{
    if(boost) applyPokeballBoost(boost);
    closePokeballOverlay(pokemon, earned);
  }, 2500);
}

function showOldPokemonPopup(f, earned) {
  document.getElementById('catch-header').textContent = 'âš¡ ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½!';
  document.getElementById('catch-name-txt').textContent = f.name;
  document.getElementById('catch-weight-txt').textContent = `+${f.pts} â˜… â€¢ +${earned}âš¡`;
  const rarEl = document.getElementById('catch-rarity');
  rarEl.textContent = f.label; rarEl.className = `rarity-${f.rar}`;
  document.getElementById('catch-fish-svg').style.display = 'none';
  const pokeEmoji = document.getElementById('catch-pokemon-emoji');
  pokeEmoji.textContent = f.emoji; pokeEmoji.style.display = 'block';
  document.getElementById('catch-sell-btn').style.display = 'none';
  document.getElementById('catch-popup').classList.add('show');
  showScorePop('+'+earned+'âš¡', gs.bobX, gs.bobY);
  makeRipple(gs.bobX, gs.bobY, 65);
}

function closePokeballOverlay(pokemon, earned) {
  const overlay = document.getElementById('pokeball-catch-overlay');
  if(overlay) overlay.style.display='none';

  // Show standard catch popup too
  document.getElementById('catch-header').textContent = 'âš¡ ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½!';
  document.getElementById('catch-name-txt').textContent = pokemon.name;
  document.getElementById('catch-weight-txt').textContent = `+${pokemon.pts} â˜… â€¢ +${earned}âš¡`;
  const rarEl = document.getElementById('catch-rarity');
  rarEl.textContent = pokemon.label; rarEl.className = `rarity-${pokemon.rar}`;
  document.getElementById('catch-fish-svg').style.display = 'none';
  const pokeEmoji = document.getElementById('catch-pokemon-emoji');
  pokeEmoji.textContent = pokemon.emoji; pokeEmoji.style.display = 'block';
  document.getElementById('catch-sell-btn').style.display = 'none';
  document.getElementById('catch-popup').classList.add('show');
  showScorePop('+'+earned+'âš¡', gs.bobX, gs.bobY);
  makeRipple(gs.bobX, gs.bobY, 65);
}

function applyPokeballBoost(boost) {
  // Save boost to inventory (shown as pokeball item)
  gs.pokeballInventory.push({...boost, obtainedAt: Date.now()});

  switch(boost.effect) {
    case 'coins':
      gs.coins += boost.val;
      updateCoins();
      coinBurst(180, 300);
      showToast(`ðŸ’° ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: +${boost.val}ðŸª™!`);
      break;
    case 'bite_x3':
      gs._pokeBoostBite = Date.now() + boost.val;
      showToast(`ðŸŽ£ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: ÐšÐ»Ñ‘Ð² x3 Ð½Ð° 45 ÑÐµÐº!`);
      break;
    case 'xp':
      addXP(boost.val);
      showToast(`â¬†ï¸ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: +${boost.val} XP!`);
      break;
    case 'next_legend':
      gs._pokeNextLegend = true;
      showToast(`â­ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ñ€Ñ‹Ð±Ð° â€” Ð›Ð•Ð“Ð•ÐÐ”Ð!`);
      break;
    case 'next_og':
      gs._pokeNextOg = true;
      showToast(`ðŸ‘‘ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ñ€Ñ‹Ð±Ð° â€” OG!`);
      break;
    case 'pirana_shield':
      showToast(`ðŸ›¡ï¸ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð‘ÑƒÑÑ‚: Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ð¿Ð¸Ñ€Ð°Ð½ÑŒÑ = Ð¿Ñ€Ð¾Ð¿ÑƒÑÐº!`);
      break;
    case 'jackpot':
      gs.coins += boost.val;
      updateCoins();
      gs.pikaCoins = Math.floor(gs.pikaCoins * 5);
      updatePikaCoins();
      for(let i=0;i<8;i++) setTimeout(()=>coinBurst(50+Math.random()*260,100+Math.random()*200), i*100);
      showToast(`ðŸŽ° Ð”Ð–Ð•ÐšÐŸÐžÐ¢! +${boost.val}ðŸª™ + PikaCoins x5!`);
      break;
  }
  saveGame();
  renderInventory(); // Refresh to show pokeball
}

// ============================================================
// PATCH â€” Apply poke boosts to fish picks (at catchFish level)
// ============================================================
// We hook gs.currentCatch right before it's used
// by patching the catchFish poke boost checks inline
const _catchFishOrigPoke = catchFish;
window.catchFish = function() {
  // Apply pokeball next-fish boosts
  if(gs._pokeNextOg && gs.currentCatch && !gs.currentCatch.isPokemon) {
    gs._pokeNextOg = false;
    const ogFish = FISH_DATA.filter(f=>f.og);
    if(ogFish.length) {
      const f = ogFish[Math.floor(Math.random()*ogFish.length)];
      gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    }
  }
  if(gs._pokeNextLegend && gs.currentCatch && !gs.currentCatch.isPokemon) {
    gs._pokeNextLegend = false;
    const legFish = FISH_DATA.filter(f=>f.rar==='legend');
    if(legFish.length) {
      const f = legFish[Math.floor(Math.random()*legFish.length)];
      gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
    }
  }
  _catchFishOrigPoke();
};

// ============================================================
// ðŸšï¸ ROTTEN SHOP â€” Hobo mode shop modifier
// ============================================================
const _renderShopOriginalRef = renderShop; // capture before override
const _renderShopHoboWrapper = function() {
  if(gs.mapMode === 'hobo') {
    const body = document.getElementById('shop-body');
    if(body && document.getElementById('shop-screen').classList.contains('active')) {
      body.innerHTML = `<div style="text-align:center;padding:20px;font-family:Neucha,cursive;color:#a08060">
        <div style="font-size:48px">ðŸ§Ÿ</div>
        <div style="font-size:16px;color:#c0a060;margin-bottom:8px">Ð‘ÐžÐœÐ–ÐÐ¢ÐÐ¯ Ð›ÐÐ’ÐšÐ</div>
        <div style="font-size:12px;color:#706040">Ð’ÑÐµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ ÑÐ³Ð½Ð¸Ð»Ð¸... ÐÐ°ÐºÐ¾Ð¿Ð¸ 1000ðŸª™ Ð¸ ÑÐ±ÐµÐ³Ð¸!</div>
        <div style="margin-top:12px;font-size:13px;color:#80c040">Ð£ Ñ‚ÐµÐ±Ñ: ${gs.coins}ðŸª™ / 1000ðŸª™</div>
        ${gs.coins>=1000?'<button onclick="hoboEscape()" style="margin-top:12px;font-family:Neucha,cursive;font-size:14px;background:linear-gradient(#406020,#204010);border:2px solid #80c040;color:#c0ff60;padding:8px 20px;border-radius:10px;cursor:pointer;">ðŸƒ Ð¡Ð‘Ð•Ð–ÐÐ¢Ð¬!</button>':''}
      </div>`;
      const rottenSeeds = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:8px">
        ${SEEDS.map(s=>`<div style="background:rgba(40,30,10,.8);border:1px solid #604020;border-radius:8px;padding:8px;text-align:center;opacity:.6">
          <div style="font-size:24px">ðŸ‚</div>
          <div style="font-family:Neucha,cursive;font-size:11px;color:#806040;">Ð¡Ð³Ð½Ð¸Ð²ÑˆÐµÐµ: ${s.name}</div>
          <div style="font-family:Neucha,cursive;font-size:10px;color:#504030">Ð¦ÐµÐ½Ð°: ${Math.floor(s.price*0.1)}ðŸª™ (ÑÐ³Ð½Ð¸Ð²ÑˆÐµÐµ)</div>
        </div>`).join('')}
      </div>`;
      body.innerHTML += rottenSeeds;
      return;
    }
  }
  _renderShopOriginalRef();
};
// Override renderShop globally
window.renderShop = _renderShopHoboWrapper;
// Also make the local renderShop reference point to the wrapper when called from switchScreen
const _patchSwitchScreenForHoboShop = true;

// ============================================================
// HARDCORE â€” Unlock button
// ============================================================
function unlockHardcoreMap() {
  // Unlock after boss fight or if they have enough coins
  const btn = document.getElementById('map-btn-hardcore');
  if(btn) {
    btn.style.display = '';
    showToast('ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð°! ÐžÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾!');
  }
}

// Unlock hardcore if boss was killed
setTimeout(()=>{
  if(localStorage.getItem('fishing_boss_defeated_v1')) {
    const btn = document.getElementById('map-btn-hardcore');
    if(btn) btn.style.display='';
  }
}, 200);

// ============================================================
// HOBO ESCAPE CHECK â€” Run periodically on hobo map
// ============================================================
setInterval(()=>{
  if(gs.mapMode==='hobo') checkHoboEscape();
}, 5000);

// ============================================================
// HC BOSS DAMAGE â€” When fish caught on hardcore map
// ============================================================
const _addXPOrig = addXP;
window.addXP = function(amount) {
  if(gs.mapMode==='hardcore' && hcBossState.active) {
    const bossDmg = Math.floor(amount * 0.5) + 20;
    damageHcBoss(bossDmg);
  }
  _addXPOrig(amount);
};

const _updateCoinsOrig = updateCoins;
window.updateCoins = function() {
  _updateCoinsOrig();
  if(gs.mapMode==='hobo') checkHoboEscape();
};

// ============================================================
// EXTRA NEW ROD ANIMATIONS IN updateRodVisual
// ============================================================
const _updateRodVisualOrigRef = updateRodVisual;
window.updateRodVisual = function() {
  _updateRodVisualOrigRef();
  const rod = gs.currentRod;
  if(rod.id === 'apocalypse') shakeScreen();

  // â”€â”€ ðŸ”± ÐŸÐžÐ¡Ð•Ð™Ð”ÐžÐ: Ð°Ð²Ñ‚Ð¾-Ð·Ð°Ð±Ñ€Ð¾Ñ + Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑÐµÐº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  clearInterval(gs._poseidonInterval);
  clearInterval(gs._godlyInterval);
  if(rod.id === 'poseidon') {
    gs._poseidonInterval = setInterval(()=>{
      if(gs.currentScreen!=='fishing') return;
      if(gs.phase==='waiting') {
        showToast('ðŸ”± ÐŸÐ¾ÑÐµÐ¹Ð´Ð¾Ð½: Ñ€Ñ‹Ð±Ð° ÑÐ°Ð¼Ð° Ð¿Ñ€Ñ‹Ð³Ð½ÑƒÐ»Ð°!');
        triggerBite();
        setTimeout(()=>{ if(gs.phase==='bite') catchFish(); }, 1500);
      } else if(gs.phase==='idle') {
        const ax = 130 + Math.floor(Math.random()*100);
        castTo(ax, 360 + Math.floor(Math.random()*60));
      }
    }, 3000);
  }

  // â”€â”€ ðŸ‘‘ Ð£Ð”ÐžÐ§ÐšÐ Ð‘ÐžÐ“ÐžÐ’: Ð°Ð²Ñ‚Ð¾-Ð·Ð°Ð±Ñ€Ð¾Ñ + Ð°Ð²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(rod.id === 'godly') {
    gs._godlyInterval = setInterval(()=>{
      if(gs.currentScreen!=='fishing') return;
      if(gs.phase==='bite') {
        catchFish();
      } else if(gs.phase==='idle') {
        const ax = 130 + Math.floor(Math.random()*100);
        castTo(ax, 360 + Math.floor(Math.random()*60));
      }
    }, 1000);
  }

  // Ñ„Ð»Ð°Ð³Ð¸ Ð¼ÐµÑ…Ð°Ð½Ð¸Ðº
  gs._quantumDouble    = rod.id === 'quantum';
  gs._celestialMode    = rod.id === 'celestial';
  gs._apocalypseMode   = rod.id === 'apocalypse';
  gs._mechAutoTarget   = rod.id === 'mech';
  gs._crystalRareBoost = rod.id === 'crystal';
  gs._dragonMegaWeight = rod.id === 'dragon';
  gs._meteorBonus      = rod.id === 'meteor';
  gs._neonAutoReel     = rod.id === 'neon';
  gs._timeFreezeWindow = rod.id === 'time';
  gs._marbleAutoReel   = rod.id === 'marble';
};

// ============================================================
// PATCH â€” Special rod effects in the fish pool (Normal mode)
// ============================================================
// We override part of normal mode fish pick to check rod specials
// This is done by patching the existing pool filter section
// The key patch: add celestial and apocalypse rod handling to existing
// triggerBite normal mode section after isShark check

// Patch via flag checks in the existing pool building code:
// (Already handled in the earlier mod - isShark returns early)
// For celestial/apocalypse we'll intercept at triggerBite by adding
// a pre-hook:
const _triggerBiteOrigBase = triggerBite;
window.triggerBite = function() {
  if(gs.currentRod?.id === 'apocalypse') {
    // Always OG, instant
    if(gs.phase!=='waiting') return;
    gs.phase='bite';
    const ogFish = FISH_DATA.filter(f=>f.og);
    gs.fish = ogFish[Math.floor(Math.random()*ogFish.length)];
    gs.currentCatch = {...gs.fish, weight:(gs.fish.w[0]+Math.random()*(gs.fish.w[1]-gs.fish.w[0])).toFixed(2)};
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    biteEl.classList.add('visible');
    shakeScreen();
    // Instant catch
    setTimeout(()=>{ if(gs.phase==='bite') catchFish(); }, 300);
    return;
  }
  if(gs.currentRod?.id === 'celestial') gs._celestialMode = true;
  _triggerBiteOrigBase();
  gs._celestialMode = false;
};

// âš›ï¸ ÐšÐ’ÐÐÐ¢Ð£Ðœ: 2 Ñ€Ñ‹Ð±Ñ‹ Ð¿Ñ€Ð¸ Ð»ÑŽÐ±Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ (keep Ð¸Ð»Ð¸ sell) â€” Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ
function _quantumBonusFish() {
  if(!gs._quantumDouble) return;
  const pool2 = FISH_DATA.filter(f=>!f.coastal && (f.rar==='rare'||f.rar==='epic'||f.rar==='legend'||f.rar==='og'));
  if(!pool2.length) return;
  const f2 = pool2[Math.floor(Math.random()*pool2.length)];
  const fish2 = {...f2, weight:(f2.w[0]+Math.random()*(f2.w[1]-f2.w[0])).toFixed(2), _rodMult: gs.currentRod.catchMult||1};
  if(gs.inventory.length < gs.maxInv) {
    gs.inventory.push(fish2);
    showToast('âš›ï¸ ÐšÐ²Ð°Ð½Ñ‚ÑƒÐ¼: +' + fish2.name + ' Ð² ÑÑƒÐ¼ÐºÑƒ (2-Ñ Ñ€Ñ‹Ð±Ð°)!');
  } else {
    // Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð¿Ð¾Ð»Ð¾Ð½ â€” Ð°Ð²Ñ‚Ð¾-Ð¿Ñ€Ð¾Ð´Ð°Ñ‚ÑŒ
    const price = calcPrice(fish2);
    gs.coins += price;
    updateCoins();
    showToast('âš›ï¸ ÐšÐ²Ð°Ð½Ñ‚ÑƒÐ¼: 2-Ñ Ñ€Ñ‹Ð±Ð° ' + fish2.name + ' Ð°Ð²Ñ‚Ð¾-Ð¿Ñ€Ð¾Ð´Ð°Ð½Ð° Ð·Ð° ' + price + 'ðŸª™!');
  }
  saveGame();
}

const _keepFishOrigRef = keepFish;
window.keepFish = function() {
  _keepFishOrigRef();
  _quantumBonusFish();
};

const _sellFishOrigRef = sellFish;
window.sellFish = function() {
  _sellFishOrigRef();
  _quantumBonusFish();
};

// ============================================================
// POKEBALL â€” Show in inventory
// ============================================================
const _renderInventoryOrigRef = renderInventory;
window.renderInventory = function() {
  _renderInventoryOrigRef();
  // Add pokeball items to inventory display
  if(!gs.pokeballInventory || !gs.pokeballInventory.length) return;
  const body = document.getElementById('inv-body') || document.querySelector('.inv-body');
  if(!body) return;
  gs.pokeballInventory.forEach((pb, idx)=>{
    const slot = document.createElement('div');
    slot.className = 'inv-slot pokeball-inv-slot';
    slot.style.cssText = 'border-color:#ff4040;background:radial-gradient(circle at 50% 40%,rgba(255,50,50,.3),rgba(0,0,0,.8))';
    slot.innerHTML = `
      <div style="font-size:32px;animation:pokeballFloat 2s ease-in-out infinite alternate">âš½</div>
      <div class="inv-fish-name" style="color:#ff8080">${pb.name}</div>
      <div class="inv-fish-weight" style="color:#c06060;font-size:9px">${pb.desc}</div>
      <div style="font-family:Neucha,cursive;font-size:10px;color:#ffd060;margin-top:2px;cursor:pointer" onclick="usePokeballBoost(${idx})">ðŸ“¦ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ</div>`;
    body.appendChild(slot);
  });
};

function usePokeballBoost(idx) {
  const pb = gs.pokeballInventory[idx];
  if(!pb) return;
  applyPokeballBoost(pb);
  gs.pokeballInventory.splice(idx, 1);
  saveGame();
  renderInventory();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ’€ Ð£Ð»ÑŒÑ‚Ñ€Ð°-ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ Ð¼Ð°ÑÑÐ¸Ð²Ðµ RODS (Ð²Ñ‹ÑˆÐµ loadGame)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Add colors for new rods
ROD_COLORS.dragon  = {color:'#ff6020', glow:'0 0 40px rgba(255,80,0,1.0)'};
ROD_COLORS.mech    = {color:'#80c8e0', glow:'0 0 30px rgba(100,200,240,.9)'};
ROD_COLORS.cosmic  = {color:'#c060ff', glow:'0 0 50px rgba(180,50,255,1.0)'};
ROD_COLORS.demonic = {color:'#cc0020', glow:'0 0 50px rgba(200,0,30,1.0)'};
ROD_COLORS.godly   = {color:'#ffd700', glow:'0 0 60px rgba(255,215,0,1.0)'};
ROD_COLORS.pharaoh = {color:'#e8c020', glow:'0 0 50px rgba(255,200,0,1.0)'};
ROD_COLORS.neon    = {color:'#00ffcc', glow:'0 0 55px rgba(0,255,200,1.0)'};
ROD_COLORS.kraken  = {color:'#6020c0', glow:'0 0 60px rgba(120,0,220,1.0)'};
ROD_COLORS.time    = {color:'#c0e0ff', glow:'0 0 70px rgba(180,220,255,1.0)'};
ROD_COLORS.flower  = {color:'#ff80c0', glow:'0 0 60px rgba(255,100,200,1.0)'};
ROD_COLORS.easter  = {color:'#ff80c0', glow:'0 0 60px rgba(255,128,192,1.0)'};
// ÐÐ¾Ð²Ñ‹Ðµ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
ROD_COLORS.blackhole = {color:'#8000ff', glow:'0 0 80px rgba(120,0,255,1.0)'};
ROD_COLORS.rainbow   = {color:'#ff80ff', glow:'0 0 60px rgba(255,128,255,.9)'};
ROD_COLORS.magnet    = {color:'#40c0ff', glow:'0 0 50px rgba(50,180,255,.9)'};
ROD_COLORS.laser     = {color:'#ff2020', glow:'0 0 70px rgba(255,0,0,1.0)'};
ROD_COLORS.bakintsa  = {color:'#ffd700', glow:'0 0 90px rgba(255,215,0,1.0)'};
ROD_COLORS.hugiwugi  = {color:'#4060ff', glow:'0 0 80px rgba(60,80,255,1.0)'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŽ¨ Ð¡ÐšÐ˜ÐÐ« Ð£Ð”ÐžÐ§ÐšÐ˜ â€” Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð² Ð¸Ð³Ñ€Ðµ
// ÐšÐ¾Ð³Ð´Ð° ÑÐºÐ¸Ð½ ÑÐºÐ¸Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½, Ð¾Ð½ Ð¼ÐµÐ½ÑÐµÑ‚ Ñ†Ð²ÐµÑ‚ Ð¸ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÑŽ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SKIN_OVERRIDES = {
  'skin_wood_golden':    { color:'#ffd700', glow:'0 0 20px rgba(255,200,30,.9)', anim:'', label:'âœ¨ Ð—Ð¾Ð»Ð¾Ñ‚Ð¾' },
  'skin_bamboo_neon':    { color:'#00ff80', glow:'0 0 25px rgba(0,255,128,.9)', anim:'animation:neonScan 1.5s ease-in-out infinite;', label:'ðŸ’¡ ÐÐµÐ¾Ð½' },
  'skin_carbon_fire':    { color:'#ff6020', glow:'0 0 30px rgba(255,80,0,1.0)', anim:'animation:meteorPulse 1s ease-in-out infinite alternate;', label:'ðŸ”¥ ÐžÐ³Ð¾Ð½ÑŒ' },
  'skin_magic_galaxy':   { color:'#c060ff', glow:'0 0 40px rgba(180,50,255,1.0)', anim:'animation:cosmicSpin 3s linear infinite;', label:'ðŸŒŒ Ð“Ð°Ð»Ð°ÐºÑ‚Ð¸ÐºÐ°' },
  'skin_golden_royal':   { color:'#ffd700', glow:'0 0 50px rgba(255,215,0,1.0)', anim:'animation:pharaohGlow 2s ease-in-out infinite alternate;', label:'ðŸ‘‘ ÐšÐ¾Ñ€Ð¾Ð»ÐµÐ²Ð°' },
  'skin_crystal_ice':    { color:'#a0f0ff', glow:'0 0 40px rgba(150,240,255,.9)', anim:'animation:timeFreeze 4s ease-in-out infinite;', label:'ðŸ§Š Ð›Ñ‘Ð´' },
  'skin_hugiwugi_kisimisi': { color:'#80ff80', glow:'0 0 50px rgba(0,255,0,.8)', anim:'animation:neonScan 2s ease-in-out infinite;', label:'ðŸŽ„ ÐšÐ¸ÑÐ¸Ð¼Ð¸ÑÐ¸' },
  'skin_bakintsa_baku':  { color:'#009900', glow:'0 0 60px rgba(0,180,0,.9)', anim:'animation:pharaohGlow 1.5s ease-in-out infinite alternate;', label:'ðŸ‡¦ðŸ‡¿ Ð‘Ð°ÐºÑƒ' },
  'skin_rainbow_full':   { color:'#ff80ff', glow:'0 0 60px rgba(255,0,255,.9)', anim:'animation:quantumFlicker .5s steps(2) infinite;', label:'ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°' },
  'skin_blackhole_dark': { color:'#4000c0', glow:'0 0 80px rgba(100,0,220,1.0)', anim:'animation:demonicPulse 1s ease-in-out infinite;', label:'â¬› Ð¢Ñ‘Ð¼Ð½Ð°Ñ' },
  'skin_laser_neon':     { color:'#ff0040', glow:'0 0 70px rgba(255,0,60,1.0)',  anim:'animation:dragonBreathe 1s ease-in-out infinite alternate;', label:'ðŸ”´ ÐÐµÐ¾Ð½' },
  'skin_magnet_steel':   { color:'#80c0ff', glow:'0 0 40px rgba(100,180,255,.8)', anim:'animation:mechPulse 2s ease-in-out infinite;', label:'ðŸ”© Ð¥Ñ€Ð¾Ð¼' },
  'skin_fish_rainbow':   { color:'#ff80ff', glow:'0 0 20px rgba(255,128,255,.6)', anim:'', label:'ðŸŒˆ Ð Ñ‹Ð±ÐºÐ¸' },
  'skin_fish_golden':    { color:'#ffd700', glow:'0 0 25px rgba(255,200,0,.7)',   anim:'', label:'âœ¨ Ð Ñ‹Ð±ÐºÐ¸' },
  'skin_fish_neon':      { color:'#00ffcc', glow:'0 0 30px rgba(0,255,200,.8)',   anim:'', label:'ðŸ’¡ Ð Ñ‹Ð±ÐºÐ¸' },
};

// Patch updateRodVisual to apply equipped skin
const _updateRodVisualBeforeSkin = updateRodVisual;
window.updateRodVisual = function() {
  _updateRodVisualBeforeSkin();

  const rod = gs.currentRod;
  const equippedSkinId = gs.equippedSkins ? gs.equippedSkins[rod.id] : null;
  if(!equippedSkinId) return;

  const skinOverride = SKIN_OVERRIDES[equippedSkinId];
  if(!skinOverride) return;

  // Apply skin to rod wrapper
  const rodWrapper = document.getElementById('rod-wrapper');
  if(rodWrapper) {
    rodWrapper.style.filter = `drop-shadow(0 0 8px ${skinOverride.color})`;
  }
  // Apply to rod SVG â€” Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ filter Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÑŽ
  const rodSvg = document.getElementById('rod-svg-ingame');
  if(rodSvg) {
    // Ð”Ð¾ÑÑ‚Ð°Ñ‘Ð¼ text-shadow Ð¸Ð· style
    const baseStyle = rodSvg.getAttribute('style') || '';
    // Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ filter Ð¸Ð· style, Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹
    const cleaned = baseStyle.replace(/filter:[^;]+;?/g, '');
    rodSvg.setAttribute('style', cleaned + `;filter:drop-shadow(0 0 12px ${skinOverride.color}) drop-shadow(0 0 25px ${skinOverride.color}80);${skinOverride.anim}`);
  }
  // Apply color to rod name label
  const nameEl = document.getElementById('current-rod-name');
  if(nameEl) {
    nameEl.style.color = skinOverride.color;
    nameEl.style.textShadow = `0 0 8px ${skinOverride.color}`;
    nameEl.textContent = 'ðŸŽ¨ ' + rod.name + ' [' + skinOverride.label + ']';
  }

  // Fish skin â€” make fish SVG in catch popup glow
  if(equippedSkinId.startsWith('skin_fish_')) {
    const catchSvg = document.getElementById('catch-fish-svg');
    if(catchSvg) {
      catchSvg.style.filter = `drop-shadow(0 0 10px ${skinOverride.color})`;
    }
  }
};

// Add equippedSkins to gs
gs.equippedSkins = gs.equippedSkins || {};

// Update equipRodUpgrade to also handle skins
window.equipRodSkin = function(skinId) {
  const rodId = gs.currentRod.id;
  gs.equippedSkins = gs.equippedSkins || {};
  if(gs.equippedSkins[rodId] === skinId) {
    delete gs.equippedSkins[rodId];
    showToast('ðŸŽ¨ Ð¡ÐºÐ¸Ð½ ÑÐ½ÑÑ‚!');
  } else {
    gs.equippedSkins[rodId] = skinId;
    showToast('ðŸŽ¨ Ð¡ÐºÐ¸Ð½ Ð½Ð°Ð´ÐµÑ‚! ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ Ð² Ð Ñ‹Ð±Ð°Ð»ÐºÐµ!');
  }
  updateRodVisual();
  saveGame();
  if(gs.currentScreen === 'fisher') renderFisherScreen();
};

// Patch renderFisherScreen to show skins with "Ð½Ð°Ð´ÐµÑ‚ÑŒ" button
const _renderFisherScreenWithSkins = window.renderFisherScreen;
window.renderFisherScreen = function() {
  if(_renderFisherScreenWithSkins) _renderFisherScreenWithSkins();

  const equip = document.getElementById('fisher-equip-panel');
  if(!equip) return;

  const oldSec = document.getElementById('fisher-skin-section');
  if(oldSec) oldSec.remove();

  const curRodSkins2 = (gs.rodSkins||[]).filter(s=>s.rod===gs.currentRod.id || s.rod===null);
  if(curRodSkins2.length === 0) return;

  const rarColors2 = {common:'#a0c080',rare:'#4090f0',epic:'#c040ff',legend:'#f0c030',og:'#ff4060'};
  const sec2 = document.createElement('div');
  sec2.id = 'fisher-skin-section';
  sec2.className = 'fisher-equip-section';
  sec2.style.marginTop = '8px';
  sec2.innerHTML = '<div class="fisher-equip-section-title">ðŸŽ¨ Ð¡ÐºÐ¸Ð½Ñ‹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸</div>';

  const grid2 = document.createElement('div');
  grid2.style.cssText = 'display:flex;flex-wrap:wrap;gap:6px;padding:10px 14px;';

  curRodSkins2.forEach(skin => {
    const isEquipped = gs.equippedSkins && gs.equippedSkins[gs.currentRod.id] === skin.id;
    const override = SKIN_OVERRIDES[skin.id];
    const chipColor = override ? override.color : rarColors2[skin.rarity] || '#fff';
    const chip = document.createElement('div');
    chip.onclick = () => equipRodSkin(skin.id);
    chip.style.cssText = `display:flex;align-items:center;gap:5px;background:rgba(10,20,30,.9);border:2px solid ${isEquipped ? chipColor : chipColor+'40'};border-radius:20px;padding:5px 10px;cursor:pointer;font-family:Neucha,cursive;font-size:10px;color:${chipColor};${isEquipped ? `box-shadow:0 0 10px ${chipColor}60;` : ''}`;
    chip.innerHTML = `<span style="font-size:14px;">${skin.icon}</span>${skin.name}${isEquipped ? ' âœ…' : ''}`;
    if(override && override.anim) chip.style.cssText += override.anim;
    grid2.appendChild(chip);
  });
  sec2.appendChild(grid2);
  equip.appendChild(sec2);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐÐ¯ Ð£Ð”ÐžÐ§ÐšÐ â€” SVG, ÐºÑ€Ð°Ñ„Ñ‚, Ð»Ð¾Ð³Ð¸ÐºÐ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SVG Ð´Ð»Ñ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ (72Ã—72)
const FLOWER_ROD_SVG = `
  <defs>
    <linearGradient id="flG" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#ffb0e0"/>
      <stop offset="30%" stop-color="#ff60a0"/>
      <stop offset="60%" stop-color="#cc40ff"/>
      <stop offset="100%" stop-color="#ff80c0"/>
    </linearGradient>
    <radialGradient id="flG2" cx="50%" cy="30%">
      <stop offset="0%" stop-color="#fff0f8"/>
      <stop offset="100%" stop-color="#ff80c0"/>
    </radialGradient>
    <filter id="flGlow"><feGaussianBlur stdDeviation="2.5"/></filter>
  </defs>
  <!-- Glow aura -->
  <ellipse cx="28" cy="26" rx="20" ry="8" fill="rgba(255,100,200,.12)" transform="rotate(-42 28 26)"/>
  <!-- Main stem -->
  <line x1="42" y1="8" x2="12" y2="44" stroke="url(#flG)" stroke-width="6.5" stroke-linecap="round"/>
  <!-- Petal decorations along stem -->
  <g transform="translate(38,12) rotate(-45)">
    <ellipse cx="0" cy="-4" rx="3" ry="5" fill="#ff80c0" opacity=".9"/>
    <ellipse cx="4" cy="0"  rx="5" ry="3" fill="#ffb0e0" opacity=".8"/>
    <ellipse cx="0" cy="4"  rx="3" ry="5" fill="#ff60a0" opacity=".9"/>
    <ellipse cx="-4" cy="0" rx="5" ry="3" fill="#e060d0" opacity=".8"/>
    <circle cx="0" cy="0" r="2.5" fill="#fff0f8"/>
  </g>
  <g transform="translate(28,23) rotate(-25)">
    <ellipse cx="0" cy="-3" rx="2.5" ry="4" fill="#c060ff" opacity=".85"/>
    <ellipse cx="3" cy="0"  rx="4" ry="2.5" fill="#e080ff" opacity=".75"/>
    <ellipse cx="0" cy="3"  rx="2.5" ry="4" fill="#a040e0" opacity=".85"/>
    <ellipse cx="-3" cy="0" rx="4" ry="2.5" fill="#d060ff" opacity=".75"/>
    <circle cx="0" cy="0" r="2" fill="#fff0f8"/>
  </g>
  <g transform="translate(18,35) rotate(-10)">
    <ellipse cx="0" cy="-3" rx="2" ry="3.5" fill="#ffd060" opacity=".9"/>
    <ellipse cx="3" cy="0"  rx="3.5" ry="2" fill="#ff9020" opacity=".8"/>
    <ellipse cx="0" cy="3"  rx="2" ry="3.5" fill="#ffc040" opacity=".9"/>
    <ellipse cx="-3" cy="0" rx="3.5" ry="2" fill="#ffe080" opacity=".8"/>
    <circle cx="0" cy="0" r="1.8" fill="#fff8e0"/>
  </g>
  <!-- Reel â€” floral design -->
  <circle cx="16" cy="37" r="7" fill="rgba(80,0,40,.7)" stroke="#ff80c0" stroke-width="2"/>
  <circle cx="16" cy="37" r="4.5" fill="#cc4080" stroke="#ffb0e0" stroke-width="1"/>
  <circle cx="16" cy="37" r="2" fill="#fff0f8" opacity=".9"/>
  <!-- Tiny flowers on reel -->
  <circle cx="16" cy="31" r="1.2" fill="#ff80c0"/>
  <circle cx="22" cy="37" r="1.2" fill="#ff80c0"/>
  <circle cx="16" cy="43" r="1.2" fill="#ffd060"/>
  <circle cx="10" cy="37" r="1.2" fill="#c060ff"/>
  <!-- Line rings â€” flower-shaped -->
  <circle cx="29" cy="25" r="3" fill="none" stroke="#ff80c0" stroke-width="1.5" opacity=".9"/>
  <circle cx="35" cy="18" r="2.5" fill="none" stroke="#c060ff" stroke-width="1.3" opacity=".85"/>
  <circle cx="39" cy="13" r="2" fill="none" stroke="#ffd060" stroke-width="1.2" opacity=".8"/>
  <!-- Tip glow -->
  <circle cx="42" cy="8" r="5" fill="rgba(255,100,200,.2)" filter="url(#flGlow)"/>
  <circle cx="42" cy="8" r="3" fill="url(#flG2)" stroke="#ff80c0" stroke-width="1"/>
  <!-- Sparkles -->
  <text x="6"  y="12" font-size="8" opacity=".8">âœ¨</text>
  <text x="44" y="30" font-size="7" opacity=".7">ðŸŒ¸</text>
  <text x="8"  y="46" font-size="7" opacity=".6">ðŸŒº</text>
`;

// ÐšÑ€Ð°Ñ„Ñ‚ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
function craftFlowerRod() {
  const sunflower = SEEDS.find(s=>s.id==='sunflower');
  const clover    = SEEDS.find(s=>s.id==='clover');
  if(!sunflower || !clover) return;
  if((sunflower.owned||0) < 3) { showToast('ðŸŒ» ÐÑƒÐ¶Ð½Ð¾ 3 ÐŸÐ¾Ð´ÑÐ¾Ð»Ð½ÑƒÑ…Ð°! (ÐµÑÑ‚ÑŒ: '+sunflower.owned+')'); return; }
  if((clover.owned||0) < 6)    { showToast('ðŸ€ ÐÑƒÐ¶Ð½Ð¾ 6 ÐšÐ»ÐµÐ²ÐµÑ€Ð°! (ÐµÑÑ‚ÑŒ: '+clover.owned+')');       return; }
  const rod = RODS.find(r=>r.id==='flower');
  if(!rod||rod.owned) { showToast('ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ Ð£Ð´Ð¾Ñ‡ÐºÐ° ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ!'); return; }
  sunflower.owned -= 3;
  clover.owned    -= 6;
  rod.owned = true;
  showToast('ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐÐ¯ Ð£Ð”ÐžÐ§ÐšÐ Ð¡ÐžÐ—Ð”ÐÐÐ! ÐÐ°Ð´ÐµÐ²Ð°Ð¹ Ð² Ð»Ð°Ð²ÐºÐµ!');
  spawnPetals(180, 350, 30);
  saveGame();
  renderShop();
}

// Ð‘Ð°Ñ„Ñ„ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ð³Ð¾ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ñ Ð² ÑÐ°Ð´Ñƒ Ð¿Ñ€Ð¸ ÑƒÐ»Ð¾Ð²Ðµ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¾Ð¹
function flowerRodGardenBuff() {
  const ready = gardenPlots.filter(p=>p.state==='growing'||p.state==='seeded');
  if(!ready.length) return;
  const idx = Math.floor(Math.random()*ready.length);
  const p = ready[idx];
  const plotIdx = gardenPlots.indexOf(p);
  // Ð£ÑÐºÐ¾Ñ€Ð¸Ñ‚ÑŒ Ñ€Ð¾ÑÑ‚ â€” ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚ÑŒ plantedAt Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ€Ð¾ÑÐ»Ð¾ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ
  gardenPlots[plotIdx].plantedAt -= 15000; // -15 ÑÐµÐº
  const seed = SEEDS.find(s=>s.id===p.seedId);
  if(seed) showToast('ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð±Ð°Ñ„Ñ„: ' + seed.flower + ' ' + seed.name + ' Ñ€Ð°ÑÑ‚Ñ‘Ñ‚ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ!');
  else showToast('ðŸŒ¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð±Ð°Ñ„Ñ„: Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ Ð² ÑÐ°Ð´Ñƒ ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð¾!');
}

// ============================================================
// ðŸ° EASTER EVENT FUNCTIONS
// ============================================================
function catchEasterRabbit(rabbit) {
  gs.phase = 'idle';
  clearTimeout(gs.biteTimeout);
  biteEl.classList.remove('visible');
  bobWrap.style.display = 'none';
  bobWrap.style.animation = '';

  gs.easterChaChaKills = (gs.easterChaChaKills || 0);
  if(rabbit.hasChacha) gs.easterChaChaKills++;

  const coins = rabbit.coins;
  gs.coins += coins;
  updateCoins();
  gs.score += rabbit.pts;
  gs.fishCount++;
  document.getElementById('fish-count').textContent = gs.fishCount;
  document.getElementById('score-val').textContent = gs.score;

  // Update popup
  document.getElementById('catch-header').textContent = rabbit.hasChacha ? 'ðŸ’ƒ Cha Cha ÐšÑ€Ð¾Ð»Ð¸Ðº!' : 'ðŸ° ÐšÑ€Ð¾Ð»Ð¸Ðº Ð¿Ð¾Ð¹Ð¼Ð°Ð½!';
  const popupSvg = document.getElementById('catch-fish-svg');
  if(popupSvg) popupSvg.style.display = 'none';
  const emojiEl = document.getElementById('catch-pokemon-emoji');
  if(emojiEl) { emojiEl.style.display='block'; emojiEl.textContent = rabbit.emoji; }
  document.getElementById('catch-name-txt').textContent = rabbit.name;
  document.getElementById('catch-weight-txt').textContent = `${rabbit.weight} ÐºÐ³ â€¢ +${rabbit.pts} â˜… â€¢ +${coins}ðŸª™`;
  const rarEl = document.getElementById('catch-rarity');
  rarEl.textContent = rabbit.hasChacha ? 'ðŸ’ƒ Cha Cha Ð±Ð°Ñ„Ñ„! (+1 Ðº Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÑƒ)' : rabbit.label;
  rarEl.className = rabbit.rar === 'legend' ? 'rarity-legend' : rabbit.rar === 'epic' ? 'rarity-epic' : rabbit.rar === 'rare' ? 'rarity-rare' : 'rarity-common';
  rarEl.style.color = rabbit.hasChacha ? '#ff80c0' : '';

  // Hide sell button (rabbits aren't sold, they give coins directly)
  document.getElementById('catch-sell-btn').style.display = 'none';
  document.getElementById('easter-rabbit-bonus').style.display = 'none';

  document.getElementById('catch-popup').classList.add('show');
  showScorePop('+'+rabbit.pts, gs.bobX, gs.bobY);
  makeRipple(gs.bobX, gs.bobY, 65);

  if(rabbit.hasChacha) {
    spawnEasterConfetti();
    showToast(`ðŸ’ƒ Cha Cha Ð±Ð°Ñ„Ñ„! ${gs.easterChaChaKills}/30 ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð²!`);
    // Check for Easter Rod unlock
    if(gs.easterChaChaKills >= 30 && !gs.easterRodUnlocked) {
      gs.easterRodUnlocked = true;
      const easterRod = RODS.find(r=>r.id==='easter');
      if(easterRod && !easterRod.owned) {
        setTimeout(()=>{
          easterRod.owned = true;
          showToast('ðŸ°ðŸŽ‰ Ð£Ð”ÐžÐ§ÐšÐ ÐŸÐÐ¡Ð¥Ð˜ Ð ÐÐ—Ð‘Ð›ÐžÐšÐ˜Ð ÐžÐ’ÐÐÐ! ÐÐ°Ð´ÐµÐ²Ð°Ð¹ Ð² Ð»Ð°Ð²ÐºÐµ!');
          spawnEasterConfetti();
          spawnEasterConfetti();
        }, 1000);
      }
    }
  } else {
    showToast(`ðŸ° ${rabbit.name} Ð¿Ð¾Ð¹Ð¼Ð°Ð½! (${gs.easterChaChaKills}/30 Cha Cha)`);
  }

  gs.catchStreak = (gs.catchStreak||0)+1;
  updateStreakUI();
  checkAchievements();
  saveGame();
}

function craftEasterRod() {
  const rod = RODS.find(r=>r.id==='easter');
  if(!rod) return;
  if(rod.owned) { showToast('ðŸ° Ð£Ð´Ð¾Ñ‡ÐºÐ° ÐŸÐ°ÑÑ…Ð¸ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ!'); return; }
  if((gs.easterChaChaKills||0) < 30) {
    showToast(`ðŸ° ÐÑƒÐ¶Ð½Ð¾ 30 Cha Cha ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð²! (ÐµÑÑ‚ÑŒ: ${gs.easterChaChaKills||0})`);
    return;
  }
  rod.owned = true;
  gs.easterRodUnlocked = true;
  showToast('ðŸ°ðŸŽ‰ Ð£Ð”ÐžÐ§ÐšÐ ÐŸÐÐ¡Ð¥Ð˜ Ð¡ÐžÐ—Ð”ÐÐÐ! ÐÐ°Ð´ÐµÐ²Ð°Ð¹ Ð² Ð»Ð°Ð²ÐºÐµ!');
  spawnEasterConfetti();
  spawnEasterConfetti();
  saveGame();
  renderShop();
}

function spawnEasterConfetti() {
  const emojis = ['ðŸ¥š','ðŸ°','ðŸŒ¸','ðŸŒ·','ðŸŒˆ','ðŸ’ƒ','ðŸ‡','âœ¨'];
  const game = document.getElementById('game');
  for(let i=0;i<12;i++) {
    setTimeout(()=>{
      const el = document.createElement('div');
      el.className = 'flower-petal';
      el.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      const angle = Math.random()*Math.PI*2;
      const dist = 50 + Math.random()*130;
      el.style.setProperty('--px', Math.cos(angle)*dist+'px');
      el.style.setProperty('--py', Math.sin(angle)*dist+'px');
      el.style.setProperty('--pr', (Math.random()*720-360)+'deg');
      el.style.left = (180-10)+'px';
      el.style.top  = (350-10)+'px';
      el.style.animationDuration = (0.8+Math.random()*1)+'s';
      game.appendChild(el);
      setTimeout(()=>el.remove(), 1800);
    }, i*40);
  }
}

function renderEasterEventScreen() {
  const content = document.getElementById('easter-event-content');
  if(!content) return;
  const kills = gs.easterChaChaKills || 0;
  const progress = Math.min(kills, 30);
  const pct = Math.round(progress/30*100);
  const easterRod = RODS.find(r=>r.id==='easter');
  const rodOwned = easterRod && easterRod.owned;
  const canCraft = kills >= 30 && !rodOwned;

  content.innerHTML = `
    <div style="background:rgba(255,128,192,.08);border:1px solid rgba(255,128,192,.3);border-radius:12px;padding:12px;margin-bottom:10px;">
      <div style="font-family:'Neucha',cursive;font-size:14px;color:#ff80c0;margin-bottom:6px;">ðŸŽ¯ ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: Cha Cha ÐšÑ€Ð¾Ð»Ð¸ÐºÐ¸</div>
      <div style="font-family:'Neucha',cursive;font-size:22px;color:#fff;text-align:center;margin:4px 0;">${progress} / 30</div>
      <div class="easter-progress-bar-outer">
        <div class="easter-progress-bar-inner" style="width:${pct}%"></div>
      </div>
      <div style="font-family:'Neucha',cursive;font-size:11px;color:#c080a0;text-align:center;">${pct}% Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</div>
    </div>

    <div style="background:rgba(255,128,192,.08);border:1px solid ${rodOwned?'#ff80c0':'rgba(255,128,192,.2)'};border-radius:12px;padding:12px;margin-bottom:10px;">
      <div style="font-family:'Neucha',cursive;font-size:14px;color:${rodOwned?'#ff80c0':'#888'};margin-bottom:6px;">ðŸ° Ð£Ð´Ð¾Ñ‡ÐºÐ° ÐŸÐ°ÑÑ…Ð¸</div>
      <div style="font-family:'Neucha',cursive;font-size:11px;color:#c080a0;margin-bottom:8px;">ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ: +10000ðŸª™ Ð”ÐµÐ½ÐµÐ¶Ð½Ñ‹Ð¹ ÐšÑ€Ð¾Ð»Ð¸Ðº + ðŸ’ƒ Cha Cha Ð±Ð°Ñ„Ñ„ Ð² Ð¿Ð¾Ð¿Ð°Ð¿Ðµ!</div>
      ${rodOwned
        ? `<div style="color:#ff80c0;font-family:'Neucha',cursive;font-size:13px;text-align:center;">âœ… ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð°! ÐÐ°Ð´ÐµÐ²Ð°Ð¹ Ð² Ð›Ð°Ð²ÐºÐµ â†’ Ð£Ð´Ð¾Ñ‡ÐºÐ¸</div>`
        : `<button class="craft-easter-btn" onclick="craftEasterRod()" ${canCraft?'':'disabled'}>
             ${canCraft ? 'ðŸ° Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð£Ð´Ð¾Ñ‡ÐºÑƒ ÐŸÐ°ÑÑ…Ð¸!' : `ðŸ”’ ÐÑƒÐ¶Ð½Ð¾ 30 Cha Cha (ÐµÑÑ‚ÑŒ: ${kills})`}
           </button>`
      }
    </div>

    <div style="font-family:'Neucha',cursive;font-size:13px;color:#ff80c0;margin-bottom:6px;">ðŸ‡ ÐšÑ€Ð¾Ð»Ð¸ÐºÐ¸ Ð½Ð° ÐšÐ°Ñ€Ñ‚Ðµ ÐŸÐ°ÑÑ…Ð°:</div>
    ${EASTER_RABBITS.map(r=>`
      <div class="easter-rabbit-card">
        <div style="font-size:24px">${r.emoji}</div>
        <div style="flex:1">
          <div style="font-family:'Neucha',cursive;font-size:13px;color:#f5e0a0;">${r.name}</div>
          <div style="font-family:'Neucha',cursive;font-size:10px;color:#c080a0;">${r.label} â€¢ +${r.coins}ðŸª™ â€¢ 50% ðŸ’ƒ Cha Cha</div>
        </div>
      </div>`).join('')}

    <button class="easter-map-btn" onclick="setMap('easter');switchScreen('fishing');">
      ðŸ° ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° ÐšÐ°Ñ€Ñ‚Ñƒ ÐŸÐ°ÑÑ…Ð°
    </button>
  `;
}

// Spawn floating petals effect
function spawnPetals(cx, cy, count) {
  const emojis = ['ðŸŒ¸','ðŸŒº','ðŸŒ¼','ðŸŒ·','ðŸŒ»','ðŸ’'];
  for(let i=0;i<count;i++) {
    setTimeout(()=>{
      const el = document.createElement('div');
      el.className = 'flower-petal';
      el.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      const angle = Math.random()*Math.PI*2;
      const dist = 60 + Math.random()*120;
      el.style.setProperty('--px', Math.cos(angle)*dist+'px');
      el.style.setProperty('--py', Math.sin(angle)*dist+'px');
      el.style.setProperty('--pr', (Math.random()*720-360)+'deg');
      el.style.left = (cx-10)+'px';
      el.style.top  = (cy-10)+'px';
      el.style.animationDuration = (0.8+Math.random()*0.8)+'s';
      document.getElementById('fishing-screen').appendChild(el);
      setTimeout(()=>el.remove(), 1600);
    }, i*30);
  }
}

// ÐŸÐ°Ñ‚Ñ‡ updateCatchPopupFish â€” Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ñ€Ñ‹Ð±Ñ‹ Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸ÐµÐ¹
(function patchFlowerFishPopup() {
  const _orig = window.updateCatchPopupFish || updateCatchPopupFish;
  window.updateCatchPopupFish = function(f) {
    _orig(f);
    const svg = document.getElementById('catch-fish-svg');
    if(f.flower && svg) {
      // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹
      svg.style.animation = (f.flowerAnim||'petalFloat') + ' 0.8s ease-in-out infinite alternate';
      // Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€
      svg.style.filter = 'drop-shadow(0 0 12px ' + f.col + ') drop-shadow(0 0 24px ' + f.col2 + ')';
      // ÐžÐºÑ€Ð°ÑÐ¸Ñ‚ÑŒ Ñ€Ñ‹Ð±ÐºÑƒ Ñ†Ð²ÐµÑ‚ÐºÐ¾Ð¼
      const g = svg.querySelector('#fishG');
      if(g) {
        g.children[0].setAttribute('stop-color', f.col);
        g.children[1].setAttribute('stop-color', f.col2);
      }
      // Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð»ÐµÐ¿ÐµÑÑ‚ÐºÐ¸!
      spawnPetals(180, 300, 20);
    } else if(svg) {
      svg.style.filter = '';
    }
  };
})();

// ÐŸÐ°Ñ‚Ñ‡ catchFish â€” Ð¿Ñ€Ð¸ Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐµ: Ð±Ð°Ñ„Ñ„ ÑÐ°Ð´Ð° + ÑˆÐ°Ð½Ñ Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹
(function patchFlowerRodCatch() {
  const _orig = window.catchFish || catchFish;
  // ÐŸÐ°Ñ‚Ñ‡Ð¸Ð¼ Ñ‡ÐµÑ€ÐµÐ· triggerBite â€” Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ñ… Ñ€Ñ‹Ð± Ð² Ð¿ÑƒÐ»
  const _origTB = window.triggerBite;
  window.triggerBite = function() {
    if(gs.currentRod?.id === 'flower') {
      if(gs.phase!=='waiting') return;
      gs.phase = 'bite';
      // 40% Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ Ñ€Ñ‹Ð±Ð°, 40% OG, 20% Ð»ÐµÐ³ÐµÐ½Ð´Ð°
      const roll = Math.random();
      let f;
      const flowerFish = FISH_DATA.filter(x=>x.flower);
      const ogFish     = FISH_DATA.filter(x=>x.og && !x.flower);
      const legFish    = FISH_DATA.filter(x=>x.rar==='legend');
      if(roll<0.40 && flowerFish.length)     f = flowerFish[Math.floor(Math.random()*flowerFish.length)];
      else if(roll<0.80 && ogFish.length)    f = ogFish[Math.floor(Math.random()*ogFish.length)];
      else if(legFish.length)                f = legFish[Math.floor(Math.random()*legFish.length)];
      else                                   f = FISH_DATA[Math.floor(Math.random()*FISH_DATA.length)];
      gs.fish = f;
      gs.currentCatch = {...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)};
      bobWrap.style.animation='floatBite .9s ease-in-out 4';
      biteEl.classList.add('visible');
      if(navigator.vibrate) navigator.vibrate([80,40,80]);
      gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 5000);
      return;
    }
    if(_origTB) _origTB();
  };
})();

// ÐŸÐ°Ñ‚Ñ‡ â€” Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¸Ð¼ÐºÐµ Ñ†Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¹ Ñ€Ñ‹Ð±Ñ‹ Ð±Ð°Ñ„Ñ„Ð¸Ð¼ ÑÐ°Ð´
(function patchFlowerRodGardenBuff() {
  const _origSell = window.sellFish;
  window.sellFish = function() {
    const f = gs.currentCatch;
    if(_origSell) _origSell();
    if(gs.currentRod?.id === 'flower') {
      setTimeout(flowerRodGardenBuff, 200);
      if(f && f.flower) {
        setTimeout(()=>showToast('ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐÐ¯: +' + f.coins + 'ðŸª™ Ð·Ð° ' + f.name + '!'), 300);
      }
    }
  };
  const _origKeep = window.keepFish;
  window.keepFish = function() {
    const f = gs.currentCatch;
    if(_origKeep) _origKeep();
    if(gs.currentRod?.id === 'flower') {
      setTimeout(flowerRodGardenBuff, 200);
    }
  };
})();
const HARDCORE_ROD_SVGS = {
  dragon: `
    <!-- Dragon Bone Rod -->
    <defs>
      <radialGradient id="drG" cx="50%" cy="30%"><stop offset="0%" stop-color="#ff9050"/><stop offset="100%" stop-color="#8a2000"/></radialGradient>
      <filter id="drF"><feGaussianBlur stdDeviation="2" result="b"/><feComposite in="SourceGraphic" in2="b" operator="over"/></filter>
    </defs>
    <!-- Dragon bones body -->
    <line x1="40" y1="8" x2="12" y2="44" stroke="url(#drG)" stroke-width="7" stroke-linecap="round" filter="url(#drF)"/>
    <line x1="40" y1="8" x2="12" y2="44" stroke="rgba(255,180,100,.4)" stroke-width="2"/>
    <!-- Bone segments -->
    <ellipse cx="36" cy="14" rx="4" ry="3" fill="#ff7030" stroke="#802010" stroke-width="1" transform="rotate(-45 36 14)"/>
    <ellipse cx="30" cy="21" rx="3.5" ry="2.5" fill="#ff6020" stroke="#802010" stroke-width="1" transform="rotate(-45 30 21)"/>
    <ellipse cx="24" cy="30" rx="3" ry="2" fill="#e05010" stroke="#702010" stroke-width="1" transform="rotate(-45 24 30)"/>
    <!-- Dragon head top -->
    <path d="M42,6 Q46,2 50,6 Q47,10 42,8Z" fill="#ff4010" stroke="#c02000" stroke-width="1"/>
    <circle cx="44" cy="5" r="1.5" fill="#ffd020"/>
    <!-- Flames at tip -->
    <path d="M48,4 Q52,-2 54,4 Q50,6 48,4Z" fill="#ff8000" opacity=".8"/>
    <path d="M49,2 Q53,-4 55,2 Q51,4 49,2Z" fill="#ffd000" opacity=".6"/>
    <!-- Reel -->
    <circle cx="18" cy="36" r="6" fill="rgba(0,0,0,.5)" stroke="#ff4010" stroke-width="2"/>
    <circle cx="18" cy="36" r="3" fill="#c03010" stroke="#ff6020" stroke-width="1"/>
    <!-- Rings -->
    <circle cx="27" cy="27" r="3" fill="none" stroke="#ff5020" stroke-width="1.5"/>
    <circle cx="33" cy="20" r="2.5" fill="none" stroke="#ff5020" stroke-width="1.3"/>
    <circle cx="37" cy="14" r="2" fill="none" stroke="#ff5020" stroke-width="1.2"/>
    <!-- Fire glow -->
    <circle cx="40" cy="8" r="6" fill="rgba(255,100,0,.15)"/>`,

  mech: `
    <!-- Mech Rod 9000 -->
    <defs>
      <linearGradient id="mG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#90e0f8"/><stop offset="50%" stop-color="#4090b0"/><stop offset="100%" stop-color="#2060a0"/></linearGradient>
    </defs>
    <!-- Main shaft (machined metal) -->
    <line x1="42" y1="9" x2="10" y2="44" stroke="url(#mG)" stroke-width="6" stroke-linecap="round"/>
    <!-- Rivets -->
    <circle cx="38" cy="13" r="1.8" fill="#c0e8f8" stroke="#2080a0" stroke-width="1"/>
    <circle cx="30" cy="23" r="1.8" fill="#c0e8f8" stroke="#2080a0" stroke-width="1"/>
    <circle cx="22" cy="33" r="1.8" fill="#c0e8f8" stroke="#2080a0" stroke-width="1"/>
    <!-- Pistons / hydraulics -->
    <rect x="26" y="27" width="6" height="10" rx="2" fill="#1a6080" stroke="#40c0e0" stroke-width="1.2" transform="rotate(-45 29 32)"/>
    <!-- AI Chip -->
    <rect x="34" y="14" width="8" height="6" rx="1" fill="#001830" stroke="#40c0e0" stroke-width="1.5"/>
    <line x1="35" y1="15" x2="41" y2="15" stroke="#00f8ff" stroke-width=".6"/>
    <line x1="35" y1="17" x2="41" y2="17" stroke="#00f8ff" stroke-width=".6"/>
    <line x1="35" y1="19" x2="41" y2="19" stroke="#00f8ff" stroke-width=".6"/>
    <!-- Gears -->
    <circle cx="16" cy="38" r="6" fill="rgba(0,0,0,.5)" stroke="#40c0e0" stroke-width="2"/>
    <circle cx="16" cy="38" r="3.5" fill="#1a4060" stroke="#40c0e0" stroke-width="1"/>
    <!-- Gear teeth -->
    <polygon points="16,32 17,33 16,34 15,33" fill="#40c0e0"/>
    <polygon points="16,42 17,43 16,44 15,43" fill="#40c0e0"/>
    <polygon points="10,38 11,39 12,38 11,37" fill="#40c0e0"/>
    <polygon points="20,38 21,39 22,38 21,37" fill="#40c0e0"/>
    <!-- Targeting reticle at tip -->
    <circle cx="43" cy="9" r="4" fill="none" stroke="#00f8ff" stroke-width="1" opacity=".8"/>
    <line x1="43" y1="5" x2="43" y2="7" stroke="#00f8ff" stroke-width="1"/>
    <line x1="43" y1="11" x2="43" y2="13" stroke="#00f8ff" stroke-width="1"/>
    <line x1="39" y1="9" x2="41" y2="9" stroke="#00f8ff" stroke-width="1"/>
    <line x1="45" y1="9" x2="47" y2="9" stroke="#00f8ff" stroke-width="1"/>`,

  cosmic: `
    <!-- Cosmic Rod -->
    <defs>
      <linearGradient id="cosG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e060ff"/><stop offset="40%" stop-color="#6020c0"/><stop offset="100%" stop-color="#200840"/></linearGradient>
      <filter id="cosGlow"><feGaussianBlur stdDeviation="3"/></filter>
    </defs>
    <!-- Glowing nebula around rod -->
    <ellipse cx="28" cy="28" rx="20" ry="8" fill="rgba(160,60,255,.1)" transform="rotate(-45 28 28)"/>
    <!-- Rod body with space cracks -->
    <line x1="42" y1="8" x2="12" y2="44" stroke="url(#cosG)" stroke-width="6" stroke-linecap="round"/>
    <!-- Space crack lines -->
    <path d="M38,12 L34,16 L38,18" stroke="rgba(200,100,255,.6)" stroke-width="1" fill="none"/>
    <path d="M26,26 L22,30 L26,32" stroke="rgba(200,100,255,.6)" stroke-width="1" fill="none"/>
    <!-- Stars along rod -->
    <circle cx="36" cy="14" r="1.5" fill="#e0c0ff"/>
    <circle cx="28" cy="24" r="1.2" fill="#e0c0ff"/>
    <circle cx="20" cy="36" r="1" fill="#e0c0ff"/>
    <!-- Meteor tip -->
    <circle cx="43" cy="8" r="5" fill="rgba(180,60,255,.3)" filter="url(#cosGlow)"/>
    <circle cx="43" cy="8" r="3" fill="#8020d0" stroke="#d060ff" stroke-width="1.5"/>
    <circle cx="42" cy="7" r="1" fill="#fff" opacity=".9"/>
    <!-- Orbital rings -->
    <ellipse cx="43" cy="8" rx="8" ry="3" fill="none" stroke="rgba(200,100,255,.5)" stroke-width="1" transform="rotate(-30 43 8)"/>
    <!-- Black hole reel -->
    <circle cx="18" cy="37" r="7" fill="rgba(0,0,0,.8)" stroke="#8020d0" stroke-width="2"/>
    <circle cx="18" cy="37" r="4" fill="#100020" stroke="rgba(200,100,255,.4)" stroke-width="1"/>
    <circle cx="18" cy="37" r="2" fill="#c060ff" opacity=".8"/>
    <!-- Planet dots around reel -->
    <circle cx="12" cy="37" r="1.5" fill="#6040c0"/>
    <circle cx="18" cy="31" r="1.5" fill="#4060c0"/>
    <circle cx="24" cy="37" r="1.5" fill="#8040c0"/>`,

  demonic: `
    <!-- Demonic Rod -->
    <defs>
      <linearGradient id="demG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff1020"/><stop offset="50%" stop-color="#800010"/><stop offset="100%" stop-color="#300008"/></linearGradient>
    </defs>
    <!-- Dark veins -->
    <path d="M38,12 Q36,20 34,20" stroke="rgba(200,0,20,.4)" stroke-width="4" fill="none" stroke-linecap="round"/>
    <path d="M28,24 Q26,32 24,32" stroke="rgba(200,0,20,.4)" stroke-width="3" fill="none" stroke-linecap="round"/>
    <!-- Main cursed rod -->
    <line x1="42" y1="8" x2="12" y2="44" stroke="url(#demG)" stroke-width="6.5" stroke-linecap="round"/>
    <!-- Blood drips -->
    <circle cx="34" cy="18" r="2" fill="#cc0010" opacity=".8"/>
    <circle cx="26" cy="28" r="1.8" fill="#cc0010" opacity=".8"/>
    <!-- Skull ornaments -->
    <circle cx="40" cy="10" r="4" fill="#1a0008" stroke="#cc0010" stroke-width="1.5"/>
    <circle cx="38" cy="9" r="1" fill="#cc0010"/>
    <circle cx="42" cy="9" r="1" fill="#cc0010"/>
    <path d="M38,12 Q40,14 42,12" stroke="#cc0010" stroke-width="1" fill="none"/>
    <!-- Demonic runes -->
    <text x="28" y="26" font-size="6" fill="rgba(200,0,20,.7)" font-family="serif" transform="rotate(-45 28 26)">ê</text>
    <!-- Hellfire reel -->
    <circle cx="17" cy="37" r="7" fill="rgba(80,0,0,.9)" stroke="#cc0010" stroke-width="2"/>
    <circle cx="17" cy="37" r="4" fill="#400008" stroke="#ff2020" stroke-width="1"/>
    <circle cx="17" cy="37" r="1.5" fill="#ff4020" opacity=".9"/>
    <!-- Rings of blood -->
    <circle cx="29" cy="25" r="3" fill="none" stroke="#cc0020" stroke-width="1.5"/>
    <circle cx="35" cy="18" r="2.5" fill="none" stroke="#cc0020" stroke-width="1.3"/>`,

  godly: `
    <!-- Rod of Gods -->
    <defs>
      <linearGradient id="godG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fff8a0"/><stop offset="30%" stop-color="#ffd700"/><stop offset="60%" stop-color="#ff8800"/><stop offset="100%" stop-color="#ffd700"/></linearGradient>
      <filter id="godF"><feGaussianBlur stdDeviation="3" result="b"/><feComposite in="SourceGraphic" in2="b" operator="over"/></filter>
    </defs>
    <!-- Divine aura -->
    <ellipse cx="26" cy="26" rx="22" ry="22" fill="rgba(255,215,0,.06)" filter="url(#godF)"/>
    <!-- Main golden rod -->
    <line x1="42" y1="8" x2="12" y2="44" stroke="url(#godG)" stroke-width="7.5" stroke-linecap="round" filter="url(#godF)"/>
    <!-- Diamond cross-sections -->
    <polygon points="39,11 42,8 45,11 42,14" fill="#fff8a0" stroke="#c09000" stroke-width="1"/>
    <polygon points="27,24 30,21 33,24 30,27" fill="#fff8a0" stroke="#c09000" stroke-width="1"/>
    <!-- Sun corona at tip -->
    <circle cx="42" cy="8" r="5" fill="rgba(255,215,0,.4)" filter="url(#godF)"/>
    <circle cx="42" cy="8" r="3.5" fill="#ffd700" stroke="#fff8a0" stroke-width="1.5"/>
    <!-- Sun rays -->
    <line x1="42" y1="2" x2="42" y2="4" stroke="#ffd700" stroke-width="1.5"/>
    <line x1="46" y1="4" x2="44.5" y2="5.5" stroke="#ffd700" stroke-width="1.5"/>
    <line x1="48" y1="8" x2="46" y2="8" stroke="#ffd700" stroke-width="1.5"/>
    <line x1="38" y1="2" x2="39.5" y2="3.5" stroke="#ffd700" stroke-width="1.5"/>
    <!-- Crown on reel -->
    <circle cx="17" cy="37" r="7" fill="rgba(60,40,0,.9)" stroke="#ffd700" stroke-width="2"/>
    <polygon points="12,34 14,30 17,34 20,30 22,34" fill="#ffd700" stroke="#c09000" stroke-width="0.8"/>
    <circle cx="14" cy="30" r="1.5" fill="#fff8a0"/>
    <circle cx="17" cy="29" r="1.5" fill="#fff8a0"/>
    <circle cx="20" cy="30" r="1.5" fill="#fff8a0"/>
    <!-- Legendary shine rings -->
    <circle cx="31" cy="23" r="3.5" fill="none" stroke="#ffd700" stroke-width="1.8" opacity=".9"/>
    <circle cx="37" cy="16" r="3" fill="none" stroke="#ffd700" stroke-width="1.6" opacity=".8"/>
    <circle cx="26" cy="30" r="2.5" fill="none" stroke="#ffd700" stroke-width="1.4" opacity=".7"/>`,

  flower: FLOWER_ROD_SVG,
  easter: `
    <!-- Easter Rod SVG -->
    <defs>
      <linearGradient id="eaRodG" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ff80c0"/><stop offset="100%" stop-color="#c060ff"/></linearGradient>
    </defs>
    <!-- Rod body -->
    <line x1="38" y1="8" x2="14" y2="42" stroke="url(#eaRodG)" stroke-width="5" stroke-linecap="round"/>
    <!-- Rabbit head at top -->
    <circle cx="40" cy="8" r="5" fill="#ffe0f0" stroke="#ff80c0" stroke-width="1.5"/>
    <!-- Ears -->
    <ellipse cx="37" cy="3" rx="1.8" ry="4" fill="#ffe0f0" stroke="#ff80c0" stroke-width="1"/>
    <ellipse cx="43" cy="3" rx="1.8" ry="4" fill="#ffe0f0" stroke="#ff80c0" stroke-width="1"/>
    <!-- Inner ears -->
    <ellipse cx="37" cy="3" rx="1" ry="2.5" fill="#ffb0d0"/>
    <ellipse cx="43" cy="3" rx="1" ry="2.5" fill="#ffb0d0"/>
    <!-- Eyes -->
    <circle cx="38" cy="8" r="1" fill="#c060ff"/>
    <circle cx="42" cy="8" r="1" fill="#c060ff"/>
    <!-- Nose -->
    <circle cx="40" cy="10" r=".8" fill="#ff60a0"/>
    <!-- Flowers on rod -->
    <circle cx="28" cy="22" r="3" fill="#ff80c0" opacity=".8"/>
    <circle cx="26" cy="19" r="1.5" fill="#ffb0d0"/>
    <circle cx="22" cy="32" r="2.5" fill="#c060ff" opacity=".7"/>
    <circle cx="20" cy="29" r="1.2" fill="#e0a0ff"/>
    <!-- Easter egg reel -->
    <ellipse cx="16" cy="38" rx="5" ry="4" fill="#ffe0c0" stroke="#d0a030" stroke-width="1.5"/>
    <line x1="11" y1="38" x2="21" y2="38" stroke="#d0a030" stroke-width="1"/>
    <ellipse cx="16" cy="38" rx="2" ry="2" fill="#ff80c0"/>`,
};

// Add SVG to ROD_COLORS specials map
(function patchRodIconSVG(){
  const _origRodIcon = window.rodIconSVG;
  window.rodIconSVG = function(rod) {
    if(HARDCORE_ROD_SVGS[rod.id]) {
      const RC = ROD_COLORS[rod.id] || {color:'#ffd700', glow:'none'};
      const glowStyle = RC.glow !== 'none' ? `filter:drop-shadow(0 0 12px ${RC.color});` : '';
      return `<svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg" style="${glowStyle}width:52px;height:52px">
        <circle cx="26" cy="26" r="24" fill="rgba(0,0,0,.6)" stroke="${RC.color}" stroke-width="2.5"/>
        ${HARDCORE_ROD_SVGS[rod.id]}
      </svg>`;
    }
    return _origRodIcon(rod);
  };
})();

// Override renderRods to show beautiful ultra-detailed cards for new rods
(function patchRenderRodsHardcore(){
  const _prev = window.renderRods;
  window.renderRods = function(body) {
    // Config for ultra rods
    const ULTRA_RODS = {
      mech:    { tier:'ÐœÐ•Ð¥Ð¢Ð˜Ð ',      tierClass:'rod-tier-mech',    borderColor:'#40c0e0', bgGrad:'rgba(0,40,60,.95),rgba(0,20,40,.9)',    anim:'mechPulse 1.5s ease-in-out infinite' },
      cosmic:  { tier:'ÐšÐžÐ¡ÐœÐžÐ¡',      tierClass:'rod-tier-cosmic',   borderColor:'#c060ff', bgGrad:'rgba(20,0,60,.95),rgba(10,0,40,.9)',    anim:'cosmicSpin 3s linear infinite' },
      demonic: { tier:'Ð”Ð•ÐœÐžÐ',       tierClass:'rod-tier-demonic',  borderColor:'#cc0020', bgGrad:'rgba(50,0,10,.95),rgba(30,0,5,.9)',     anim:'demonicPulse 1.2s ease-in-out infinite' },
      godly:   { tier:'Ð‘ÐžÐ“-Ð¢Ð˜Ð•Ð ',   tierClass:'rod-tier-godly',    borderColor:'#ffd700', bgGrad:'rgba(50,35,0,.95),rgba(30,20,0,.9)',    anim:'godlyShine 1.8s ease-in-out infinite' },
      flower:  { tier:'ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐš',  tierClass:'rod-tier-flower',   borderColor:'#ff80c0', bgGrad:'rgba(60,0,40,.97),rgba(30,0,25,.95)',   anim:'flowerRodGlow 1.5s ease-in-out infinite' },
      easter:  { tier:'ðŸ° ÐŸÐÐ¡Ð¥Ð',   tierClass:'rod-tier-easter',   borderColor:'#ff80c0', bgGrad:'rgba(60,0,50,.97),rgba(35,0,30,.95)',   anim:'easterRodGlow 1.5s ease-in-out infinite' },
      pharaoh: { tier:'ðŸº Ð¤ÐÐ ÐÐžÐ',  tierClass:'rod-tier-pharaoh',  borderColor:'#ffe060', bgGrad:'rgba(40,25,0,.97),rgba(20,10,0,.95)',   anim:'pharaohGlow 2s ease-in-out infinite alternate' },
      neon:    { tier:'ðŸ’» ÐÐ•ÐžÐ',     tierClass:'rod-tier-neon',     borderColor:'#00ffcc', bgGrad:'rgba(0,15,12,.97),rgba(0,8,6,.95)',     anim:'neonScan 1.5s ease-in-out infinite' },
      kraken:  { tier:'ðŸ™ ÐšÐ ÐÐšÐ•Ð',  tierClass:'rod-tier-kraken',   borderColor:'#7030d0', bgGrad:'rgba(10,0,30,.97),rgba(5,0,20,.95)',    anim:'krakenTentacle 2.5s ease-in-out infinite' },
      time:    { tier:'â³ Ð’Ð Ð•ÐœÐ¯',    tierClass:'rod-tier-time',     borderColor:'#c0d8ff', bgGrad:'rgba(8,12,22,.97),rgba(4,6,14,.95)',    anim:'timeFreeze 5s ease-in-out infinite' },
      // ÐÐ¾Ð²Ñ‹Ðµ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
      blackhole:{ tier:'ðŸŒŒ Ð‘Ð•Ð—Ð”ÐÐ', tierClass:'rod-tier-demonic',  borderColor:'#8000ff', bgGrad:'rgba(5,0,20,.98),rgba(0,0,10,.98)',     anim:'bhPulse 1s ease-in-out infinite' },
      rainbow:  { tier:'ðŸŒˆ Ð ÐÐ”Ð£Ð“Ð', tierClass:'rod-tier-cosmic',   borderColor:'#ff80ff', bgGrad:'rgba(20,0,30,.95),rgba(0,10,20,.95)',   anim:'rainbowShift 3s linear infinite' },
      magnet:   { tier:'ðŸ§² ÐœÐÐ“ÐÐ˜Ð¢', tierClass:'rod-tier-mech',     borderColor:'#40c0ff', bgGrad:'rgba(0,20,40,.97),rgba(0,10,25,.97)',   anim:'mechPulse 1.5s ease-in-out infinite' },
      laser:    { tier:'ðŸ’¥ Ð›ÐÐ—Ð•Ð ',  tierClass:'rod-tier-demonic',  borderColor:'#ff2020', bgGrad:'rgba(40,0,10,.98),rgba(20,0,5,.98)',    anim:'laserPulse 0.5s ease-in-out infinite alternate' },
      // Ð›Ð¸Ð¼Ð¸Ñ‚ÐºÐ¸ â€” Ñ‚Ð¾Ð¶Ðµ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾ ÐµÑÐ»Ð¸ Ð²Ñ‹Ð´Ð°Ð½Ñ‹
      hugiwugi: { tier:'ðŸŽ„ Ð›Ð˜ÐœÐ˜Ð¢', tierClass:'rod-tier-godly',    borderColor:'#4060ff', bgGrad:'rgba(0,10,60,.98),rgba(0,5,40,.98)',   anim:'neonScan 2s ease-in-out infinite' },
      bakintsa: { tier:'ðŸ‡¦ðŸ‡¿ Ð›Ð˜ÐœÐ˜Ð¢',tierClass:'rod-tier-godly',    borderColor:'#ffd700', bgGrad:'rgba(30,20,0,.98),rgba(15,10,0,.98)',  anim:'pharaohGlow 1.5s ease-in-out infinite alternate' },
    };

    RODS.forEach(rod=>{
      const owned=rod.owned||false;
      const equipped=rod.equipped||false;

      // â­ Ð›Ð˜ÐœÐ˜Ð¢ÐÐ«Ð• ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ â€” ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° ÐµÑÐ»Ð¸ Ð½Ðµ Ð²Ñ‹Ð´Ð°Ð½Ñ‹!
      if(rod.limited && !owned && !equipped) return;

      let btnHtml;

      if(rod.craftable && !owned) {
        if(rod.craftType === 'flower') {
          // Ð¦Ð²ÐµÑ‚Ð¾Ñ‡Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€” ÐºÑ€Ð°Ñ„Ñ‚ Ð¸Ð· ÑÐµÐ¼ÑÐ½
          const sunflower = SEEDS.find(s=>s.id==='sunflower');
          const clover    = SEEDS.find(s=>s.id==='clover');
          const hasSun = (sunflower?.owned||0) >= 3;
          const hasClv = (clover?.owned||0) >= 6;
          const canCraft = hasSun && hasClv;
          const sunTxt = 'ðŸŒ» '+(sunflower?.owned||0)+'/3';
          const clvTxt = 'ðŸ€ '+(clover?.owned||0)+'/6';
          btnHtml = `<button class="craft-flower-btn" onclick="craftFlowerRod()"${canCraft?'':' disabled'} title="ÐÑƒÐ¶Ð½Ð¾: 3Ã—ðŸŒ» Ð¸ 6Ã—ðŸ€">ðŸŒ¸ ÐšÑ€Ð°Ñ„Ñ‚<br><span style="font-size:9px">${sunTxt} â€¢ ${clvTxt}</span></button>`;
        } else if(rod.craftType === 'easter') {
          // Ð£Ð´Ð¾Ñ‡ÐºÐ° ÐŸÐ°ÑÑ…Ð¸ â€” ÐºÑ€Ð°Ñ„Ñ‚ Ð¸Ð· ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð² Ñ Cha Cha
          const kills = gs.easterChaChaKills || 0;
          const canCraft = kills >= 30;
          const killTxt = `ðŸ° ${kills}/30 Cha Cha`;
          btnHtml = `<button class="craft-easter-btn" onclick="craftEasterRod()"${canCraft?'':' disabled'} title="ÐÑƒÐ¶Ð½Ð¾: 30 ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð² Ñ Cha Cha">ðŸ° ÐšÑ€Ð°Ñ„Ñ‚<br><span style="font-size:9px">${killTxt}</span></button>`;
        } else {
          const canCraft = (gs.sharkSkins||0) >= 1 && gs.coins >= 10000;
          const bossKilled = !!localStorage.getItem(BOSS_KEY);
          if(!bossKilled) {
            btnHtml = `<button class="shop-item-btn btn-owned-shop" style="font-size:10px">ðŸ”’ Ð£Ð±ÐµÐ¹ ÐÐºÑƒÐ»Ñƒ</button>`;
          } else {
            btnHtml = `<button class="craft-rod-btn" onclick="craftSharkRod()" style="font-size:12px;padding:5px 10px"${canCraft?'':' disabled'}>ðŸ”¨ ÐšÑ€Ð°Ñ„Ñ‚ (ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹ + 10ÐºðŸª™)</button>`;
          }
        }
      } else if(equipped) {
        btnHtml=`<button class="shop-item-btn btn-equipped-shop">âœ“ ÐÐ°Ð´ÐµÑ‚Ð°</button>`;
      } else if(owned) {
        btnHtml=`<button class="shop-item-btn btn-equip-shop" onclick="equipRod('${rod.id}')">ÐÐ°Ð´ÐµÑ‚ÑŒ</button>`;
      } else {
        const canBuy = gs.coins >= (rod.price||0);
        btnHtml=`<button class="shop-item-btn btn-buy-shop" onclick="buyRod('${rod.id}')"${canBuy?'':' style="opacity:.5"'}>ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ</button>`;
      }

      const ultra = ULTRA_RODS[rod.id];

      if(ultra) {
        // â•â•â• ULTRA ROD â€” big beautiful card â•â•â•
        const RC = ROD_COLORS[rod.id] || {color:'#ffd700'};
        const svgContent = HARDCORE_ROD_SVGS[rod.id] || '';
        const bigSvg = `<svg viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg"
          style="width:72px;height:72px;filter:drop-shadow(0 0 12px ${RC.color});animation:${ultra.anim}">
          <circle cx="26" cy="26" r="24" fill="rgba(0,0,0,.7)" stroke="${RC.color}" stroke-width="2.5"/>
          ${svgContent}
        </svg>`;

        const nameWithBadge = `${rod.name}<span class="rod-tier-badge ${ultra.tierClass}">${ultra.tier}</span>`;
        const cls = (equipped?'equipped':owned?'owned':'') + ' ultra-rod';
        const el = makeShopItem(bigSvg, nameWithBadge, rod.desc, rod.stats,
          owned?'':rod.price, btnHtml, cls);

        // Apply custom border and bg
        el.style.borderColor = ultra.borderColor;
        el.style.boxShadow = `0 0 12px ${ultra.borderColor}55, inset 0 0 20px rgba(0,0,0,.3)`;
        el.style.background = `linear-gradient(135deg, ${ultra.bgGrad})`;
        if(equipped) el.style.boxShadow = `0 0 20px ${ultra.borderColor}aa, 0 0 40px ${ultra.borderColor}44`;

        // Fix innerHTML for name badge
        const nameEl = el.querySelector('.shop-item-name');
        if(nameEl) {
          nameEl.innerHTML = nameWithBadge;
          nameEl.style.color = RC.color;
          nameEl.style.textShadow = `0 0 10px ${RC.color}`;
        }
        body.appendChild(el);
      } else {
        // Normal rod card
        const cls=equipped?'equipped':owned?'owned':'';
        let nameHtml = rod.name;
        if(rod.detail) nameHtml += `<span class="rod-detail-badge">${rod.detail}</span>`;
        const el=makeShopItem(
          rodIconSVG(rod), nameHtml, rod.desc, rod.stats,
          (owned||rod.craftable)?'':rod.price, btnHtml, cls
        );
        const nameEl = el.querySelector('.shop-item-name');
        if(nameEl && rod.detail) nameEl.innerHTML = nameHtml;
        body.appendChild(el);
      }
    });
  };
})();

// Handle new rod catch behavior
(function patchHardcoreRodCatch(){
  // Patch bite logic for new rods in setInterval-friendly way
  const _prevCheckPickFish = window.pickFishPatched;
  window.pickFishPatched = function() {
    const rod = gs.currentRod;
    // Demonic rod: only OG/legend + bonus coins
    if(rod.id==='demonic') {
      const pool = FISH_DATA.filter(f=>f.og||f.rar==='legend'||f.rar==='coastal_legend');
      const f = pool[Math.floor(Math.random()*pool.length)];
      gs._demonicBonus = true;
      return f;
    }
    // Godly: literally any fish, heavily weighted OG
    if(rod.id==='godly') {
      const pool = [];
      FISH_DATA.filter(f=>!f.coastal).forEach(f=>{
        const w = f.og ? 50 : f.rar==='legend' ? 20 : f.rar==='epic' ? 10 : 1;
        for(let i=0;i<w;i++) pool.push(f);
      });
      return pool[Math.floor(Math.random()*pool.length)];
    }
    if(_prevCheckPickFish) return _prevCheckPickFish();
    return null;
  };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const HC_BOSSES = [
  {id:'kraken',    name:'ðŸ™ ÐšÑ€Ð°ÐºÐµÐ½',        hp:500,  reward:3000, icon:'ðŸ™'},
  {id:'leviathan', name:'ðŸ Ð›ÐµÐ²Ð¸Ð°Ñ„Ð°Ð½',       hp:800,  reward:5000, icon:'ðŸ'},
  {id:'siren',     name:'ðŸ§œ Ð¡Ð¸Ñ€ÐµÐ½Ð° Ð¡Ð¼ÐµÑ€Ñ‚Ð¸',  hp:1000, reward:8000, icon:'ðŸ§œ'},
  {id:'neptune',   name:'ðŸ”± ÐÐµÐ¿Ñ‚ÑƒÐ½',         hp:1500, reward:15000, icon:'ðŸ”±'},
  {id:'abyss',     name:'ðŸŒ‘ Ð‘ÐµÐ·Ð´Ð½Ð°',         hp:3000, reward:50000, icon:'ðŸŒ‘'},
];

let hcBossState = {
  active: false,
  bossIdx: 0,
  hp: 0,
  maxHp: 0,
  tapCount: 0,
  tapNeeded: 0,
};
let hcBossTimer = null;

function unlockHardcoreMap() {
  gs.hardcoreUnlocked = true;
  const btn = document.getElementById('map-btn-hardcore');
  if(btn) btn.style.display='';
  showToast('ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð°! Ð˜Ð´Ð¸ Ñ‚ÑƒÐ´Ð° ÐµÑÐ»Ð¸ Ð½Ðµ Ð±Ð¾Ð¸ÑˆÑŒÑÑ!');
  saveGame();
}

function setHardcoreMap() {
  // Called from setMap when mode=hardcore
  const badge = document.getElementById('hardcore-mode-badge');
  if(badge) badge.style.display='block';
  document.documentElement.style.setProperty('--sky-top','#100000');
  document.documentElement.style.setProperty('--sky-bot','#1a0000');
  document.documentElement.style.setProperty('--water-top','#300000');
  document.documentElement.style.setProperty('--water-bot','#100000');
  // Start boss spawning
  scheduleHCBoss();
  showToast('ðŸ’€ Ð¥ÐÐ Ð”ÐšÐžÐ  ÐšÐÐ Ð¢Ð! Ð‘Ð¾ÑÑÑ‹ Ð°Ñ‚Ð°ÐºÑƒÑŽÑ‚! ÐŸÐ¸Ñ€Ð°Ð½ÑŒÐ¸ Ð¾Ñ…Ð¾Ñ‚ÑÑ‚ÑÑ! Ð£Ð´Ð°Ñ‡Ð¸...');
}

function scheduleHCBoss() {
  clearTimeout(hcBossTimer);
  if(gs.mapMode !== 'hardcore') return;
  hcBossTimer = setTimeout(()=>{
    if(gs.mapMode !== 'hardcore') return;
    spawnHCBoss();
  }, 15000 + Math.random()*20000); // 15-35 sec between bosses
}

function spawnHCBoss() {
  if(hcBossState.active) return;
  const boss = HC_BOSSES[hcBossState.bossIdx % HC_BOSSES.length];
  hcBossState.active = true;
  hcBossState.hp = boss.hp;
  hcBossState.maxHp = boss.hp;
  hcBossState.tapNeeded = boss.hp;
  hcBossState.tapCount = 0;

  const nameEl = document.getElementById('hc-boss-name');
  const barEl = document.getElementById('hc-boss-bar');
  if(nameEl) nameEl.textContent = boss.name + ' â€” Ð¢Ð°Ð¿Ð°Ð¹ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð±ÐµÐ´Ð¸Ñ‚ÑŒ!';
  if(barEl) barEl.style.display='block';
  updateHCBossBar();

  showToast('ðŸ’€ Ð‘ÐžÐ¡Ð¡ ÐŸÐžÐ¯Ð’Ð˜Ð›Ð¡Ð¯: ' + boss.name + '! Ð¢Ð°Ð¿Ð°Ð¹ Ð²Ð¾Ð´Ñƒ Ð±Ñ‹ÑÑ‚Ñ€Ð¾!');
  shakeScreen();
}

function updateHCBossBar() {
  const pct = Math.max(0, hcBossState.hp / hcBossState.maxHp * 100);
  const fill = document.getElementById('hc-boss-hp-fill');
  if(fill) fill.style.width = pct + '%';
}

function tapHCBoss() {
  if(!hcBossState.active) return;
  hcBossState.hp -= 15 + Math.floor(Math.random()*20);
  updateHCBossBar();
  if(hcBossState.hp <= 0) {
    hcBossState.hp = 0;
    hcBossState.active = false;
    const boss = HC_BOSSES[hcBossState.bossIdx % HC_BOSSES.length];
    gs.coins += boss.reward;
    updateCoins();
    document.getElementById('hc-boss-bar').style.display='none';
    showToast('ðŸ† Ð‘ÐžÐ¡Ð¡ Ð£Ð‘Ð˜Ð¢: ' + boss.name + '! +' + boss.reward.toLocaleString() + 'ðŸª™!');
    hcBossState.bossIdx++;
    addXP(500);
    coinBurst(180, 350);
    scheduleHCBoss();
    saveGame();
  }
}

// Patch water click for hardcore boss tapping
const _origWaterClickHC = fishingScreen.onclick;
fishingScreen.addEventListener('click', function() {
  if(gs.mapMode==='hardcore' && hcBossState.active) tapHCBoss();
});

// Patch setMap to handle hardcore
const _origSetMap = window.setMap;
window.setMap = function(mode) {
  // Clear hardcore-specific state
  clearTimeout(hcBossTimer);
  hcBossState.active = false;
  document.getElementById('hc-boss-bar').style.display='none';
  document.getElementById('hardcore-mode-badge').style.display='none';
  document.getElementById('bum-mode-badge').style.display='none';
  document.getElementById('map-btn-bum').style.display='none';

  if(mode === 'hardcore') {
    if(!gs.hardcoreUnlocked) {
      showToast('ðŸ”’ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€ ÐºÐ°Ñ€Ñ‚Ð° Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð°! Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð±ÐµÐ´Ð¸ Ð“Ð¸Ð±Ñ€Ð¸Ð´ ÐÐºÑƒÐ»Ñƒ!');
      return;
    }
    gs.mapMode = 'hardcore';
    ['normal','pokemon','coast','hardcore','bum','easter'].forEach(m=>{
      const btn = document.getElementById('map-btn-'+m);
      if(btn) btn.classList.toggle('active', m==='hardcore');
    });
    setHardcoreMap();
    return;
  }
  if(mode === 'bum') {
    // Can't leave directly â€” handled by tryLeaveBumMap
    return;
  }
  _origSetMap(mode);
};

// Unlock hardcore when boss is killed
const _origCloseBoss = window.closeBossFight;
window.closeBossFight = function() {
  _origCloseBoss();
  unlockHardcoreMap();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ¦· ÐŸÐ˜Ð ÐÐÐ¬Ð¯ ÐœÐ•Ð¥ÐÐÐ˜ÐšÐ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ§Ÿ Ð‘ÐžÐœÐ–ÐÐ¢Ð¡ÐšÐÐ¯ ÐšÐÐ Ð¢Ð
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const BUM_FISH = [
  {name:'Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ð¹ ÐšÐ°Ñ€Ð°ÑÑŒ',   w:[0.1,0.5], pts:2,  coins:2,  rar:'common', label:'ðŸ’€ Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ð¹', col:'#604030', col2:'#302018', bum:true},
  {name:'Ð¢ÑƒÑ…Ð»Ñ‹Ð¹ ÐžÐºÑƒÐ½ÑŒ',      w:[0.2,0.8], pts:3,  coins:3,  rar:'common', label:'ðŸ’€ Ð¢ÑƒÑ…Ð»Ñ‹Ð¹',   col:'#504028', col2:'#282010', bum:true},
  {name:'Ð“Ð½Ð¸Ð»Ð°Ñ Ð©ÑƒÐºÐ°',       w:[0.3,2.0], pts:5,  coins:5,  rar:'rare',   label:'ðŸ’€ Ð“Ð½Ð¸Ð»Ð°Ñ',   col:'#404020', col2:'#202010', bum:true},
  {name:'ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ñ‹Ð¹ Ð›ÐµÑ‰',     w:[0.5,3.0], pts:8,  coins:8,  rar:'rare',   label:'ðŸ’€ ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ñ‹Ð¹',col:'#503818', col2:'#281808', bum:true},
  {name:'Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ð¹ Ð‘Ð°Ñ„Ñ„ÐµÑ€',   w:[0.1,0.3], pts:20, coins:40, rar:'rare',   label:'ðŸŸ¡ Ð‘Ð°Ñ„Ñ„ÐµÑ€+',  col:'#c0a020', col2:'#806010', buff:true, bum:true},
];

function triggerBumMap() {
  gs.mapMode = 'bum';
  gs.bumCoins = gs.coins;
  // Clear all map buttons active state
  ['normal','pokemon','coast','hardcore','bum'].forEach(m=>{
    const btn = document.getElementById('map-btn-'+m);
    if(btn) btn.classList.toggle('active', m==='bum');
  });
  const bumBtn = document.getElementById('map-btn-bum');
  if(bumBtn) bumBtn.style.display='';
  document.getElementById('bum-mode-badge').style.display='block';

  // Apocalyptic water colors
  document.documentElement.style.setProperty('--sky-top','#0e0c06');
  document.documentElement.style.setProperty('--sky-bot','#1a160a');
  document.documentElement.style.setProperty('--water-top','#1e1608');
  document.documentElement.style.setProperty('--water-bot','#0a0804');

  // Show "boss" arrival
  showBumBossArrival();
  saveGame();
}

function showBumBossArrival() {
  // Re-use boss overlay briefly for the arrival cutscene
  const overlay = document.getElementById('boss-overlay');
  overlay.classList.add('active');
  const cs = document.getElementById('boss-cutscene');
  document.getElementById('boss-hp-wrap').style.display='none';
  document.getElementById('boss-attack-zone').style.display='none';
  document.getElementById('boss-victory').classList.remove('show');

  cs.innerHTML = `
    <div class="boss-cs-text" style="color:#c08020;text-shadow:0 0 20px #c08020">ðŸ’€ Ð‘ÐÐÐšÐ ÐžÐ¢!</div>
    <div class="boss-cs-sub" style="color:#a07030">ÐŸÐ¸Ñ€Ð°Ð½ÑŒÐ¸ Ð²ÑÑ‘ ÑÑŠÐµÐ»Ð¸... Ð¥Ð¾Ð·ÑÐ¸Ð½ Ð¥Ð°Ñ€Ð´ÐºÐ¾Ñ€ ÐšÐ°Ñ€Ñ‚Ñ‹<br>Ð›Ð˜Ð§ÐÐž Ð²Ñ‹Ð³Ð¾Ð½ÑÐµÑ‚ Ñ‚ÐµÐ±Ñ Ð½Ð° Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ð¸Ðº!</div>
    <div style="font-size:60px;animation:sharkFloat 1s ease-in-out infinite alternate;margin:10px 0">ðŸ‘¹</div>
    <div class="boss-cs-sub" style="color:#ff8040">Â«Ð’ÐžÐ ÐžÐ¢Ð¡Ð®Ð”Ð, ÐÐ˜Ð©Ð•Ð‘Ð ÐžÐ”!Â»</div>`;

  setTimeout(()=>{
    overlay.classList.remove('active');
    showToast('ðŸ’€ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð‘ÐžÐœÐ–ÐÐ¢ÐÐ˜Ðš! Ð¡Ð¾Ð±ÐµÑ€Ð¸ 1000ðŸª™ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ¹Ñ‚Ð¸!');
  }, 3500);
}

function tryLeaveBumMap() {
  if(gs.mapMode !== 'bum') return;
  if(gs.coins >= 1000) {
    gs.mapMode = 'normal';
    document.getElementById('bum-mode-badge').style.display='none';
    document.getElementById('map-btn-bum').style.display='none';
    setMap('normal');
    showToast('ðŸŽ‰ Ð¢Ñ‹ Ð²Ñ‹Ð±Ñ€Ð°Ð»ÑÑ Ð¸Ð· Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ð¸ÐºÐ°! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð±ÐµÑ€ÐµÐ³Ð¸ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹!');
    saveGame();
  } else {
    const need = 1000 - gs.coins;
    showToast('ðŸ’¸ ÐÑƒÐ¶Ð½Ð¾ ÐµÑ‰Ñ‘ ' + need + 'ðŸª™ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾ÐºÐ¸Ð½ÑƒÑ‚ÑŒ Ð‘Ð¾Ð¼Ð¶Ð°Ñ‚Ð½Ð¸Ðº!');
  }
}

// Patch setMap to handle bum map fish
const _origPickBumFish = true;
// Patch the bite/catch sequence to use bum fish when in bum map
// We override the bite behavior trigger for bum map
const _origBiteCheck = window.onBite;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŒ¿ Ð‘Ð£Ðœ ÐœÐÐŸ Ð Ð«Ð‘Ð« Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¹ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐµ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Intercept the bite phase to inject bum map fish
(function patchBumMapFish(){
  // We patch at the pool-building level inside the existing bite listener
  // by overriding setMap to inject bum fish into FISH_DATA temporarily
  const bumFishIds = BUM_FISH.map(f=>f.name);

  // Remove bum fish if added before
  function removeBumFishFromData() {
    const idx = FISH_DATA.findIndex(f=>f.bum);
    while(FISH_DATA.findIndex(f=>f.bum) !== -1) {
      FISH_DATA.splice(FISH_DATA.findIndex(f=>f.bum), 1);
    }
  }

  const _prevSetMap2 = window.setMap;
  window.setMap = function(mode) {
    removeBumFishFromData();
    if(mode === 'bum') {
      // Add bum fish
      BUM_FISH.forEach(f=>FISH_DATA.push({...f}));
    }
    _prevSetMap2(mode);
  };

  // Also patch the fish pool builder for bum map
  const _origBiteLogic = window.triggerBiteAttempt || null;
  // We handle bum map fish by patching the cast/bite logic
  // The pool builder already checks gs.mapMode so we inject through that
})();

// Patch coastal pool builder to handle bum map
const _origFishPickPool = null;
// Direct approach: patch the fishing screen click to inject bum map logic
(function patchBumMapPickFish(){
  const _prevPickPatched = window.pickFishPatched;
  window.pickFishPatched = function() {
    if(gs.mapMode === 'bum') {
      // Only bum fish
      const bumPool = FISH_DATA.filter(f=>f.bum);
      if(bumPool.length) {
        const f = bumPool[Math.floor(Math.random()*bumPool.length)];
        return {...f};
      }
    }
    if(_prevPickPatched) return _prevPickPatched();
    return null;
  };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš½ ÐŸÐžÐšÐ•Ð‘ÐžÐ› Ð Ð•Ð¤Ð’ÐžÐ Ðš â€” ÐŸÑ€Ð¸ Ð»ÑŽÐ±Ð¾Ð¼ ÑƒÐ»Ð¾Ð²Ðµ ÑˆÐ°Ð½Ñ Ð¿Ð¾Ð¹Ð¼Ð°Ñ‚ÑŒ Ð±Ð¾Ð½ÑƒÑ Ð² ÐŸÐ¾ÐºÐµÐ±Ð¾Ð»
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const POKEBALL_BOOSTS = [
  {id:'coin_rain',   name:'ÐœÐ¾Ð½ÐµÑ‚Ð½Ñ‹Ð¹ Ð”Ð¾Ð¶Ð´ÑŒ',  icon:'ðŸ’°', desc:'+3000 Ð¼Ð¾Ð½ÐµÑ‚',        type:'coins',   value:3000},
  {id:'og_lure',     name:'OG ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ°',     icon:'ðŸ‘‘', desc:'OG Ñ€Ñ‹Ð±Ñ‹ 60 ÑÐµÐº',     type:'og_lure', value:60000},
  {id:'xp_boost',    name:'XP x3',           icon:'âš¡', desc:'XP x3 Ð½Ð° 90 ÑÐµÐº',    type:'xp',      value:90000},
  {id:'bite_god',    name:'ÐšÐ»Ñ‘Ð²-Ð‘ÐžÐ“',        icon:'ðŸŽ£', desc:'ÐšÐ»Ñ‘Ð² x10 Ð½Ð° 30 ÑÐµÐº', type:'bite',    value:30000},
  {id:'legend_pull', name:'Ð—Ð¾Ð² Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹',     icon:'ðŸŒŸ', desc:'Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹ 45ÑÐµÐº',type:'legend',  value:45000},
  {id:'shark_skin',  name:'ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹',      icon:'ðŸ¦ˆ', desc:'+1 ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹',      type:'shark_skin',value:1},
  {id:'mega_coins',  name:'ÐœÐ•Ð“Ð-ÐœÐžÐÐ•Ð¢Ð«',     icon:'ðŸ’Ž', desc:'+10000 Ð¼Ð¾Ð½ÐµÑ‚',        type:'coins',   value:10000},
  {id:'pika_ultra',  name:'Ð£Ð»ÑŒÑ‚Ñ€Ð°-ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ',   icon:'âš¡âš¡',desc:'+200 ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ð¾Ð²',  type:'pika',    value:200},
];

let pendingPokeballBoost = null;

function trySpawnPokeball() {
  // 15% chance on any catch
  if(Math.random() > 0.15) return;
  const boost = POKEBALL_BOOSTS[Math.floor(Math.random()*POKEBALL_BOOSTS.length)];
  pendingPokeballBoost = boost;

  // Show pokeball animation overlay
  const overlay = document.getElementById('pokeball-catch-overlay');
  document.getElementById('pokeball-boost-txt').textContent = boost.icon + ' ' + boost.name + ': ' + boost.desc;
  overlay.style.display='block';
  if(navigator.vibrate) navigator.vibrate([100,50,100,50,200]);
}

function collectPokeball() {
  if(!pendingPokeballBoost) return;
  const boost = pendingPokeballBoost;
  pendingPokeballBoost = null;
  document.getElementById('pokeball-catch-overlay').style.display='none';

  // Add to inventory as a special pokeball item
  const pokeballItem = {
    name: 'ÐŸÐ¾ÐºÐµÐ±Ð¾Ð»: ' + boost.name,
    label: 'âš½ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð»-Ð‘ÑƒÑÑ‚',
    rar: 'pokeball',
    weight: 'â€”',
    pts: 0,
    coins: 0,
    col: '#cc2020',
    col2: '#881010',
    pokeballBoost: boost,
    _isPokeball: true,
  };

  if(gs.inventory.length < gs.maxInv) {
    gs.inventory.push(pokeballItem);
    renderInventory();
    showToast('âš½ ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ñ ' + boost.icon + ' ' + boost.name + ' Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ!');
  } else {
    showToast('ðŸŽ’ Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð¿Ð¾Ð»Ð¾Ð½! ÐŸÐ¾ÐºÐµÐ±Ð¾Ð» Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½!');
  }
  saveGame();
}

function activatePokeballBoost(idx) {
  const item = gs.inventory[idx];
  if(!item || !item._isPokeball || !item.pokeballBoost) return;
  const boost = item.pokeballBoost;
  gs.inventory.splice(idx, 1);

  switch(boost.type) {
    case 'coins':
      gs.coins += boost.value; updateCoins(); coinBurst(180,350);
      showToast(boost.icon + ' ' + boost.name + ': +' + boost.value + 'ðŸª™!');
      break;
    case 'og_lure':
      gs._ogLureActive = Date.now() + boost.value;
      showToast(boost.icon + ' OG ÐŸÑ€Ð¸Ð¼Ð°Ð½ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð° ' + (boost.value/1000) + ' ÑÐµÐº!');
      break;
    case 'xp':
      gs._xpBoostEnd = Date.now() + boost.value;
      showToast(boost.icon + ' XP x3 Ð½Ð° ' + (boost.value/1000) + ' ÑÐµÐº!');
      break;
    case 'bite':
      gs._biteBoostEnd = Date.now() + boost.value;
      showToast(boost.icon + ' ÐšÐ»Ñ‘Ð² x10 Ð½Ð° ' + (boost.value/1000) + ' ÑÐµÐº!');
      break;
    case 'legend':
      gs._legendOnlyEnd = Date.now() + boost.value;
      showToast(boost.icon + ' Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð»ÐµÐ³ÐµÐ½Ð´Ñ‹ ' + (boost.value/1000) + ' ÑÐµÐº!');
      break;
    case 'shark_skin':
      gs.sharkSkins = (gs.sharkSkins||0) + boost.value;
      showToast(boost.icon + ' +' + boost.value + ' ÐšÐ¾Ð¶Ð° ÐÐºÑƒÐ»Ñ‹!');
      break;
    case 'pika':
      gs.pikaCoins += boost.value; updatePikaCoins();
      showToast(boost.icon + ' +' + boost.value + ' ÐŸÐ¸ÐºÐ°ÐšÐ¾Ð¸Ð½Ð¾Ð²!');
      break;
  }
  renderInventory();
  saveGame();
}

// Patch catchFish/catchPokemon to try spawn pokeball
const _prevCatchPokemon = window.catchPokemon;
window.catchPokemon = function(f) {
  _prevCatchPokemon(f);
  setTimeout(trySpawnPokeball, 800);
};

// Patch inventory render to show pokeball items with activate button
const _origRenderInventory = window.renderInventory;
window.renderInventory = function() {
  _origRenderInventory();
  // After original render, patch pokeball slots
  const inv = document.getElementById('inv-body');
  if(!inv) return;
  const slots = inv.querySelectorAll('.inv-slot:not(.empty)');
  slots.forEach((slot, i) => {
    if(gs.inventory[i] && gs.inventory[i]._isPokeball) {
      slot.classList.add('pokeball-inv-slot');
      slot.style.border = '2px solid #cc2020';
      slot.style.background = 'radial-gradient(circle,rgba(80,0,0,.5),rgba(20,0,0,.8))';
      // Override click
      slot.onclick = () => activatePokeballBoost(i);
      // Update display
      const nameEl = slot.querySelector('.inv-fish-name');
      if(nameEl) {
        nameEl.textContent = gs.inventory[i].name.replace('ÐŸÐ¾ÐºÐµÐ±Ð¾Ð»: ','');
        nameEl.style.color = '#ff8080';
      }
      const weightEl = slot.querySelector('.inv-fish-weight');
      if(weightEl) weightEl.textContent = 'âš½ Ð¢Ð°Ð¿ = Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ!';
    }
  });
};

// Pokeball SVG in inventory
const _origUpdateCatchPopup = window.updateCatchPopupFish;
// Pokeball rarity display
const _origRarEl2 = document.getElementById('catch-rarity');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ð Ð•Ð¤Ð’ÐžÐ Ðš ÐŸÐ˜ÐšÐÐ§Ð£ â€” Ð˜ÐœÐ‘Ð ÐŸÐ˜ÐšÐÐ§Ð£ Ð’ Ð›Ð®Ð‘ÐžÐ™ ÐšÐÐ Ð¢Ð•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// New imba Pokemon that appear on ANY map
const IMBA_POKEMON = [
  {name:'ÐœÐµÐ³Ð°-ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ',    emoji:'âš¡âš¡', pts:500,  coins:300, pikaCoins:500, rar:'og', label:'ðŸ‘‘ Ð˜ÐœÐ‘Ð', col:'#ffd700', col2:'#c09000', imba:true},
  {name:'Ð“Ð¸Ð³Ð°Ð½Ñ‚ÑÐºÐ¸Ð¹ ÐœÑŒÑŽ', emoji:'ðŸ’«',  pts:600,  coins:400, pikaCoins:600, rar:'og', label:'ðŸ‘‘ Ð˜ÐœÐ‘Ð', col:'#ff80ff', col2:'#c040c0', imba:true},
  {name:'ÐŸÑ€Ð¾Ñ‚Ð¾-ÐœÑŒÑŽÑ‚Ñƒ',    emoji:'ðŸ”®',  pts:800,  coins:500, pikaCoins:800, rar:'og', label:'ðŸ‘‘ Ð˜ÐœÐ‘Ð', col:'#c040ff', col2:'#8010c0', imba:true},
  {name:'ÐŸÐ¸ÐºÐ°Ñ‡Ñƒ ÐžÐ¼ÐµÐ³Ð°',   emoji:'âš¡ðŸ‘‘',pts:1000, coins:1000,pikaCoins:1000,rar:'og', label:'ðŸ‘‘ OMEGA',col:'#ffffff', col2:'#c0c0c0', imba:true},
];
IMBA_POKEMON.forEach(p=>POKEMON_DATA.push(p));

// On any catch (on any map), 5% chance to spawn imba pokemon in pokeball
function trySpawnImbaPokemon() {
  if(Math.random() > 0.05) return;
  const p = IMBA_POKEMON[Math.floor(Math.random()*IMBA_POKEMON.length)];
  pendingPokeballBoost = {
    id: 'imba_pokemon',
    name: p.name,
    icon: p.emoji,
    desc: '+' + p.pikaCoins + 'âš¡ Ð¸ +' + p.pts + 'â˜…',
    type: 'pika',
    value: p.pikaCoins,
    _pokemon: p,
  };

  const overlay = document.getElementById('pokeball-catch-overlay');
  const ballEl = document.getElementById('pokeball-anim');
  ballEl.textContent = 'ðŸ”´âšª'; // Pokeball look
  document.getElementById('pokeball-boost-txt').textContent = 'âœ¨ Ð˜ÐœÐ‘Ð ÐŸÐžÐšÐ•ÐœÐžÐ: ' + p.emoji + ' ' + p.name + '! (+' + p.pikaCoins + 'âš¡ +' + p.pts + 'â˜…)';
  overlay.style.display='block';
  if(navigator.vibrate) navigator.vibrate([200,100,200,100,400]);
}

// Patch trySpawnPokeball to also try imba
const _prevTrySpawn = trySpawnPokeball;
// Already defined trySpawnPokeball â€” add imba attempt at catch time
// Hook into the main catch popup show moment
const _origCatchFishFinal = window.onCatchComplete;

// Patch: after any fish catch (not pokemon), also try pokeball + imba
// We hook into the 'keepFish' and 'sellFish' calls as those happen after catch popup
const _origKeepFish = window.keepFish;
window.keepFish = function() {
  if(_origKeepFish) _origKeepFish();
  // Try pokeball spawn after keeping fish
  setTimeout(()=>{
    trySpawnPokeball();
    if(Math.random() < 0.03) trySpawnImbaPokemon();
  }, 300);
};

const _origSellFishFn = window.sellFish;
window.sellFish = function() {
  if(_origSellFishFn) _origSellFishFn();
  setTimeout(()=>{
    trySpawnPokeball();
    if(Math.random() < 0.03) trySpawnImbaPokemon();
  }, 300);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ð‘Ð£Ðœ ÐœÐÐŸ â€” Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ðµ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ñ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BUM_SEEDS_OVERLAY = [
  {id:'rotten_flower',  name:'ðŸ¥€ Ð¡Ð³Ð½Ð¸Ð²ÑˆÐ¸Ð¹ Ð¦Ð²ÐµÑ‚Ð¾Ðº', bag:'ðŸ¥€', seed:'ðŸ’€', flower:'ðŸ¥€', color:'#604030',
   desc:'Ð“Ð½Ð¸Ð»Ð¾Ðµ. Ð’Ð¾Ð½ÑÐµÑ‚. ÐÐ¾ Ñ…Ð¾Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾...',
   flowerDesc:'ÐœÑƒÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð²ÑˆÐ¸Ð¹ Ð³Ð½Ð¸Ð»Ð¾Ð¹ Ñ†Ð²ÐµÑ‚Ð¾Ðº. ÐŸÑ€Ð¾Ð´Ð°Ñ‘Ñ‚ÑÑ Ð´Ñ‘ÑˆÐµÐ²Ð¾ Ð½Ð¾ ÐºÐ¾Ð¼Ñƒ Ð½ÑƒÐ¶Ð½Ð° Ð³Ð½Ð¸Ð»ÑŒ?',
   growTime:30000, price:3, sellPrice:5, owned:0, bum:true},
  {id:'cursed_plant',   name:'â˜ ï¸ ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ð¾Ðµ Ð Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ',bag:'â˜ ï¸',seed:'ðŸ’€',flower:'â˜ ï¸',color:'#402010',
   desc:'ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ð¾. Ð Ð°ÑÑ‚Ñ‘Ñ‚ Ð±Ñ‹ÑÑ‚Ñ€Ð¾. Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚.',
   flowerDesc:'ÐŸÑ€Ð¾ÐºÐ»ÑÑ‚Ð¾Ðµ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ Ñ Ð½ÐµÐ¿Ñ€ÐµÐ´ÑÐºÐ°Ð·ÑƒÐµÐ¼Ñ‹Ð¼ ÑÑ„Ñ„ÐµÐºÑ‚Ð¾Ð¼ Ð¿Ñ€Ð¸ ÑÐ±Ð¾Ñ€Ðµ. Ð˜Ð½Ð¾Ð³Ð´Ð° Ð²Ð¾Ñ€ÑƒÐµÑ‚ Ð¼Ð¾Ð½ÐµÑ‚Ñ‹!',
   growTime:20000, price:1, sellPrice:2, owned:0, bum:true},
];

// Patch garden shop to show bum seeds when in bum map
const _origRenderShopSeeds = window.renderShopSeeds;

// Patch renderGarden to tint everything rotten when in bum map
const _origRenderGarden = window.renderGarden;
window.renderGarden = function() {
  if(_origRenderGarden) _origRenderGarden();
  // Add bum seeds to SEEDS temporarily
  if(gs.mapMode === 'bum') {
    BUM_SEEDS_OVERLAY.forEach(s=>{
      if(!SEEDS.find(x=>x.id===s.id)) SEEDS.push({...s});
    });
  } else {
    BUM_SEEDS_OVERLAY.forEach(s=>{
      const idx = SEEDS.findIndex(x=>x.id===s.id);
      if(idx!==-1) SEEDS.splice(idx,1);
    });
  }
};

// ðŸŽ® ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð»Ð°Ð³Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸
(function applyLoadedFlags(){
  if(gs.hardcoreUnlocked || localStorage.getItem(BOSS_KEY)) {
    gs.hardcoreUnlocked = true;
    const btn = document.getElementById('map-btn-hardcore');
    if(btn) btn.style.display='';
  }
  if(gs.coastUnlocked) {
    const btn = document.getElementById('map-btn-coast');
    if(btn) btn.style.display='';
  }
  if(gs.currentRod) {
    const el = document.getElementById('current-rod-name');
    if(el) el.textContent = 'Ð£Ð´Ð¾Ñ‡ÐºÐ°: ' + gs.currentRod.name;
  }
  // ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¾ÑÑ‚ Ð¾ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð·
  if(!localStorage.getItem('fishing_comp_toast_shown')) {
    localStorage.setItem('fishing_comp_toast_shown','1');
    setTimeout(()=>{ if(typeof showToast==='function') showToast('ðŸŽ +1 000 000ðŸª™ + Ð’Ð¡Ð• Ð£Ð”ÐžÐ§ÐšÐ˜ + ðŸŒ¸ Ð¦Ð’Ð•Ð¢ÐžÐ§ÐÐÐ¯ Ð£Ð”ÐžÐ§ÐšÐ!'); }, 1500);
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŽµ Ð—Ð’Ð£ÐšÐ˜ Ð˜Ð“Ð Ð« (Web Audio API)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function getAudioCtx() {
  if(!audioCtx) { try { audioCtx = new AudioCtx(); } catch(e){} }
  return audioCtx;
}

function playSound(type) {
  try {
    const ctx = getAudioCtx();
    if(!ctx) return;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    const now = ctx.currentTime;
    switch(type) {
      case 'cast':
        o.frequency.setValueAtTime(400, now); o.frequency.linearRampToValueAtTime(200, now+0.3);
        g.gain.setValueAtTime(0.3, now); g.gain.linearRampToValueAtTime(0, now+0.3);
        o.start(now); o.stop(now+0.3); break;
      case 'bite':
        o.type='square';
        o.frequency.setValueAtTime(800, now); o.frequency.linearRampToValueAtTime(1200, now+0.1); o.frequency.linearRampToValueAtTime(600, now+0.2);
        g.gain.setValueAtTime(0.4, now); g.gain.linearRampToValueAtTime(0, now+0.3);
        o.start(now); o.stop(now+0.3); break;
      case 'catch':
        o.type='sine';
        [0, 0.1, 0.2].forEach((t,i)=>{
          const o2=ctx.createOscillator(); o2.connect(g);
          o2.frequency.value=[523,659,784][i];
          o2.start(now+t); o2.stop(now+t+0.15);
        });
        g.gain.setValueAtTime(0.3, now); g.gain.linearRampToValueAtTime(0, now+0.35);
        o.start(now); o.stop(now+0.01); break;
      case 'miss':
        o.type='sawtooth';
        o.frequency.setValueAtTime(300, now); o.frequency.linearRampToValueAtTime(100, now+0.3);
        g.gain.setValueAtTime(0.2, now); g.gain.linearRampToValueAtTime(0, now+0.3);
        o.start(now); o.stop(now+0.3); break;
      case 'coin':
        o.type='sine';
        o.frequency.setValueAtTime(1000, now); o.frequency.linearRampToValueAtTime(1400, now+0.1);
        g.gain.setValueAtTime(0.2, now); g.gain.linearRampToValueAtTime(0, now+0.2);
        o.start(now); o.stop(now+0.2); break;
      case 'legend':
        o.type='sine';
        [0,0.08,0.16,0.24,0.32].forEach((t,i)=>{
          const o2=ctx.createOscillator(); o2.connect(g);
          o2.type='sine'; o2.frequency.value=[523,659,784,1047,1319][i];
          o2.start(now+t); o2.stop(now+t+0.12);
        });
        g.gain.setValueAtTime(0.35, now); g.gain.linearRampToValueAtTime(0, now+0.5);
        o.start(now); o.stop(now+0.01); break;
      case 'disco':
        o.type='square';
        const notes = [440,554,659,880,1047];
        notes.forEach((freq,i)=>{
          const o2=ctx.createOscillator(); o2.connect(g);
          o2.frequency.value=freq; o2.start(now+i*0.1); o2.stop(now+i*0.1+0.08);
        });
        g.gain.setValueAtTime(0.4, now); g.gain.linearRampToValueAtTime(0, now+0.6);
        o.start(now); o.stop(now+0.01); break;
      case 'lootbox':
        o.type='sine';
        [0,0.05,0.1,0.15,0.2,0.25,0.3].forEach((t,i)=>{
          const o2=ctx.createOscillator(); o2.connect(g);
          o2.frequency.value=200+i*150; o2.start(now+t); o2.stop(now+t+0.07);
        });
        g.gain.setValueAtTime(0.35, now); g.gain.linearRampToValueAtTime(0, now+0.45);
        o.start(now); o.stop(now+0.01); break;
      case 'hugiwugi':
        o.type='sawtooth';
        o.frequency.setValueAtTime(50, now); o.frequency.linearRampToValueAtTime(300, now+0.15); o.frequency.linearRampToValueAtTime(80, now+0.35);
        g.gain.setValueAtTime(0.5, now); g.gain.linearRampToValueAtTime(0, now+0.45);
        o.start(now); o.stop(now+0.45); break;
      case 'promo':
        o.type='sine';
        [523,784,1047,1319].forEach((freq,i)=>{
          const o2=ctx.createOscillator(); o2.connect(g);
          o2.frequency.value=freq; o2.start(now+i*0.07); o2.stop(now+i*0.07+0.1);
        });
        g.gain.setValueAtTime(0.3, now); g.gain.linearRampToValueAtTime(0, now+0.4);
        o.start(now); o.stop(now+0.01); break;
    }
  } catch(e){}
}

// Ð¥ÑƒÐº Ð·Ð²ÑƒÐºÐ¾Ð² Ð½Ð° Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
const _origAnimateCast = animateCast;
window.animateCast = function(x,y,cb){ playSound('cast'); _origAnimateCast(x,y,cb); };

const _origTriggerBite = triggerBite;
window.triggerBite = function(){ playSound('bite'); _origTriggerBite(); };

const _origMiss = miss;
window.miss = function(){ playSound('miss'); _origMiss(); };

// Sound on fish catch popup
const _origCatchFishForSound = catchFish;
window.catchFish = function() {
  const f = gs.currentCatch;
  if(f) {
    if(f.rar==='og'||f.rar==='flower') playSound('legend');
    else if(f.rar==='legend'||f.rar==='coastal_legend') playSound('legend');
    else playSound('catch');
  }
  _origCatchFishForSound();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŽ Ð›Ð£Ð¢Ð‘ÐžÐšÐ¡Ð« (LOOTBOXES)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LOOTBOX_TYPES = [
  {id:'rainbow_box', name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ', icon:'ðŸŒˆ', price:5000, color:'#ff80ff',
   desc:'Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ ÑƒÐ´Ð¾Ñ‡ÐµÐº Ð¸ Ñ€ÐµÐ´ÐºÐ¸Ðµ ÑÐºÐ¸Ð½Ñ‹!'},
  {id:'gold_box',    name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ',  icon:'ðŸ¥‡', price:10000, color:'#ffd700',
   desc:'Ð›ÑƒÑ‡ÑˆÐ¸Ð¹ ÑˆÐ°Ð½Ñ Ð½Ð° Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ!'},
  {id:'basic_box',   name:'ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ',  icon:'ðŸ“¦', price:2000, color:'#a0c080',
   desc:'Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¸ ÑÐºÐ¸Ð½Ñ‹'},
];

const ROD_UPGRADES_POOL = [
  // Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸
  {id:'upg_wood_ext', name:'Ð£Ð´Ð»Ð¸Ð½Ð¸Ñ‚ÐµÐ»ÑŒ Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð¾Ð¹', icon:'ðŸ”§', rod:'wood', desc:'Ð”Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð±Ñ€Ð¾ÑÐ° +30%', effect:'ext', rarity:'common'},
  {id:'upg_wood_reel', name:'ÐšÐ°Ñ‚ÑƒÑˆÐºÐ° Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð¾Ð¹', icon:'âš™ï¸', rod:'wood', desc:'Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ¸ +25%', effect:'reel', rarity:'common'},
  {id:'upg_bamboo_spring', name:'ÐŸÑ€ÑƒÐ¶Ð¸Ð½Ð½Ñ‹Ð¹ Ð‘Ð°Ð¼Ð±ÑƒÐº', icon:'ðŸŒ¿', rod:'bamboo', desc:'ÐšÐ»Ñ‘Ð² +50% Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾', effect:'bite', rarity:'common'},
  {id:'upg_carbon_tip', name:'ÐšÐ°Ñ€Ð±Ð¾Ð½-ÐÐ°ÐºÐ¾Ð½ÐµÑ‡Ð½Ð¸Ðº', icon:'â¬›', rod:'carbon', desc:'Ð§ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ÐºÐ»Ñ‘Ð²ÐºÐ¸ +40%', effect:'sense', rarity:'rare'},
  {id:'upg_magic_rune', name:'Ð”Ñ€ÐµÐ²Ð½ÑÑ Ð ÑƒÐ½Ð° ÐœÐ°Ð³Ð¸Ð¸', icon:'âœ¨', rod:'magic', desc:'Ð¨Ð°Ð½Ñ OG Ñ€Ñ‹Ð±Ñ‹ +15%', effect:'og_chance', rarity:'rare'},
  {id:'upg_golden_core', name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð¡ÐµÑ€Ð´ÐµÑ‡Ð½Ð¸Ðº', icon:'ðŸ’›', rod:'golden', desc:'+500ðŸª™ Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²', effect:'coins', rarity:'epic'},
  {id:'upg_crystal_lens', name:'ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð›Ð¸Ð½Ð·Ð°', icon:'ðŸ”®', rod:'crystal', desc:'Ð ÐµÐ´ÐºÐ¾ÑÑ‚ÑŒ Ñ€Ñ‹Ð± x3 Ð²Ð¼ÐµÑÑ‚Ð¾ x2', effect:'rare_x3', rarity:'epic'},
  {id:'upg_thunder_coil', name:'Ð“Ñ€Ð¾Ð¼Ð¾Ð²Ð°Ñ ÐšÐ°Ñ‚ÑƒÑˆÐºÐ°', icon:'âš¡', rod:'thunder', desc:'ÐÐ²Ñ‚Ð¾-Ð¿Ð¾Ð´ÑÐµÑ‡ÐºÐ° 100%', effect:'auto', rarity:'epic'},
  {id:'upg_void_eye', name:'Ð“Ð»Ð°Ð· Ð‘ÐµÐ·Ð´Ð½Ñ‹', icon:'ðŸ‘ï¸', rod:'void', desc:'Ð›ÐµÐ³ÐµÐ½Ð´Ñ‹ Ð²ÑÐµÐ³Ð´Ð° OG', effect:'void_og', rarity:'legend'},
  {id:'upg_ghost_soul', name:'ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ Ð”ÑƒÑˆÐ°', icon:'ðŸ‘»', rod:'ghost', desc:'Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ ÐºÐ»Ñ‘Ð² x0.5â€“x5', effect:'ghost_boost', rarity:'legend'},
  {id:'upg_pharaoh_scarab', name:'Ð¡ÐºÐ°Ñ€Ð°Ð±ÐµÐ¹ Ð¤Ð°Ñ€Ð°Ð¾Ð½Ð°', icon:'ðŸª²', rod:'pharaoh', desc:'ÐœÐ¾Ð½ÐµÑ‚Ñ‹ x3 Ð²Ð¼ÐµÑÑ‚Ð¾ x2', effect:'coins_x3', rarity:'legend'},
  {id:'upg_kraken_ink', name:'Ð§ÐµÑ€Ð½Ð¸Ð»Ð° ÐšÑ€Ð°ÐºÐµÐ½Ð°', icon:'ðŸ¦‘', rod:'kraken', desc:'+10000ðŸª™ Ð½Ð° OG Ð²Ð¼ÐµÑÑ‚Ð¾ 5000', effect:'kraken_bonus', rarity:'legend'},
  {id:'upg_time_hourglass', name:'ÐŸÐµÑÐ¾Ñ‡Ð½Ñ‹Ðµ Ð§Ð°ÑÑ‹', icon:'âŒ›', rod:'time', desc:'5 Ñ€Ñ‹Ð± Ð·Ð° Ñ€Ð°Ð· Ð²Ð¼ÐµÑÑ‚Ð¾ 3', effect:'time_fish5', rarity:'legend'},
  {id:'upg_bakintsa_gold', name:'Ð‘Ð°ÐºÐ¸Ð½ÑÐºÐ¾Ðµ Ð—Ð¾Ð»Ð¾Ñ‚Ð¾', icon:'ðŸ†', rod:'bakintsa', desc:'+5000ðŸª™ Ð²Ð¼ÐµÑÑ‚Ð¾ 2500 Ð·Ð° ÑƒÐ»Ð¾Ð²', effect:'baku_bonus', rarity:'og'},
  {id:'upg_hugiwugi_scream', name:'Ð£Ð»ÑŒÑ‚Ñ€Ð°-ÐšÑ€Ð¸Ðº Ð¥Ð°Ð³Ð¸', icon:'ðŸ˜±', rod:'hugiwugi', desc:'ÐšÑ€Ð¸Ðº Ð¾Ð³Ð»ÑƒÑˆÐ°ÐµÑ‚ â€” Ñ€Ñ‹Ð±Ð° Ð½Ðµ ÑƒÐ¿Ð»Ñ‹Ð²Ð°ÐµÑ‚ 15 ÑÐµÐº', effect:'hagi_stun', rarity:'og'},
  {id:'upg_rainbow_shimmer', name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ð‘Ð»ÐµÑÐº', icon:'ðŸŒˆ', rod:'rainbow', desc:'Ð‘Ð¾Ð½ÑƒÑ Ð²ÑÐµÐ³Ð´Ð° x3 Ð¼Ð¾Ð½ÐµÑ‚Ñ‹', effect:'rainbow_x3', rarity:'epic'},
  {id:'upg_blackhole_warp', name:'Ð’Ð°Ñ€Ð¿ Ð§Ñ‘Ñ€Ð½Ð¾Ð¹ Ð”Ñ‹Ñ€Ñ‹', icon:'ðŸŒ€', rod:'blackhole', desc:'Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ñ +10 Ñ€Ñ‹Ð± ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 ÑƒÐ»Ð¾Ð²Ð°', effect:'bh_boost', rarity:'og'},
];

const ROD_SKINS_POOL = [
  {id:'skin_wood_golden', name:'Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ', icon:'ðŸªµâœ¨', rod:'wood', desc:'Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ Ð² Ð·Ð¾Ð»Ð¾Ñ‚Ðµ', rarity:'rare'},
  {id:'skin_bamboo_neon', name:'ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ð¹ Ð‘Ð°Ð¼Ð±ÑƒÐº', icon:'ðŸŸ¢', rod:'bamboo', desc:'Ð¡Ð²ÐµÑ‚Ð¸Ñ‚ÑÑ Ð² Ñ‚ÐµÐ¼Ð½Ð¾Ñ‚Ðµ', rarity:'rare'},
  {id:'skin_carbon_fire', name:'ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ð¹ ÐšÐ°Ñ€Ð±Ð¾Ð½', icon:'ðŸ”¥', rod:'carbon', desc:'ÐžÐ³Ð½ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ´ Ð¿Ñ€Ð¸ Ð·Ð°Ð±Ñ€Ð¾ÑÐµ', rarity:'epic'},
  {id:'skin_magic_galaxy', name:'Ð“Ð°Ð»Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð’Ð¾Ð»ÑˆÐµÐ±Ð½Ð°Ñ', icon:'ðŸŒŒ', rod:'magic', desc:'Ð“Ð°Ð»Ð°ÐºÑ‚Ð¸ÐºÐ° Ð² ÑƒÐ´Ð¾Ñ‡ÐºÐµ', rarity:'epic'},
  {id:'skin_golden_royal', name:'ÐšÐ¾Ñ€Ð¾Ð»ÐµÐ²ÑÐºÐ°Ñ Ð—Ð¾Ð»Ð¾Ñ‚Ð°Ñ', icon:'ðŸ‘‘', rod:'golden', desc:'ÐšÐ¾Ñ€Ð¾Ð½Ð° Ð½Ð° ÑƒÐ´Ð¾Ñ‡ÐºÐµ', rarity:'legend'},
  {id:'skin_crystal_ice', name:'Ð›ÐµÐ´ÑÐ½Ð°Ñ ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ', icon:'ðŸ§Š', rod:'crystal', desc:'Ð›ÐµÐ´ÑÐ½Ñ‹Ðµ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ñ‹', rarity:'legend'},
  {id:'skin_hugiwugi_kisimisi', name:'ÐšÐ¸ÑÐ¸Ð¼Ð¸ÑÐ¸ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸', icon:'ðŸŽ„', rod:'hugiwugi', desc:'ÐÐ¾Ð²Ð¾Ð³Ð¾Ð´Ð½Ð¸Ð¹ ÑÐºÐ¸Ð½ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸!', rarity:'og'},
  {id:'skin_bakintsa_baku', name:'Ð¤Ð»Ð°Ð³ Ð‘Ð°ÐºÑƒ', icon:'ðŸ‡¦ðŸ‡¿', rod:'bakintsa', desc:'Ð¤Ð»Ð°Ð³ ÐÐ·ÐµÑ€Ð±Ð°Ð¹Ð´Ð¶Ð°Ð½Ð° Ð½Ð° ÑƒÐ´Ð¾Ñ‡ÐºÐµ', rarity:'og'},
  {id:'skin_rainbow_full', name:'ÐŸÐ¾Ð»Ð½Ð°Ñ Ð Ð°Ð´ÑƒÐ³Ð°', icon:'ðŸŒˆðŸŒŸ', rod:'rainbow', desc:'Ð’ÑÐµ Ñ†Ð²ÐµÑ‚Ð° Ñ€Ð°Ð´ÑƒÐ³Ð¸ 100%', rarity:'epic'},
  {id:'skin_blackhole_dark', name:'Ð¢Ñ‘Ð¼Ð½Ð°Ñ ÐœÐ°Ñ‚ÐµÑ€Ð¸Ñ', icon:'â¬›ðŸŒ€', rod:'blackhole', desc:'ÐŸÑ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾ Ð¸ÑÐºÐ°Ð¶Ð°ÐµÑ‚ÑÑ', rarity:'og'},
  {id:'skin_laser_neon', name:'ÐÐµÐ¾Ð½ Ð›Ð°Ð·ÐµÑ€', icon:'ðŸ”´ðŸ’«', rod:'laser', desc:'ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ð¹ Ð»Ð°Ð·ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¸Ñ†ÐµÐ»', rarity:'epic'},
  {id:'skin_magnet_steel', name:'Ð¡Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐœÐ°Ð³Ð½Ð¸Ñ‚', icon:'ðŸ§²ðŸ”©', rod:'magnet', desc:'Ð¥Ñ€Ð¾Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð°Ð³Ð½Ð¸Ñ‚', rarity:'rare'},
  // Ð¡ÐºÐ¸Ð½Ñ‹ Ñ€Ñ‹Ð±Ð¾Ðº
  {id:'skin_fish_rainbow', name:'Ð Ð°Ð´ÑƒÐ¶Ð½Ð°Ñ Ð Ñ‹Ð±ÐºÐ°', icon:'ðŸ ðŸŒˆ', rod:null, desc:'Ð’ÑÐµ Ñ€Ñ‹Ð±ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ»Ð¸Ð²Ð°ÑŽÑ‚ÑÑ', rarity:'rare'},
  {id:'skin_fish_golden', name:'Ð—Ð¾Ð»Ð¾Ñ‚Ñ‹Ðµ Ð Ñ‹Ð±ÐºÐ¸', icon:'ðŸŸâœ¨', rod:null, desc:'Ð Ñ‹Ð±ÐºÐ¸ Ð¸Ð· Ð·Ð¾Ð»Ð¾Ñ‚Ð°', rarity:'epic'},
  {id:'skin_fish_neon', name:'ÐÐµÐ¾Ð½Ð¾Ð²Ñ‹Ðµ Ð Ñ‹Ð±ÐºÐ¸', icon:'ðŸ¡ðŸ’¡', rod:null, desc:'Ð¡Ð²ÐµÑ‚ÑÑ‰Ð¸ÐµÑÑ Ñ€Ñ‹Ð±ÐºÐ¸', rarity:'legend'},
];

gs.lootboxes = gs.lootboxes || {};
gs.rodUpgrades = gs.rodUpgrades || [];
gs.rodSkins = gs.rodSkins || [];
gs.equippedUpgrades = gs.equippedUpgrades || {};

function openLootbox(typeId) {
  const type = LOOTBOX_TYPES.find(t=>t.id===typeId);
  if(!type) return;
  if((gs.lootboxes[typeId]||0) <= 0) { showToast('âŒ ÐÐµÑ‚ Ð»ÑƒÑ‚Ð±Ð¾ÐºÑÐ¾Ð² ÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð°!'); return; }
  gs.lootboxes[typeId]--;
  playSound('lootbox');

  // Rarity roll
  const roll = Math.random();
  let rarity;
  if(typeId === 'gold_box') {
    if(roll < 0.02) rarity = 'og';
    else if(roll < 0.10) rarity = 'legend';
    else if(roll < 0.30) rarity = 'epic';
    else if(roll < 0.60) rarity = 'rare';
    else rarity = 'common';
  } else if(typeId === 'rainbow_box') {
    if(roll < 0.05) rarity = 'og';
    else if(roll < 0.18) rarity = 'legend';
    else if(roll < 0.40) rarity = 'epic';
    else if(roll < 0.70) rarity = 'rare';
    else rarity = 'common';
  } else {
    if(roll < 0.01) rarity = 'og';
    else if(roll < 0.05) rarity = 'legend';
    else if(roll < 0.15) rarity = 'epic';
    else if(roll < 0.40) rarity = 'rare';
    else rarity = 'common';
  }

  // 50/50 upgrade or skin
  const pool = Math.random() < 0.5
    ? ROD_UPGRADES_POOL.filter(u => u.rarity === rarity || (rarity==='common' && u.rarity==='common'))
    : ROD_SKINS_POOL.filter(s => s.rarity === rarity || (rarity==='common' && s.rarity==='rare'));

  const fallback = Math.random() < 0.5 ? ROD_UPGRADES_POOL : ROD_SKINS_POOL;
  const items = pool.length > 0 ? pool : fallback;
  const item = items[Math.floor(Math.random()*items.length)];

  // Check if upgrade or skin
  if(ROD_UPGRADES_POOL.includes(item)) {
    gs.rodUpgrades.push({...item, obtainedAt: Date.now()});
  } else {
    gs.rodSkins.push({...item, obtainedAt: Date.now()});
  }

  saveGame();
  showLootboxResult(item, type);
}

function showLootboxResult(item, type) {
  const overlay = document.getElementById('lootbox-overlay');
  if(!overlay) return;
  const rarColors = {common:'#a0c080', rare:'#4090f0', epic:'#c040ff', legend:'#f0c030', og:'#ff4060'};
  document.getElementById('lb-item-icon').textContent = item.icon;
  document.getElementById('lb-item-name').textContent = item.name;
  document.getElementById('lb-item-desc').textContent = item.desc;
  const rarEl = document.getElementById('lb-item-rarity');
  rarEl.textContent = item.rarity.toUpperCase();
  rarEl.style.color = rarColors[item.rarity] || '#fff';
  rarEl.style.textShadow = `0 0 10px ${rarColors[item.rarity]}`;
  overlay.style.display = 'block';
}

// Add lootbox tab to shop
const _origSwitchShopTab = switchShopTab;
window.switchShopTab = function(tab, el) {
  if(tab === 'lootbox') {
    currentShopTab = 'lootbox';
    document.querySelectorAll('.shop-tab').forEach(t=>t.classList.remove('active'));
    if(el) el.classList.add('active');
    const body = document.getElementById('shop-body');
    renderLootboxes(body);
    return;
  }
  if(tab === 'promo') {
    currentShopTab = 'promo';
    document.querySelectorAll('.shop-tab').forEach(t=>t.classList.remove('active'));
    if(el) el.classList.add('active');
    renderPromoScreen(document.getElementById('shop-body'));
    return;
  }
  _origSwitchShopTab(tab, el);
};

function renderLootboxes(body) {
  body.innerHTML = '';
  const hdr = document.createElement('div');
  hdr.style.cssText = 'font-family:UnifrakturMaguntia,cursive;font-size:18px;color:#ffd700;text-align:center;padding:12px 0 6px;text-shadow:0 0 12px rgba(255,200,0,.6);';
  hdr.textContent = 'ðŸŽ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑÑ‹';
  body.appendChild(hdr);

  const inv = document.createElement('div');
  inv.style.cssText = 'font-family:Neucha,cursive;font-size:12px;color:#c0e080;text-align:center;padding:4px 0 10px;';
  inv.textContent = 'Ð¢Ð²Ð¾Ð¸ Ð»ÑƒÑ‚Ð±Ð¾ÐºÑÑ‹: ' + LOOTBOX_TYPES.map(t=>`${t.icon}Ã—${gs.lootboxes[t.id]||0}`).join(' | ');
  body.appendChild(inv);

  LOOTBOX_TYPES.forEach(type => {
    const card = document.createElement('div');
    card.style.cssText = `margin:6px 8px;border-radius:14px;background:linear-gradient(135deg,rgba(10,20,5,.9),rgba(5,15,3,.95));border:2px solid ${type.color}40;padding:12px;display:flex;align-items:center;gap:10px;`;
    card.innerHTML = `
      <div style="font-size:36px;filter:drop-shadow(0 0 10px ${type.color});">${type.icon}</div>
      <div style="flex:1;">
        <div style="font-family:UnifrakturMaguntia,cursive;font-size:14px;color:${type.color};">${type.name}</div>
        <div style="font-family:Neucha,cursive;font-size:10px;color:rgba(180,220,130,.7);">${type.desc}</div>
        <div style="font-family:Neucha,cursive;font-size:11px;color:#ffd700;margin-top:3px;">Ð£ Ñ‚ÐµÐ±Ñ: ${gs.lootboxes[type.id]||0} ÑˆÑ‚</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:4px;">
        <button onclick="buyLootbox('${type.id}')" style="font-family:Neucha,cursive;font-size:11px;background:linear-gradient(135deg,#2a5010,#1a3008);border:1px solid #60a030;border-radius:8px;color:#a0e040;padding:6px 10px;cursor:pointer;">ðŸª™${type.price.toLocaleString('ru')}</button>
        <button onclick="openLootbox('${type.id}')" style="font-family:Neucha,cursive;font-size:11px;background:linear-gradient(135deg,#4a1a60,#2a0a40);border:1px solid #9030d0;border-radius:8px;color:#e080ff;padding:6px 10px;cursor:pointer;">ðŸŽ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ</button>
      </div>
    `;
    body.appendChild(card);
  });

  // Show owned upgrades/skins
  if(gs.rodUpgrades.length > 0 || gs.rodSkins.length > 0) {
    const secHdr = document.createElement('div');
    secHdr.style.cssText = 'font-family:UnifrakturMaguntia,cursive;font-size:14px;color:#c0a030;text-align:center;padding:10px 0 4px;';
    secHdr.textContent = 'âœ¨ Ð¢Ð²Ð¾Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¸ ÑÐºÐ¸Ð½Ñ‹';
    body.appendChild(secHdr);
    [...gs.rodUpgrades, ...gs.rodSkins].slice(-10).forEach(item=>{
      const el = document.createElement('div');
      el.style.cssText = 'margin:4px 8px;border-radius:8px;background:rgba(10,25,5,.8);border:1px solid rgba(80,160,30,.3);padding:8px 10px;display:flex;align-items:center;gap:8px;font-family:Neucha,cursive;';
      const rarColors = {common:'#a0c080',rare:'#4090f0',epic:'#c040ff',legend:'#f0c030',og:'#ff4060'};
      el.innerHTML = `<span style="font-size:20px;">${item.icon}</span><div><div style="font-size:12px;color:#c8e090;">${item.name}</div><div style="font-size:10px;color:rgba(150,200,100,.6);">${item.desc}</div></div><div style="margin-left:auto;font-size:10px;color:${rarColors[item.rarity]||'#fff'};">${item.rarity.toUpperCase()}</div>`;
      body.appendChild(el);
    });
  }
}

function buyLootbox(typeId) {
  const type = LOOTBOX_TYPES.find(t=>t.id===typeId);
  if(!type) return;
  if(gs.coins < type.price) { showToast(`âŒ ÐÑƒÐ¶Ð½Ð¾ ${type.price.toLocaleString('ru')}ðŸª™!`); return; }
  gs.coins -= type.price;
  gs.lootboxes[typeId] = (gs.lootboxes[typeId]||0) + 1;
  updateCoins();
  renderLootboxes(document.getElementById('shop-body'));
  playSound('coin');
  showToast(`ðŸŽ ${type.name} ÐºÑƒÐ¿Ð»ÐµÐ½!`);
  saveGame();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸŽŸï¸ ÐŸÐ ÐžÐœÐžÐšÐžÐ”Ð«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROMO_CODES = {
  'Ð°Ñ…Ð°Ð°Ð°Ð°Ð´': {
    used: false,
    rewards: [
      {type:'lootbox', id:'rainbow_box', qty:2, label:'2 Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ñ… Ð›ÑƒÑ‚Ð±Ð¾ÐºÑÐ°'},
    ],
    label: 'ðŸŒˆ Ð¡Ñ‚Ð°Ñ€Ñ‚-ÐŸÐ°ÐºÐµÑ‚!'
  },
  'Ð´Ð¸ÑÐºÐ¾Ð±Ð°ÐºÑƒ': {
    used: false,
    rewards: [
      {type:'coins', qty:50000, label:'50 000ðŸª™'},
    ],
    label: 'ðŸª© Ð”Ð¸ÑÐºÐ¾ ÐœÐ¾Ð½ÐµÑ‚Ñ‹!'
  },
  'Ñ…Ð°Ð³Ð¸Ð¸Ð¼Ð±Ð°': {
    used: false,
    rewards: [
      {type:'lootbox', id:'gold_box', qty:1, label:'1 Ð—Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ'},
    ],
    label: 'ðŸ‘‘ Ð—Ð¾Ð»Ð¾Ñ‚Ð¾ Ð¥Ð°Ð³Ð¸!'
  },
};
gs.usedPromos = gs.usedPromos || {};

function renderPromoScreen(body) {
  body.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.style.cssText = 'padding:16px;';
  wrap.innerHTML = `
    <div style="font-family:UnifrakturMaguntia,cursive;font-size:18px;color:#ffd700;text-align:center;margin-bottom:12px;text-shadow:0 0 12px rgba(255,200,0,.6);">ðŸŽŸï¸ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´</div>
    <div style="display:flex;gap:6px;margin-bottom:12px;">
      <input id="promo-input" placeholder="Ð’Ð²ÐµÐ´Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´..." maxlength="20"
        style="flex:1;font-family:Neucha,cursive;font-size:14px;background:rgba(0,0,0,.5);border:1px solid rgba(80,160,30,.4);border-radius:8px;padding:8px 12px;color:#c0e090;outline:none;"/>
      <button onclick="applyPromo()" style="font-family:Neucha,cursive;font-size:13px;background:linear-gradient(135deg,#2a6010,#1a4008);border:2px solid #60b030;border-radius:8px;color:#a0e040;padding:8px 14px;cursor:pointer;">âœ… ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ</button>
    </div>
    <div id="promo-result" style="font-family:Neucha,cursive;font-size:13px;text-align:center;min-height:24px;margin-bottom:12px;"></div>
    <div style="font-family:Neucha,cursive;font-size:11px;color:rgba(150,200,100,.5);text-align:center;">ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð´Ð°ÑŽÑ‚ Ð»ÑƒÑ‚Ð±Ð¾ÐºÑÑ‹, Ð¼Ð¾Ð½ÐµÑ‚Ñ‹ Ð¸ Ð¾ÑÐ¾Ð±Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ñ‹!</div>
  `;
  body.appendChild(wrap);
}

function applyPromo() {
  const input = document.getElementById('promo-input');
  if(!input) return;
  const code = input.value.trim().toLowerCase();
  const resEl = document.getElementById('promo-result');

  if(!code) { if(resEl) resEl.style.color='#ff8060', resEl.textContent='âŒ Ð’Ð²ÐµÐ´Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´!'; return; }
  if(gs.usedPromos[code]) { if(resEl) resEl.style.color='#ff8060', resEl.textContent='âŒ Ð­Ñ‚Ð¾Ñ‚ ÐºÐ¾Ð´ ÑƒÐ¶Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½!'; return; }

  const promo = PROMO_CODES[code];
  if(!promo) { if(resEl) resEl.style.color='#ff8060', resEl.textContent='âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´!'; return; }

  // Apply
  gs.usedPromos[code] = true;
  const labels = [];
  promo.rewards.forEach(r=>{
    if(r.type === 'lootbox') { gs.lootboxes[r.id] = (gs.lootboxes[r.id]||0) + r.qty; }
    else if(r.type === 'coins') { gs.coins += r.qty; updateCoins(); coinBurst(180, 350); }
    else if(r.type === 'rod') { const rod = RODS.find(x=>x.id===r.id); if(rod) rod.owned=true; }
    labels.push(r.label);
  });

  playSound('promo');
  if(resEl) { resEl.style.color='#80e040'; resEl.textContent=`âœ… ${promo.label} ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾: ${labels.join(', ')}!`; }
  input.value = '';
  saveGame();
  showToast(`ðŸŽŸï¸ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ "${code}" Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½! ${promo.label}`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸª© Ð”Ð˜Ð¡ÐšÐžÐ¢Ð•ÐšÐ + Ð˜Ð’Ð•ÐÐ¢ 25 Ð¤Ð•Ð’Ð ÐÐ›Ð¯ 14:30 (ÐÐ·ÐµÑ€Ð±Ð°Ð¹Ð´Ð¶Ð°Ð½ = UTC+4)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let discoActive = false;
let discoInterval = null;

function startDisco() {
  if(discoActive) return;
  discoActive = true;
  playSound('disco');
  showToast('ðŸª© Ð”Ð˜Ð¡ÐšÐžÐ¢Ð•ÐšÐ ÐÐÐ§ÐÐ›ÐÐ¡Ð¬! ÐšÐ»Ñ‘Ð² x5 Ð½Ð° Ð²Ñ€ÐµÐ¼Ñ Ð¸Ð²ÐµÐ½Ñ‚Ð°!');

  const game = document.getElementById('game');
  // Add disco ball
  const discoBall = document.createElement('div');
  discoBall.id = 'disco-ball';
  discoBall.innerHTML = 'ðŸª©';
  discoBall.style.cssText = 'position:absolute;top:60px;left:50%;transform:translateX(-50%);font-size:36px;z-index:5000;animation:discoBallSpin 1s linear infinite;pointer-events:none;filter:drop-shadow(0 0 20px #ff80ff);';
  game.appendChild(discoBall);

  // Disco lights
  discoInterval = setInterval(()=>{
    const colors = ['#ff0080','#0080ff','#00ff80','#ff8000','#8000ff','#ffff00'];
    const col = colors[Math.floor(Math.random()*colors.length)];
    const light = document.createElement('div');
    light.style.cssText = `position:absolute;inset:0;background:${col};opacity:0.08;z-index:4999;pointer-events:none;border-radius:12px;animation:discoFlash .15s ease-out forwards;`;
    game.appendChild(light);
    setTimeout(()=>light.remove(), 200);
    playSound('disco');
  }, 800);
}

function stopDisco() {
  discoActive = false;
  clearInterval(discoInterval);
  const ball = document.getElementById('disco-ball');
  if(ball) ball.remove();
}

// Admin popup notification
function showAdminPopup(msg, delay) {
  setTimeout(()=>{
    const popup = document.createElement('div');
    popup.style.cssText = `position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9999;background:linear-gradient(135deg,#1a0a30,#2a1050);border:3px solid #ff80ff;border-radius:16px;padding:16px 20px;text-align:center;max-width:300px;box-shadow:0 0 40px rgba(255,0,255,.5);animation:adminPopIn .5s cubic-bezier(.34,1.56,.64,1) forwards;`;
    popup.innerHTML = `
      <div style="font-size:28px;margin-bottom:6px;">ðŸ‘‘</div>
      <div style="font-family:UnifrakturMaguntia,cursive;font-size:14px;color:#ff80ff;margin-bottom:6px;text-shadow:0 0 10px rgba(255,128,255,.8);">Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð• ÐÐ”ÐœÐ˜ÐÐ˜Ð¡Ð¢Ð ÐÐ¢ÐžÐ Ð</div>
      <div style="font-family:Neucha,cursive;font-size:13px;color:#c0e0ff;line-height:1.4;">${msg}</div>
      <button onclick="this.parentNode.remove()" style="margin-top:10px;font-family:Neucha,cursive;font-size:12px;background:linear-gradient(135deg,#4a0080,#2a0050);border:1px solid #ff80ff;border-radius:8px;color:#ff80ff;padding:6px 16px;cursor:pointer;">âœ… ÐŸÐ¾Ð½ÑÐ»!</button>
    `;
    document.getElementById('game').appendChild(popup);
    setTimeout(()=>popup.remove(), 15000);
  }, delay);
}

// Event scheduler for Feb 25 14:30 Baku time (UTC+4)
function checkEventTime() {
  const now = new Date();
  const bakuOffset = 4 * 60; // UTC+4
  const bakuNow = new Date(now.getTime() + (bakuOffset - now.getTimezoneOffset()) * 60000);
  const month = bakuNow.getMonth() + 1; // 1-based
  const day = bakuNow.getDate();
  const h = bakuNow.getHours();
  const m = bakuNow.getMinutes();

  // Check if Feb 25
  if(month === 2 && day === 25) {
    // 14:30 - Disco starts + event begins
    if(h === 14 && m >= 30 && m < 35 && !gs._eventStarted) {
      gs._eventStarted = true;
      startDisco();
      showAdminPopup('ðŸŽ‰ Ð˜Ð’Ð•ÐÐ¢ ÐÐÐ§ÐÐ›Ð¡Ð¯!<br>Ð”Ð¸ÑÐºÐ¾ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½!<br>Ð Ð°Ð·Ð´Ð°Ñ‡Ð° ÑƒÐ´Ð¾Ñ‡ÐµÐº ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐµÑ‚!', 500);
    }
    // 14:35 - Hugiwugi rod given
    if(h === 14 && m >= 35 && m < 40 && !gs._hugiwugiGiven) {
      gs._hugiwugiGiven = true;
      const hugRod = RODS.find(r=>r.id==='hugiwugi');
      if(hugRod) hugRod.owned = true;
      playSound('hugiwugi');
      showAdminPopup('ðŸ’™ ÐÐ”ÐœÐ˜Ð Ð’Ð«Ð”ÐÐ› Ð’ÐÐœ:<br><strong>Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸</strong><br>Ð›Ð˜ÐœÐ˜Ð¢Ð˜Ð ÐžÐ’ÐÐÐÐÐ¯!', 200);
      showToast('ðŸ’™ Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð°!');
      saveGame();
    }
    // 14:40 - Bakintsa rod given
    if(h === 14 && m >= 40 && m < 50 && !gs._bakintsaGiven) {
      gs._bakintsaGiven = true;
      const bakRod = RODS.find(r=>r.id==='bakintsa');
      if(bakRod) bakRod.owned = true;
      showAdminPopup('ðŸ† ÐÐ”ÐœÐ˜Ð Ð’Ð«Ð”ÐÐ› Ð’ÐÐœ:<br><strong>Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð°ÐºÐ¸Ð½Ñ†Ð°</strong><br>Ð›Ð˜ÐœÐ˜Ð¢Ð˜Ð ÐžÐ’ÐÐÐÐÐ¯! ðŸ‡¦ðŸ‡¿', 200);
      showToast('ðŸ† Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð°ÐºÐ¸Ð½Ñ†Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð°!');
      saveGame();
    }
    // 14:50 - Event ends
    if(h === 14 && m >= 50 && gs._eventStarted && !gs._eventEnded) {
      gs._eventEnded = true;
      stopDisco();
      showAdminPopup('ðŸŒ… Ð˜Ð²ÐµÐ½Ñ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»ÑÑ!<br>Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° ÑƒÑ‡Ð°ÑÑ‚Ð¸Ðµ!<br>Ð’Ð°ÑˆÐ¸ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ! ðŸŽ£', 200);
    }
  }
}
setInterval(checkEventTime, 10000);
// Run immediately
setTimeout(checkEventTime, 2000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš™ï¸ ÐÐžÐ’Ð«Ð• Ð£Ð”ÐžÐ§ÐšÐ˜ â€” ÐœÐ•Ð¥ÐÐÐ˜ÐšÐ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ðŸ•³ï¸ Ð§Ñ‘Ñ€Ð½Ð°Ñ Ð”Ñ‹Ñ€Ð° â€” Ð³Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ð²Ð·Ñ€Ñ‹Ð² ÐºÐ°Ð¶Ð´Ñ‹Ðµ 3 ÑƒÐ»Ð¾Ð²Ð°
gs._blackholeCatches = 0;

// ðŸŒˆ Ð Ð°Ð´ÑƒÐ¶Ð½Ð°Ñ â€” ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð±Ð¾Ð½ÑƒÑ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑƒÐ»Ð¾Ð²
// ðŸ§² ÐœÐ°Ð³Ð½Ð¸Ñ‚Ð½Ð°Ñ â€” ÑˆÐ°Ð½Ñ Ð²Ñ‹Ñ‚Ð°Ñ‰Ð¸Ñ‚ÑŒ ÑÑƒÐ½Ð´ÑƒÐº
// ðŸ”´ Ð›Ð°Ð·ÐµÑ€Ð½Ð°Ñ â€” Ð½Ð° Ð»ÐµÐ³ÐµÐ½Ð´Ñƒ â†’ 3 OG Ñ€Ñ‹Ð±Ñ‹

// Patch catchFish for new rods
const _catchFishNewRods = window.catchFish || function(){};
window.catchFish = function() {
  const rod = gs.currentRod;
  _catchFishNewRods();

  if(rod.id === 'blackhole') {
    gs._blackholeCatches = (gs._blackholeCatches||0) + 1;
    if(gs._blackholeCatches % 3 === 0) {
      // Gravity explosion â€” add 5 random fish
      const allFish = FISH_DATA.filter(f=>!f.flower);
      for(let i=0;i<5;i++) {
        if(gs.inventory.length < gs.maxInv) {
          const f = allFish[Math.floor(Math.random()*allFish.length)];
          gs.inventory.push({...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)});
        }
      }
      showToast('ðŸ•³ï¸ Ð“Ð ÐÐ’Ð˜Ð¢ÐÐ¦Ð˜ÐžÐÐÐ«Ð™ Ð’Ð—Ð Ð«Ð’! +5 Ñ€Ñ‹Ð± Ð·Ð°ÑÐ¾ÑÐ°Ð½Ð¾!');
      // Visual effect
      const game = document.getElementById('game');
      const exp = document.createElement('div');
      exp.style.cssText='position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);font-size:60px;z-index:9000;pointer-events:none;animation:coinBurstAnim .8s ease-out forwards;';
      exp.textContent='ðŸ•³ï¸'; game.appendChild(exp);
      setTimeout(()=>exp.remove(), 900);
      renderInventory();
    }
  }

  if(rod.id === 'rainbow') {
    const bonuses = [
      ()=>{ gs.coins += 1000; updateCoins(); showToast('ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°: +1000ðŸª™!'); playSound('coin'); },
      ()=>{ addXP(200); showToast('ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°: +200 XP!'); },
      ()=>{ gs._biteBoostEnd = Date.now() + 30000; showToast('ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°: ÐšÐ»Ñ‘Ð² x3 Ð½Ð° 30 ÑÐµÐº!'); },
      ()=>{ const og = FISH_DATA.filter(f=>f.og); if(og.length && gs.inventory.length < gs.maxInv) { const f=og[Math.floor(Math.random()*og.length)]; gs.inventory.push({...f, weight:(f.w[0]+Math.random()*(f.w[1]-f.w[0])).toFixed(2)}); renderInventory(); showToast('ðŸŒˆ Ð Ð°Ð´ÑƒÐ³Ð°: Ð ÐµÐ´ÐºÐ°Ñ OG Ñ€Ñ‹Ð±Ð°!'); } },
    ];
    bonuses[Math.floor(Math.random()*bonuses.length)]();
    // Change water color
    const colors = ['#0060ff','#00c060','#ff0080','#8000ff','#ff6000'];
    document.getElementById('water-bg').style.background = `linear-gradient(to bottom, ${colors[Math.floor(Math.random()*colors.length)]}60, ${colors[Math.floor(Math.random()*colors.length)]}20)`;
    setTimeout(()=>{ document.getElementById('water-bg').style.background=''; }, 3000);
  }

  if(rod.id === 'magnet') {
    if(Math.random() < 0.3) {
      // Chest found!
      const chests = [
        { label:'ðŸª™ ÐœÐ¾Ð½ÐµÑ‚Ð½Ñ‹Ð¹ Ð¡ÑƒÐ½Ð´ÑƒÐº', action: ()=>{ gs.coins += 5000; updateCoins(); coinBurst(180,350); showToast('ðŸ§² Ð¡Ð£ÐÐ”Ð£Ðš: +5000ðŸª™!'); } },
        { label:'ðŸŽ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ-Ð¡ÑƒÐ½Ð´ÑƒÐº', action: ()=>{ gs.lootboxes['rainbow_box'] = (gs.lootboxes['rainbow_box']||0)+1; showToast('ðŸ§² Ð¡Ð£ÐÐ”Ð£Ðš: Ð Ð°Ð´ÑƒÐ¶Ð½Ñ‹Ð¹ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑ!'); } },
        { label:'â¬†ï¸ XP Ð¡ÑƒÐ½Ð´ÑƒÐº', action: ()=>{ addXP(500); showToast('ðŸ§² Ð¡Ð£ÐÐ”Ð£Ðš: +500 XP!'); } },
      ];
      const chest = chests[Math.floor(Math.random()*chests.length)];
      chest.action();
      playSound('coin');
    }
  }

  if(rod.id === 'laser') {
    const f = gs.currentCatch;
    if(f && (f.rar==='legend'||f.rar==='coastal_legend'||f.rar==='og')) {
      // Laser beam â€” 3 OG fish
      const ogFish = FISH_DATA.filter(f=>f.og);
      for(let i=0;i<3;i++) {
        if(gs.inventory.length < gs.maxInv && ogFish.length) {
          const bonus = ogFish[Math.floor(Math.random()*ogFish.length)];
          gs.inventory.push({...bonus, weight:(bonus.w[0]+Math.random()*(bonus.w[1]-bonus.w[0])).toFixed(2)});
        }
      }
      // Laser effect
      const game = document.getElementById('game');
      const laser = document.createElement('div');
      laser.style.cssText='position:absolute;top:0;left:50%;transform:translateX(-50%);width:4px;height:100%;background:linear-gradient(to bottom,transparent,#ff0000,transparent);z-index:9000;pointer-events:none;animation:discoFlash .3s ease-out forwards;opacity:0.8;';
      game.appendChild(laser);
      setTimeout(()=>laser.remove(), 350);
      showToast('ðŸ”´ Ð›ÐÐ—Ð•Ð ! Ð›ÐµÐ³ÐµÐ½Ð´Ð° â†’ 3 OG Ñ€Ñ‹Ð±Ñ‹!');
      renderInventory();
    }
  }

  if(rod.id === 'bakintsa') {
    gs.coins += 2500; updateCoins(); playSound('coin');
    showToast('ðŸ† Ð£Ð´Ð¾Ñ‡ÐºÐ° Ð‘Ð°ÐºÐ¸Ð½Ñ†Ð°: +2500ðŸª™!');
  }
  if(rod.id === 'hugiwugi') {
    playSound('hugiwugi');
    showToast('ðŸ’™ Ð¥Ð°Ð³Ð¸ Ð’Ð°Ð³Ð¸: Ð¡ÐšÐ Ð˜ÐœÐ•Ð  Ð£Ð–ÐÐ¡Ð!');
    // Screen shake
    const game = document.getElementById('game');
    game.style.animation = 'apocalypseShake .5s ease-out';
    setTimeout(()=>game.style.animation='', 500);
  }
};

// bite pools for new rods
const _origTriggerBiteCheck = window.triggerBite;
window.triggerBite = function() {
  const rod = gs.currentRod;
  if(rod && rod.id === 'hugiwugi') {
    const ogFish = FISH_DATA.filter(f=>f.og);
    gs.currentCatch = {...ogFish[Math.floor(Math.random()*ogFish.length)], weight:(ogFish[0].w[0]+Math.random()*(ogFish[0].w[1]-ogFish[0].w[0])).toFixed(2)};
    gs.phase = 'bite';
    bobWrap.style.animation='floatBite .9s ease-in-out 4';
    const biteEl2 = document.getElementById('bite-indicator');
    if(biteEl2) biteEl2.classList.add('visible');
    if(navigator.vibrate) navigator.vibrate([200,100,200]);
    gs.biteTimeout = setTimeout(()=>{ if(gs.phase==='bite') miss(); }, 8000);
    return;
  }
  _origTriggerBiteCheck();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ§‘â€ðŸŽ£ FISHER TAB â€” Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¸Ð· Ð»ÑƒÑ‚Ð±Ð¾ÐºÑÐ¾Ð²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Patch renderFisherScreen to show upgrades section
const _origRenderFisherScreen = window.renderFisherScreen;
window.renderFisherScreen = function() {
  if(_origRenderFisherScreen) _origRenderFisherScreen();

  // Add upgrades from lootbox to fisher screen
  const equip = document.getElementById('fisher-equip-panel');
  if(!equip) return;

  // Remove old lootbox upgrade section
  const oldSec = document.getElementById('fisher-lootbox-section');
  if(oldSec) oldSec.remove();

  const curRodUpgrades = (gs.rodUpgrades||[]).filter(u=>u.rod===gs.currentRod.id || u.rod===null);
  // Ð¡ÐºÐ¸Ð½Ñ‹ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð² fisher-skin-section (Ð¿Ð°Ñ‚Ñ‡ Ð²Ñ‹ÑˆÐµ) â€” Ñ‚ÑƒÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ

  if(curRodUpgrades.length === 0) {
    const sec = document.createElement('div');
    sec.id = 'fisher-lootbox-section';
    sec.className = 'fisher-equip-section';
    sec.style.marginTop = '8px';
    sec.innerHTML = `<div class="fisher-equip-section-title">âš¡ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸</div><div style="font-family:Neucha,cursive;font-size:11px;color:rgba(150,200,100,.4);padding:10px 14px;">ÐÐµÑ‚ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹. ÐžÑ‚ÐºÑ€Ð¾Ð¹ ðŸŽ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑÑ‹ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ!</div>`;
    equip.appendChild(sec);
    return;
  }

  const sec = document.createElement('div');
  sec.id = 'fisher-lootbox-section';
  sec.className = 'fisher-equip-section';
  sec.style.marginTop = '8px';
  sec.innerHTML = `<div class="fisher-equip-section-title">âš¡ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ¸</div>`;

  const grid = document.createElement('div');
  grid.style.cssText = 'display:flex;flex-wrap:wrap;gap:6px;padding:10px 14px;';

  curRodUpgrades.forEach(u => {
    const isEquipped = gs.equippedUpgrades && gs.equippedUpgrades[gs.currentRod.id] === u.id;
    const rarColors3 = {common:'rgba(60,140,30,.4)',rare:'#4090f0',epic:'#c040ff',legend:'#f0c030',og:'#ff4060'};
    const borderCol = isEquipped ? '#a0e040' : rarColors3[u.rarity] || 'rgba(60,140,30,.4)';
    const chip = document.createElement('div');
    chip.onclick = () => equipRodUpgrade(u.id);
    chip.style.cssText = `display:flex;align-items:center;gap:5px;background:rgba(10,30,15,.8);border:2px solid ${borderCol};border-radius:20px;padding:5px 10px;cursor:pointer;font-family:Neucha,cursive;font-size:10px;color:#a0d060;${isEquipped ? 'box-shadow:0 0 8px rgba(80,200,40,.4);' : ''}`;
    chip.innerHTML = `<span style="font-size:14px;">${u.icon}</span>${u.name}${isEquipped ? ' âœ…' : ''}`;
    grid.appendChild(chip);
  });

  sec.appendChild(grid);
  equip.appendChild(sec);
};

function equipRodUpgrade(id) {
  const rodId = gs.currentRod.id;
  if(gs.equippedUpgrades[rodId] === id) {
    delete gs.equippedUpgrades[rodId];
    showToast('â¬‡ï¸ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ ÑÐ½ÑÑ‚Ð¾!');
  } else {
    gs.equippedUpgrades[rodId] = id;
    showToast('â¬†ï¸ Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ð½Ð°Ð´ÐµÑ‚Ð¾!');
  }
  saveGame();
  if(typeof renderFisherScreen === 'function') renderFisherScreen();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ðŸ›’ Ð”ÐžÐ‘ÐÐ’Ð˜Ð¢Ð¬ Ð’ÐšÐ›ÐÐ”ÐšÐ˜ Ð’ ÐœÐÐ“ÐÐ—Ð˜Ð
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.getElementById('shop-tabs');
  if(tabs) {
    const lb = document.createElement('div');
    lb.className = 'shop-tab';
    lb.onclick = function(){ switchShopTab('lootbox', this); };
    lb.textContent = 'ðŸŽ Ð›ÑƒÑ‚Ð±Ð¾ÐºÑÑ‹';
    tabs.appendChild(lb);

    const pr = document.createElement('div');
    pr.className = 'shop-tab';
    pr.onclick = function(){ switchShopTab('promo', this); };
    pr.textContent = 'ðŸŽŸï¸ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´';
    tabs.appendChild(pr);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH SAVE/LOAD for new data
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _origSaveGame = saveGame;
window.saveGame = function() {
  _origSaveGame();
  try {
    const extra2 = {
      lootboxes: gs.lootboxes || {},
      rodUpgrades: gs.rodUpgrades || [],
      rodSkins: gs.rodSkins || [],
      equippedUpgrades: gs.equippedUpgrades || {},
      equippedSkins: gs.equippedSkins || {},      // â† Ð¡ÐšÐ˜ÐÐ«
      usedPromos: gs.usedPromos || {},
      _eventStarted: gs._eventStarted || false,
      _hugiwugiGiven: gs._hugiwugiGiven || false,
      _bakintsaGiven: gs._bakintsaGiven || false,
      _eventEnded: gs._eventEnded || false,
    };
    localStorage.setItem('fishing_reborn_extra2', JSON.stringify(extra2));
  } catch(e) {}
};

// Load new data
try {
  const raw2 = localStorage.getItem('fishing_reborn_extra2');
  if(raw2) {
    const ex2 = JSON.parse(raw2);
    gs.lootboxes = ex2.lootboxes || {};
    gs.rodUpgrades = ex2.rodUpgrades || [];
    gs.rodSkins = ex2.rodSkins || [];
    gs.equippedUpgrades = ex2.equippedUpgrades || {};
    gs.equippedSkins = ex2.equippedSkins || {};    // â† Ð¡ÐšÐ˜ÐÐ«
    gs.usedPromos = ex2.usedPromos || {};
    gs._eventStarted = ex2._eventStarted || false;
    gs._hugiwugiGiven = ex2._hugiwugiGiven || false;
    gs._bakintsaGiven = ex2._bakintsaGiven || false;
    gs._eventEnded = ex2._eventEnded || false;
  }
} catch(e) {}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSS ANIMATIONS for new features (inject into style)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const newStyles = document.createElement('style');
newStyles.textContent = `
@keyframes discoBallSpin { 0%{transform:translateX(-50%) rotate(0deg);filter:drop-shadow(0 0 20px #ff80ff);} 50%{filter:drop-shadow(0 0 30px #80ffff);} 100%{transform:translateX(-50%) rotate(360deg);filter:drop-shadow(0 0 20px #ff80ff);} }
@keyframes discoFlash { 0%{opacity:.15} 50%{opacity:.25} 100%{opacity:0} }
@keyframes adminPopIn { 0%{transform:translate(-50%,-50%) scale(0)} 100%{transform:translate(-50%,-50%) scale(1)} }
@keyframes lootboxShake { 0%,100%{transform:rotate(-3deg)} 50%{transform:rotate(3deg)} }

/* â•â•â• BLACKHOLE ROD â•â•â• */
@keyframes bhPulse { 0%{opacity:.6;transform:scale(.9)} 100%{opacity:1;transform:scale(1.1)} }
@keyframes bhDiscSpin { 0%{transform-origin:10px -18px;transform:rotateX(70deg) rotate(0deg)} 100%{transform-origin:10px -18px;transform:rotateX(70deg) rotate(360deg)} }
@keyframes bhParticle1 { 0%{transform:translate(0,0);opacity:.8} 100%{transform:translate(8px,-8px);opacity:0} }
@keyframes bhParticle2 { 0%{transform:translate(0,0);opacity:.7} 100%{transform:translate(-8px,-6px);opacity:0} }
@keyframes bhParticle3 { 0%{transform:translate(0,0);opacity:.6} 100%{transform:translate(5px,-10px);opacity:0} }
@keyframes bhJet { 0%{opacity:.3;stroke-width:1} 100%{opacity:.8;stroke-width:3} }
@keyframes bhOrbit { 0%{transform-origin:10px 0;transform:rotate(0deg) translateX(2px)} 100%{transform-origin:10px 0;transform:rotate(360deg) translateX(2px)} }
@keyframes blackholeRipple { 0%{opacity:.1;rx:8} 100%{opacity:.4;rx:18} }

/* â•â•â• RAINBOW ROD â•â•â• */
@keyframes rainbowShift { 0%{filter:hue-rotate(0deg)} 100%{filter:hue-rotate(360deg)} }
@keyframes rainbowShift2 { 0%{filter:hue-rotate(180deg)} 100%{filter:hue-rotate(540deg)} }
@keyframes scaleGlint { 0%{opacity:.3;transform:scale(.8)} 100%{opacity:.9;transform:scale(1.2)} }
@keyframes fishSwim1 { 0%{transform:scaleX(1) translateX(-2px)} 100%{transform:scaleX(-1) translateX(2px)} }
@keyframes fishSwim2 { 0%{transform:scaleX(-1) translateX(2px)} 100%{transform:scaleX(1) translateX(-2px)} }

/* â•â•â• MAGNET ROD â•â•â• */
@keyframes coinMagnet1 { 0%{transform:translate(0,0);opacity:.8} 50%{transform:translate(5px,5px);opacity:1} 100%{transform:translate(0,0);opacity:.8} }
@keyframes coinMagnet2 { 0%{transform:translate(0,0)} 50%{transform:translate(-6px,4px)} 100%{transform:translate(0,0)} }
@keyframes coinMagnet3 { 0%{transform:translate(0,0);opacity:.6} 50%{transform:translate(4px,6px);opacity:1} 100%{transform:translate(0,0);opacity:.6} }
@keyframes mechPulse { 0%{filter:brightness(1)} 50%{filter:brightness(1.4)} 100%{filter:brightness(1)} }

/* â•â•â• LASER ROD â•â•â• */
@keyframes laserPulse { 0%{opacity:.5;filter:brightness(.8)} 100%{opacity:1;filter:brightness(1.5)} }
@keyframes laserBeamFlicker { 0%{opacity:1;stroke-width:3} 100%{opacity:.4;stroke-width:1} }
@keyframes laserCharge { 0%{fill:#ff0040;r:2} 100%{fill:#ff8080;r:3.5} }
@keyframes laserRing { 0%{opacity:.5;stroke-width:1.5} 100%{opacity:1;stroke-width:3} }

/* â•â•â• HUGIWUGI ROD â•â•â• */
@keyframes snowFlake1 { 0%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(-5px) rotate(180deg)} 100%{transform:translateY(0) rotate(360deg)} }
@keyframes snowFlake2 { 0%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(5px) rotate(-180deg)} 100%{transform:translateY(0) rotate(-360deg)} }

/* â•â•â• BAKINTSA ROD â•â•â• */
@keyframes bkuFlame { 0%{transform:scaleX(.8) scaleY(.9)} 100%{transform:scaleX(1.2) scaleY(1.1)} }

#lootbox-overlay {
  display:none; position:fixed; inset:0; z-index:99999; background:rgba(0,0,0,.88);
  align-items:center; justify-content:center; flex-direction:column;
  padding:20px; box-sizing:border-box;
}
#lootbox-overlay.show { display:flex; }
#lb-result-card {
  background:linear-gradient(135deg,#1a0a30,#2a1060);
  border:3px solid #c040ff; border-radius:20px; padding:24px 20px; text-align:center;
  width:90%; max-width:320px; box-shadow:0 0 60px rgba(200,50,255,.5);
  animation:adminPopIn .5s cubic-bezier(.34,1.56,.64,1) forwards;
  position:relative; z-index:100000;
}
`;
document.head.appendChild(newStyles);


</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ðŸŒ… ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ¯Ð¯ ÐžÐ‘ÐÐžÐ’Ð â€” ÐŸÐ ÐžÐ©ÐÐ›Ð¬ÐÐÐ¯ Ð¡Ð¦Ð•ÐÐ
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>
/* Farewell overlay â€” full screen */
#farewell-overlay {
  position:absolute; inset:0; z-index:99999;
  background:#000; display:flex; align-items:center; justify-content:center;
  flex-direction:column; overflow:hidden;
  animation:farewellFadeIn 1.2s ease forwards;
}
@keyframes farewellFadeIn { from{opacity:0} to{opacity:1} }

/* === SKY CANVAS === */
#fw-sky {
  position:absolute; inset:0;
  background: linear-gradient(to bottom, #1a0520 0%, #3d1a00 35%, #c86820 65%, #ffa040 80%, #ffcc80 100%);
  transition: background 4s;
}

/* Sun at horizon */
#fw-sun {
  position:absolute; bottom:38%; left:50%; transform:translateX(-50%);
  width:60px; height:60px;
  background:radial-gradient(circle at 40% 40%, #fff5a0, #ffcc30, #ff8820);
  border-radius:50%;
  box-shadow:0 0 60px 30px rgba(255,160,30,.5), 0 0 120px 60px rgba(255,100,0,.2);
  animation:fwSunPulse 4s ease-in-out infinite alternate;
  opacity:0; transition:opacity 3s;
}
@keyframes fwSunPulse{0%{box-shadow:0 0 50px 25px rgba(255,160,30,.4)}100%{box-shadow:0 0 80px 40px rgba(255,200,50,.7)}}

/* Clouds */
.fw-cloud {
  position:absolute; border-radius:50%; filter:blur(8px);
  background:rgba(255,200,160,.18);
  animation:fwCloudDrift var(--cd,40s) linear infinite;
  animation-delay:var(--cdelay,0s);
}
@keyframes fwCloudDrift {0%{transform:translateX(-120px)}100%{transform:translateX(500px)}}

/* Ground */
#fw-ground {
  position:absolute; bottom:0; left:0; right:0; height:38%;
  background:linear-gradient(to bottom, #1a2f0a 0%, #0e1a06 100%);
  border-top:3px solid #2a4010;
}
/* Water/river */
#fw-water {
  position:absolute; bottom:38%; left:0; right:0; height:12%;
  background:linear-gradient(to bottom, rgba(60,120,200,.7), rgba(20,60,120,.5));
  border-top:1px solid rgba(100,200,255,.3);
}
.fw-water-line {
  position:absolute; left:0; right:0; height:2px;
  background:rgba(150,220,255,.2);
  animation:fwWaterMove 3s linear infinite;
}
@keyframes fwWaterMove{0%{transform:translateX(0)}100%{transform:translateX(-40px)}}

/* === FISH CHARACTER === */
#fw-fish {
  position:absolute; font-size:52px;
  bottom: -80px; left: 35%;
  filter:drop-shadow(0 4px 12px rgba(0,100,200,.6));
  animation:fwFishRise 2s cubic-bezier(.34,1.56,.64,1) forwards;
  animation-delay:0.5s;
  z-index:10;
}
@keyframes fwFishRise {
  0%  { bottom:-80px; transform:rotate(0deg); }
  60% { bottom:32%; transform:rotate(-15deg); }
  80% { bottom:29%; transform:rotate(5deg); }
  100%{ bottom:30%; transform:rotate(0deg); }
}

/* Fish tears */
.fw-tear {
  position:absolute; width:5px; height:8px;
  background:radial-gradient(ellipse at 50% 30%, rgba(100,200,255,.9), rgba(60,140,220,.7));
  border-radius:50% 50% 60% 60%;
  top:42px; left:calc(50% - 8px);
  animation:fwTearFall var(--td,1.2s) ease-in infinite;
  animation-delay:var(--tdelay,0s);
  opacity:0;
}
@keyframes fwTearFall {
  0%  {opacity:0; transform:translateY(0) scaleX(1);}
  10% {opacity:1;}
  80% {opacity:.8;}
  100%{opacity:0; transform:translateY(30px) scaleX(.7);}
}

/* === PLAYER CHARACTER (Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÐº) === */
#fw-player {
  position:absolute; bottom:30%;
  left:-80px; /* starts off screen */
  z-index:11;
  animation:fwPlayerWalk 2.5s ease-out forwards;
  animation-delay:2.8s;
  display:flex; flex-direction:column; align-items:center; gap:2px;
}
@keyframes fwPlayerWalk {
  0%  { left:-80px; }
  100%{ left:48%; }
}

/* Player body (emoji + nick) */
#fw-player-body { font-size:38px; position:relative; }
#fw-player-nick {
  position:absolute; top:-26px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,.65); border:1px solid #c0a040;
  border-radius:8px; padding:1px 7px;
  font-family:'Neucha',cursive; font-size:11px; color:#f0d060;
  white-space:nowrap;
}

/* Player walk legs */
.fw-walk-leg {
  font-size:16px; animation:fwLegWalk .4s linear infinite alternate;
}
@keyframes fwLegWalk{0%{transform:rotate(-20deg)}100%{transform:rotate(20deg)}}

/* === HUG === */
#fw-hug-zone {
  position:absolute; bottom:30%; left:35%;
  z-index:12; display:none;
  animation:fwHugPop .5s cubic-bezier(.34,1.56,.64,1) forwards;
}
@keyframes fwHugPop{0%{transform:scale(0)}100%{transform:scale(1)}}

/* Hearts burst */
.fw-heart {
  position:absolute; font-size:18px;
  animation:fwHeartFly var(--hd,1.8s) ease-out forwards infinite;
  animation-delay:var(--hdelay,0s);
  opacity:0;
}
@keyframes fwHeartFly{
  0%{opacity:0; transform:translate(0,0) scale(.5);}
  20%{opacity:1;}
  100%{opacity:0; transform:translate(var(--hx,0px),var(--hy,-60px)) scale(1.3);}
}

/* === DIALOGUE BUBBLES === */
.fw-bubble {
  position:absolute; z-index:20;
  background:rgba(10,6,2,.88); border:2px solid #c0a040;
  border-radius:14px; padding:8px 14px;
  font-family:'Neucha',cursive; font-size:14px; color:#f0e0b0;
  max-width:170px; text-align:center;
  box-shadow:0 4px 20px rgba(0,0,0,.7);
  opacity:0; transform:scale(0); transform-origin:bottom center;
  transition:opacity .4s, transform .4s cubic-bezier(.34,1.56,.64,1);
  line-height:1.4;
}
.fw-bubble.show { opacity:1; transform:scale(1); }
.fw-bubble::after {
  content:''; position:absolute; bottom:-10px; left:30px;
  border:5px solid transparent; border-top-color:#c0a040;
}
.fw-bubble.right::after { left:auto; right:30px; }

/* === FADE TO BLACK === */
#fw-darkness {
  position:absolute; inset:0; background:#000; opacity:0; z-index:30;
  transition:opacity 3s ease;
  pointer-events:none;
}
#fw-darkness.darken { opacity:1; }

/* === ROSE === */
#fw-rose-screen {
  position:absolute; inset:0; z-index:35; background:#000;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  opacity:0; transition:opacity 2s;
  pointer-events:none;
}
#fw-rose-screen.show { opacity:1; pointer-events:auto; }

#fw-rose {
  font-size:90px;
  animation:fwRosePulse 3s ease-in-out infinite alternate;
  filter:drop-shadow(0 0 30px rgba(200,20,50,.8));
}
@keyframes fwRosePulse{0%{filter:drop-shadow(0 0 20px rgba(200,20,50,.4))}100%{filter:drop-shadow(0 0 50px rgba(255,50,80,.9))}}

/* Slides system - replaces eol-text */
#fw-eol-text { display:none; }
#fw-eol-line  { display:none; }

#fw-slides {
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  padding:20px 24px 110px;
  opacity:0; transition:opacity 1.5s;
  pointer-events:none;
  z-index:36;
}
#fw-slides.show { opacity:1; pointer-events:auto; }

.fw-slide {
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  padding:30px 28px 120px;
  opacity:0; transition:opacity 0.9s ease;
  pointer-events:none;
}
.fw-slide.active { opacity:1; }

.fw-slide-icon {
  font-size:76px; margin-bottom:20px;
  filter:drop-shadow(0 0 22px rgba(255,150,50,.5));
  animation:fwSlideIconPulse 3s ease-in-out infinite alternate;
}
@keyframes fwSlideIconPulse{0%{transform:scale(1) rotate(-2deg)}100%{transform:scale(1.1) rotate(2deg)}}

.fw-slide-title {
  font-family:'UnifrakturMaguntia',cursive;
  font-size:22px; color:#f0d060;
  text-shadow:0 0 16px rgba(240,180,50,.7);
  text-align:center; margin-bottom:14px; line-height:1.3;
}
.fw-slide-body {
  font-family:'Neucha',cursive;
  font-size:15px; color:#c0a880;
  text-align:center; line-height:1.9; max-width:280px;
}

/* dot indicators */
#fw-slide-dots {
  position:absolute; bottom:88px; left:50%; transform:translateX(-50%);
  display:flex; gap:9px; z-index:37;
  opacity:0; transition:opacity 1s;
}
#fw-slide-dots.show { opacity:1; }
.fw-dot {
  width:9px; height:9px; border-radius:50%;
  background:rgba(200,160,60,.25); border:1px solid #806030;
  transition:background .4s, transform .4s;
}
.fw-dot.active { background:#f0d060; transform:scale(1.5); box-shadow:0 0 8px rgba(240,180,50,.7); }

#fw-press-f {
  font-family:'UnifrakturMaguntia',cursive; font-size:28px;
  color:#f0d060; margin-top:18px;
  text-shadow:0 0 20px rgba(255,200,50,.8);
  animation:fwFBlink 1.5s ease-in-out infinite;
  opacity:0; transition:opacity 1s;
  cursor:pointer;
}
#fw-press-f.show { opacity:1; }
@keyframes fwFBlink{0%,100%{opacity:1}50%{opacity:.3}}

/* === MEMORIAL STATS SCREEN === */
#fw-memorial {
  position:absolute; inset:0; z-index:40; background:#000;
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  padding:30px 20px 20px; overflow-y:auto;
  opacity:0; transition:opacity 1.5s;
}
#fw-memorial.show { opacity:1; }

.fw-mem-title {
  font-family:'UnifrakturMaguntia',cursive; font-size:26px; color:#d4a030;
  text-shadow:0 0 16px rgba(200,150,30,.7); margin-bottom:6px; text-align:center;
}
.fw-mem-sub {
  font-family:'Neucha',cursive; font-size:12px; color:#806040; margin-bottom:24px; text-align:center;
}

.fw-stat-card {
  width:100%; max-width:300px; background:linear-gradient(135deg,rgba(20,10,4,.95),rgba(40,20,8,.9));
  border:2px solid #604020; border-radius:14px; padding:14px 18px; margin-bottom:12px;
  font-family:'Neucha',cursive; text-align:center;
  transform:translateY(40px); opacity:0; transition:all .6s ease;
}
.fw-stat-card.appear { transform:translateY(0); opacity:1; }
.fw-stat-card .fw-stat-icon { font-size:36px; margin-bottom:4px; }
.fw-stat-card .fw-stat-label { font-size:11px; color:#806040; margin-bottom:2px; }
.fw-stat-card .fw-stat-value { font-size:28px; color:#f0d060; font-weight:bold; text-shadow:0 0 10px rgba(240,180,60,.5); }

.fw-rod-card {
  width:100%; max-width:300px; background:linear-gradient(135deg,rgba(30,15,5,.95),rgba(60,30,10,.9));
  border:2px solid #a07020; border-radius:14px; padding:14px 18px; margin-bottom:12px;
  font-family:'Neucha',cursive; text-align:center;
  transform:translateY(40px); opacity:0; transition:all .6s ease;
}
.fw-rod-card.appear { transform:translateY(0); opacity:1; }
.fw-rod-card .fw-rod-icon { font-size:44px; margin-bottom:4px; }
.fw-rod-card .fw-rod-name { font-size:16px; color:#f0d060; margin-bottom:2px; }
.fw-rod-card .fw-rod-label { font-size:11px; color:#a08040; }

#fw-offline-notice {
  width:100%; max-width:300px; background:rgba(20,5,5,.95); border:2px solid #801010;
  border-radius:14px; padding:14px 18px; text-align:center; font-family:'Neucha',cursive;
  transform:translateY(40px); opacity:0; transition:all .6s ease;
  margin-top:8px;
}
#fw-offline-notice.appear { transform:translateY(0); opacity:1; }
#fw-offline-notice .fw-off-title { font-size:16px; color:#ff6060; margin-bottom:6px; }
#fw-offline-notice .fw-off-sub { font-size:12px; color:#a04040; line-height:1.5; }
</style>

<!-- UPDATE CUTSCENE -->
<div id="update-cutscene" style="
  position:fixed;inset:0;z-index:99999;
  background:linear-gradient(135deg,#000a1a,#00050f);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  overflow:hidden;
">
  <div id="cs-marbles" style="position:absolute;inset:0;pointer-events:none;"></div>
  <div style="position:absolute;inset:0;pointer-events:none;overflow:hidden;">
    <div style="position:absolute;top:30%;left:0;right:0;height:2px;background:linear-gradient(to right,transparent,rgba(0,200,255,.5),transparent);animation:csGlitch 0.8s ease-in-out infinite alternate;"></div>
    <div style="position:absolute;top:65%;left:0;right:0;height:1px;background:linear-gradient(to right,transparent,rgba(255,80,200,.4),transparent);animation:csGlitch 1.2s ease-in-out infinite alternate-reverse;"></div>
  </div>
  <div id="cs-text1" style="font-family:'UnifrakturMaguntia',cursive;font-size:36px;color:#00e8ff;text-shadow:0 0 30px #00e8ff,0 0 60px rgba(0,200,255,.5);text-align:center;padding:0 20px;opacity:0;transform:scale(0.5);transition:opacity 0.8s,transform 0.8s cubic-bezier(.34,1.56,.64,1);z-index:2;">ÐÐµÐ¾Ð¶Ð¸Ð´Ð°Ð»?</div>
  <div id="cs-text2" style="font-family:'Neucha',cursive;font-size:16px;color:#a0f0ff;margin-top:16px;text-align:center;padding:0 30px;opacity:0;transform:translateY(20px);transition:opacity 0.6s,transform 0.6s ease;z-index:2;line-height:1.6;">ÐÐ¾ Ñ‚ÑƒÑ‚ Ñ ÑÐ´ÐµÐ»Ð°Ð» Ð¾Ð±Ð½Ð¾Ð²Ñƒ ðŸŽ£<br><span style="font-size:12px;color:#608090;">ÐœÑ€Ð°Ð¼Ð¾Ñ€Ð½Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ° â€¢ Ð‘Ð¾Ð»ÑŒÑˆÐµ Ñ€Ñ‹Ð± â€¢ ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸ â€¢ Ð‘Ð°Ð³Ð¸ Ð¿Ð¾Ñ‡Ð¸Ð½ÐµÐ½Ñ‹!</span></div>
  <div id="cs-marbles-text" style="font-size:48px;margin-top:24px;opacity:0;transition:opacity 0.5s;z-index:2;animation:csMarblesFloat 2s ease-in-out infinite alternate;">ðŸª¨âœ¨ðŸŽ£</div>
  <button id="cs-skip-btn" style="position:absolute;bottom:40px;font-family:'UnifrakturMaguntia',cursive;font-size:18px;background:linear-gradient(135deg,#004060,#00a0c0);border:2px solid #00e0ff;border-radius:16px;padding:12px 40px;color:#80ffff;cursor:pointer;box-shadow:0 0 20px rgba(0,200,255,.4);opacity:0;transition:opacity 0.5s;z-index:2;">ðŸŽ£ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ€Ñ‹Ð±Ð°Ð»ÐºÑƒ!</button>
</div>
<style>
@keyframes csGlitch{0%{opacity:.3;transform:scaleX(.8)}100%{opacity:.9;transform:scaleX(1.1)}}
@keyframes csMarblesFloat{0%{transform:translateY(0) rotate(-5deg)}100%{transform:translateY(-12px) rotate(5deg)}}
@keyframes marbleDrop{0%{transform:translateY(-100px) rotate(0deg);opacity:0}20%{opacity:1}80%{opacity:.8}100%{transform:translateY(800px) rotate(720deg);opacity:0}}
/* Fish catch animation */
@keyframes fishBlink{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes finWave{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(15deg)}}
@keyframes fishWiggle{0%,100%{transform:rotate(-3deg) scaleX(1)}25%{transform:rotate(3deg) scaleX(1.05)}50%{transform:rotate(-2deg) scaleX(.98)}75%{transform:rotate(4deg) scaleX(1.03)}}
@keyframes marbleSplashAnim{0%{transform:scale(1) translateY(0);opacity:1}100%{transform:scale(0.2) translateY(-40px);opacity:0}}
</style>
<script>
(function(){
  function skipCS(){
    var cs=document.getElementById('update-cutscene');
    if(!cs||cs._closing) return;
    cs._closing=true;
    cs.style.transition='opacity 0.6s';
    cs.style.opacity='0';
    setTimeout(function(){ if(cs.parentNode) cs.parentNode.removeChild(cs); },700);
  }
  window.skipUpdateCutscene=skipCS;

  var mc=document.getElementById('cs-marbles');
  for(var i=0;i<18;i++){
    var b=document.createElement('div');
    var sz=10+Math.random()*25;
    var hue=Math.floor(Math.random()*60+160);
    b.style.cssText='position:absolute;width:'+sz+'px;height:'+sz+'px;border-radius:50%;background:radial-gradient(circle at 35% 30%,rgba(255,255,255,.8),hsl('+hue+',60%,50%),hsl('+hue+',40%,25%));box-shadow:inset -3px -3px 6px rgba(0,0,0,.4),0 0 '+(sz*.5)+'px rgba(0,200,255,.3);left:'+(Math.random()*95)+'%;top:'+(Math.random()*-50-10)+'px;animation:marbleDrop '+(2+Math.random()*3)+'s '+(Math.random()*2)+'s ease-in forwards;';
    if(mc) mc.appendChild(b);
  }

  var btn=document.getElementById('cs-skip-btn');
  if(btn){
    btn.addEventListener('click', skipCS);
    btn.addEventListener('touchend', function(e){ e.preventDefault(); skipCS(); });
  }

  setTimeout(function(){ var t=document.getElementById('cs-text1'); if(t){t.style.opacity='1';t.style.transform='scale(1)';} },400);
  setTimeout(function(){ var t=document.getElementById('cs-text2'); if(t){t.style.opacity='1';t.style.transform='translateY(0)';} },1100);
  setTimeout(function(){ var t=document.getElementById('cs-marbles-text'); if(t) t.style.opacity='1'; },1800);
  setTimeout(function(){ if(btn) btn.style.opacity='1'; },2200);
  setTimeout(skipCS, 6000);
})();
</script>

<!-- FAREWELL HTML -->
<div id="farewell-overlay">
  <!-- Background sky / sunset -->
  <div id="fw-sky">
    <div class="fw-cloud" style="width:120px;height:45px;top:20%;left:10%;--cd:38s;--cdelay:-10s;"></div>
    <div class="fw-cloud" style="width:80px;height:30px;top:35%;left:50%;--cd:52s;--cdelay:-25s;"></div>
    <div class="fw-cloud" style="width:150px;height:50px;top:15%;left:60%;--cd:45s;--cdelay:-8s;"></div>
  </div>
  <div id="fw-sun"></div>

  <!-- Water reflection strip -->
  <div id="fw-water">
    <div class="fw-water-line" style="top:20%;animation-delay:0s;"></div>
    <div class="fw-water-line" style="top:50%;animation-delay:.7s;"></div>
    <div class="fw-water-line" style="top:75%;animation-delay:1.4s;"></div>
  </div>

  <!-- Ground -->
  <div id="fw-ground"></div>

  <!-- Fish character -->
  <div id="fw-fish">ðŸŸ</div>

  <!-- Tears on fish -->
  <div id="fw-fish-tears" style="position:absolute;bottom:calc(30% + 36px);left:calc(35% + 18px);z-index:11;display:none;">
    <div class="fw-tear" style="--td:1.3s;--tdelay:0s;left:0px;"></div>
    <div class="fw-tear" style="--td:1.5s;--tdelay:.4s;left:10px;"></div>
    <div class="fw-tear" style="--td:1.2s;--tdelay:.8s;left:-6px;"></div>
  </div>

  <!-- Player walking character -->
  <div id="fw-player">
    <div id="fw-player-body">ðŸ§‘
      <div id="fw-player-nick" id="fw-nick-label">Ð Ñ‹Ð±Ð°Ðº</div>
    </div>
  </div>

  <!-- Hug zone (replaces both chars) -->
  <div id="fw-hug-zone">
    <span style="font-size:52px;">ðŸ¤—ðŸŸ</span>
    <!-- Hearts -->
    <div class="fw-heart" style="left:10px;top:-10px;--hd:2s;--hdelay:0s;--hx:-15px;--hy:-55px;">ðŸ’™</div>
    <div class="fw-heart" style="left:40px;top:-5px;--hd:1.8s;--hdelay:.3s;--hx:10px;--hy:-65px;">ðŸ’œ</div>
    <div class="fw-heart" style="left:70px;top:-12px;--hd:2.2s;--hdelay:.6s;--hx:20px;--hy:-50px;">ðŸ’™</div>
    <div class="fw-heart" style="left:25px;top:-20px;--hd:1.6s;--hdelay:.9s;--hx:-5px;--hy:-70px;">â¤ï¸</div>
  </div>

  <!-- Dialogue: Fish speaks -->
  <div class="fw-bubble" id="fw-bubble-fish" style="bottom:calc(30% + 105px); left:15%;">
    ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ...
  </div>

  <!-- Dialogue: Player responds -->
  <div class="fw-bubble right" id="fw-bubble-player" style="bottom:calc(30% + 115px); right:8%;">
    Ð¯ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ...<br>ÐŸÑ€Ð¾ÑÑ‚Ð¸ ðŸ™
  </div>

  <!-- Fade darkness -->
  <div id="fw-darkness"></div>

  <!-- Rose / end of service screen -->
  <div id="fw-rose-screen">
    <!-- Slides container -->
    <div id="fw-slides"></div>
    <!-- Dot indicators -->
    <div id="fw-slide-dots"></div>
    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð˜Ð“Ð ÐÐ¢Ð¬ -->
    <div id="fw-play-btn" style="
        position:absolute; bottom:22px; left:50%; transform:translateX(-50%);
        z-index:38; cursor:pointer; user-select:none;
        background:linear-gradient(135deg,#1a4a08,#2e7a10);
        border:2px solid #5aaa20; border-radius:20px;
        padding:18px 48px; text-align:center;
        font-family:'UnifrakturMaguntia',cursive; font-size:26px; color:#a0e040;
        box-shadow:0 0 24px rgba(60,180,20,.4);
        opacity:0; transition:opacity 1s;
        -webkit-tap-highlight-color:transparent;
        white-space:nowrap; touch-action:manipulation;
      ">
      ðŸŽ£ Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ
    </div>
  </div>

  <!-- Memorial stats screen -->
  <div id="fw-memorial">
    <div class="fw-mem-title">ðŸŽ£ Ð¢Ð²Ð¾Ñ Ð Ñ‹Ð±Ð°Ð»ÐºÐ°</div>
    <div class="fw-mem-sub">Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð·Ð°Ð±Ñ€Ð¾Ñ...</div>

    <div class="fw-stat-card" id="fwc-fish">
      <div class="fw-stat-icon">ðŸŸ</div>
      <div class="fw-stat-label">Ð Ñ‹Ð± Ð¿Ð¾Ð¹Ð¼Ð°Ð½Ð¾</div>
      <div class="fw-stat-value" id="fwv-fish">0</div>
    </div>

    <div class="fw-stat-card" id="fwc-coins">
      <div class="fw-stat-icon">ðŸª™</div>
      <div class="fw-stat-label">ÐœÐ¾Ð½ÐµÑ‚ ÑÐ¾Ð±Ñ€Ð°Ð½Ð¾</div>
      <div class="fw-stat-value" id="fwv-coins">0</div>
    </div>

    <div class="fw-stat-card" id="fwc-score">
      <div class="fw-stat-icon">â­</div>
      <div class="fw-stat-label">ÐžÑ‡ÐºÐ¾Ð² Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾</div>
      <div class="fw-stat-value" id="fwv-score">0</div>
    </div>

    <div class="fw-stat-card" id="fwc-poke">
      <div class="fw-stat-icon">âš¡</div>
      <div class="fw-stat-label">ÐŸÐ¾ÐºÐµÐ¼Ð¾Ð½Ð¾Ð² Ð¿Ð¾Ð¹Ð¼Ð°Ð½Ð¾</div>
      <div class="fw-stat-value" id="fwv-poke">0</div>
    </div>

    <div class="fw-rod-card" id="fwc-rod">
      <div class="fw-rod-icon" id="fwv-rod-icon">ðŸŽ£</div>
      <div class="fw-rod-name" id="fwv-rod-name">Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ</div>
      <div class="fw-rod-label">Ð›ÑŽÐ±Ð¸Ð¼Ð°Ñ ÑƒÐ´Ð¾Ñ‡ÐºÐ°</div>
    </div>

    <div id="fw-offline-notice">
      <div class="fw-off-title">ðŸŒ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð˜Ð³Ñ€Ñ‹ Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ!</div>
      <div class="fw-off-sub">
        Ð’ÑÐµ Ð¾Ð½Ð»Ð°Ð¹Ð½ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹!<br>
        Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³, Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡Ð°Ñ‚, Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐµÑ€ â€” ðŸŸ¢<br><br>
        Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ð·Ð°Ð´! ðŸŽ£<br><br>
        Ð£Ð´Ð°Ñ‡Ð¸ Ð½Ð° Ñ€Ñ‹Ð±Ð°Ð»ÐºÐµ! ðŸŸ
      </div>
    </div>

    <div style="height:40px;"></div>

    <!-- Enter game button -->
    <div id="fw-enter-btn"
      onclick="closeFarewellAndPlay()"
      ontouchend="closeFarewellAndPlay()"
      style="
        width:100%;max-width:300px;
        background:linear-gradient(135deg,#1a3a0a,#2a5010);
        border:2px solid #4a8020; border-radius:16px;
        padding:16px; text-align:center;
        font-family:'Neucha',cursive; font-size:18px; color:#a0e040;
        cursor:pointer; user-select:none;
        opacity:0; transform:scale(.8);
        transition:opacity .6s, transform .6s cubic-bezier(.34,1.56,.64,1);
        box-shadow:0 0 20px rgba(60,160,20,.3);
        -webkit-tap-highlight-color:rgba(80,200,30,.3);
        margin-bottom:30px;
      ">
      ðŸŽ£ Ð’Ð¾Ð¹Ñ‚Ð¸ Ð² Ð¸Ð³Ñ€Ñƒ<br>
      <span style="font-size:12px;color:#60c030;">ðŸŒ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½!</span>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ðŸŒ… FAREWELL ANIMATION CONTROLLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function initFarewell() {
  // Make sure gs is loaded (might not be yet if DOMContentLoaded hasn't fired)
  function getFarewellStats() {
    try {
      const raw = localStorage.getItem('fishing_reborn_v2') || localStorage.getItem('fishing_reborn');
      const extra = localStorage.getItem('fishing_reborn_extra');
      const d = raw ? JSON.parse(raw) : {};
      const ex = extra ? JSON.parse(extra) : {};

      // Current rod icon from RODS array
      let rodIcon = 'ðŸŽ£', rodName = 'Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ';
      if(typeof RODS !== 'undefined' && typeof gs !== 'undefined' && gs.currentRod) {
        rodIcon = gs.currentRod.icon || 'ðŸŽ£';
        rodName = gs.currentRod.name || 'Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ';
      }

      return {
        fishCount:   (typeof gs !== 'undefined' ? gs.fishCount  : 0) || d.fishCount  || 0,
        coins:       (typeof gs !== 'undefined' ? gs.coins       : 0) || d.coins      || 0,
        score:       (typeof gs !== 'undefined' ? gs.score       : 0) || d.score      || 0,
        pikaCount:   (typeof gs !== 'undefined' ? gs.pikaCatchCount : 0) || ex.pikaCatchCount || 0,
        rodIcon, rodName,
        playerName:  (typeof myPlayerName !== 'undefined' ? myPlayerName : '') || 'Ð Ñ‹Ð±Ð°Ðº',
      };
    } catch(e) {
      return { fishCount:0, coins:0, score:0, pikaCount:0, rodIcon:'ðŸŽ£', rodName:'Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ', playerName:'Ð Ñ‹Ð±Ð°Ðº' };
    }
  }

  function delay(ms) { return new Promise(r=>setTimeout(r,ms)); }

  async function runFarewellScene() {
    const stats = getFarewellStats();

    // Set player nick
    const nickEl = document.getElementById('fw-player-nick') || document.querySelector('#fw-player-body [id]');
    if(nickEl) nickEl.textContent = stats.playerName;

    // Sun rise fade in
    await delay(400);
    document.getElementById('fw-sun').style.opacity = '1';

    // Fish tears appear after fish rises (2s animation + 0.5s delay = 2.5s)
    await delay(2600);
    document.getElementById('fw-fish-tears').style.display = 'block';

    // Player walks in (starts at 2.8s delay in CSS, takes 2.5s)
    await delay(3200);

    // Hug â€” hide fish + player, show hug
    await delay(2600); // after player walk finishes
    document.getElementById('fw-fish').style.display = 'none';
    document.getElementById('fw-player').style.display = 'none';
    document.getElementById('fw-fish-tears').style.display = 'none';

    const hugZone = document.getElementById('fw-hug-zone');
    hugZone.style.display = 'block';

    // Fish dialogue: "ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ..."
    await delay(600);
    document.getElementById('fw-bubble-fish').classList.add('show');

    // Player response: "Ð¯ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ... ÐŸÑ€Ð¾ÑÑ‚Ð¸"
    await delay(2200);
    document.getElementById('fw-bubble-player').classList.add('show');

    // Look at sunset together â€” both bubbles stay for a bit
    await delay(3000);

    // Fade to black
    document.getElementById('fw-bubble-fish').classList.remove('show');
    document.getElementById('fw-bubble-player').classList.remove('show');
    await delay(400);

    const darkness = document.getElementById('fw-darkness');
    darkness.style.pointerEvents = 'auto';
    darkness.classList.add('darken');

    await delay(3200);

    // ÐšÐ°Ñ‚ÑÑ†ÐµÐ½Ð° ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð°ÑÑŒ â€” ÑÑ€Ð°Ð·Ñƒ Ð² Ð¸Ð³Ñ€Ñƒ
    closeFarewellAndPlay();
  }

  window.showMemorial = function() {
    // prevent double-fire on mobile (touchend + click)
    if(window._memShown) return;
    window._memShown = true;

    // Fill in stats
    const stats = getFarewellStats();
    document.getElementById('fwv-fish').textContent  = stats.fishCount.toLocaleString('ru');
    document.getElementById('fwv-coins').textContent = stats.coins.toLocaleString('ru');
    document.getElementById('fwv-score').textContent = stats.score.toLocaleString('ru');
    document.getElementById('fwv-poke').textContent  = stats.pikaCount.toLocaleString('ru');
    document.getElementById('fwv-rod-icon').textContent = stats.rodIcon;
    document.getElementById('fwv-rod-name').textContent = stats.rodName;

    // Hide rose, show memorial
    document.getElementById('fw-rose-screen').classList.remove('show');
    const mem = document.getElementById('fw-memorial');
    mem.classList.add('show');

    // Animate cards in one by one
    const cards = mem.querySelectorAll('.fw-stat-card, .fw-rod-card, #fw-offline-notice');
    cards.forEach((c, i) => {
      setTimeout(() => c.classList.add('appear'), 300 + i * 350);
    });

    // Show "Enter game" button after all cards appeared
    const lastDelay = 300 + cards.length * 350 + 500;
    setTimeout(() => {
      const btn = document.getElementById('fw-enter-btn');
      if(btn) { btn.style.opacity='1'; btn.style.transform='scale(1)'; }
    }, lastDelay);

    // Disable multiplayer hint
    setTimeout(() => {
      if(typeof showToast === 'function') showToast('ðŸŒ ÐžÐ½Ð»Ð°Ð¹Ð½ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹! Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ!');
    }, 2200);
  };

  window.closeFarewellAndPlay = function() {
    if(window._farewellClosed) return;
    window._farewellClosed = true;

    // Online is back! Don't kill anything.
    // Try to init Firebase
    if(typeof initFirebase === 'function') { try { initFirebase(); } catch(e){} }

    // Hide overlay with fade
    const ov = document.getElementById('farewell-overlay');
    ov.style.transition = 'opacity 0.8s';
    ov.style.opacity = '0';
    setTimeout(() => {
      ov.style.display = 'none';
      const multiTab = document.getElementById('nav-multi');
      if(multiTab) {
        multiTab.style.opacity = '1';
        multiTab.style.pointerEvents = 'auto';
      }
      if(typeof showToast === 'function') {
        showToast('ðŸŒ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¸Ð³Ñ€Ñ‹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð°! ÐžÐ½Ð»Ð°Ð¹Ð½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚! ðŸŽ£');
      }
    }, 800);
  };

  // Ð’ÐµÑˆÐ°ÐµÐ¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ñ‡ÐµÑ€ÐµÐ· JS â€” ÑÐ°Ð¼Ñ‹Ð¹ Ð½Ð°Ð´Ñ‘Ð¶Ð½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ð´Ð»Ñ Ð¼Ð¾Ð±Ð¸Ð»
  document.addEventListener('DOMContentLoaded', function() {
    // ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ Ð¿Ð¾Ð·Ð¶Ðµ, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð²ÐµÑˆÐ°ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° overlay
    document.getElementById('farewell-overlay').addEventListener('touchstart', function(e) {
      if(e.target.closest('#fw-play-btn')) {
        e.preventDefault();
        e.stopPropagation();
        window.closeFarewellAndPlay();
      }
    }, {passive: false});
    document.getElementById('farewell-overlay').addEventListener('click', function(e) {
      if(e.target.closest('#fw-play-btn')) {
        window.closeFarewellAndPlay();
      }
    });
  });

  // Skip farewell scene â€” go straight to game
  if(document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => setTimeout(closeFarewellAndPlay, 100));
  } else {
    setTimeout(closeFarewellAndPlay, 100);
  }
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â• ðŸŽ Ð›Ð£Ð¢Ð‘ÐžÐšÐ¡ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ â€” Ð²Ð½Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð³Ð¾ fixed â•â•â•â•â•â•â•â•â•â•â• -->
<div id="lootbox-overlay">
  <div id="lb-result-card">
    <div style="font-size:60px;margin-bottom:10px;" id="lb-item-icon">ðŸŽ</div>
    <div style="font-family:UnifrakturMaguntia,cursive;font-size:20px;color:#e080ff;margin-bottom:6px;text-shadow:0 0 12px rgba(200,80,255,.8);">ÐŸÐžÐ›Ð£Ð§Ð•ÐÐž!</div>
    <div style="font-family:UnifrakturMaguntia,cursive;font-size:16px;color:#ffd700;margin-bottom:8px;" id="lb-item-name">ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚</div>
    <div style="font-family:Neucha,cursive;font-size:12px;color:#c0d0ff;margin-bottom:10px;line-height:1.4;" id="lb-item-desc">ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ</div>
    <div style="font-family:Neucha,cursive;font-size:15px;font-weight:bold;margin-bottom:16px;" id="lb-item-rarity">Ð Ð•Ð”ÐšÐžÐ¡Ð¢Ð¬</div>
    <button onclick="document.getElementById('lootbox-overlay').classList.remove('show');document.getElementById('lootbox-overlay').style.display='none';" style="font-family:Neucha,cursive;font-size:16px;background:linear-gradient(135deg,#4a0080,#2a0050);border:2px solid #c040ff;border-radius:12px;color:#e080ff;padding:12px 28px;cursor:pointer;min-width:140px;">âœ¨ ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾!</button>
  </div>
</div>

</body>
</html>
